import{d as b,p as M,q as j,u as F,a as G,s as U,r as E,c as S,o as K,v as H,x as W,b as C,e as _,f as r,w as f,g as l,y as J,z as Q,F as X,h as Y,A as Z,B as ee,t as te,j as y,R as se,C as oe,D as ae,E as ne,m as ie}from"./index-DqZw0EDK.js";import{L as re}from"./index-Bzywb4Nz.js";import{_ as le}from"./search-Cs0epEsK.js";import{_ as ce}from"./ReviewStoreItem.vue_vue_type_script_setup_true_lang-DNVHcV_S.js";import{S as de,G as ue}from"./SortBox-BreH13Fx.js";import{_ as pe}from"./CommonVanProvider.vue_vue_type_script_setup_true_lang-oA-aDWMj.js";import{q as O}from"./guarantee-BZjryzuD.js";import{G as o}from"./guarantee-BhLJfceW.js";import{u as fe}from"./index-BblTMty9.js";import"./member-wzMSw2ZB.js";import"./use-refs-0JYqhbRs.js";import"./CommonPop.vue_vue_type_script_setup_true_lang-Bhjs6e-4.js";import"./index-GfLTIcC5.js";import"./use-placeholder-Bi-uQ-dr.js";import"./BackIcon-C1C-V4Fq.js";/* empty css                                                                 */const me={class:"font-normal bg-gray1"},he={class:"px-3 pt-3 sticky top-[50px] rounded-t-xl z-10 bg-gray1"},ve={class:"flex-1"},ge={class:"px-3 min-h-[66vh] pb-20"},_e={class:"fixed left-0 right-0 m-auto w-full sm:w-[375px] justify-center flex items-center bottom-9 z-50 gap-3 px-3"},ye={class:"text-black whitespace-nowrap"},Re=b({name:"ReviewStore"}),we=b({...Re,setup(Te){const[x,R]=fe(!1),{memberLevels:N}=M(),m=j(),I=F(),{t:n}=G(),e=U({active:1,shopName:"",page:0,size:10,finished:!1,list:{[o.STORE_OPEN]:[],[o.STORE_CLAIM]:[],[o.CROWD_PUBLIC]:[]},loading:!1,total:0,sortType:null,needRequest:!1}),h=E(null),c=E({id:null}),L=async s=>{if(await N()<4)return oe(n("deng-ji-bu-zu"));c.value=s,R(!0)},k={[o.STORE_OPEN]:n("shen-he-kai-dian"),[o.STORE_CLAIM]:n("shen-he-jiu-dian"),[o.STORE_INACTIVE]:n("di-huo-yue-dian")},A={[o.STORE_OPEN]:1,[o.STORE_CLAIM]:0,[o.STORE_INACTIVE]:2},$=S(()=>A[e.active]),V=S(()=>[{name:n("kai-dian-shi-jian"),asc:1,desc:2}]);o.STORE_OPEN+"",n("wo-shen-he-de-dian"),o.STORE_CLAIM+"",n("wo-ren-ling-de-dian"),o.STORE_INACTIVE+"",n("wo-shen-he-de-dian");const q=s=>{e.sortType!==s&&(e.sortType=s,i())},B=()=>{switch(+e.active){case o.STORE_OPEN:u(`/storeRecords?type=${o.OPEN_RECORD}`);break;case o.STORE_CLAIM:u(`/storeRecords?type=${o.CLAIM_RECORD}`);break;case o.STORE_INACTIVE:u(`/storeRecords?type=${o.INACTIVE_RECORD}`);break;default:u(`/storeRecords?type=${e.active}`)}},i=()=>{e.page=0,e.total=0,e.finished=!1,e.loading=!0,e.list=[],w()},w=async()=>{e.loading=!0,e.page+=1,await P(),e.loading=!1},u=s=>{I.push(s)},z=async()=>{var a,p;const s={page:1,size:1,type:e.active+1,shopId:(a=c.value)==null?void 0:a.id},{success:t,data:v}=await O(s);if(!t)return i();const d=v[0]||null;d&&(d.id,(p=c.value)==null||p.id),c.value=d;const g=e.list[e.active].find(D=>{var T;return D.id===((T=c.value)==null?void 0:T.id)});g.guaranteeList=d.guaranteeList},P=async()=>{const s={page:e.page,size:e.size,type:e.active,sortType:e.sortType,shopName:e.shopName},t=await O(s);if(e.loading=!1,!t.success){e.finished=!0;return}if(!t.data||!+t.total){e.finished=!0;return}e.finished=!1,e.total=t.total,e.list[e.active]=e.page===1?t.data:e.list[e.active].concat(t.data),e.list[e.active].length>=e.total&&(e.finished=!0)};return K(()=>{m.query.active&&(e.active=Number(m.query.active)),i()}),H(async()=>{const s=m.query.active;(s&&e.active!==Number(s)||e.needRequest)&&(e.active=Number(s),h.value&&h.value.resetSort(null),e.shopName=null,e.sortType=null,await i(),e.needRequest=!1)}),W(()=>{ae.size>0&&(ne(),e.needRequest=!0)}),(s,t)=>{const v=J,d=re,g=ee;return _(),C("div",me,[r(pe,{title:k[e.active]},{default:f(()=>[l("div",he,[l("div",ve,[r(v,{modelValue:e.shopName,"onUpdate:modelValue":t[0]||(t[0]=a=>e.shopName=a),placeholder:s.$t("qing-shu-ru-sou-suo-dian-pu-ming-cheng"),class:"w-[100% - 20px] text-center iconfont rounded-full",style:{background:"#fff"},clearable:"",onKeyup:Q(i,["enter"])},{"right-icon":f(()=>[l("div",{onClick:i},t[6]||(t[6]=[l("img",{src:le,class:"w-4 h-4"},null,-1)]))]),_:1},8,["modelValue","placeholder"])]),r(de,{ref_key:"sortBoxRef",ref:h,style:{color:"black"},color:"#b7b4b0",activeColor:"#5D5A56",list:V.value,onChange:q},null,8,["list"])]),l("div",ge,[r(d,{loading:e.loading,"onUpdate:loading":t[1]||(t[1]=a=>e.loading=a),finished:e.finished,"finished-text":s.$t("mei-you-geng-duo-le"),"loading-text":s.$t("jia-zai-zhong"),"immediate-check":!1,onLoad:w},{default:f(()=>[(_(!0),C(X,null,Y(e.list[e.active],(a,p)=>(_(),Z(ce,{key:p,shop:a,type:e.active,onHandleTo:u,onOpen:L},null,8,["shop","type"]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])]),l("div",_e,[r(g,{round:"",color:"#FED73A",class:"flex-1 !h-[46px] flex items-center justify-center font-semibold border-none",onClick:t[2]||(t[2]=a=>B())},{default:f(()=>[l("span",ye,te(s.$t("wo-shen-he-de-dian")),1)]),_:1})]),r(ue,{show:y(x),data:c.value,active:e.active,"shop-type":$.value,content:s.$t("shi-fou-que-ren-wei-gai-dian-shen-he"),onClose:t[3]||(t[3]=a=>y(R)(!1)),onInit:t[4]||(t[4]=a=>i()),onSuccess:t[5]||(t[5]=a=>z())},null,8,["show","data","active","shop-type","content"]),r(y(se),{class:"child-view"})]),_:1},8,["title"])])}}}),Pe=ie(we,[["__scopeId","data-v-5d138c21"]]);export{Pe as default};

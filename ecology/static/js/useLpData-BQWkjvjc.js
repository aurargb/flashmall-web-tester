import{bi as se,ap as $,r as S,bj as j,c as P,b6 as J,I as X,au as ue,bk as le,ac as ce,af as fe,ag as de,a3 as ve,ao as ee,a8 as M,an as K}from"./index-D1IDHpEr.js";const me={},ge=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),he=()=>me,I=e=>e,z=e=>Array.isArray(e),Z=e=>e!==null&&typeof e=="object",k=e=>e instanceof Function,D=e=>e==null,q=typeof window>"u",ne=()=>{var e;return q||D((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},pe=()=>{var e,n;return(e=!q&&((n=window.navigator)===null||n===void 0?void 0:n.onLine))!==null&&e!==void 0?e:!0},G=()=>new Promise(()=>{}),x=e=>ue(e)?e.value:e,we=e=>Z(e)?Object.assign(z(e)?[]:{},e):e,W=new Map,Re=e=>D(e)?void 0:W.get(e),Ee=(e,n,t)=>{const a=W.get(e);a!=null&&a.timer&&clearTimeout(a.timer);const o=setTimeout(()=>W.delete(e),n);W.set(e,{...t,timer:o})};function re(e,n,t){let a,o,u,l,r,i,s=0,f=!1,d=!1,T=!0;const v=!n&&n!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");n=+n||0,Z(t)&&(f=!!t.leading,d="maxWait"in t,u=d?Math.max(+t.maxWait||0,n):u,T="trailing"in t?!!t.trailing:T);function w(c){const y=a,C=o;return a=o=void 0,s=c,l=e.apply(C,y),l}function m(c,y){return v?(window.cancelAnimationFrame(r),window.requestAnimationFrame(c)):setTimeout(c,y)}function E(c){if(v)return window.cancelAnimationFrame(c);clearTimeout(c)}function g(c){return s=c,r=m(R,n),f?w(c):l}function p(c){const y=c-i,C=c-s,F=n-y;return d?Math.min(F,u-C):F}function h(c){const y=c-i,C=c-s;return i===void 0||y>=n||y<0||d&&C>=u}function R(){const c=Date.now();if(h(c))return b(c);r=m(R,p(c))}function b(c){return r=void 0,T&&a?w(c):(a=o=void 0,l)}function L(){r!==void 0&&E(r),s=0,a=i=o=r=void 0}function A(){return r===void 0?l:b(Date.now())}function N(){return r!==void 0}function O(){const c=Date.now(),y=h(c);for(var C=arguments.length,F=new Array(C),_=0;_<C;_++)F[_]=arguments[_];if(a=F,o=this,i=c,y){if(r===void 0)return g(i);if(d)return r=m(R,n),w(i)}return r===void 0&&(r=m(R,n)),l}return O.cancel=L,O.flush=A,O.pending=N,O}function Te(e,n,t){let a=!0,o=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Z(t)&&(a="leading"in t?!!t.leading:a,o="trailing"in t?!!t.trailing:o),re(e,n,{leading:a,trailing:o,maxWait:n})}var be=I((e,n)=>{let{debounceInterval:t,debounceOptions:a,manual:o}=n;const u=S(!1),l=S(),r=P(()=>a),i=P(()=>x(t)),s=S(e.context.runAsync);return o||(u.value=!0),J(f=>{D(i.value)||(l.value=re(d=>d(),i.value,r.value),e.context.runAsync=function(){for(var d=arguments.length,T=new Array(d),v=0;v<d;v++)T[v]=arguments[v];return new Promise((w,m)=>{u.value?(u.value=!1,s.value(...T).then(w).catch(m)):l.value(()=>{s.value(...T).then(w).catch(m)})})},f(()=>{var d;(d=l.value)===null||d===void 0||d.cancel(),e.context.runAsync=s.value}))}),{onCancel(){var f;(f=l.value)===null||f===void 0||f.cancel()}}}),Se=I((e,n)=>{let{errorRetryCount:t=0,errorRetryInterval:a=0}=n;const o=S(),u=S(0),l=P(()=>x(t)),r=P(()=>x(a));let i=!1;const s=()=>{u.value=0},f=P(()=>{if(r.value)return r.value;const v=1e3,E=Math.floor(Math.random()*2**Math.min(u.value,9)+1);return v*E}),d=()=>{let v;const w=l.value===-1,m=u.value<l.value;return(w||m)&&(w||(u.value+=1),v=setTimeout(()=>{i=!0,e.context.refresh()},f.value)),()=>v&&clearTimeout(v)},T=()=>{o.value&&o.value()};return{onBefore(){i||s(),i=!1,T()},onSuccess(){s()},onError(){o.value=d()},onCancel(){s(),T()}}}),ye=I((e,n)=>{let{ready:t=S(!0),manual:a,defaultParams:o=[]}=n;return X(t,u=>{!a&&u&&e.context.run(...o)},{flush:"sync"}),{onBefore(){if(!(k(t)?t():t.value))return e.loading.value=!1,{isBreak:!0}}}}),Ce=I((e,n)=>{let{refreshDeps:t,refreshDepsAction:a,manual:o}=n;if(t===void 0||z(t)&&t.length===0)return{};const u=z(t)?t:[t];return X(u,()=>{a?a():!o&&e.context.refresh()}),{}}),Pe=I((e,n)=>{let{throttleInterval:t,throttleOptions:a}=n;const o=S(),u=P(()=>x(t)),l=P(()=>a),r=S(e.context.runAsync);return J(i=>{if(D(t))return{};o.value=Te(s=>s(),u.value,l.value),e.context.runAsync=function(){for(var s=arguments.length,f=new Array(s),d=0;d<s;d++)f[d]=arguments[d];return new Promise((T,v)=>{o.value(()=>{r.value(...f).then(T).catch(v)})})},i(()=>{var s;(s=o.value)===null||s===void 0||s.cancel(),e.context.runAsync=r.value})}),{onCancel(){var i;(i=o.value)===null||i===void 0||i.cancel()}}});const Le=(e,n)=>t=>{Object.keys(t).forEach(a=>{e[a].value=t[a]}),n.forEach(a=>a(e))},Ae=(e,n)=>()=>{let t=n;for(let a=e.length;a-- >0;)t=e[a](t);return t()},Oe=(e,n,t)=>{var a,o;const{initialData:u,onSuccess:l,onError:r,onBefore:i,onAfter:s}=n,f=S((a=void 0)!==null&&a!==void 0?a:!1),d=j((o=void 0)!==null&&o!==void 0?o:u),T=j(void 0),v=S(void 0),w=S([]),m=j("pending"),E={},g=Le({status:m,loading:f,data:d,error:T,params:v},[]),p=function(R){for(var b=arguments.length,L=new Array(b>1?b-1:0),A=1;A<b;A++)L[A-1]=arguments[A];if(R==="onQuery"){const N=w.value.map(O=>O.onQuery).filter(Boolean);return{servicePromise:Ae(N,L[0])()}}else{const N=w.value.map(O=>{var c;return(c=O[R])===null||c===void 0?void 0:c.call(O,...L)});return Object.assign({},...N)}},h=S(0);return E.runAsync=async function(){for(var R=arguments.length,b=new Array(R),L=0;L<R;L++)b[L]=arguments[L];g({loading:!0,params:b,status:"pending"}),h.value+=1;const A=h.value,{isBreak:N,breakResult:O=G()}=p("onBefore",b);if(N)return g({status:"settled"}),O;i==null||i(b);try{const c=()=>new Promise(F=>F(e(...v.value)));let{servicePromise:y}=p("onQuery",c);y||(y=c());const C=await y;return A!==h.value?G():(g({data:C,loading:!1,error:void 0,status:"settled"}),p("onSuccess",C,b),l==null||l(C,b),A===h.value&&p("onAfter",b,C,void 0),s==null||s(b),C)}catch(c){if(A!==h.value)return G();throw g({loading:!1,error:c,status:"settled"}),p("onError",c,b),r==null||r(c,b),A===h.value&&p("onAfter",b,void 0,c),s==null||s(b),c}},E.run=function(){E.runAsync(...arguments).catch(R=>{r||console.error(R)})},E.cancel=()=>{h.value+=1,g({loading:!1}),p("onCancel")},E.refresh=()=>{E.run(...v.value||[])},E.refreshAsync=()=>E.runAsync(...v.value||[]),E.mutate=R=>{const b=k(R)?R(d.value):R,L=we(b);g({data:L}),p("onMutate",L)},{status:m,loading:f,data:d,error:T,params:v,plugins:w,context:E}};function xe(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const a=se(ge,{}),o={...he(),...a,...n},{manual:u=!1,defaultParams:l=[]}=o,r=Oe(e,o);if(r.plugins.value=t.map(i=>i(r,o)),!u){const i=r.params.value||l;r.context.run(...i)}return $(()=>{r.context.cancel()}),{loading:r.loading,data:r.data,error:r.error,params:r.params,cancel:r.context.cancel,refresh:r.context.refresh,refreshAsync:r.context.refreshAsync,mutate:r.context.mutate,run:r.context.run,runAsync:r.context.runAsync}}const Q=new Map,Ie=(e,n)=>{Q.set(e,n),n.then(t=>(Q.delete(e),t)).catch(()=>{Q.delete(e)})},Ne=e=>Q.get(e),B=new Map,Fe=(e,n)=>{B.has(e)&&B.get(e).forEach(t=>t(n))},Be=(e,n)=>(B.has(e)?B.get(e).push(n):B.set(e,[n]),()=>{const t=B.get(e).indexOf(n);B.get(e).splice(t,1)});var De=I((e,n)=>{let{cacheKey:t,cacheTime:a=6e5,staleTime:o=0,getCache:u,setCache:l}=n;if(!t)return{};const r=k(t)?t:()=>t,i=S(()=>{});let s;const f=g=>u?u(g):Re(g),d=(g,p,h)=>{l?l(g,h):Ee(g,p,h),Fe(g,h.data)},T=g=>o===-1||g+o>new Date().getTime(),v=(g,p)=>Object.prototype.hasOwnProperty.call(g,p),w=g=>{const p=r(g);return Be(p,h=>{e.data.value=h})},m=r(),E=f(m);return E&&v(E,"data")&&(e.data.value=E.data,e.params.value=E.params),m&&(i.value=w()),$(()=>{i.value()}),{onBefore(g){const p=r(g),h=f(p);if(!h||!v(h,"data"))return{};if(T(h.time))return e.data.value=h.data,e.loading.value=!1,{isBreak:!0,breakResult:h.data};e.data.value=h.data},onQuery(g){const p=e.params.value,h=r(p);let R=Ne(h);return R&&R!==s?()=>R:(R=g(),s=R,Ie(h,R),()=>R)},onSuccess(g,p){const h=r(p);h&&(i.value(),d(h,a,{data:g,params:p,time:new Date().getTime()}),i.value=w(p))},onMutate(g){const p=r(e.params.value);p&&(i.value(),d(p,a,{data:g,params:e.params.value,time:new Date().getTime()}),i.value=w(e.params.value))}}});function _e(e){let n,t;class a extends Promise{constructor(u){super(u),this.cancel=()=>{t(),clearTimeout(n)}}}return new a(o=>{t=o,n=setTimeout(t,e)})}function U(){return new Date().getTime()}var Me=I((e,n)=>{let{loadingDelay:t=0,loadingKeep:a=0}=n;const o=S(()=>{}),u=P(()=>x(t)),l=P(()=>x(a));let r=0,i={};const s=()=>{let f;return u.value&&(f=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},u.value)),()=>f&&clearTimeout(f)};return{onBefore(){e.loading.value=!u.value,o.value(),o.value=s(),r=U()},onQuery(f){if(!l.value)return()=>f();i=_e(l.value+u.value);const d=async()=>{try{const v=await f();return U()-r<=u.value&&i.cancel(),Promise.resolve(v)}catch(v){return U()-r<=u.value&&i.cancel(),Promise.reject(v)}},T=Promise.allSettled([d(),i]).then(v=>{const w=v[0];return w.status==="fulfilled"?w.value:Promise.reject(w.reason)});return()=>T},onCancel(){o.value()},onAfter(){o.value()}}}),H;const ae=new Set,oe=new Set,ie=new Set,V=(e,n)=>{let t;switch(e){case"FOCUS_LISTENER":t=ae;break;case"RECONNECT_LISTENER":t=ie;break;case"VISIBLE_LISTENER":t=oe;break}if(!t.has(n))return t.add(n),()=>{t.delete(n)}},Y=e=>{e.forEach(n=>{n()})};!q&&(H=window)!==null&&H!==void 0&&H.addEventListener&&(window.addEventListener("visibilitychange",()=>{ne()&&Y(oe)},!1),window.addEventListener("focus",()=>Y(ae),!1),window.addEventListener("online",()=>Y(ie),!1));var We=I((e,n)=>{let{pollingInterval:t,pollingWhenHidden:a=!1,pollingWhenOffline:o=!1,errorRetryCount:u=0}=n;const l=S(),r=S(!1),i=P(()=>x(t)),s=P(()=>x(u)),f=[],d=m=>{m&&f.push(m)},T=()=>(a||ne())&&(o||pe()),v=m=>{if(e.error.value&&s.value!==0)return;let E;if(!D(i.value)&&i.value>=0)if(T())E=setTimeout(m,i.value);else{r.value=!0;return}return()=>E&&clearTimeout(E)},w=()=>{r.value&&T()&&(e.context.refresh(),r.value=!1)};return X(i,()=>{l.value&&(l.value(),l.value=v(()=>e.context.refresh()))}),a||d(V("VISIBLE_LISTENER",w)),o||d(V("RECONNECT_LISTENER",w)),$(()=>{f.forEach(m=>m())}),{onBefore(){var m;(m=l.value)===null||m===void 0||m.call(l)},onCancel(){var m;(m=l.value)===null||m===void 0||m.call(l)},onAfter(){l.value=v(()=>e.context.refresh())}}});const Qe=(e,n)=>{let t=!1;return function(){t||(t=!0,e(...arguments),setTimeout(()=>{t=!1},n))}};var Ve=I((e,n)=>{let{refreshOnWindowFocus:t=!1,refocusTimespan:a=5e3}=n;const o=P(()=>x(t)),u=P(()=>x(a)),l=[],r=s=>{s&&l.push(s)},i=()=>{l.forEach(s=>s())};return J(()=>{if(i(),o.value){const s=Qe(e.context.refresh,u.value);r(V("VISIBLE_LISTENER",s)),r(V("FOCUS_LISTENER",s))}}),$(()=>{i()}),{}});function te(e,n,t){return xe(e,n,[Me,Se,be,We,Pe,Ve,Ce,ye,De])}const $e=()=>{const e=le();return{getReserves:async()=>{try{const a=await e.getReserves();return fe(a)}catch(a){return de(a)}},totalSupply:async()=>{try{const a=await e.totalSupply();return ce(a)}catch{return""}}}};function Ke(){const{accountStore:e}=ve(),{totalSupply:n}=$e(),t=P(()=>!!e.isSign),a=async()=>{const f=await Promise.all([ee(M.WMAI).balanceOf(M.LP),ee(M.MCOIN).balanceOf(M.LP)]);return{mcoinPrice:K(f[1]).div(f[0]).toString(),poolWmai:K(f[0]).toString(),poolMcoin:K(f[1]).toString()}},{data:o,loading:u,refreshAsync:l}=te(a,{initialData:{mcoinPrice:"",poolWmai:"",poolMcoin:""},ready:t}),{data:r,loading:i,refreshAsync:s}=te(n,{defaultParams:[],initialData:"",ready:t});return{refreshLpSupply:s,refreshFlowValue:l,lpSupply:r,lpSupplyLoading:i,flowValue:o,flowValueLoading:u}}export{Ke as u};

import{c as P,a1 as gt,l as S,aN as q,d as L,n as R,at as U,h as A,r as M,av as bt,W as T,au as et,ar as W,a as yt,aK as nt,e as g,a3 as at,$ as lt,V as z,t as ot,g as Dt,aq as xt,ba as wt,w as E,bb as j,aw as Ot,j as it,p as G,m as ut,bc as kt,s as st,bd as rt,be as ct}from"./index-Ce_DXvk7.js";const[Ht,C,mt]=P("picker"),vt=t=>t.find(i=>!i.disabled)||t[0];function K(t,i){for(let l=i=q(i,0,t.length);l<t.length;l++)if(!t[l].disabled)return l;for(let l=i-1;l>=0;l--)if(!t[l].disabled)return l;return 0}const dt=(t,i,l)=>i!==void 0&&!!t.find(u=>u[l.value]===i);function J(t,i,l){const u=t.findIndex(s=>s[l.value]===i);return t[K(t,u)]}const[pt,X]=P("picker-column"),ft=Symbol(pt);var Tt=L({name:pt,props:{value:R,fields:U(Object),options:A(),readonly:Boolean,allowHtml:Boolean,optionHeight:U(Number),swipeDuration:U(R),visibleOptionNum:U(R)},emits:["change","clickOption","scrollInto"],setup(t,{emit:i,slots:l}){let u,s,w,b,v;const r=M(),x=M(),d=M(0),p=M(0),I=bt(),N=()=>t.options.length,Y=()=>t.optionHeight*(+t.visibleOptionNum-1)/2,o=m=>{let e=K(t.options,m);const a=-e*t.optionHeight,n=()=>{e>N()-1&&(e=K(t.options,m));const y=t.options[e][t.fields.value];y!==t.value&&i("change",y)};u&&a!==d.value?v=n:n(),d.value=a},c=()=>t.readonly||!t.options.length,f=m=>q(Math.round(-m/t.optionHeight),0,N()-1),k=T(()=>f(d.value)),h=()=>{u=!1,p.value=0,v&&(v(),v=null)},F=m=>{if(!c()){if(I.start(m),u){const e=function(a){const{transform:n}=window.getComputedStyle(a),y=n.slice(7,n.length-1).split(", ")[5];return Number(y)}(x.value);d.value=Math.min(0,e-Y())}p.value=0,s=d.value,w=Date.now(),b=s,v=null}},V=()=>{if(c())return;const m=d.value-b,e=Date.now()-w;if(e<300&&Math.abs(m)>15)return void((n,y)=>{const H=Math.abs(n/y);n=d.value+H/.003*(n<0?-1:1);const D=f(n);p.value=+t.swipeDuration,o(D)})(m,e);const a=f(d.value);p.value=200,o(a),setTimeout(()=>{u=!1},0)},$=()=>{const m={height:`${t.optionHeight}px`};return t.options.map((e,a)=>{const n=e[t.fields.text],{disabled:y}=e,H=e[t.fields.value],D={role:"button",style:m,tabindex:y?-1:0,class:[X("item",{disabled:y,selected:H===t.value}),e.className],onClick:()=>(O=>{u||c()||(v=null,p.value=200,o(O),i("clickOption",t.options[O]))})(a)},B={class:"van-ellipsis",[t.allowHtml?"innerHTML":"textContent"]:n};return g("li",D,[l.option?l.option(e,a):g("div",B,null)])})};return et(ft),W({stopMomentum:h}),yt(()=>{const m=u?Math.floor(-d.value/t.optionHeight):t.options.findIndex(n=>n[t.fields.value]===t.value),e=K(t.options,m),a=-e*t.optionHeight;u&&e<m&&h(),d.value=a}),nt("touchmove",m=>{if(c())return;I.move(m),I.isVertical()&&(u=!0,at(m,!0));const e=q(s+I.deltaY.value,-N()*t.optionHeight,t.optionHeight),a=f(e);a!==k.value&&i("scrollInto",t.options[a]),d.value=e;const n=Date.now();n-w>300&&(w=n,b=e)},{target:r}),()=>g("div",{ref:r,class:X(),onTouchstartPassive:F,onTouchend:V,onTouchcancel:V},[g("ul",{ref:x,style:{transform:`translate3d(0, ${d.value+Y()}px, 0)`,transitionDuration:`${p.value}ms`,transitionProperty:p.value?"all":"none"},class:X("wrapper"),onTransitionend:h},[$()])])}});const[Vt]=P("picker-toolbar"),Q={title:String,cancelButtonText:String,confirmButtonText:String},Mt=["cancel","confirm","title","toolbar"],Ct=Object.keys(Q);var It=L({name:Vt,props:Q,emits:["confirm","cancel"],setup(t,{emit:i,slots:l}){const u=()=>i("cancel"),s=()=>i("confirm"),w=()=>{var v;const r=(v=t.cancelButtonText)!=null?v:mt("cancel");if(l.cancel||r)return g("button",{type:"button",class:[C("cancel"),lt],onClick:u},[l.cancel?l.cancel():r])},b=()=>{var v;const r=(v=t.confirmButtonText)!=null?v:mt("confirm");if(l.confirm||r)return g("button",{type:"button",class:[C("confirm"),lt],onClick:s},[l.confirm?l.confirm():r])};return()=>g("div",{class:C("toolbar")},[l.toolbar?l.toolbar():[w(),l.title?l.title():t.title?g("div",{class:[C("title"),"van-ellipsis"]},[t.title]):void 0,b()]])}});const[Nt,At]=P("picker-group"),St=Symbol(Nt);S({tabs:A(),activeTab:z(0),nextStepText:String,showToolbar:ot},Q);const Z=S({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:z(44),showToolbar:ot,swipeDuration:z(1e3),visibleOptionNum:z(6)},Q),Ft=st(L({name:Ht,props:S({},Z,{columns:A(),modelValue:A(),toolbarPosition:Dt("top"),columnsFieldNames:Object}),emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(t,{emit:i,slots:l}){const u=M(),s=M(t.modelValue.slice(0)),{parent:w}=et(St),{children:b,linkChildren:v}=xt(ft);v();const r=T(()=>function(e){return S({text:"text",value:"value",children:"children"},e)}(t.columnsFieldNames)),x=T(()=>wt(t.optionHeight)),d=T(()=>function(e,a){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(a.children in n)return"cascade"}return"default"}(t.columns,r.value)),p=T(()=>{const{columns:e}=t;switch(d.value){case"multiple":return e;case"cascade":return function(a,n,y){const H=[];let D={[n.children]:a},B=0;for(;D&&D[n.children];){const O=D[n.children],tt=y.value[B];D=gt(tt)?J(O,tt,n):void 0,!D&&O.length&&(D=J(O,vt(O)[n.value],n)),B++,H.push(O)}return H}(e,r.value,s);default:return[e]}}),I=T(()=>p.value.some(e=>e.length)),N=T(()=>p.value.map((e,a)=>J(e,s.value[a],r.value))),Y=T(()=>p.value.map((e,a)=>e.findIndex(n=>n[r.value.value]===s.value[a]))),o=(e,a)=>{if(s.value[e]!==a){const n=s.value.slice(0);n[e]=a,s.value=n}},c=()=>({selectedValues:s.value.slice(0),selectedOptions:N.value,selectedIndexes:Y.value}),f=()=>{b.forEach(a=>a.stopMomentum());const e=c();return it(()=>{i("confirm",e)}),e},k=()=>i("cancel",c()),h=()=>p.value.map((e,a)=>g(Tt,{value:s.value[a],fields:r.value,options:e,readonly:t.readonly,allowHtml:t.allowHtml,optionHeight:x.value,swipeDuration:t.swipeDuration,visibleOptionNum:t.visibleOptionNum,onChange:n=>((y,H)=>{o(H,y),d.value==="cascade"&&s.value.forEach((D,B)=>{const O=p.value[B];dt(O,D,r.value)||o(B,O.length?O[0][r.value.value]:void 0)}),it(()=>{i("change",S({columnIndex:H},c()))})})(n,a),onClickOption:n=>((y,H)=>{const D={columnIndex:H,currentOption:y};i("clickOption",S(c(),D)),i("scrollInto",D)})(n,a),onScrollInto:n=>{i("scrollInto",{currentOption:n,columnIndex:a})}},{option:l.option})),F=e=>{if(I.value){const a={height:`${x.value}px`},n={backgroundSize:`100% ${(e-x.value)/2}px`};return[g("div",{class:C("mask"),style:n},null),g("div",{class:[kt,C("frame")],style:a},null)]}},V=()=>{const e=x.value*+t.visibleOptionNum,a={height:`${e}px`};return g("div",{ref:u,class:C("columns"),style:a},[h(),F(e)])},$=()=>{if(t.showToolbar&&!w)return g(It,ut(G(t,Ct),{onConfirm:f,onCancel:k}),G(l,Mt))};let m;return E(p,e=>{e.forEach((a,n)=>{a.length&&!dt(a,s.value[n],r.value)&&o(n,vt(a)[r.value.value])})},{immediate:!0}),E(()=>t.modelValue,e=>{j(e,s.value)||j(e,m)||(s.value=e.slice(0),m=e.slice(0))},{deep:!0}),E(s,e=>{j(e,t.modelValue)||(m=e.slice(0),i("update:modelValue",m))},{immediate:!0}),nt("touchmove",at,{target:u}),W({confirm:f,getSelectedOptions:()=>N.value}),()=>{var e,a;return g("div",{class:C()},[t.toolbarPosition==="top"?$():null,t.loading?g(Ot,{class:C("loading")},null):null,(e=l["columns-top"])==null?void 0:e.call(l),V(),(a=l["columns-bottom"])==null?void 0:a.call(l),t.toolbarPosition==="bottom"?$():null])}}})),Bt=S({},Z,{modelValue:A(),filter:Function,formatter:{type:Function,default:(t,i)=>i}}),Yt=Object.keys(Z),_=(t,i,l,u,s,w)=>{const b=function(v,r){if(v<0)return[];const x=Array(v);let d=-1;for(;++d<v;)x[d]=r(d);return x}(i-t+1,v=>{const r=rt(t+v);return u(l,{text:r,value:r})});return s?s(l,b,w):b},ht=new Date().getFullYear(),[$t]=P("date-picker"),jt=st(L({name:$t,props:S({},Bt,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(ht-10,0,1),validator:ct},maxDate:{type:Date,default:()=>new Date(ht+10,11,31),validator:ct}}),emits:["confirm","cancel","change","update:modelValue"],setup(t,{emit:i,slots:l}){const u=M(t.modelValue),s=M(!1),w=M(),b=T(()=>s.value?t.modelValue:u.value),v=o=>o===t.minDate.getFullYear(),r=o=>o===t.maxDate.getFullYear(),x=o=>{const{minDate:c,columnsType:f}=t,k=f.indexOf(o),h=b.value[k];if(h)return+h;switch(o){case"year":return c.getFullYear();case"month":return c.getMonth()+1;case"day":return c.getDate()}},d=()=>{const o=x("year"),c=x("month"),f=v(o)&&(h=>h===t.minDate.getMonth()+1)(c)?t.minDate.getDate():1,k=r(o)&&(h=>h===t.maxDate.getMonth()+1)(c)?t.maxDate.getDate():((h,F)=>32-new Date(h,F-1,32).getDate())(o,c);return _(f,k,"day",t.formatter,t.filter,b.value)},p=T(()=>t.columnsType.map(o=>{switch(o){case"year":return(()=>{const c=t.minDate.getFullYear(),f=t.maxDate.getFullYear();return _(c,f,"year",t.formatter,t.filter,b.value)})();case"month":return(()=>{const c=x("year"),f=v(c)?t.minDate.getMonth()+1:1,k=r(c)?t.maxDate.getMonth()+1:12;return _(f,k,"month",t.formatter,t.filter,b.value)})();case"day":return d();default:return[]}}));E(u,o=>{j(o,t.modelValue)||i("update:modelValue",o)}),E(()=>t.modelValue,(o,c)=>{s.value=j(c,u.value),o=((f,k)=>f.map((h,F)=>{const V=k[F];if(V.length){const $=+V[0].value,m=+V[V.length-1].value;return rt(q(+h,$,m))}return h}))(o,p.value),j(o,u.value)||(u.value=o),s.value=!1},{immediate:!0});const I=(...o)=>i("change",...o),N=(...o)=>i("cancel",...o),Y=(...o)=>i("confirm",...o);return W({confirm:()=>{var o;return(o=w.value)==null?void 0:o.confirm()},getSelectedDate:()=>u.value}),()=>g(Ft,ut({ref:w,modelValue:u.value,"onUpdate:modelValue":o=>u.value=o,columns:p.value,onChange:I,onCancel:N,onConfirm:Y},G(t,Yt)),l)}}));export{jt as D};

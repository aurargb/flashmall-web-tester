import{x as n,y as p,z as t,C as l,H as o,aV as de,e as h,A as m,D as X,E as u,_ as ue,v as ce,K as pe,r as c,ad as fe,o as me,Q as v,af as ve,N as xe,S as ye,O as _e,F as j,G as be,__tla as ge}from"./index-Ce_DXvk7.js";import{L as he}from"./index-CscZwBzF.js";import{e as we,b as Te,_ as ke}from"./cf-D0X9PrTD.js";import{_ as Ce}from"./DetailCard-DFTxejGZ.js";import{_ as $e}from"./TokenAmount-V2Bwu2KM.js";import{u as Me}from"./index-BmORpdFZ.js";import{a as x,R as je,T as w}from"./projectEnum-9kZKCKr4.js";import{c as Ie,__tla as Re}from"./cfContract-XFp0fv1b.js";import{u as Oe}from"./useCountdown-DD4s2lb6.js";import"./StateTimeBar-C7QRNDIm.js";import"./MAI-BT7NZAfN.js";import{__tla as Ne}from"./contractHelper-BHednLWH.js";let Y,De=Promise.all([(()=>{try{return ge}catch{}})(),(()=>{try{return Re}catch{}})(),(()=>{try{return Ne}catch{}})()]).then(async()=>{let I,R,O,N,D,E,S,A,P,L,q,z,F,G,U,H,J,K,Q;I={class:"bg-white rounded-xl p-3 mb-3"},R={class:"address-time flex justify-between items-center"},O={class:"text-b2 text-sm font-semibold"},N={class:"text-b3 text-sm font-normal"},D={class:"mt-2"},E={class:"text-orange1 text-sm font-semibold"},S={__name:"ParticipatedRecordCard",props:{data:{type:Object,default:()=>{}},project:{type:Object,default:()=>{}}},setup(r){const[y,V]=Me(!1),T=()=>{V(!y.value)};return(_,k)=>(n(),p("div",I,[t("div",R,[t("p",O,l(o(de)(r.data.address,"...",4,4)),1),t("p",N,l(r.data.createTime),1)]),t("div",D,[h($e,{mcoin:r.data.mcoin,mai:r.data.mai,point:r.data.point,type:r.project.targetType},{default:m(()=>[t("span",E,l(r.data.num||"-")+l(_.$t("serving")),1)]),_:1},8,["mcoin","mai","point","type"])]),r.data.remark?(n(),p("div",{key:0,class:"rounded bg-gray4 p-1 mt-2 cursor-pointer",onClick:T},[t("p",{class:X(["text-xs text-b3 font-normal",{"line-clamp-1":!o(y)}])},[t("span",null,l(_.$t("remark"))+": ",1),t("span",null,l(r.data.remark),1)],2)])):u("",!0)]))}},A={class:"page__container bg-flash-linear relative"},P={class:"fixed top-0 w-full right-0 left-0"},L={class:"sm:w-[375px] mx-auto fixed top-[50px] h-[calc(100vh-50px)] w-full right-0 left-0 px-3 pt-2"},q={class:"mt-4"},z={class:"text-b1 text-base font-semibold"},F={class:"mt-3 overflow-y-scroll h-[calc(100%-238px)] pb-16"},G={class:"w-full fixed bottom-0 left-0 right-0 py-4 px-3 flex justify-between gap-3"},U={class:"text-b2 text-base font-semibold"},H={class:"text-b1 text-base font-normal"},J={class:"text-b1 text-base font-normal whitespace-nowrap"},K={key:0},Q={key:1},Y=ue({__name:"Detail",setup(r){const{t:y}=ce(),{accountStore:V,reloadStore:T}=pe(),_=ve(),k=c(_.query.id),{back:Z}=Ie(),a=c({}),C=c(0),ee=c(20),ae=c(0),i=c(!1),b=c(!1),f=c([]),te=()=>{i.value=!0,C.value+=1,le()},le=()=>{const e={projectId:k.value,onlyMe:!0,page:C.value,size:ee.value};we(e).then(s=>{if(s.code!=200||s.success===!1)return b.value=!0,void(i.value=!1);const d=s.data||{};ae.value=d.total,f.value=C.value===1?f.value=d.records:f.value.concat(d.records),d.current>=d.pages&&(b.value=!0)}).catch(s=>{b.value=!0,i.value=!1}).finally(()=>{i.value=!1})},{remainingTimeText:B,startCountdown:W,stopCountdown:se}=Oe({endText:y("ended"),onEnd:()=>{window.location.reload()}}),ne=()=>{const e=a.value;e.status!=x.IN_PROGRESS?e.status!=x.NOT_STARTED||W(e.startTime):W(e.endTime)},$=c(!1),oe=async()=>{const e={id:a.value.id};$.value=!0;const s=await Z(e.id);$.value=!1,s.success&&(xe($t("Refund successful")),T.reload())};return fe(()=>{se()}),me(()=>{(async()=>{const e={id:k.value};i.value=!0;try{const s=await Te(e);if(s.code===200&&s.success){const d=s.data;a.value=d,ne()}}catch(s){console.error("\u83B7\u53D6\u9879\u76EE\u8BE6\u60C5\u5931\u8D25:",s)}finally{i.value=!1}})()}),(e,s)=>{const d=ke,re=ye,ie=he,M=_e;return n(),p("div",A,[t("section",P,[h(d,{title:e.$t("Details of participating in crowdfunding")},null,8,["title"])]),t("section",L,[h(Ce,{project:a.value,remainingTimeText:o(B)},null,8,["project","remainingTimeText"]),t("div",q,[t("h2",z,l(e.$t("my-participated")),1)]),t("div",F,[f.value.length!==0||i.value?u("",!0):(n(),v(re,{key:0,name:e.$t("No participation record")},null,8,["name"])),h(ie,{loading:i.value,"onUpdate:loading":s[0]||(s[0]=g=>i.value=g),finished:b.value,"finished-text":f.value.length===0?"":e.$t("no-more"),onLoad:te},{default:m(()=>[(n(!0),p(j,null,be(f.value,g=>(n(),v(S,{key:g.id,data:g,project:a.value},null,8,["data","project"]))),128))]),_:1},8,["loading","finished","finished-text"])])]),t("section",G,[a.value.status==o(x).NOT_STARTED?(n(),v(M,{key:0,class:"w-full btn not-started-btn rounded"},{default:m(()=>[t("span",U,l(o(B))+l(e.$t("start-after")),1)]),_:1})):u("",!0),a.value.status==o(x).SUCCEED?(n(),v(M,{key:1,class:"w-full btn others-success-btn rounded"},{default:m(()=>[t("span",H,l(e.$t("Crowdfunding is successful waiting for subsequent income")),1)]),_:1})):u("",!0),a.value.status==o(x).FAILED&&a.value.relatedType==o(je).JOIN?(n(),v(M,{key:2,class:X(["w-full btn main-btn",{"fail-btn":a.value.relatedRefunded}]),onClick:oe,loading:$.value,disabled:!!a.value.relatedRefunded||a.value.targetType==o(w).POINT},{default:m(()=>[t("span",J,[t("span",null,l(a.value.relatedRefunded?e.$t("crowdfunding-failed-others"):e.$t("crowdfunding-failed")),1),a.value.relatedRefunded?u("",!0):(n(),p(j,{key:0},[a.value.targetType==o(w).MAI?(n(),p("span",K,","+l(e.$t("Click to refund"))+l(a.value.relatedMai)+"Mai",1)):u("",!0),a.value.targetType==o(w).MCOIN?(n(),p("span",Q,","+l(e.$t("Click to refund"))+l(a.value.relatedMcoin)+"MC",1)):u("",!0),a.value.targetType==o(w).MCOIN_MAI?(n(),p(j,{key:2},[t("span",null,","+l(e.$t("Click to refund")),1),t("span",null,l(a.value.relatedMcoin)+"MC&",1),t("span",null,l(a.value.relatedMai)+"Mai",1)],64)):u("",!0)],64))])]),_:1},8,["class","loading","disabled"])):u("",!0)])])}}},[["__scopeId","data-v-5053c446"]])});export{De as __tla,Y as default};

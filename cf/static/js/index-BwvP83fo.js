import{aO as we,c as ee,g as E,n as B,t as Se,i as D,l as ae,aX as Ce,d as le,aY as Be,e as o,a1 as x,I as P,s as re,bn as Ve,bo as Me,bp as Ie,aD as Ae,aC as ze,V as Ee,ah as Pe,r as R,au as Le,W as V,T as te,ar as Te,bq as $e,w as qe,j as W,o as De,aK as We,as as je,aB as ne,a0 as He,aN as Ne,a3 as K,br as Oe,m as Fe,aj as Re,a2 as Ke}from"./index-Ce_DXvk7.js";let Ue=0;const[Xe,M]=ee("cell"),ie={tag:E("div"),icon:String,size:String,title:B,value:B,label:B,center:Boolean,isLink:Boolean,border:Se,iconPrefix:String,valueClass:D,labelClass:D,titleClass:D,titleStyle:null,arrowDirection:String,required:{type:[Boolean,String],default:null},clickable:{type:Boolean,default:null}},Ye=re(le({name:Xe,props:ae({},ie,Ce),setup(e,{slots:r}){const c=Be(),I=()=>{if(r.label||x(e.label))return o("div",{class:[M("label"),e.labelClass]},[r.label?r.label():e.label])},n=()=>{var p;if(r.title||x(e.title)){const d=(p=r.title)==null?void 0:p.call(r);return Array.isArray(d)&&d.length===0?void 0:o("div",{class:[M("title"),e.titleClass],style:e.titleStyle},[d||o("span",null,[e.title]),I()])}},v=()=>{const p=r.value||r.default;if(p||x(e.value))return o("div",{class:[M("value"),e.valueClass]},[p?p():o("span",null,[e.value])])},L=()=>{if(r["right-icon"])return r["right-icon"]();if(e.isLink){const p=e.arrowDirection&&e.arrowDirection!=="right"?`arrow-${e.arrowDirection}`:"arrow";return o(P,{name:p,class:M("right-icon")},null)}};return()=>{var p;const{tag:d,size:y,center:g,border:j,isLink:T,required:H}=e,A=(p=e.clickable)!=null?p:T,S={center:g,required:!!H,clickable:A,borderless:!j};return y&&(S[y]=!!y),o(d,{class:M(S),role:A?"button":void 0,tabindex:A?0:void 0,onClick:c},{default:()=>{var z;return[r.icon?r.icon():e.icon?o(P,{name:e.icon,class:M("left-icon"),classPrefix:e.iconPrefix},null):void 0,n(),v(),L(),(z=r.extra)==null?void 0:z.call(r)]}})}}}));function oe(e){return Array.isArray(e)?!e.length:e!==0&&!e}function se(e,r){const{message:c}=r;return ze(c)?c(e,r):c||""}function _e({target:e}){e.composing=!0}function ue({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function w(e){return[...e].length}function U(e,r){return[...e].slice(0,r).join("")}const[Ge,b]=ee("field");var Je=le({name:Ge,props:ae({},ie,{id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:B,max:Number,min:Number,formatter:Function,clearIcon:E("clear"),modelValue:Ee(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:E("focus"),formatTrigger:E("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},{rows:B,type:E("text"),rules:Array,autosize:[Boolean,Object],labelWidth:B,labelClass:D,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:r,slots:c}){const I=function(){const a=we(),{name:l="unknown"}=(a==null?void 0:a.type)||{};return`${l}-${++Ue}`}(),n=Pe({status:"unvalidated",focused:!1,validateMessage:""}),v=R(),L=R(),p=R(),{parent:d}=Le(je),y=()=>{var a;return String((a=e.modelValue)!=null?a:"")},g=a=>x(e[a])?e[a]:d&&x(d.props[a])?d.props[a]:void 0,j=V(()=>{const a=g("readonly");if(e.clearable&&!a){const l=y()!=="",t=e.clearTrigger==="always"||e.clearTrigger==="focus"&&n.focused;return l&&t}return!1}),T=V(()=>p.value&&c.input?p.value():e.modelValue),H=V(()=>{var a;const l=g("required");return l==="auto"?(a=e.rules)==null?void 0:a.some(t=>t.required):l}),A=a=>a.reduce((l,t)=>l.then(()=>{if(n.status==="failed")return;let{value:s}=T;if(t.formatter&&(s=t.formatter(s,t)),!function(i,f){if(oe(i)){if(f.required)return!1;if(f.validateEmpty===!1)return!0}return!(f.pattern&&!f.pattern.test(String(i)))}(s,t))return n.status="failed",void(n.validateMessage=se(s,t));if(t.validator)return oe(s)&&t.validateEmpty===!1?void 0:function(i,f){return new Promise(m=>{const u=f.validator(i,f);Ae(u)?u.then(m):m(u)})}(s,t).then(i=>{i&&typeof i=="string"?(n.status="failed",n.validateMessage=i):i===!1&&(n.status="failed",n.validateMessage=se(s,t))})}),Promise.resolve()),S=()=>{n.status="unvalidated",n.validateMessage=""},z=()=>r("endValidate",{status:n.status,message:n.validateMessage}),X=(a=e.rules)=>new Promise(l=>{S(),a?(r("startValidate"),A(a).then(()=>{n.status==="failed"?(l({name:e.name,message:n.validateMessage}),z()):(n.status="passed",l(),z())})):l()}),N=a=>{if(d&&e.rules){const{validateTrigger:l}=d.props,t=ne(l).includes(a),s=e.rules.filter(i=>i.trigger?ne(i.trigger).includes(a):t);s.length&&X(s)}},$=(a,l="onChange")=>{var t,s;const i=a;a=(u=>{var h;const{maxlength:k}=e;if(x(k)&&w(u)>+k){const C=y();if(C&&w(C)===+k)return C;const Q=(h=v.value)==null?void 0:h.selectionEnd;if(n.focused&&Q){const F=[...u],Z=F.length-+k;return F.splice(Q-Z,Z),F.join("")}return U(u,+k)}return u})(a);const f=w(i)-w(a);if(e.type==="number"||e.type==="digit"){const u=e.type==="number";a=He(a,u,u),l==="onBlur"&&a!==""&&(e.min!==void 0||e.max!==void 0)&&(a=Ne(+a,(t=e.min)!=null?t:-1/0,(s=e.max)!=null?s:1/0).toString())}let m=0;if(e.formatter&&l===e.formatTrigger){const{formatter:u,maxlength:h}=e;if(a=u(a),x(h)&&w(a)>+h&&(a=U(a,+h)),v.value&&n.focused){const{selectionEnd:k}=v.value,C=U(i,k);m=w(u(C))-w(C)}}if(v.value&&v.value.value!==a)if(n.focused){let{selectionStart:u,selectionEnd:h}=v.value;if(v.value.value=a,x(u)&&x(h)){const k=w(a);f?(u-=f,h-=f):m&&(u+=m,h+=m),v.value.setSelectionRange(Math.min(u,k),Math.min(h,k))}}else v.value.value=a;a!==e.modelValue&&r("update:modelValue",a)},ce=a=>{a.target.composing||$(a.target.value)},O=()=>{var a;return(a=v.value)==null?void 0:a.blur()},Y=()=>{var a;return(a=v.value)==null?void 0:a.focus()},q=()=>{const a=v.value;e.type==="textarea"&&e.autosize&&a&&function(l,t){const s=Ve();l.style.height="auto";let i=l.scrollHeight;if(Ie(t)){const{maxHeight:f,minHeight:m}=t;f!==void 0&&(i=Math.min(i,f)),m!==void 0&&(i=Math.max(i,m))}i&&(l.style.height=`${i}px`,Me(s))}(a,e.autosize)},de=a=>{n.focused=!0,r("focus",a),W(q),g("readonly")&&O()},ge=a=>{n.focused=!1,$(y(),"onBlur"),r("blur",a),g("readonly")||(N("onBlur"),W(q),Ke())},_=a=>r("clickInput",a),fe=a=>r("clickLeftIcon",a),ve=a=>r("clickRightIcon",a),G=V(()=>typeof e.error=="boolean"?e.error:!(!d||!d.props.showError||n.status!=="failed")||void 0),pe=V(()=>{const a=g("labelWidth"),l=g("labelAlign");if(a&&l!=="top")return{width:te(a)}}),me=a=>{a.keyCode===13&&(d&&d.props.submitOnEnter||e.type==="textarea"||K(a),e.type==="search"&&O()),r("keypress",a)},J=()=>e.id||`${I}-input`,be=()=>{const a=b("control",[g("inputAlign"),{error:G.value,custom:!!c.input,"min-height":e.type==="textarea"&&!e.autosize}]);if(c.input)return o("div",{class:a,onClick:_},[c.input()]);const l={id:J(),ref:v,name:e.name,rows:e.rows!==void 0?+e.rows:void 0,class:a,disabled:g("disabled"),readonly:g("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,autocapitalize:e.autocapitalize,autocorrect:e.autocorrect,enterkeyhint:e.enterkeyhint,spellcheck:e.spellcheck,"aria-labelledby":e.label?`${I}-label`:void 0,"data-allow-mismatch":"attribute",onBlur:ge,onFocus:de,onInput:ce,onClick:_,onChange:ue,onKeypress:me,onCompositionend:ue,onCompositionstart:_e};return e.type==="textarea"?o("textarea",l,null):o("input",Fe((t=e.type)==="number"?{type:"text",inputmode:"decimal"}:t==="digit"?{type:"tel",inputmode:"numeric"}:{type:t},l),null);var t},he=()=>{const a=c["right-icon"];if(e.rightIcon||a)return o("div",{class:b("right-icon"),onClick:ve},[a?a():o(P,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},ye=()=>{if(e.showWordLimit&&e.maxlength){const a=w(y());return o("div",{class:b("word-limit")},[o("span",{class:b("word-num")},[a]),Re("/"),e.maxlength])}},ke=()=>{if(d&&d.props.showErrorMessage===!1)return;const a=e.errorMessage||n.validateMessage;if(a){const l=c["error-message"],t=g("errorMessageAlign");return o("div",{class:b("error-message",t)},[l?l({message:a}):a])}},xe=()=>[o("div",{class:b("body")},[be(),j.value&&o(P,{ref:L,name:e.clearIcon,class:b("clear")},null),he(),c.button&&o("div",{class:b("button")},[c.button()])]),ye(),ke()];return Te({blur:O,focus:Y,validate:X,formValue:T,resetValidation:S,getValidationStatus:()=>n.status}),$e(Oe,{customValue:p,resetValidation:S,validateWithTrigger:N}),qe(()=>e.modelValue,()=>{$(y()),S(),N("onChange"),W(q)}),De(()=>{$(y(),e.formatTrigger),W(q)}),We("touchstart",a=>{K(a),r("update:modelValue",""),r("clear",a)},{target:V(()=>{var a;return(a=L.value)==null?void 0:a.$el})}),()=>{const a=g("disabled"),l=g("labelAlign"),t=(()=>{const s=c["left-icon"];if(e.leftIcon||s)return o("div",{class:b("left-icon"),onClick:fe},[s?s():o(P,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])})();return o(Ye,{size:e.size,class:b({error:G.value,disabled:a,[`label-${l}`]:l}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:pe.value,valueClass:b("value"),titleClass:[b("label",[l,{required:H.value}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:t&&l!=="top"?()=>t:null,title:()=>{const s=(()=>{const i=g("labelWidth"),f=g("labelAlign"),m=g("colon")?":":"";return c.label?[c.label(),m]:e.label?o("label",{id:`${I}-label`,for:c.input?void 0:J(),"data-allow-mismatch":"attribute",onClick:u=>{K(u),Y()},style:f==="top"&&i?{width:te(i)}:void 0},[e.label+m]):void 0})();return l==="top"?[t,s].filter(Boolean):s||[]},value:xe,extra:c.extra})}}});const Qe=re(Je);export{Qe as F};

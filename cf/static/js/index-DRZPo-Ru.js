import{c as V,d as G,r as k,ah as Q,av as de,aq as Oe,W as I,ar as _,w as Z,aF as me,aG as ge,aH as $e,o as ee,L as Ye,aI as Xe,aJ as Ze,b as he,aK as pe,e as w,t as $,n as M,V as E,aL as ae,aM as fe,j as J,a3 as oe,aN as B,s as te,au as ke,aO as Te,T as ve,a1 as Be,k as we,g as ie,Y as Re,aP as He,m as le,I as ye,at as se,aQ as Me,aw as Le,aR as be,a6 as We,p as De,P as Ee,h as Ne,i as xe,$ as je,a4 as Fe,l as Ae,aS as qe,aT as Ue}from"./index-Ce_DXvk7.js";const[Ce,ne]=V("swipe"),Ve={loop:$,width:M,height:M,vertical:Boolean,autoplay:E(0),duration:E(500),touchable:$,lazyRender:Boolean,initialSwipe:E(0),indicatorColor:String,showIndicators:$,stopPropagation:$},Se=Symbol(Ce),Ge=te(G({name:Ce,props:Ve,emits:["change","dragStart","dragEnd"],setup(e,{emit:f,slots:m}){const a=k(),c=k(),o=Q({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let b=!1;const y=de(),{children:v,linkChildren:z}=Oe(Se),l=I(()=>v.length),g=I(()=>o[e.vertical?"height":"width"]),h=I(()=>e.vertical?y.deltaY.value:y.deltaX.value),S=I(()=>o.rect?(e.vertical?o.rect.height:o.rect.width)-g.value*l.value:0),Y=I(()=>g.value?Math.ceil(Math.abs(S.value)/g.value):l.value),s=I(()=>l.value*g.value),C=I(()=>(o.active+l.value)%l.value),O=I(()=>{const t=e.vertical?"vertical":"horizontal";return y.direction.value===t}),d=I(()=>{const t={transitionDuration:`${o.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+o.offset.toFixed(2)}px)`};if(g.value){const u=e.vertical?"height":"width",n=e.vertical?"width":"height";t[u]=`${s.value}px`,t[n]=e[n]?`${e[n]}px`:""}return t}),X=(t,u=0)=>{let n=t*g.value;e.loop||(n=Math.min(n,-S.value));let p=u-n;return e.loop||(p=B(p,S.value,0)),p},x=({pace:t=0,offset:u=0,emitChange:n})=>{if(l.value<=1)return;const{active:p}=o,P=(D=>{const{active:ce}=o;return D?e.loop?B(ce+D,-1,l.value):B(ce+D,0,Y.value):ce})(t),W=X(P,u);if(e.loop){if(v[0]&&W!==S.value){const D=W<S.value;v[0].setOffset(D?s.value:0)}if(v[l.value-1]&&W!==0){const D=W>0;v[l.value-1].setOffset(D?-s.value:0)}}o.active=P,o.offset=W,n&&P!==p&&f("change",C.value)},T=()=>{o.swiping=!0,o.active<=-1?x({pace:l.value}):o.active>=l.value&&x({pace:-l.value})},A=()=>{T(),y.reset(),ae(()=>{o.swiping=!1,x({pace:1,emitChange:!0})})};let N;const L=()=>clearTimeout(N),R=()=>{L(),+e.autoplay>0&&l.value>1&&(N=setTimeout(()=>{A(),R()},+e.autoplay))},H=(t=+e.initialSwipe)=>{if(!a.value)return;const u=()=>{var n,p;if(!fe(a)){const P={width:a.value.offsetWidth,height:a.value.offsetHeight};o.rect=P,o.width=+((n=e.width)!=null?n:P.width),o.height=+((p=e.height)!=null?p:P.height)}l.value&&(t=Math.min(l.value-1,t))===-1&&(t=l.value-1),o.active=t,o.swiping=!0,o.offset=X(t),v.forEach(P=>{P.setOffset(0)}),R()};fe(a)?J().then(u):u()},q=()=>H(o.active);let U;const K=t=>{!e.touchable||t.touches.length>1||(y.start(t),b=!1,U=Date.now(),L(),T())},i=()=>{if(!e.touchable||!o.swiping)return;const t=Date.now()-U,u=h.value/t;if((Math.abs(u)>.25||Math.abs(h.value)>g.value/2)&&O.value){const n=e.vertical?y.offsetY.value:y.offsetX.value;let p=0;p=e.loop?n>0?h.value>0?-1:1:0:-Math[h.value>0?"ceil":"floor"](h.value/g.value),x({pace:p,emitChange:!0})}else h.value&&x({pace:0});b=!1,o.swiping=!1,f("dragEnd",{index:C.value}),R()},r=(t,u)=>{const n=u===C.value,p=n?{backgroundColor:e.indicatorColor}:void 0;return w("i",{style:p,class:ne("indicator",{active:n})},null)};return _({prev:()=>{T(),y.reset(),ae(()=>{o.swiping=!1,x({pace:-1,emitChange:!0})})},next:A,state:o,resize:q,swipeTo:(t,u={})=>{T(),y.reset(),ae(()=>{let n;n=e.loop&&t===l.value?o.active===0?0:t:t%l.value,u.immediate?ae(()=>{o.swiping=!1}):o.swiping=!1,x({pace:n-o.active,emitChange:!0})})}}),z({size:g,props:e,count:l,activeIndicator:C}),Z(()=>e.initialSwipe,t=>H(+t)),Z(l,()=>H(o.active)),Z(()=>e.autoplay,R),Z([me,ge,()=>e.width,()=>e.height],q),Z($e(),t=>{t==="visible"?R():L()}),ee(H),Ye(()=>H(o.active)),Xe(()=>H(o.active)),Ze(L),he(L),pe("touchmove",t=>{e.touchable&&o.swiping&&(y.move(t),O.value)&&(!e.loop&&(o.active===0&&h.value>0||o.active===l.value-1&&h.value<0)||(oe(t,e.stopPropagation),x({offset:h.value}),b||(f("dragStart",{index:C.value}),b=!0)))},{target:c}),()=>{var t;return w("div",{ref:a,class:ne()},[w("div",{ref:c,style:d.value,class:ne("track",{vertical:e.vertical}),onTouchstartPassive:K,onTouchend:i,onTouchcancel:i},[(t=m.default)==null?void 0:t.call(m)]),m.indicator?m.indicator({active:C.value,total:l.value}):e.showIndicators&&l.value>1?w("div",{class:ne("indicators",{vertical:e.vertical})},[Array(l.value).fill("").map(r)]):void 0])}}})),[Je,Ke]=V("swipe-item"),Qe=te(G({name:Je,setup(e,{slots:f}){let m;const a=Q({offset:0,inited:!1,mounted:!1}),{parent:c,index:o}=ke(Se);if(!c)return;const b=I(()=>{const v={},{vertical:z}=c.props;return c.size.value&&(v[z?"height":"width"]=`${c.size.value}px`),a.offset&&(v.transform=`translate${z?"Y":"X"}(${a.offset}px)`),v}),y=I(()=>{const{loop:v,lazyRender:z}=c.props;if(!z||m)return!0;if(!a.mounted)return!1;const l=c.activeIndicator.value,g=c.count.value-1,h=l===0&&v?g:l-1,S=l===g&&v?0:l+1;return m=o.value===l||o.value===h||o.value===S,m});return ee(()=>{J(()=>{a.mounted=!0})}),_({setOffset:v=>{a.offset=v}}),()=>{var v;return w("div",{class:Ke(),style:b.value},[y.value?(v=f.default)==null?void 0:v.call(f):null])}}})),[_e,j]=V("image"),ze=te(G({name:_e,props:{src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:M,height:M,radius:M,lazyLoad:Boolean,iconSize:M,showError:$,errorIcon:ie("photo-fail"),iconPrefix:String,showLoading:$,loadingIcon:ie("photo"),crossorigin:String,referrerpolicy:String},emits:["load","error"],setup(e,{emit:f,slots:m}){const a=k(!1),c=k(!0),o=k(),{$Lazyload:b}=Te().proxy,y=I(()=>{const s={width:ve(e.width),height:ve(e.height)};return Be(e.radius)&&(s.overflow="hidden",s.borderRadius=ve(e.radius)),s});Z(()=>e.src,()=>{a.value=!1,c.value=!0});const v=s=>{c.value&&(c.value=!1,f("load",s))},z=()=>{const s=new Event("load");Object.defineProperty(s,"target",{value:o.value,enumerable:!0}),v(s)},l=s=>{a.value=!0,c.value=!1,f("error",s)},g=(s,C,O)=>O?O():w(ye,{name:s,size:e.iconSize,class:C,classPrefix:e.iconPrefix},null),h=()=>{if(a.value||!e.src)return;const s={alt:e.alt,class:j("img"),style:{objectFit:e.fit,objectPosition:e.position},crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy};return e.lazyLoad?Re(w("img",le({ref:o},s),null),[[He("lazy"),e.src]]):w("img",le({ref:o,src:e.src,onLoad:v,onError:l},s),null)},S=({el:s})=>{const C=()=>{s===o.value&&c.value&&z()};o.value?C():J(C)},Y=({el:s})=>{s!==o.value||a.value||l()};return b&&we&&(b.$on("loaded",S),b.$on("error",Y),he(()=>{b.$off("loaded",S),b.$off("error",Y)})),ee(()=>{J(()=>{var s;(s=o.value)!=null&&s.complete&&!e.lazyLoad&&z()})}),()=>{var s;return w("div",{class:j({round:e.round,block:e.block}),style:y.value},[h(),c.value&&e.showLoading?w("div",{class:j("loading")},[g(e.loadingIcon,j("loading-icon"),m.loading)]):a.value&&e.showError?w("div",{class:j("error")},[g(e.errorIcon,j("error-icon"),m.error)]):void 0,(s=m.default)==null?void 0:s.call(m)])}}})),Ie=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),ue=V("image-preview")[1];var ea=G({props:{src:String,show:Boolean,active:Number,minZoom:se(M),maxZoom:se(M),rootWidth:se(Number),rootHeight:se(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean},emits:["scale","close","longPress"],setup(e,{emit:f,slots:m}){const a=Q({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),c=de(),o=k(),b=k(),y=k(!1),v=k(!1);let z=0;const l=I(()=>{const{scale:i,moveX:r,moveY:t,moving:u,zooming:n,initializing:p}=a,P={transitionDuration:n||u||p?"0s":".3s"};return(i!==1||v.value)&&(P.transform=`matrix(${i}, 0, 0, ${i}, ${r}, ${t})`),P}),g=I(()=>{if(a.imageRatio){const{rootWidth:i,rootHeight:r}=e,t=y.value?r/a.imageRatio:i;return Math.max(0,(a.scale*t-i)/2)}return 0}),h=I(()=>{if(a.imageRatio){const{rootWidth:i,rootHeight:r}=e,t=y.value?r:i*a.imageRatio;return Math.max(0,(a.scale*t-r)/2)}return 0}),S=(i,r)=>{var t;if((i=B(i,+e.minZoom,+e.maxZoom+1))!==a.scale){const u=i/a.scale;if(a.scale=i,r){const n=be((t=o.value)==null?void 0:t.$el),p={x:.5*n.width,y:.5*n.height},P=a.moveX-(r.x-n.left-p.x)*(u-1),W=a.moveY-(r.y-n.top-p.y)*(u-1);a.moveX=B(P,-g.value,g.value),a.moveY=B(W,-h.value,h.value)}else a.moveX=0,a.moveY=v.value?z:0;f("scale",{scale:i,index:e.active})}},Y=()=>{S(1)};let s,C,O,d,X,x,T,A,N=!1;const L=i=>{const{touches:r}=i;if(s=r.length,s===2&&e.disableZoom)return;const{offsetX:t}=c;c.start(i),C=a.moveX,O=a.moveY,A=Date.now(),N=!1,a.moving=s===1&&(a.scale!==1||v.value),a.zooming=s===2&&!t.value,a.zooming&&(d=a.scale,X=Ie(r))},R=i=>{var r;const t=(r=b.value)==null?void 0:r.$el;if(!t)return;const u=t.firstElementChild,n=i.target===t,p=u==null?void 0:u.contains(i.target);!e.closeOnClickImage&&p||!e.closeOnClickOverlay&&n||f("close")},H=i=>{if(s>1)return;const r=Date.now()-A;c.isTap.value&&(r<250?e.doubleScale?T?(clearTimeout(T),T=null,(()=>{const t=a.scale>1?1:2;S(t,t===2||v.value?{x:c.startX.value,y:c.startY.value}:void 0)})()):T=setTimeout(()=>{R(i),T=null},250):R(i):r>We&&f("longPress"))},q=i=>{let r=!1;if((a.moving||a.zooming)&&(r=!0,a.moving&&C===a.moveX&&O===a.moveY&&(r=!1),!i.touches.length)){a.zooming&&(a.moveX=B(a.moveX,-g.value,g.value),a.moveY=B(a.moveY,-h.value,h.value),a.zooming=!1),a.moving=!1,C=0,O=0,d=1,a.scale<1&&Y();const t=+e.maxZoom;a.scale>t&&S(t,x)}oe(i,r),H(i),c.reset()},U=()=>{const{rootWidth:i,rootHeight:r}=e,t=r/i,{imageRatio:u}=a;y.value=a.imageRatio>t&&u<2.6,v.value=a.imageRatio>t&&u>=2.6,v.value&&(z=(u*i-r)/2,a.moveY=z,a.initializing=!0,Me(()=>{a.initializing=!1})),Y()},K=i=>{const{naturalWidth:r,naturalHeight:t}=i.target;a.imageRatio=t/r,U()};return Z(()=>e.active,Y),Z(()=>e.show,i=>{i||Y()}),Z(()=>[e.rootWidth,e.rootHeight],U),pe("touchmove",i=>{const{touches:r}=i;if(c.move(i),a.moving){const{deltaX:t,deltaY:u}=c,n=t.value+C,p=u.value+O;if((e.vertical?c.isVertical()&&Math.abs(p)>h.value:c.isHorizontal()&&Math.abs(n)>g.value)&&!N)return void(a.moving=!1);N=!0,oe(i,!0),a.moveX=B(n,-g.value,g.value),a.moveY=B(p,-h.value,h.value)}if(a.zooming&&(oe(i,!0),r.length===2)){const t=Ie(r),u=d*t/X;x=(n=>({x:(n[0].clientX+n[1].clientX)/2,y:(n[0].clientY+n[1].clientY)/2}))(r),S(u,x)}},{target:I(()=>{var i;return(i=b.value)==null?void 0:i.$el})}),_({resetScale:Y}),()=>{const i={loading:()=>w(Le,{type:"spinner"},null)};return w(Qe,{ref:b,class:ue("swipe-item"),onTouchstartPassive:L,onTouchend:q,onTouchcancel:q},{default:()=>[m.image?w("div",{class:ue("image-wrap")},[m.image({src:e.src,onLoad:K,style:l.value})]):w(ze,{ref:o,src:e.src,fit:"contain",class:ue("image",{vertical:y.value}),style:l.value,onLoad:K},i)]})}}});const[aa,F]=V("image-preview"),oa=["show","teleport","transition","overlayStyle","closeOnPopstate"];var Pe=G({name:aa,props:{show:Boolean,loop:$,images:Ne(),minZoom:E(1/3),maxZoom:E(3),overlay:$,vertical:Boolean,closeable:Boolean,showIndex:$,className:xe,closeIcon:ie("clear"),transition:String,beforeClose:Function,doubleScale:$,overlayClass:xe,overlayStyle:Object,swipeDuration:E(300),startPosition:E(0),showIndicators:Boolean,closeOnPopstate:$,closeOnClickImage:$,closeOnClickOverlay:$,closeIconPosition:ie("top-right"),teleport:[String,Object]},emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:f,slots:m}){const a=k(),c=k(),o=Q({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),b=()=>{if(a.value){const d=be(a.value.$el);o.rootWidth=d.width,o.rootHeight=d.height,a.value.resize()}},y=d=>f("scale",d),v=d=>f("update:show",d),z=()=>{Fe(e.beforeClose,{args:[o.active],done:()=>v(!1)})},l=d=>{d!==o.active&&(o.active=d,f("change",d))},g=()=>{if(e.showIndex)return w("div",{class:F("index")},[m.index?m.index({index:o.active}):`${o.active+1} / ${e.images.length}`])},h=()=>{if(m.cover)return w("div",{class:F("cover")},[m.cover()])},S=()=>{o.disableZoom=!0},Y=()=>{o.disableZoom=!1},s=()=>{if(e.closeable)return w(ye,{role:"button",name:e.closeIcon,class:[F("close-icon",e.closeIconPosition),je],onClick:z},null)},C=()=>f("closed"),O=(d,X)=>{var x;return(x=a.value)==null?void 0:x.swipeTo(d,X)};return _({resetScale:()=>{var d;(d=c.value)==null||d.resetScale()},swipeTo:O}),ee(b),Z([me,ge],b),Z(()=>e.startPosition,d=>l(+d)),Z(()=>e.show,d=>{const{images:X,startPosition:x}=e;d?(l(+x),J(()=>{b(),O(+x,{immediate:!0})})):f("close",{index:o.active,url:X[o.active]})}),()=>w(Ee,le({class:[F(),e.className],overlayClass:[F("overlay"),e.overlayClass],onClosed:C,"onUpdate:show":v},De(e,oa)),{default:()=>[s(),w(Ge,{ref:a,lazyRender:!0,loop:e.loop,class:F("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:l,onDragEnd:Y,onDragStart:S},{default:()=>[e.images.map((d,X)=>w(ea,{ref:x=>{X===o.active&&(c.value=x)},src:d,show:e.show,active:o.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:o.rootWidth,rootHeight:o.rootHeight,disableZoom:o.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:y,onClose:z,onLongPress:()=>f("longPress",{index:X})},{image:m.image}))]}),g(),h()]})}});let re;const ta={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"},ia=(e,f=0)=>{if(we)return re||({instance:re}=qe({setup(){const{state:m,toggle:a}=Ue(),c=()=>{m.images=[]};return()=>w(Pe,le(m,{onClosed:c,"onUpdate:show":a}),null)}})),e=Array.isArray(e)?{images:e,startPosition:f}:e,re.open(Ae({},ta,e)),re};te(Pe);export{ze as I,ia as s};

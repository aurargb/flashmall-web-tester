var L=Object.defineProperty;var U=(a,e,u)=>e in a?L(a,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):a[e]=u;var w=(a,e,u)=>U(a,typeof e!="symbol"?e+"":e,u);import{c as Y,d as q,r as S,bs as B,ah as z,av as K,w as P,aK as Q,e as g,V as N,n as W,aw as Z,j,bt as J,a3 as X,s as tt,_ as st,v as et,W as at,o as lt,ad as ot,x as h,y as b,z as c,C as d,H as l,aV as nt,bf as it,F as $,aj as k,Y as H,Z as M,E as F,Q as A,aU as x,A as ut,L as rt,bu as ct}from"./index-Ce_DXvk7.js";import{a as i}from"./projectEnum-9kZKCKr4.js";import{u as dt,_ as pt}from"./useCountdown-DD4s2lb6.js";import{_ as V}from"./TokenAmount-V2Bwu2KM.js";import{_ as mt}from"./DataRow-0sSszyJ5.js";import{b as vt}from"./cf-D0X9PrTD.js";const[gt,E,ht]=Y("pull-refresh"),ft=["pulling","loosing","success"],Tt=tt(q({name:gt,props:{disabled:Boolean,modelValue:Boolean,headHeight:N(50),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:W,successDuration:N(500),animationDuration:N(300)},emits:["change","refresh","update:modelValue"],setup(a,{emit:e,slots:u}){let t;const _=S(),D=S(),R=B(_),n=z({status:"normal",distance:0,duration:0}),p=K(),I=()=>{if(a.headHeight!==50)return{height:`${a.headHeight}px`}},y=()=>n.status!=="loading"&&n.status!=="success"&&!a.disabled,m=(s,v)=>{const r=+(a.pullDistance||a.headHeight);n.distance=s,n.status=v?"loading":s===0?"normal":s<r?"pulling":"loosing",e("change",{status:n.status,distance:s})},o=()=>{const{status:s}=n;return s==="normal"?"":a[`${s}Text`]||ht(s)},f=()=>{const{status:s,distance:v}=n;if(u[s])return u[s]({distance:v});const r=[];return ft.includes(s)&&r.push(g("div",{class:E("text")},[o()])),s==="loading"&&r.push(g(Z,{class:E("loading")},{default:o})),r},C=s=>{t=J(R.value)===0,t&&(n.duration=0,p.start(s))},G=s=>{y()&&C(s)},O=()=>{t&&p.deltaY.value&&y()&&(n.duration=+a.animationDuration,n.status==="loosing"?(m(+a.headHeight,!0),e("update:modelValue",!0),j(()=>e("refresh"))):m(0))};return P(()=>a.modelValue,s=>{n.duration=+a.animationDuration,s?m(+a.headHeight,!0):u.success||a.successText?(n.status="success",setTimeout(()=>{m(0)},+a.successDuration)):m(0,!1)}),Q("touchmove",s=>{if(y()){t||C(s);const{deltaY:v}=p;p.move(s),t&&v.value>=0&&p.isVertical()&&(X(s),m((r=>{const T=+(a.pullDistance||a.headHeight);return r>T&&(r=r<2*T?T+(r-T)/2:1.5*T+(r-2*T)/4),Math.round(r)})(v.value)))}},{target:D}),()=>{var s;const v={transitionDuration:`${n.duration}ms`,transform:n.distance?`translate3d(0,${n.distance}px, 0)`:""};return g("div",{ref:_,class:E()},[g("div",{ref:D,class:E("track"),style:v,onTouchstartPassive:G,onTouchend:O,onTouchcancel:O},[g("div",{class:E("head"),style:I()},[f()]),(s=u.default)==null?void 0:s.call(u)])])}}})),xt={class:"w-full min-h-[100px] rounded-xl bg-white mb-3 p-3"},yt={class:"base-info flex justify-between items-center"},St={class:"text-sm text-b2 font-semibold"},bt={class:"text-sm font-semibold"},Et={class:"mt-4"},_t={class:"project-title line-clamp-2"},Dt={class:"text-b1 text-base font-semibold"},Ct={key:0,class:"mt-[17px]"},wt={class:"mt-4"},Rt={class:"text-b1 text-sm font-semibold"},It={class:"ml-1"},Nt={__name:"ProjectCard",props:{project:{type:Object,default:()=>{}}},setup(a){const{t:e}=et(),u=a,t=S({});P(u.project,o=>{t.value=o||{}},{deep:!0,immediate:!0});const _=S({succeed:e("crowdfunding-success"),confirmed:e("crowdfunding-success"),failed:e("crowdfunding-failed"),in_progress:e("crowdfunding-in-progress"),not_started:e("not-started"),published:e("under-review"),not_published:e("review-not-published"),canceled:e("crowdfunding-canceled")}),D=S({succeed:"#07C160",confirmed:"#07C160",failed:"#F44",in_progress:"#FF8812",not_started:"#999",not_published:"#999",canceled:"#999"}),R=at(()=>({[i.IN_PROGRESS]:!0,[i.FAILED]:!0,[i.SUCCEED]:!0,[i.CONFIRMED]:!0,[i.CANCELED]:!0})[t.value.status]),{remainingTimeText:n,endFlag:p,startCountdown:I,stopCountdown:y}=dt({endText:e("ended"),onEnd:()=>{m()}}),m=async()=>{const o={id:t.value.id};try{const f=await vt(o);if(f.success){const C=f.data;t.value=C}}catch{}};return lt(()=>{(()=>{let o;t.value.status===i.NOT_STARTED?o=t.value.startTime:t.value.status===i.IN_PROGRESS&&(o=t.value.endTime),o&&I(o)})()}),ot(()=>{y()}),(o,f)=>(h(),b("div",xt,[c("div",yt,[c("p",St,d(l(nt)(t.value.creator,"...",4,4)),1),c("p",bt,[c("span",{style:it({color:D.value[t.value.status]})},[t.value.status==l(i).IN_PROGRESS?(h(),b($,{key:0},[k(d(l(p)?"":o.$t("remaining"))+d(l(n)),1)],64)):t.value.status==l(i).NOT_STARTED?(h(),b($,{key:1},[k(d(l(n))+d(l(p)?"":o.$t("start-after")),1)],64)):(h(),b($,{key:2},[k(d(_.value[t.value.status]||"--"),1)],64))],4)])]),c("div",Et,[c("p",_t,[H(c("em",{class:"no-public-tag text-orange1 text-xxs font-normal"},d(o.$t("not-public")),513),[[M,t.value.expose===!1]]),H(c("em",{class:"history-tag text-xxs font-normal"},d(o.$t("history")),513),[[M,t.value.history]]),c("span",Dt,d(t.value.title||"--"),1)])]),R.value?(h(),b("div",Ct,[g(pt,{class:"mt-1",progress:t.value.progress,count:t.value.collectedNum,total:t.value.targetNum,status:t.value.status},null,8,["progress","count","total","status"])])):F("",!0),c("div",wt,[t.value.status==l(i).IN_PROGRESS||t.value.status==l(i).SUCCEED||t.value.status==l(i).CONFIRMED||t.value.status==l(i).FAILED?(h(),A(V,{key:0,title:o.$t("collected"),mcoin:l(x)(t.value.collectedMcoin),mai:l(x)(t.value.collectedMai),point:l(x)(t.value.collectedPoint),type:t.value.targetType},null,8,["title","mcoin","mai","point","type"])):F("",!0),g(V,{class:"mt-2",title:o.$t("target"),mcoin:l(x)(t.value.targetMcoin),mai:l(x)(t.value.targetMai),point:l(x)(t.value.targetPoint),type:t.value.targetType},null,8,["title","mcoin","mai","point","type"]),t.value.status==l(i).IN_PROGRESS||t.value.status==l(i).SUCCEED||t.value.status==l(i).CONFIRMED||t.value.status==l(i).FAILED?(h(),A(mt,{key:1,title:o.$t("participants"),class:"mt-2"},{right:ut(()=>[c("span",Rt,d(t.value.participantNum||0),1),c("span",It,d(o.$t("person")),1)]),_:1},8,["title"])):F("",!0)])]))}},$t=st(Nt,[["__scopeId","data-v-79b6e6ae"]]);class kt{constructor(e,u){w(this,"scrollTop");w(this,"selector");w(this,"key");this.scrollTop=0,this.selector=e,this.key=u,rt(()=>{if(sessionStorage.getItem(this.key)=="1")return sessionStorage.removeItem(this.key),void this.clearScrollTop();j(()=>{const t=document.querySelector(this.selector);t&&(t.scrollTop=this.scrollTop)})}),ct(()=>{const t=document.querySelector(this.selector);this.scrollTop=t?t.scrollTop:0})}clearScrollTop(){this.scrollTop=0}getScrollTop(){return this.scrollTop}setScrollTop(e){this.scrollTop=e}}export{Tt as P,kt as S,$t as a};

import{y as A,E as G,F as c,G as n,I as R,J as D,R as Z,K as p,X as N,H as Y,Q as P,w as W,a2 as ee,l as te,r,x as y,z as ae,D as le,O as L,P as i,N as oe,Y as ue,bs as ne}from"./vendor-BlU_hoYl.js";import{_ as se}from"./GoodsEvaluateItem-CS4PG3Cx.js";import{_ as T}from"./DefaultPage-DQXPcwhv.js";import{_ as ie}from"./EvalHeader-DJqjKwds.js";import{ac as V,g as k,bZ as ve,b_ as re,aE as de}from"./index-Clz0Qna-.js";import"./BackIcon-8hcEjDKb.js";const ce={class:"flex items-center gap-2 overflow-x-auto"},me=["onClick"],fe={key:1},ge=A({props:{list:null,value:null},emits:["change"],setup(x,{emit:h}){return(C,F)=>{const d=G("van-icon");return n(),c("div",ce,[(n(!0),c(R,null,D(x.list,u=>(n(),c("div",{class:Z(["flex items-center flex-shrink-0 px-2 text-sm leading-6 rounded",{" bg-primary text-white":x.value===u.id,"bg-yellow-004":x.value!==u.id}]),key:u.id,onClick:a=>h("change",u.id)},[u.id===1?(n(),p(d,{key:0,class:"mr-1.5",name:"photo-o",size:"16"})):N("",!0),Y("span",null,P(u.name),1),u.id?(n(),c("span",fe,"("+P(u.count)+")",1)):N("",!0)],10,me))),128))])}}}),pe={class:"px-2.5 font-normal"},he={class:"bg-white rounded-xl p-2.5 min-h-[calc(100%-44px)]"},Ce=A({name:"EvaluateGood"});function ye(x){const{t:h}=W(),C=ee(),F=te(),d=r(null),u=r(null),a=r({}),z=async()=>{const e={goodsId:u.value},t=await ve(e);t.success&&(a.value=t.data)},l=r(null),E=y(()=>{var t,o,g;let e=0;switch(l.value){case 1:e=0;break;case 2:e=(t=a.value)==null?void 0:t.goodNoPicAndTextCount;break;case 3:e=(o=a.value)==null?void 0:o.badNoPicAndTextCount;break;default:e=(g=a.value)==null?void 0:g.noPicAndTextCount;break}return e}),S=y(()=>{const e={goodsId:u.value,shopId:d.value,commentLevel:l.value};return"?"+Object.keys(e).map(t=>e[t]?`${t}=${e[t]}`:"").filter(t=>t).join("&")}),j=y(()=>{var e,t,o;return[{id:null,name:h("common.all"),count:H.value},{id:1,name:h("evaluate.picture"),count:((e=a.value)==null?void 0:e.havePicsCount)||0},{id:2,name:h("evaluate.Good reviews"),count:((t=a.value)==null?void 0:t.goodCount)||0},{id:3,name:h("evaluate.Bad review"),count:((o=a.value)==null?void 0:o.badCount)||0}]}),M=e=>{l.value!==e&&(l.value=e,O())},m=r(!1),f=r(!1),s=r([]),w=r(0),U=r(20),_=r(0),H=y(()=>{var e,t,o,g,v,$,I;if(l.value===null)return(((e=a.value)==null?void 0:e.goodCount)||0)+(((t=a.value)==null?void 0:t.badCount)||0);switch(l.value){case 1:return((o=a.value)==null?void 0:o.havePicsCount)||0;case 2:return((g=a.value)==null?void 0:g.goodCount)||0;case 3:return((v=a.value)==null?void 0:v.badCount)||0;default:return((($=a.value)==null?void 0:$.goodCount)||0)+(((I=a.value)==null?void 0:I.badCount)||0)}}),J=async()=>{m.value=!0;const e=l.value,t={page:w.value,size:U.value,goodsId:u.value||null,shopId:d.value||null,commentStatus:1,commentType:null,sortBy:"desc|comment_time",havePicsFlag:null,haveContentFlag:null,havePicOrTextFlag:null};l.value==null&&(t.havePicOrTextFlag=!0),l.value==1&&(t.havePicsFlag=!0),l.value==2&&(t.commentType=2,t.havePicOrTextFlag=!0),l.value==3&&(t.commentType=1,t.havePicOrTextFlag=!0),Reflect.deleteProperty(t,"commentLevel");const o=await de(t);if(m.value=!1,!o.success){f.value=!0;return}if(!o.data||!o.data.total){f.value=!0;return}if(e!==l.value){f.value=!0;return}s.value=w.value===1?o.data.records:s.value.concat(o.data.records),_.value=o.data.total,s.value.length>=_.value&&(f.value=!0)},q=y(()=>{if(s.value&&s.value.length>0){const e=[];for(let t=0;t<s.value.length;t++)s.value[t].commentPics&&s.value[t].commentPics.length>0&&e.push(...s.value[t].commentPics.split(","));return e}return[]}),K=e=>{const t=q.value.findIndex(o=>o===e);ne({images:q.value,closeable:!0,showIndex:!0,startPosition:t})},B=async()=>{w.value+=1,await J()},O=()=>{s.value=[],w.value=0,_.value=0,f.value=!1,m.value=!1,B()},Q=async()=>{l.value=null,await z(),O()},b=e=>{F.push(e)};ae(()=>C.query.goodsId,e=>{C.path.includes("/offline-evaluate-home?goodsId=")&&u.value!==e&&u.value&&(u.value=e,Q())},{deep:!0,immediate:!0});const X=async()=>{const e={shopId:d.value},t=await re(e);t.success&&(a.value=t.data)};return le(()=>{u.value=C.query.goodsId,d.value=C.query.shopId,u.value&&z(),d.value&&X()}),(e,t)=>{const o=G("VanList"),g=G("router-view");return n(),c("div",pe,[L(ie,{title:d.value?e.$t("evaluate.shop review"):e.$t("evaluate.service review")},null,8,["title"]),Y("div",he,[L(ge,{list:i(j),value:l.value,onChange:M},null,8,["list","value"]),l.value===2&&a.value.defaultGoodCount>0&&a.value.defaultGoodCount===a.value.goodCount?(n(),p(T,{key:0,class:"text-sm",needTextTop:!0,titleColor:"#222221",url:i(k)("images/default_evaluate.png"),title:`<div style='margin-bottom:8px;'>${e.$t("evaluate.default positive reviews",{num:a.value.defaultGoodCount})}</div><div>${e.$t("evaluate.positive review time",{time:i(V)(a.value.defaultGoodLastTime,"Y-m-d")})}</div>`,top:"9rem"},null,8,["url","title"])):l.value===null&&a.value.defaultGoodCount>0&&a.value.defaultGoodCount===a.value.totalCount?(n(),p(T,{key:1,class:"text-sm",needTextTop:!0,titleColor:"#222221",url:i(k)("images/default_evaluate.png"),title:`<div style='margin-bottom:8px;'>${e.$t("evaluate.default positive reviews",{num:a.value.defaultGoodCount})}</div><div>${e.$t("evaluate.positive review time",{time:i(V)(a.value.defaultGoodLastTime,"Y-m-d")})}</div>`,top:"9rem"},null,8,["url","title"])):!s.value.length&&i(E)>0?(n(),c("div",{key:2,class:"py-8 text-sm text-center",onClick:t[0]||(t[0]=v=>b("/offline-evaluate-default"+i(S)))},P(e.$t("evaluate.without content",{num:i(E)})),1)):f.value&&_.value===0?(n(),p(T,{key:3,needTextTop:!0,titleColor:"#A45E00",url:i(k)("images/evaluate_empty.png"),title:e.$t("evaluate.No reviews yet"),top:"9rem",iconSize:"16rem"},null,8,["url","title"])):!s.value.length&&!m.value?(n(),p(T,{key:4,needTextTop:!0,titleColor:"#A45E00",url:i(k)("images/evaluate_empty.png"),title:e.$t("evaluate.No reviews yet"),top:"9rem",iconSize:"16rem"},null,8,["url","title"])):(n(),p(o,{key:5,class:"mt-4",loading:m.value,"onUpdate:loading":t[2]||(t[2]=v=>m.value=v),finished:f.value,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:B},{default:oe(()=>[(n(!0),c(R,null,D(s.value,(v,$)=>(n(),p(se,{onImgPre:K,style:ue($===s.value.length-1?"margin-bottom: 1rem":""),onClick:I=>b(`/offlineEvaluateView?id=${v.orderId}`),data:v,key:v.id},null,8,["style","onClick","data"]))),128)),!m.value&&(l.value===null&&a.value.noPicAndTextCount>0||l.value===2&&a.value.goodNoPicAndTextCount>0||l.value===3&&a.value.badNoPicAndTextCount>0)?(n(),c("div",{key:0,class:"text-sm text-center",onClick:t[1]||(t[1]=v=>b("/offline-evaluate-default"+i(S)))},P(e.$t("evaluate.without content",{num:l.value===null?a.value.noPicAndTextCount:a.value.goodNoPicAndTextCount})),1)):N("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"]))]),L(g,{class:"child-view bg-[#f2f0ef]"})])}}const Pe=A({...Ce,setup:ye});export{Pe as default};

import{_ as k,y as w,w as $,a1 as E,l as U,r as g,z,E as u,F as h,a2 as R,G as x,O as l,H as t,I as P,J as B,Q as p,N as S,X as G,P as T,T as d}from"./vendor-Ba70TIw4.js";import{_ as D}from"./GoodInfo-BFme2Yc2.js";import{g as N,a8 as q,a9 as A,a3 as H,q as O,W as j}from"./index-DGR86ePT.js";import{_ as J}from"./EvalHeader-Bib_84jg.js";import{u as M}from"./upload-28Y_C7H9.js";import{s as Q,g as W}from"./order-DXFBu85c.js";import"./GoodsPrice-9JtLUWL4.js";import"./MCOIN-BOqZVkND.js";import"./CardPrice-CeulNolr.js";import"./order-H59PKTFP.js";import"./BackIcon-DkqwcD_b.js";const X={key:0,class:"px-2.5 font-normal text-black"},Y={class:"mt-4 text-base font-normal bg-white rounded-xl"},K={class:"flex items-center px-2.5 pt-2.5"},Z={class:"mr-1"},ee={class:"flex items-center p-2.5 border-b border-solid border-[#F6F6F5]"},te={class:"mr-1"},ae={class:"p-2.5"},oe={class:"rounded-xl bg-[#F6F6F5]"},se={class:"mt-4 text-base font-normal bg-white px-2.5 pt-[14px] rounded-xl"},ne={class:""},le={class:"mr-[8px] mb-[8px] w-full h-full"},re=["src"],de={class:"mt-1 text-xs font-light text-center text-default"},ie={class:"flex justify-center pb-10 mt-10"},ce={class:"text-base"},me=w({name:"EvaluatePost"});function ue(fe){const{t:V}=$(),f=E(),b=U(),c=g(null),i=g(null),L=async()=>{const e=await W({orderId:c.value});e.success&&(e.data.dataList=e.data.dataList.map(s=>({...s,commentStar:5,commentShopStar:5,imgList:[]})),i.value=e.data)},I=async(e,s)=>{const o=q(e.file);if(!o.valid)return s.imgList.length-=1,d(o.tips);const r=A(e.file);if(!r.valid)return s.imgList.length-=1,d(r.tips);const _=await H(e,"goodsImg"),m=await M(_);if(!m.success)return d("图片上传失败"),s.imgList.length-=1;s.imgList[s.imgList.length-1]={url:O.imgUrl+m.data}},v=g(!1),F=async()=>{const e=i.value.dataList.map(o=>({orderGoodsId:o.id,commentContent:o.commentContent,commentStar:o.commentStar,commentShopStar:o.commentShopStar,commentImages:o.imgList.map(r=>r.url).join(",")}));v.value=!0;const s=await Q({dataList:e});v.value=!1,s.success&&(d.setDefaultOptions({forbidClick:!0}),d({message:V("evaluate.Evaluation success"),icon:j("toast-success.svg"),duration:2e3}),setTimeout(()=>{f.params.refresh="1",b.back()},2e3))},y=e=>{b.push(e)};return z(()=>f.query.orderId,e=>{f.path==="/evaluate-post"&&(c.value!==e||c.value===null)&&(c.value=e,L(),d.setDefaultOptions({forbidClick:!0}))},{deep:!0,immediate:!0}),(e,s)=>{const o=u("van-rate"),r=u("van-field"),_=u("van-uploader"),m=u("VanButton");return i.value?(x(),h("div",X,[l(J,{title:e.$t("evaluate.Post a review")},null,8,["title"]),(x(!0),h(P,null,B(i.value.dataList,(a,C)=>(x(),h("div",{class:"mb-8",key:C},[l(D,{orderGoodInfo:a,order:i.value.order,onHandleTo:y},null,8,["orderGoodInfo","order"]),t("div",Y,[t("div",K,[t("span",Z,p(e.$t("evaluate.Product Rating")),1),l(o,{modelValue:a.commentStar,"onUpdate:modelValue":n=>a.commentStar=n,size:20,color:"#FEA021"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",ee,[t("span",te,p(e.$t("evaluate.Store Rating")),1),l(o,{modelValue:a.commentShopStar,"onUpdate:modelValue":n=>a.commentShopStar=n,size:20,color:"#FEA021"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",ae,[t("div",oe,[l(r,{maxlength:"200",modelValue:a.commentContent,"onUpdate:modelValue":n=>a.commentContent=n,rows:"8",autosize:"",label:"",type:"textarea","show-word-limit":"",placeholder:a.commentStar<3&&a.commentStar>0?e.$t("evaluate.help merchants improve"):e.$t("evaluate.praise")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])]),t("div",se,[t("div",ne,[l(_,{modelValue:a.imgList,"onUpdate:modelValue":n=>a.imgList=n,accept:"image/*","max-count":3,"preview-size":"100%",afterRead:n=>{I(n,a)}},{default:S(()=>[t("div",le,[t("div",{style:G(a.imgList.length==0?"height: 100px;width: 100px":""),class:"flex flex-col items-center justify-center w-full h-full text-center text-black border border-dashed border-black-400"},[t("img",{src:T(N)("images/addPic.png"),class:"w-[50px] h-[50px]"},null,8,re),t("div",de,p(a.imgList.length==2?e.$t("evaluate.You can also add one"):e.$t("common.add img")),1)],4)])]),_:2},1032,["modelValue","onUpdate:modelValue","afterRead"])])])]))),128)),t("div",ie,[l(m,{loading:v.value,onClick:F,round:"",class:"h-10 min-w-[180px] px-5 font-semibold text-white btn-linear-primary"},{default:S(()=>[t("span",ce,p(e.$t("evaluate.Post a review")),1)]),_:1},8,["loading"])])])):R("",!0)}}const pe=w({...me,setup:ue}),Fe=k(pe,[["__scopeId","data-v-6fdea72e"]]);export{Fe as default};

import{_ as M}from"./USDT-Dlu99aCg.js";import{_ as k}from"./MCOIN-Bodfn-v1.js";import{_ as U,y as E,l as q,a1 as Y,w as z,r as x,x as F,bf as N,z as H,D as J,E as T,K,G as u,N as p,O as f,H as n,P as r,F as g,J as Q,I as w,Q as y,Y as W,Z}from"./vendor-Ba70TIw4.js";import{C as j}from"./CommonVanProvider-CqQk6UpZ.js";import{_ as X}from"./OfflineGoods-CAFrr8v4.js";import{_ as ee}from"./OfflineStore-CHdPP1fn.js";import{B as se}from"./BetweenTab-DPw9h7Hc.js";import{e as oe,d as O,bL as te,bM as ae}from"./index-Bsb9uxb4.js";import{a as b,O as re}from"./offlineGoods-DvT2Go6q.js";import{u as ne}from"./usePaymentBalance-D735mm3_.js";import{P as le}from"./order-H59PKTFP.js";import{_ as de}from"./RegionBox-BvMqDDAY.js";import"./BackIcon-DkqwcD_b.js";import"./ImgBoutiqueLable-BMjuak4g.js";import"./shop-CeqcS6K2.js";/* empty css                                                               */import"./piggyBank-DHjFTeuA.js";const m=_=>(W("data-v-4fbc5ff4"),_=_(),Z(),_),ie={class:"mx-3 py-3 safe-body overflow-y-auto"},ce=["onClick"],fe={class:"text-b3"},ue={class:"flex items-center font-semibold"},pe=m(()=>n("img",{src:M,class:"w-4 h-4 mr-1"},null,-1)),me=m(()=>n("span",{class:"text-b3 ml-1"},"(",-1)),_e=m(()=>n("img",{src:k,class:"w-4 h-4 mr-1"},null,-1)),he={class:"text-b1"},ge=m(()=>n("span",{class:"text-b3"},")",-1)),ye=m(()=>n("img",{src:k,class:"w-4 h-4 mr-1"},null,-1)),be={class:"text-b1"},Ie=E({name:"ConsumerOrders"});function ve(_){const{accountStore:l}=oe(),P=q(),I=Y(),{t:h}=z(),A=x(null),L=F(()=>[{label:h("order.To be confirmed"),value:b.PAYMENT_SUCCESS},{label:h("order.canceled"),value:b.CANCELLED},{label:h("order.completed"),value:b.COMPLETED},{label:h("common.all"),value:-1}]),{getPaymentBySource:$}=ne(x(!0)),s=N({status:-1,shopInfo:null,list:[],total:0,loading:!1,finished:!1}),c=N({shopId:null,orderCustomerAddress:l==null?void 0:l.account,page:0,size:20,orderStatus:-1,sortBy:"desc|create_time"}),B=o=>{s.status=o,P.replace({path:"offlineConsumerorders",query:{status:o}}),R()},D=o=>{var t;return(t=L.value.find(a=>+a.value==+o))==null?void 0:t.label},v=o=>{P.push(o)},R=async()=>{s.finished=!1,s.total=0,s.list=[],c.page=0,C()},C=async()=>{if(!(l!=null&&l.sign.address))return s.finished=!0;s.loading=!0,c.orderCustomerAddress=l==null?void 0:l.sign.address,c.page+=1,await V(),s.loading=!1},V=async()=>{s.status<0?delete c.orderStatus:c.orderStatus=s.status;const{success:o,data:t}=await te(c);if(s.loading=!1,!o){s.finished=!0;return}const{records:a,total:d,current:e,pages:i}=t;if(!d||!a||!(a!=null&&a.length)){s.finished=!0;return}s.total=d;const S=x([]);S.value=a.map(G=>({btnLoading:!1,...G})),s.list=c.page===1?S.value:s.list.concat(S.value),+e>=+i&&(s.finished=!0)};return H(()=>I.path,async o=>{if(o==="/offlineConsumerorders"){const t=sessionStorage.getItem("consumer_offline_refresh_chainOrderId");if(t){const a=s.list.findIndex(d=>d.orderId==t);if(a>-1&&s.status===b.PAYMENT_SUCCESS)s.list.splice(a,1);else if(a>-1&&s.status===-1){const d=await ae({id:t});d.success&&(s.list[a]=d.data||{})}sessionStorage.removeItem("consumer_offline_refresh_chainOrderId")}}},{deep:!0}),J(async()=>{var o,t;(o=I.query)!=null&&o.status&&(s.status=Number((t=I.query)==null?void 0:t.status)),C()}),(o,t)=>{const a=T("VanList"),d=T("router-view");return u(),K(j,{title:o.$t("offline.main title"),class:"bg-gray1 font-Puhui font-normal relative shopGoodsPage","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(e,i)=>{i.shopGoodsRef=e,A.value=e}},{right:p(()=>[f(de)]),default:p(()=>[f(se,{options:r(L),"label-key":"label","value-key":"value",modelValue:r(s).status,"onUpdate:modelValue":t[0]||(t[0]=e=>r(s).status=e),onChange:B},null,8,["options","modelValue"]),n("div",ie,[f(a,{loading:r(s).loading,"onUpdate:loading":t[1]||(t[1]=e=>r(s).loading=e),finished:r(s).finished,"immediate-check":!1,"finished-text":o.$t("common.noMore"),"loading-text":o.$t("common.loading"),onLoad:C},{default:p(()=>[(u(!0),g(w,null,Q(r(s).list,e=>(u(),g("div",{class:"offline-crad-box mb-3",key:e.orderId,onClick:i=>v(`/offlineConsumerDetail?id=${e.orderId}`)},[f(ee,{store:{images:e.shopPics,name:e.shopName},showOrderStatus:"",status:D(e.orderStatus)},null,8,["store","status"]),f(X,{"show-order-type":"",class:"mt-3",goods:{goodsName:e.relName,goodsIcons:e.relIcons,orderType:e.orderType,areaExtName2:e.areaExtName2,storeName:e.storeName},onImageClick:i=>e.orderType===r(re).GOODS?v("/offlineConsumerorders/offlineGoodsDetail?goodsId="+e.relId+(e.storeId?`&storeId=${e.storeId}`:"")):v("/shop?shopId="+e.relId)},{"bottom-left":p(()=>{var i;return[n("div",fe,y(o.$t((i=r($)(e.orderPaySource))==null?void 0:i.name)),1)]}),"bottom-price":p(()=>[n("div",ue,[e.orderPaySource===r(le).USDT_WALLET?(u(),g(w,{key:0},[pe,n("span",null,y(r(O)(e==null?void 0:e.orderRealUsdt)),1),me,_e,n("span",he,y(r(O)(e==null?void 0:e.orderRealAmount)),1),ge],64)):(u(),g(w,{key:1},[ye,n("span",be,y(r(O)(e==null?void 0:e.orderRealAmount)),1)],64))])]),_:2},1032,["goods","onImageClick"])],8,ce))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])]),f(d,{class:"child-view bg-gray1"})]),_:1},8,["title"])}}const Ce=E({...Ie,setup:ve}),Me=U(Ce,[["__scopeId","data-v-4fbc5ff4"]]);export{Me as default};

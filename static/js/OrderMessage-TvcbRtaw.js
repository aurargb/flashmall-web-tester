import{_ as re}from"./clear-post-DEgIZooW.js";import{B as ie}from"./BackIcon-8hcEjDKb.js";import{_ as P,r as g,x as R,z as ce,F as b,G as c,H as s,I as te,J as ae,R as de,X as M,a3 as ue,Q as i,P as k,n as fe,w as ne,y as me,l as pe,a2 as xe,be as ve,D as ge,bh as be,bj as he,E as j,O as q,K as X,br as Y,N as f,T as K}from"./vendor-BlU_hoYl.js";import{l as Z}from"./shop-CeqcS6K2.js";import{v as ye,l as _e}from"./index-UgIL2Smv.js";import{f as we,r as ke,q as Te,a as De}from"./mall-DBbHU8Zq.js";const Ue=["onClick","id"],Ce={class:"text-sm text-b3 font-normal flex items-center"},Le={class:"label__wrap"},Oe={key:0,class:"fm-tab-underline"},Ie={props:{options:{type:[Array,Object],required:!0},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"value"},modelValue:[String,Number,Object],scrollToSelected:{type:Boolean,default:!0},scrollOffset:{type:Number,default:16}},emits:["update:modelValue","change"],setup(d,{emit:U}){const u=d,r=g(null),I=g(null),S=g([]),T=R(()=>Array.isArray(u.options)?u.options:Object.values(u.options));function x(o){return o[u.valueKey]===u.modelValue}function B(o){U("update:modelValue",o[u.valueKey]),U("change",o[u.valueKey])}ce(()=>u.modelValue,async()=>{u.scrollToSelected&&(await fe(),C())},{immediate:!0});function C(){const o=T.value.findIndex(m=>x(m));if(o===-1)return;const O=document.getElementById(`fm-tab-item-${o}`),e=r.value;if(O&&e){const m=O.offsetLeft-(u.scrollOffset||0);e.scrollTo({left:m,behavior:"smooth"})}}let V=!1,_=0,w=0;function h(o){V=!0,_=o.touches?o.touches[0].pageX:o.pageX,w=r.value.scrollLeft}function L(o){if(!V)return;const O=o.touches?o.touches[0].pageX:o.pageX,e=_-O;r.value.scrollLeft=w+e}function $(){V=!1}return(o,O)=>(c(),b("div",{class:"fm-tab",ref:(e,m)=>{m.tabWrapper=e,r.value=e},onMousedown:h,onTouchstart:h,onMousemove:L,onTouchmove:L,onMouseup:$,onMouseleave:$,onTouchend:$},[s("div",{class:"flex flex-nowrap justify-start items-center gap-4",ref:(e,m)=>{m.tabList=e,I.value=e}},[(c(!0),b(te,null,ae(k(T),(e,m)=>(c(),b("div",{key:e[d.valueKey]??m,class:de([["fm-tab-item",{active:x(e)}],"relative last:pr-4"]),onClick:n=>B(e),ref:(n,E)=>{E.tabItems=n,S.value=n},id:`fm-tab-item-${m}`},[s("p",Ce,[s("span",Le,i(e[d.labelKey]),1),ue(o.$slots,"badge"+m,{},void 0,!0)]),x(e)?(c(),b("div",Oe)):M("",!0)],10,Ue))),128))],512)],544))}},ee=P(Ie,[["__scopeId","data-v-524e1736"]]),$e={class:"w-full bg-white rounded-xl p-3 overflow-x-hidden"},Me={class:"title__wrap w-full flex justify-start items-center"},Se={key:0,class:"w-[8px] h-[8px] rounded-full mr-1.5 bg-[#FF8812] flex-shrink-0"},Ve={class:"text-base text-b1 font-normal text-ellipsis line-clamp-1 flex-1 min-w-0"},Ee={key:1,class:"text-xs font-normal border border-[#FF8812] rounded-[2px] px-1 text-[#FF8812] ml-1 flex-shrink-0"},Fe=["innerHTML"],qe={class:"time__wrap w-full mt-2 no-wrap text-right"},Re={class:"text-sm text-b3 font-normal"},Be={props:{item:{type:Object,default:()=>{}}},setup(d){const U=d,{t:u}=ne(),{currentLocale:r}=ye(),I={1:"支付结果",2:"物流",3:"售后",4:"线下服务",5:"审核",11:"物流",12:"售后",13:"补货",14:"审核",15:"线下服务"},S=R(()=>{const T=U.item[`content${Z[r.value]}`]||U.item.contentCn||U.item.contentEn;return T?T.replace(/<[^>]*>/g,""):""});return(T,x)=>(c(),b("div",$e,[s("div",Me,[d.item.readFlag?M("",!0):(c(),b("div",Se)),s("p",Ve,i(d.item[`title${k(Z)[k(r)]}`]||d.item.titleCn||d.item.titleEn),1),d.item.category?(c(),b("p",Ee,i(I[d.item.category]),1)):M("",!0)]),s("div",{class:"content__wrap w-full text-sm text-b2 font-normal mt-2 line-clamp-2",innerHTML:k(S)},null,8,Fe),s("div",qe,[s("p",Re,i(k(_e)(d.item.updateTime||d.item.createTime)),1)])]))}},je=P(Be,[["__scopeId","data-v-059c4392"]]),Ke={class:"w-full h-full bg-[#f2f0ef]"},Ne={class:"header-bar sticky top-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 bg-white"},ze={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},Ae={class:"font-bold text-base text-b1"},Xe={key:1,class:"w-5 h-5",src:re,alt:"一键清空已读"},Pe={key:0},He={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ge={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},We={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Je={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Qe={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ye={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ze={key:1},et={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},tt={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},at={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},nt={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},st={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},lt={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},ot={class:"list__wrap w-full h-[calc(100vh-50px-34px)] z-10 overflow-y-auto scroll-smooth px-3 scrollPage"},rt=me({name:"OrderMessage"});function it(d){var J,Q;const{t:U}=ne(),u=pe(),r=xe(),I=R(()=>{var a;return((a=r.query)==null?void 0:a.type)==1?"consumer":"merchant"}),S=R(()=>[{label:"全部",value:null},{label:"支付结果",value:1},{label:"物流",value:2},{label:"售后",value:3},{label:"审核",value:5},{label:"线下服务",value:4}]),T=R(()=>[{label:"全部",value:null},{label:"物流",value:11},{label:"售后",value:12},{label:"补货",value:13},{label:"审核",value:14},{label:"线下服务",value:15}]),x=g((J=r.query)!=null&&J.category?+((Q=r.query)==null?void 0:Q.category):null),B=a=>{let l={...r.query,category:a};a||delete l.category,u.replace({path:"/orderMessage",query:l}),setTimeout(()=>{L()})},C=g(0),V=g(20),_=g(!1),w=g(!1),h=g([]),L=()=>{C.value=0,h.value=[],w.value=!1,$(),E()},$=()=>{w.value||(_.value=!0,C.value+=1,o())},o=()=>{var p;const a=x.value,l={page:C.value,size:V.value,type:(p=r.query)==null?void 0:p.type,category:a};Te(l).then(t=>{if(t.success===!1){K(t.message||"获取数据失败"),w.value=!0;return}if(a!=x.value){w.value=!0;return}const D=t.data||[],A=t.total||0;h.value=C.value===1?D:h.value.concat(D),(h.value.length>=A||D.length===0)&&(w.value=!0)}).catch(t=>{console.error("获取订单消息列表失败:",t),K("网络错误，请稍后重试"),w.value=!0}).finally(()=>{_.value=!1})},O=a=>{var D;const l=a.id;a.readFlag=!0;const p=(D=r.query)==null?void 0:D.type;m(l).then(()=>E(p)),a.goodsId;const t=a.orderId;switch(a.remindType){case 101:e("/buyerOrderList/buyerOrderDetail?id="+t);break;case 102:e("/buyerOrderList/buyerOrderDetail?id="+t);break;case 103:e("/buyerOrderList/buyerOrderDetail?id="+t);break;case 104:e("/refundDetail?id="+t);break;case 105:e("/refundDetail?id="+t);break;case 107:e("/buyerOrderList/buyerOrderDetail?id="+t);break;case 108:e("/buyerOrderList/buyerOrderDetail?id="+t);break;case 109:e("/evaluate-post?orderId="+t);break;case 110:e("/refundDetail?id="+t);break;case 111:e("/refundDetail?id="+t);break;case 112:e("/refundDetail?id="+t);break;case 201:e("/sellerOrderDetail?id="+t);break;case 205:e("/sellerOrderDetail?id="+t);break;case 2010:e("/sellerOrderDetail?id="+t);break;case 202:e("/merchantRefundDetail?id="+t);break;case 203:e("/shopGoods");break;case 204:e("/profile?path=merchant");break;case 106:e("/editShopInfo");break;case 206:e("/sellerOrderDetail?id="+t);break;case 207:e("/merchantRefundDetail?id="+t);break;case 208:e("/merchantRefundDetail?id="+t);break;case 209:e("/merchantRefundDetail?id="+t);break;case 210:e("/merchantRefundDetail?id="+t);break;case 100102:e("/offlineConsumerDetail?id="+t);break;case 100103:e("/offlineConsumerDetail?id="+t);break;case 100104:e("/offlineEvaluateSubmit?id="+t);break;case 100202:e("/offlineMerchantDetail?id="+t);break;case 1002020:e("/offlineMerchantDetail?id="+t);break;case 100203:e("/offlineMerchantDetail?id="+t);break}},e=a=>{u.push(a)},m=async a=>{await De({id:a})},n=g({}),E=async(a=(l=>(l=r.query)==null?void 0:l.type)())=>{const p=await we({type:a});if(p.success){n.value=p.data||{};return}},v=a=>a===0?0:a>99?"99+":a,[H,G]=ve(!1),N=g(null),se=()=>{var p;if(H.value)return;const a=Date.now();if(N.value&&a-N.value<2e3){K("请勿频繁点击");return}const l={type:(p=r.query)==null?void 0:p.type};G(!0),ke(l).then(t=>{t.success&&(K("已清除未读消息"),le(),L())}).catch(t=>{console.error("清空已读失败:",t)}).finally(()=>{G(!1)}),N.value=a},le=async()=>{h.value.forEach(a=>{a.readFlag=!0})};let F=null;const oe=async()=>{const a=sessionStorage.getItem("orderMessage_scrollTop");+a?F.scrollTo({top:+a,left:0,behavior:"instant"}):sessionStorage.removeItem("orderMessage_scrollTop")},z=g(!1),W=()=>{z.value||(z.value=!0,setTimeout(()=>{sessionStorage.setItem("orderMessage_scrollTop",F.scrollTop+""),z.value=!1},500))};return ge(()=>{E(),F=document.querySelector(".scrollPage"),F.addEventListener("scroll",W)}),be(()=>{var a,l;try{oe(),sessionStorage.getItem("orderMessage_refreshFlag")&&C.value>0&&(x.value=(a=r.query)!=null&&a.category?+((l=r.query)==null?void 0:l.category):null,L())}finally{sessionStorage.removeItem("orderMessage_refreshFlag")}}),he(()=>{F.removeEventListener("scroll",W)}),(a,l)=>{const p=j("van-loading"),t=j("Empty"),D=j("van-list"),A=j("van-pull-refresh");return c(),b("div",Ke,[s("section",Ne,[s("div",ze,[q(ie)]),s("div",Ae,i(a.$t("home.Order Message")),1),s("div",{class:"absolute right-4 flex items-center gap-1 -translate-y-1/2 top-1/2 w-5 h-5",onClick:se},[k(H)?(c(),X(p,{key:0,size:"20"})):(c(),b("img",Xe))])]),k(I)==="consumer"?(c(),b("section",Pe,[q(ee,{options:k(S),modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=y=>x.value=y),onChange:B,"label-key":"label","value-key":"value"},Y({_:2},[n.value.totalUnread>0?{name:"badge0",fn:f(()=>[s("span",He,i(v(n.value.totalUnread)),1)])}:void 0,n.value.paymentUnread>0?{name:"badge1",fn:f(()=>[s("span",Ge,i(v(n.value.paymentUnread)),1)])}:void 0,n.value.logisticsUnread>0?{name:"badge2",fn:f(()=>[s("span",We,i(v(n.value.logisticsUnread)),1)])}:void 0,n.value.aftersaleUnread>0?{name:"badge3",fn:f(()=>[s("span",Je,i(v(n.value.aftersaleUnread)),1)])}:void 0,n.value.reviewUnread>0?{name:"badge4",fn:f(()=>[s("span",Qe,i(v(n.value.reviewUnread)),1)])}:void 0,n.value.offlineUnread>0?{name:"badge5",fn:f(()=>[s("span",Ye,i(v(n.value.offlineUnread)),1)])}:void 0]),1032,["options","modelValue"])])):M("",!0),k(I)==="merchant"?(c(),b("section",Ze,[q(ee,{options:k(T),modelValue:x.value,"onUpdate:modelValue":l[1]||(l[1]=y=>x.value=y),onChange:B,"label-key":"label","value-key":"value"},Y({_:2},[n.value.totalUnread>0?{name:"badge0",fn:f(()=>[s("span",et,i(v(n.value.totalUnread)),1)])}:void 0,n.value.logisticsUnread>0?{name:"badge1",fn:f(()=>[s("span",tt,i(v(n.value.logisticsUnread)),1)])}:void 0,n.value.aftersaleUnread>0?{name:"badge2",fn:f(()=>[s("span",at,i(v(n.value.aftersaleUnread)),1)])}:void 0,n.value.restockUnread>0?{name:"badge3",fn:f(()=>[s("span",nt,i(v(n.value.restockUnread)),1)])}:void 0,n.value.reviewUnread>0?{name:"badge4",fn:f(()=>[s("span",st,i(v(n.value.reviewUnread)),1)])}:void 0,n.value.offlineUnread>0?{name:"badge5",fn:f(()=>[s("span",lt,i(v(n.value.offlineUnread)),1)])}:void 0]),1032,["options","modelValue"])])):M("",!0),s("section",ot,[q(A,{modelValue:_.value,"onUpdate:modelValue":l[3]||(l[3]=y=>_.value=y),onRefresh:L,"animation-duration":"0"},{default:f(()=>[h.value.length===0&&!_.value?(c(),X(t,{key:0,name:"暂无消息"})):M("",!0),q(D,{loading:_.value,"onUpdate:loading":l[2]||(l[2]=y=>_.value=y),finished:w.value,"finished-text":h.value.length===0?"":"没有更多了",onLoad:$},{default:f(()=>[(c(!0),b(te,null,ae(h.value,y=>(c(),X(je,{key:y.id,item:y,class:"mb-3 first:mt-3",onClick:dt=>O(y)},null,8,["item","onClick"]))),128))]),_:1},8,["loading","finished","finished-text"])]),_:1},8,["modelValue"])])])}}const ct=Object.assign(rt,{setup:it}),gt=P(ct,[["__scopeId","data-v-72a9b4c1"]]);export{gt as default};

import{_ as Z,x as T,F as i,G as t,H as r,I as f,J as R,X as m,Q as x,P as l,Z as W,$ as ee,y as ve,r as y,a2 as de,z as me,a7 as pe,D as ye,a9 as fe,K as S,N as E,l as Ce,E as O,O as F,a1 as $,T as Q}from"./vendor-BlU_hoYl.js";import{C as _e}from"./CommonVanProvider-CDfGVWR4.js";import{e as xe,aQ as g,aR as X,at as Y,aM as he}from"./index-UgIL2Smv.js";import{u as ge}from"./useCityMap-CU72MCNW.js";import{B as ke}from"./BetweenTab-BE6o466J.js";import{_ as be}from"./SearchBar-DHowt_Ev.js";import"./BackIcon-8hcEjDKb.js";/* empty css                                                               */import"./search-B34EARrH.js";import"./delete-Dyula9w6.js";const Ne="/static/images/gps-gray-Brgff8nc.svg",te="/static/images/flag-DsGJY6jz.svg",Se=v=>(W("data-v-0b12affc"),v=v(),ee(),v),Ee={class:"active-cities_container px-4"},Fe=Se(()=>r("p",{class:"test-sm text-b3 font-normal"},"当前开通的城市",-1)),De=["onClick"],Ae={key:0},Le={key:1,src:te,class:"w-[18px] h-[18px] ml-1"},we={props:{cityList:{type:Array,default:()=>[]},limit:{type:[Number,String],default:5}},emits:["click"],setup(v,{emit:e}){const k=v,b=T(()=>k.cityList.slice(0,k.limit)),N=n=>{e("set",n)};return(n,C)=>(t(),i("div",Ee,[Fe,r("div",null,[(t(!0),i(f,null,R(l(b),d=>(t(),i("div",{key:d.name,class:"active-cities-item h-[52px] border-b border-solid border-[#E5E5E5] flex items-center justify-start text-sm font-normal text-b1",onClick:D=>N(d)},[r("span",null,x(d.areaName),1),Number(d.storeCount)>0?(t(),i("span",Ae,"(代买单门店"+x(d.storeCount)+"家)",1)):m("",!0),d.visitedFlag?(t(),i("img",Le)):m("",!0)],8,De))),128))])]))}},Be=Z(we,[["__scopeId","data-v-0b12affc"]]),se=v=>(W("data-v-40b9cb5f"),v=v(),ee(),v),Pe={class:"px-3 pb-2"},Re={class:"h-[calc(100vh-127px)] overflow-y-auto relative"},$e={key:0,class:"search-result"},Ie={class:"px-4 pt-3"},Ve=se(()=>r("p",{class:"text-sm font-normal text-b3"},"当前定位城市/上次选择",-1)),Oe={class:"py-4 flex items-center justify-start gap-3"},Te=se(()=>r("img",{src:Ne,class:"w-4 h-4 mr-1"},null,-1)),qe={class:"text-sm font-normal text-b1"},je=$(" 定位失败 "),Ue=$(" 定位中... "),Ke={class:"text-sm font-normal text-b1"},Me={class:"text-sm font-normal text-b1"},ze={key:0},He={class:"relative"},Ge={class:"flex items-center justify-start"},Je={class:"custom-title"},Qe={key:0,src:te,class:"w-[18px] h-[18px] ml-1"},Xe=ve({setup(v){var K;const{cityMapStore:e}=xe(),{getUserLocation:k}=ge(),b=de(),N=Ce(),n=y(null),C=y([]),d=y(!1),D=y(!1),p=y([]),u={CN:!1,OVERSEAS:!0},ae=[{label:"国内(含港澳台)",value:u.CN},{label:"海外",value:u.OVERSEAS}],a=y({status:((K=e.currentActiveCity)==null?void 0:K.overseasFlag)||!1,keyword:"",isSelector:b.query.mode==="select",fromRoute:b.query.from?decodeURIComponent(String(b.query.from)):""}),I=y([]);me(()=>n.value,s=>{s?I.value=Object.keys(n.value):I.value=[]},{immediate:!0,deep:!0});const oe=T(()=>pe.isEmpty(n.value)),q=T(()=>a.value.keyword.trim()!==""&&d.value),ie=s=>{a.value.status=s,n.value=[],q.value?(s===u.CN?n.value=g(e.regions,"areaNamePinyinFirstPrefix",2):n.value=g(e.overseasRegions,"areaNamePinyinFirstPrefix",1),j(a.value.keyword)):s===u.CN?n.value=g(e.regions,"areaNamePinyinFirstPrefix",2):n.value=g(e.overseasRegions,"areaNamePinyinFirstPrefix",1),p.value=e.getActiveCitiesList(s!==u.CN)||[],V(p.value)},j=async s=>{if(console.log("搜索关键词:",s),!s.trim()){C.value=[];return}d.value=!0;try{const o={areaLevel:a.value.status==u.CN?"2":"1",keywords:s.trim()};D.value=!0,Q.loading({message:"搜索中...",duration:0,forbidClick:!1});const _=await he(a.value.status,o);C.value=_.data||[]}catch(o){console.error("搜索失败:",o),C.value=[]}finally{Q.clear(),D.value=!1}},le=()=>{C.value=[],d.value=!1},re=()=>{h(e.locationCity),setTimeout(()=>{k("reset")},1e3)},h=s=>{!s||!s.areaName||(a.value.isSelector?e.setSelectedArea(s):e.setCurrentCity(s,"manual"),a.value.fromRoute==="back"?N.back():N.replace({path:a.value.fromRoute}))},U=y({}),ne=async()=>{p.value=e.getActiveCitiesList(a.value.status!==u.CN)||[];try{const[s,o]=await Promise.all([X({overseasFlag:!1}),X({overseasFlag:!0})]),_=s.data||[],A=o.data||[];e.setActiveCitiesList(_,!1),e.setActiveCitiesList(A,!0),p.value=a.value.status===u.CN?_:A,V(p.value)}catch(s){console.error("获取开通城市失败:",s),p.value=e.getActiveCitiesList(a.value.status!==u.CN)||[],V(p.value)}},V=s=>{s.forEach(o=>{o.visitedFlag&&(U.value[o.areaName]=!0)})},ue=()=>{N.push("/city/footprints")};return ye(()=>{e.regions||e.init(),a.value.status===u.CN?n.value=g(e.regions,"areaNamePinyinFirstPrefix",2):n.value=g(e.overseasRegions,"areaNamePinyinFirstPrefix",1),ne(),document.querySelector("#app").style.minHeight="580px"}),fe(()=>{document.querySelector("#app").style.minHeight=null}),(s,o)=>{const _=O("van-cell"),A=O("van-index-anchor"),ce=O("van-index-bar");return t(),S(_e,{title:"当前位置",class:"bg-white font-Puhui font-normal relative min-h-[560px]","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(L,w)=>{w.searchRef=L}},{right:E(()=>[a.value.isSelector?m("",!0):(t(),i("div",{key:0,class:"text-sm font-normal text-b2",onClick:ue}," 足迹 "))]),default:E(()=>{var L,w,M,z,H,G,J;return[r("section",null,[r("div",Pe,[F(be,{modelValue:a.value.keyword,"onUpdate:modelValue":o[0]||(o[0]=c=>a.value.keyword=c),placeholder:"搜索城市名称/拼音","search-button-text":"搜索",onSearch:j,onClear:le},null,8,["modelValue"])]),F(ke,{options:ae,"label-key":"label","value-key":"value",modelValue:a.value.status,"onUpdate:modelValue":o[1]||(o[1]=c=>a.value.status=c),onChange:ie,class:"relative z-10"},null,8,["modelValue"]),r("section",Re,[l(q)?(t(),i("div",$e,[C.value.length===0&&!D.value?(t(),S(Y,{key:0,name:"暂无搜索结果"})):m("",!0),(t(!0),i(f,null,R(C.value,c=>(t(),S(_,{class:"w-full",title:c.areaName,key:c.areaId,onClick:B=>h(c)},null,8,["title","onClick"]))),128))])):(t(),i(f,{key:1},[r("div",Ie,[Ve,r("div",Oe,[r("div",{class:"area-box position-box",onClick:o[2]||(o[2]=c=>l(e).locationCity?re():l(k)("reset"))},[Te,r("span",qe,[l(e).locationCity?(t(),i(f,{key:0},[$(x(((L=l(e).locationCity)==null?void 0:L.areaName)||"--"),1)],64)):l(e).locationCity?(t(),i(f,{key:2},[Ue],64)):(t(),i(f,{key:1},[je],64))])]),a.value.status===u.CN&&l(e).lastSelectCity&&((w=l(e).lastSelectCity)==null?void 0:w.areaId)!=((M=l(e).locationCity)==null?void 0:M.areaId)?(t(),i("div",{key:0,class:"area-old-box position-box",onClick:o[3]||(o[3]=c=>h(l(e).lastSelectCity))},[r("span",Ke,x((z=l(e).lastSelectCity)==null?void 0:z.areaName),1)])):m("",!0),a.value.status===u.OVERSEAS&&l(e).lastSelectOverseasCity&&((H=l(e).lastSelectOverseasCity)==null?void 0:H.areaId)!=((G=l(e).locationCity)==null?void 0:G.areaId)?(t(),i("div",{key:1,class:"area-old-box position-box",onClick:o[4]||(o[4]=c=>h(l(e).lastSelectOverseasCity))},[r("span",Me,x((J=l(e).lastSelectOverseasCity)==null?void 0:J.areaName),1)])):m("",!0)])]),a.value.status===u.CN?(t(),i("div",ze,[F(Be,{cityList:p.value,onSet:h,limit:5},null,8,["cityList"])])):m("",!0),r("div",He,[l(oe)?(t(),S(Y,{key:0,name:"暂无地区数据"})):m("",!0),F(ce,{sticky:!0,"index-list":I.value,teleport:"#app",class:"select-area-index-bar"},{default:E(()=>[(t(!0),i(f,null,R(n.value,(c,B)=>(t(),i("div",{key:B},[F(A,{index:B},{default:E(()=>[$(x(B),1)]),_:2},1032,["index"]),(t(!0),i(f,null,R(c,P=>(t(),S(_,{key:P.areaId,onClick:Ye=>h(P)},{title:E(()=>[r("p",Ge,[r("span",Je,x(P.areaName),1),U.value[P.areaName]?(t(),i("img",Qe)):m("",!0)])]),_:2},1032,["onClick"]))),128))]))),128))]),_:1},8,["index-list"])])],64))])])]}),_:1},512)}}}),nt=Z(Xe,[["__scopeId","data-v-40b9cb5f"]]);export{nt as default};

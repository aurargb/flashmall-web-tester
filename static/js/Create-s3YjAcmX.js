import{_ as ne,y as W,w as ie,a2 as ce,l as de,x as C,r as E,z as me,D as pe,bj as fe,E as k,K as I,G as c,N as y,H as s,F as m,X as F,O as x,P as r,bE as xe,bF as ve,a4 as _e,Q as b,bc as z,bp as O,R as q,a1 as J,Z as ge,$ as he,bs as we,T as S,aH as ye}from"./vendor-BlU_hoYl.js";import{u as Fe}from"./upload-Bd5o3h4D.js";import{e as be,W as T,aw as Be,a3 as Ne,q as Ce,r as Ee,aO as $}from"./index-Clz0Qna-.js";import{i as ke,b as H}from"./offlineGoods-DvT2Go6q.js";import{C as Se}from"./CommonVanProvider-CDfGVWR4.js";import{_ as De,a as Ie}from"./GoodItem-D2-TUjur.js";import"./BackIcon-8hcEjDKb.js";import"./collect-EjkhARjb.js";import"./useCityMap-L2xSDWSa.js";import"./MCOIN-Bodfn-v1.js";import"./ImgBoutiqueLable-BIio6fYG.js";import"./shop-CeqcS6K2.js";const K=""+new URL("../images/arrow-down-fill2-BCS2ivEO.svg",import.meta.url).href,Q=""+new URL("../images/arrow-down-fill-LyJdP7Ry.svg",import.meta.url).href,D=B=>(ge("data-v-1a35b6e8"),B=B(),he(),B),Te={class:"bg-white rounded-xl overflow-hidden mx-3 px-3 py-3 title"},Pe={class:"van-uploader__wrapper flex flex-wrap gap-3"},Ve=["onClick"],Ae={class:"van-image van-uploader__preview-image",style:{width:"72.5px",height:"72.5px"}},Re={class:"w-[72.5px] h-[72.5px] border border-dashed border-b4 rounded-md text-center flex flex-col justify-center items-center text-[#d9d9d9]"},Ge=D(()=>s("div",{class:"text-xxs font-light text-center text-b1 opacity-30"}," 添加图片 ",-1)),Ue={class:"text-xxs font-light text-center text-b1 opacity-30"},je={class:"border-b4 border-b border-solid py-3 flex items-center justify-between"},Le={class:"text-b3 text-sm font-normal shrink-0"},Me={class:"pt-3"},ze={class:"text-b3 text-sm font-normal w-full text-right"},Oe={class:"bg-white rounded-xl m-3 px-3 py-4"},qe={class:"flex items-center justify-between"},$e=D(()=>s("div",{class:"text-b1 text-sm font-semibold min-w-fit"},"门店信息",-1)),He={key:0,class:"ml-auto max-w-[70%] line-clamp-1 text-right"},We={key:1,class:"w-full text-right"},Je={key:2,src:K,class:"w-4 h-4 ml-[2px]"},Ke={key:3,src:Q,class:"w-4 h-4 ml-[2px]"},Qe={key:0,class:"bg-[#F5F5F5] rounded-lg p-3 mt-3"},Xe={key:0,class:"bg-white rounded-[10px] m-3 px-3 py-4"},Ze={class:"flex items-center justify-between"},Ye=D(()=>s("div",{class:"text-b1 text-sm font-semibold min-w-fit"},"服务信息",-1)),et={key:0,class:"ml-auto max-w-[70%] line-clamp-1 text-right"},tt={key:1,class:"w-full text-right"},ot={key:2,src:K,class:"w-4 h-4 ml-[2px]"},st={key:3,src:Q,class:"w-4 h-4 ml-[2px]"},at={key:0,class:"bg-[#F5F5F5] rounded-xl p-3 mt-3"},rt=D(()=>s("div",{class:"h-[74px]"},null,-1)),lt={class:"fixed bottom-0 left-0 w-full flex items-center px-3 pt-4 safe-bottom justify-evenly gap-x-3 btn-wrapper"},ut=J(" 存草稿 "),nt=J(" 发布笔记 "),it=W({name:"CreateNote"});function ct(B){const{t:P}=ie(),{loadingToggle:N}=Ee(),V=ce(),v=de(),{cityMapStore:a}=be(),A=C(()=>{var e;return((e=V.query)==null?void 0:e.noteId)||""}),u=E({storeNoteTopic:"",storeNoteContent:"",releaseFlag:null}),g=E(!1),d=E([]),R=E(6),X=C(()=>{var e;return((e=V.query)==null?void 0:e.storeId)||""}),n=C(()=>a.selectedStore),f=C(()=>a.selectedGoods);me(()=>n.value,(e,t)=>{e&&t&&a.setSelectedGoods(null)},{immediate:!0,deep:!0});const Z=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,o=e==="x"?t:t&3|8;return o.toString(16)}),Y=e=>{if(H.find(o=>{var l;return o===((l=e.type)==null?void 0:l.toLowerCase())}))return!0;S.fail("仅支持上传以下格式："+H.map(o=>{var l;return(l=o.replaceAll("image/",""))==null?void 0:l.toLocaleUpperCase()}).join("/"))},ee=async e=>{if(d.value.length>=R.value)return;S.loading({message:"上传中...",forbidClick:!0,duration:0});const t=await Ne(e,"noteImg"),o=await Fe(t);S.clear(),o.success&&d.value.push({id:Z(),url:Ce.imgUrl+o.data})},te=e=>{we({images:d.value.map(t=>t.url),startPosition:e})},oe=()=>{a.setNoteForm({storeNoteTopic:u.value.storeNoteTopic,storeNoteContent:u.value.storeNoteContent,storeNotePics:d.value.join(","),store:a.selectedStore,goods:a.selectedGoods}),v.push("/city/noteCreate/selectStore")},se=()=>{v.push({path:"/city/noteCreate/selectGoods",query:{storeName:encodeURIComponent(n.value.storeName||"选择服务"),storeId:n.value.storeId}})},ae=async()=>{if(g.value||!U())return;g.value=!0,N(!0);const e=G(),t=await $({...e,releaseFlag:!1});g.value=!1,N(!1),t.success&&(h("保存成功","toast-success.svg"),setTimeout(()=>{v.replace("/city/draftNote")},1500))},re=async()=>{g.value||U()&&ye.confirm({messageAlign:"center",message:"发布后不可编辑，已发布笔记可通过“存草稿”再次发布",confirmButtonText:P("common.confirm"),confirmButtonColor:"#FF507A",cancelButtonText:P("common.cancel"),cancelButtonColor:"#2E2008"}).then(async()=>{g.value=!0,N(!0);const e=G(),t=await $({...e,releaseFlag:!0});g.value=!1,N(!1),t.success&&(h("发布成功","toast-success.svg"),setTimeout(()=>{var o,l,i;((i=(l=(o=v.options)==null?void 0:o.history)==null?void 0:l.state)==null?void 0:i.back.indexOf("/city/myNote"))>-1?(v.back(),setTimeout(()=>{v.replace("/city/myNote")},50)):v.replace("/city/myNote")},1500))}).catch(()=>{})},h=(e="",t="toast-warn.svg")=>{S({message:e,icon:T(t),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})},G=()=>{var l,i;const e=d.value.map(p=>p.url).join(","),t=(l=n.value)==null?void 0:l.storeId,o=(i=f.value)==null?void 0:i.goodsId;return{...u.value,storeNotePics:e,storeId:t,goodsId:o}},U=()=>d.value.length?u.value.storeNoteTopic?u.value.storeNoteContent?n.value?!0:(h("请选择门店"),!1):(h("请输入笔记内容"),!1):(h("请输入笔记标题"),!1):(h("请上传笔记图片"),!1),le=async()=>{var t,o,l,i,p,w;const e=await Be({id:A.value});e.success&&(u.value=e.data||{},d.value=(t=e.data)!=null&&t.storeNotePics?(o=e.data)==null?void 0:o.storeNotePics.split(","):[],(l=e.data)!=null&&l.store&&a.setSelectedStore((i=e.data)==null?void 0:i.store),(p=e.data)!=null&&p.goods&&a.setSelectedGoods((w=e.data)==null?void 0:w.goods))};return pe(()=>{var e,t,o,l,i,p;X.value||a.setSelectedStore(null),a.setSelectedGoods(null),u.value.storeNoteTopic=((e=a.noteForm)==null?void 0:e.storeNoteTopic)||"",u.value.storeNoteContent=((t=a.noteForm)==null?void 0:t.storeNoteContent)||"",d.value=(o=a.noteForm)!=null&&o.storeNotePics?(l=a.noteForm)==null?void 0:l.storeNotePics.split(","):[],a.setSelectedStore(((i=a.noteForm)==null?void 0:i.store)||null),a.setSelectedGoods(((p=a.noteForm)==null?void 0:p.goods)||null),a.setNoteForm(null),A.value&&le()}),fe(()=>{a.setSelectedStore(null)}),(e,t)=>{const o=k("VanImage"),l=k("van-uploader"),i=k("VanButton"),p=k("router-view");return c(),I(Se,{title:"发布笔记",class:"font-Puhui font-normal relative bg-gray1 min-h-full",themeVars:{navBarBackgroundColor:"#F2F0EF"}},{default:y(()=>{var w,j,L,M;return[s("div",Te,[s("div",Pe,[d.value.length?(c(),I(r(xe),ve({key:0,class:"flex flex-wrap gap-3",modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=_=>d.value=_),"item-key":"id"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"}),{item:y(({element:_,index:ue})=>[s("div",{class:"van-uploader__preview",onClick:_e(mt=>te(ue),["stop"])},[s("div",Ae,[x(o,{src:_.url,class:"van-image__img rounded-md overflow-hidden",alt:"",fit:"cover"},null,8,["src"])]),x(o,{src:r(T)("imgDel.svg"),class:"absolute top-2 right-2 w-[15px] h-[15px] bg- rounded-full",alt:"删除",fit:"cover"},null,8,["src"])],8,Ve)]),_:1},16,["modelValue"])):F("",!0),d.value.length<R.value?(c(),I(l,{key:1,accept:r(ke),"max-count":6,"preview-size":"72.5",beforeRead:Y,afterRead:ee},{default:y(()=>[s("div",Re,[x(o,{src:r(T)("image-default.svg"),class:"w-6 mx-auto overflow-hidden",alt:""},null,8,["src"]),Ge,s("div",Ue,b(d.value.length)+"/6 ",1)])]),_:1},8,["accept"])):F("",!0)]),s("div",je,[z(s("input",{type:"text",class:"w-full","onUpdate:modelValue":t[1]||(t[1]=_=>u.value.storeNoteTopic=_),maxlength:15,placeholder:"输入笔记标题"},null,512),[[O,u.value.storeNoteTopic,void 0,{trim:!0}]]),s("span",Le,b(u.value.storeNoteTopic.length)+"/15",1)]),s("div",Me,[z(s("textarea",{"onUpdate:modelValue":t[2]||(t[2]=_=>u.value.storeNoteContent=_),maxlength:200,placeholder:"输入笔记正文",class:"min-h-[100px] w-full resize-y"},null,512),[[O,u.value.storeNoteContent,void 0,{trim:!0}]]),s("p",ze,b(u.value.storeNoteContent.length)+"/200 ",1)])]),s("div",Oe,[s("div",qe,[$e,s("div",{class:q(["w-full flex items-center",r(n)?"text-[#585654]":"text-[#999]"]),onClick:oe},[r(n)&&((w=r(n))!=null&&w.storeName)?(c(),m("span",He,b(((j=r(n))==null?void 0:j.storeName)||"--"),1)):(c(),m("span",We,"去选择")),r(n)?(c(),m("img",Je)):(c(),m("img",Ke))],2)]),r(n)?(c(),m("div",Qe,[x(De,{store:r(n)},null,8,["store"])])):F("",!0)]),r(n)?(c(),m("div",Xe,[s("div",Ze,[Ye,s("div",{class:q(["w-full flex items-center",r(f)?"text-[#585654]":"text-[#999]"]),onClick:se},[r(f)&&((L=r(f))!=null&&L.goodsName)?(c(),m("span",et,b(((M=r(f))==null?void 0:M.goodsName)||"--"),1)):(c(),m("span",tt,"去选择(非必选)")),r(f)?(c(),m("img",ot)):(c(),m("img",st))],2)]),r(f)?(c(),m("div",at,[x(Ie,{goods:r(f),store:r(n)},null,8,["goods","store"])])):F("",!0)])):F("",!0),rt,s("div",lt,[x(i,{round:"",type:"primary",class:"flex-1 min-w-[130px] h-[46px] rounded-full border border-solid border-b4 bg-white text-b2 text-base font-semibold",onClick:ae},{default:y(()=>[ut]),_:1}),x(i,{round:"",class:"flex-1 min-w-[130px] h-[46px] text-base font-semibold bg-yellow text-b1",onClick:re},{default:y(()=>[nt]),_:1})]),x(p,{class:"child-view"})]}),_:1})}}const dt=W({...it,setup:ct}),Nt=ne(dt,[["__scopeId","data-v-1a35b6e8"]]);export{Nt as default};

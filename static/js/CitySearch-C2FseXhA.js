import{y as U,F as h,G as n,I as D,J as H,a4 as ue,R as de,Q as C,E as M,H as s,O as N,K as $,X as V,a1 as ve,P as k,Y as fe,_ as te,r as v,bl as he,N as ae,l as me,a2 as pe,w as _e,x as G,z as ge,D as ye,bc as be,bp as Ce,bD as we,Z as xe,$ as ke}from"./vendor-BlU_hoYl.js";import{_ as Le}from"./search-B34EARrH.js";import{_ as Se}from"./delete-Dyula9w6.js";import{B as $e}from"./BackIcon-8hcEjDKb.js";import{B as Ie}from"./BetweenTab-BE6o466J.js";import{H as se}from"./HomeGoodsItem-C90L2NDT.js";import{O as Ae}from"./OfflineMerchantLabel-BcDolHRH.js";import{u as oe}from"./useCityMap-DQk2VBUJ.js";import{e as K,aL as le,at as Ee,au as Fe}from"./index-Wb-6_0W_.js";/* empty css                                                               */import"./MCOIN-BOqZVkND.js";import"./store-CbLb3G6E.js";import"./RatioBox-X84r5IHu.js";import"./ImgBoutiqueLable-BIio6fYG.js";import"./shop-CeqcS6K2.js";const Ne={class:"flex flex-wrap items-center gap-3"},Ve=["onClick"],Re=U({props:{modelValue:null,options:null},emits:["update:modelValue","change"],setup(r,{emit:y}){function f(t){y("update:modelValue",t.value),y("change",t.value)}return(t,w)=>(n(),h("div",Ne,[(n(!0),h(D,null,H(r.options,(m,d)=>(n(),h("div",{class:de(["w-fit h-[32px] px-3 py-1.5 rounded-md text-sm flex justify-center items-center",r.modelValue===m.value?"bg-[#FFF8EC] text-[#FF8812] border-solid border border-[#FF8812]":"bg-[#F5F5F5]  text-[#585654]"]),key:m.value??d,onClick:ue(l=>f(m),["stop"])},C(m.label),11,Ve))),128))]))}}),Oe={class:"shop-img w-[80px] h-[80px] rounded-lg overflow-hidden flex-shrink-0 relative"},Be={class:"shop-content h-full ml-2 w-full"},Te={class:"w-full text-base text-b1 font-semibold flex items-center justify-between"},De={class:"line-clamp-1"},je={class:"text-sm text-b3 font-normal"},Pe={class:"h-[20px] text-sm text-b3 font-normal mt-[18px] flex items-center justify-between"},qe={class:"engagement"},Me={key:0,class:"distance"},ze={props:{backgroundColor:{type:String,default:""},store:{type:Object,default:()=>({})}},setup(r){const{distanceFormat:y}=oe(),{cityMapStore:f}=K();return(t,w)=>{var d,l,c,b,I,u,i;const m=M("van-image");return n(),h("div",{class:"w-full rounded-xl flex items-center justify-start",style:fe({backgroundColor:r.backgroundColor})},[s("div",Oe,[N(m,{width:"80",height:"80",fit:"cover",src:(((d=r.store)==null?void 0:d.storeIcons)||"").split(",")[0]},null,8,["src"]),+((l=r.store)==null?void 0:l.storeGoodsCount)>0?(n(),$(Ae,{key:0})):V("",!0)]),s("div",Be,[s("div",Te,[s("span",De,C(((c=r.store)==null?void 0:c.storeName)||""),1)]),s("div",je,C(((b=r.store)==null?void 0:b.goodsCategoryName3)||"")+" "+C(r.store.areaExtName3||""),1),s("div",Pe,[s("span",qe,[+((I=r.store)==null?void 0:I.wantCount)?(n(),h(D,{key:0},[ve(C(r.store.wantCount)+"人想要 ",1)],64)):V("",!0)]),(u=k(f).locationCoords)!=null&&u.lng&&((i=k(f).locationCoords)!=null&&i.lat)?(n(),h("span",Me,C(k(y)(r.store.distance)),1)):V("",!0)])])],4)}}},Ge="/static/images/search-recommend-DZW-4urq.svg",Ue={class:"font-Puhui"},He={key:0,class:"mb-4 flex justify-center items-center gap-3"},Ke=he('<div class="line-left" data-v-e5a7ad04></div><div class="flex items-center gap-0.5" data-v-e5a7ad04><img src="'+Ge+'" class="w-4 h-4" data-v-e5a7ad04><div class="text-sm text-b3 font-normal" data-v-e5a7ad04>大家都在搜</div></div><div class="line-right" data-v-e5a7ad04></div>',3),Ze=[Ke],Je=U({props:{keyword:null,sortAct:null},emits:["onDetail"],setup(r,{emit:y}){const f=r,{cityMapStore:t}=K(),w=v(!1),m=v(0),d=v(20),l=v(!1),c=v([]),b=async()=>{w.value=!0,m.value+=1,l.value=!1,await I(),w.value=!1},I=async()=>{var j,B,E,F;let u={goodsStatus:1,goodsNameLike:null,notBelongAreaIdPreviousLastLeaf:((j=t.currentActiveCity)==null?void 0:j.areaId)||"",overseasFlag:((B=t.currentActiveCity)==null?void 0:B.overseasFlag)||!1};f.keyword&&(u.goodsNameLike=f.keyword);let i=[f.sortAct];f.sortAct!=="asc|distance"&&i.push("asc|distance"),i.push("asc|goods_id");let R=i.length?i.join(","):null;const _={page:m.value,size:d.value,...u,longitude:t.locationCoords.lng||((E=t.currentActiveCity)==null?void 0:E.areaLongitude)||null,latitude:t.locationCoords.lat||((F=t.currentActiveCity)==null?void 0:F.areaLatitude)||null,sortBy:R},{success:g,data:A}=await le(_);if(!g||!A||!A.total){l.value=!0;return}const O=A.records||[];O.forEach(L=>{L.shopName=L.storeName||L.shopName}),c.value=m.value===1?O:[...c.value,...O],c.value.length>=A.total&&(l.value=!0)};return(u,i)=>{const R=M("van-list");return n(),h("div",Ue,[c.value.length?(n(),h("div",He,Ze)):V("",!0),N(R,{loading:w.value,"onUpdate:loading":i[0]||(i[0]=_=>w.value=_),finished:l.value,"finished-text":"","loading-text":c.value.length?u.$t("common.loading"):"",onLoad:b},{default:ae(()=>[(n(!0),h(D,null,H(c.value,_=>(n(),$(se,{key:_.goodsId,goods:_,class:"mb-4 :last:mb-0",onClick:g=>y("onDetail",_),"show-store-name":"","show-distance":""},null,8,["goods","onClick"]))),128))]),_:1},8,["loading","finished","loading-text"])])}}}),Qe=te(Je,[["__scopeId","data-v-e5a7ad04"]]),ne=r=>(xe("data-v-63d801c4"),r=r(),ke(),r),We={class:"font-Puhui font-normal relative pb-20 app-container"},Xe={class:"header__wrap w-full h-[50px]"},Ye={class:"header__title h-full van-nav-bar__content"},et={class:"van-nav-bar__left van-haptics-feedback"},tt={class:"van-nav-bar__title van-ellipsis text-b1 text-lg font-bold"},at={class:"van-nav-bar__right van-haptics-feedback text-b3"},st={class:"search__wrap w-full h-[48px] px-3 pb-3"},ot={class:"search__input w-full h-full bg-white rounded-3xl flex items-center justify-center px-3 py-2.5"},lt=ne(()=>s("div",{class:"search__icon flex-shrink-0"},[s("img",{src:Le,class:"w-4 h-4"})],-1)),nt=["placeholder","onKeyup"],rt=ne(()=>s("img",{src:Se,class:"w-4 h-4",alt:""},null,-1)),it=[rt],ct={class:"text-[#FF8812] text-sm font-semibold whitespace-nowrap"},ut={class:"list__wrap safe-bottom"},dt={class:"p-3"},vt={class:"goods__wrap overflow-y-scroll"},ft=U({name:"OfflineHome"});function ht(r){var J,Q;const y=me(),f=pe(),{cityMapStore:t}=K(),{getUserLocation:w}=oe(),{t:m}=_e(),d=v(""),l=v(((J=f.query)==null?void 0:J.tab)||"STORE"),c=v(!1),b=v(0),I=v(20),u=v(!1),i=v([]),R=G(()=>[{label:"线下门店",value:"STORE"},{label:m("shop.offline server"),value:"SERVE"}]),_=G(()=>{var a,p;let e=[];return(a=t.locationCoords)!=null&&a.lat&&((p=t.locationCoords)!=null&&p.lng)&&e.push({label:"距离优先",value:"asc|distance"}),e.push({label:"销量优先",value:"desc|store_sales_volume_order"}),l.value==="SERVE"&&e.push({label:"精选/优选优先",value:"asc|goods_sort"}),e}),g=v((Q=_.value[0])==null?void 0:Q.value),A=()=>{d.value="",E()},O=e=>{var a;l.value=e,e==="STORE"&&g.value==="asc|goods_sort"&&(g.value=(a=_.value[0])==null?void 0:a.value),y.replace({path:"/city/search",query:{tab:e}}),F()},j=e=>{g.value=e,F()},B=v(null),E=()=>{c.value||(b.value=0,u.value=!1,i.value=[],L(),B.value.blur())},F=()=>{b.value=0,u.value=!1,i.value=[],L()},L=async()=>{c.value=!0,b.value+=1,u.value=!1,await re(),c.value=!1},re=async()=>{var T,q,W,X,Y,ee;let e={};l.value==="STORE"?e={storeNameLike:d.value,areaIdPreviousLastLeaf:((T=t.currentActiveCity)==null?void 0:T.areaId)||"3501",overseasFlag:((q=t.currentActiveCity)==null?void 0:q.overseasFlag)||!1}:e={goodsStatus:1,goodsNameLike:d.value,belongAreaIdPreviousLastLeaf:((W=t.currentActiveCity)==null?void 0:W.areaId)||"",overseasFlag:((X=t.currentActiveCity)==null?void 0:X.overseasFlag)||!1};let a=[g.value];g.value!=="asc|distance"&&a.push("asc|distance"),l.value==="STORE"?a.push("asc|store_id"):a.push("asc|goods_id");let p=a.length?a.join(","):null;const S={page:b.value,size:I.value,...e,longitude:t.locationCoords.lng||((Y=t.currentActiveCity)==null?void 0:Y.areaLongitude)||null,latitude:t.locationCoords.lat||((ee=t.currentActiveCity)==null?void 0:ee.areaLatitude)||null,sortBy:p},{success:P,data:o}=l.value==="STORE"?await Fe(S):await le(S);if(!P||!o||!o.total){u.value=!0;return}const x=o.records||[];x.forEach(z=>{z.shopName=z.storeName||z.shopName}),i.value=b.value===1?x:[...i.value,...x],i.value.length>=o.total&&(u.value=!0)},Z=e=>{y.push({path:"/city/search/offlineGoodsDetail",query:{goodsId:e.goodsId,storeId:e.storeId,child:"1"}})},ie=e=>{console.log(e),y.push({path:"/city/search/storefront",query:{storeId:e.storeId,child:1}})},ce=G(()=>{var e,a,p;return{longitude:t.locationCoords.lng||((e=t.currentActiveCity)==null?void 0:e.areaLongitude)||null,latitude:t.locationCoords.lat||((a=t.currentActiveCity)==null?void 0:a.areaLatitude)||null,areaIdPreviousLastLeaf:((p=t.currentActiveCity)==null?void 0:p.areaId)||""}});return ge(()=>ce.value,(e,a)=>{e!=null&&e.areaIdPreviousLastLeaf&&F()},{immediate:!0,deep:!0}),ye(async()=>{var e,a,p,S;t.currentActiveCity?(e=t.locationCoords)!=null&&e.lat&&((a=t.locationCoords)!=null&&a.lng)||t.setNoAuthError():await w(),(p=f.query)!=null&&p.tab&&(l.value=(S=f.query)==null?void 0:S.tab)}),(e,a)=>{var P;const p=M("van-list"),S=M("router-view");return n(),h("div",We,[s("div",Xe,[s("div",Ye,[s("div",et,[N($e)]),s("div",tt,C(e.$t("common.search")),1),s("div",at,C((P=k(t).currentActiveCity)==null?void 0:P.areaName),1)])]),s("div",st,[s("div",ot,[lt,be(s("input",{ref:(o,x)=>{x.searchRef=o,B.value=o},type:"text","onUpdate:modelValue":a[0]||(a[0]=o=>d.value=o),class:"w-full h-full bg-transparent ml-1 font-normal",placeholder:e.$t("mall.Enter search keywords"),onKeyup:we(E,["enter"]),enterkeyhint:"search"},null,40,nt),[[Ce,d.value]]),d.value?(n(),h("div",{key:0,class:"flex-shrink-0 flex items-center justify-center",onClick:A},it)):V("",!0),s("div",{class:"search__btn ml-2 flex-shrink-0",onClick:E},[s("span",ct,C(e.$t("common.search")),1)])])]),s("div",ut,[N(Ie,{options:k(R),"label-key":"label","value-key":"value",class:"!pt-3",modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value=o),onChange:O},null,8,["options","modelValue"]),s("div",dt,[N(Re,{options:k(_),modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=o=>g.value=o),onChange:j},null,8,["options","modelValue"])]),s("div",vt,[i.value.length===0&&!c.value?(n(),$(Ee,{key:0,name:e.$t("common.No data yet")},null,8,["name"])):(n(),$(p,{key:1,loading:c.value,"onUpdate:loading":a[3]||(a[3]=o=>c.value=o),finished:u.value,"finished-text":l.value==="STORE"?e.$t("common.noMore"):"",onLoad:L},{default:ae(()=>[(n(!0),h(D,null,H(i.value,o=>{var x,T;return n(),h(D,{key:o.goodsId+o.storeId},[l.value==="STORE"?(n(),$(ze,{key:0,store:o,class:"mb-4 :last:mb-0",onClick:q=>ie(o)},null,8,["store","onClick"])):(n(),$(se,{key:1,goods:o,class:"mb-4 :last:mb-0",onClick:q=>Z(o),"show-store-name":"","show-distance":!!((x=k(t).locationCoords)!=null&&x.lat&&((T=k(t).locationCoords)!=null&&T.lng))},null,8,["goods","onClick","show-distance"]))],64)}),128))]),_:1},8,["loading","finished","finished-text"])),l.value==="SERVE"&&u.value?(n(),$(Qe,{key:2,keyword:d.value,sortAct:g.value,onOnDetail:Z},null,8,["keyword","sortAct"])):V("",!0)])]),N(S,{class:"child-view bg-gray1"})])}}const mt=Object.assign(ft,{setup:ht}),Ft=te(mt,[["__scopeId","data-v-63d801c4"]]);export{Ft as default};

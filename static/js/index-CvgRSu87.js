import{_ as ke}from"./kefu-DRX49rvc.js";import{_ as se,y as E,x as U,F as l,G as a,a2 as d,P as _,R as G,Q as C,H as s,I as j,J as oe,w as le,K as m,O as B,a0 as xe,a4 as be,T as H,a1 as we,l as Te,r as c,a8 as $e,z as Z,bh as _e,D as Ce,E as M,N as z,Y as Ie,Z as Le}from"./vendor-Ba70TIw4.js";import{e as Se,v as qe,g as Ae,bm as Re,r as Ne,X as De,bn as Be,bo as Ge,aF as ze,bb as Ee}from"./index-DiRx6UeW.js";import{a as Me}from"./shop-CeqcS6K2.js";import{_ as Ue}from"./buy-cart-m4kq4Bzt.js";import{_ as je}from"./BoutiqueLable-RObK-asU.js";import{R as ee}from"./RatioBox-hb9qVZol.js";import{_ as Oe}from"./ShopMaskTips-pbij6JLk.js";import{_ as te}from"./GoodsPrice-DfhrvFCM.js";import{_ as ae}from"./CardPrice-CeulNolr.js";import{D as Fe}from"./goods-BVwS8oFG.js";import{M as Pe}from"./MallTabBar-i9zOUNty.js";import{B as Ve}from"./BackIcon-DkqwcD_b.js";import{a as He}from"./category-QNgdQFvQ.js";import{q as Ke}from"./cart-DpaReRSb.js";import{b as Ye}from"./mall-B7Basf_X.js";import{_ as Xe}from"./DefaultPage-CnAxfjxg.js";import{H as Je}from"./HomeGoodsItem-BKiiBcSj.js";import"./MCOIN-Bodfn-v1.js";import"./store-odfdGeH-.js";import"./useCityMap-Ct9b_yYY.js";import"./ImgBoutiqueLable-BMjuak4g.js";const Qe=""+new URL("../images/flashSale-DOaFK4_-.png",import.meta.url).href,We=""+new URL("../images/unflashSale-CjYqec_P.png",import.meta.url).href,Ze={class:"relative z-20 whitespace-nowrap flex justify-center gap-16 px-12 py-2.5 overflow-hidden bg-white rounded-t-lg sort-shadow text-black-400 text-sm font-normal"},et={class:"flex items-center gap-1"},tt={key:0,class:"w-4 h-4",src:Qe},at={key:1,class:"w-4 h-4",src:We},st=E({props:{deliveryType:null},emits:["change"],setup(e,{emit:h}){const{useShopStore:i}=Se(),w=U(()=>i.shopMenus&&i.shopMenus.includes(4)),r=U(()=>i.shopMenus&&i.shopMenus.includes(3));return(n,y)=>(a(),l("div",Ze,[_(w)?(a(),l("div",{key:0,class:G({active:e.deliveryType===1}),onClick:y[0]||(y[0]=p=>h("change",1))},C(n.$t("common.send")),3)):d("",!0),_(w)?(a(),l("div",{key:1,class:G({active:e.deliveryType===2}),onClick:y[1]||(y[1]=p=>h("change",2))},C(n.$t("shop.offline server")),3)):d("",!0),_(r)?(a(),l("div",{key:2,class:G({active:e.deliveryType===3}),onClick:y[2]||(y[2]=p=>h("change",3))},[s("div",et,[e.deliveryType===3?(a(),l("img",tt)):(a(),l("img",at)),s("span",null,C(n.$t("order.onesale order")),1)])],2)):d("",!0)]))}}),ot=se(st,[["__scopeId","data-v-3069830c"]]),lt={class:"relative w-[100px] h-full overflow-hidden border-solid border-r-2 border-primary-008"},nt={class:"w-[98px] h-full overflow-y-auto flex flex-col gap-2 py-4"},it=["onClick"],rt={class:"font-normal leading-6 text-center"},dt=E({props:{list:{default:()=>[]},flashSaleList:{default:()=>[]},classId:{default:null},shopId:null,deliveryType:null},emits:["change"],setup(e,{emit:h}){const i=e,{currentLocale:w}=qe(),r=U(()=>i.deliveryType===3?i.flashSaleList.map(n=>({...n,name:n[`${Me[w.value]}Name`]})):i.list.filter(n=>+n.type==+i.deliveryType||!n.type));return(n,y)=>(a(),l("div",lt,[s("div",nt,[(a(!0),l(j,null,oe(_(r),p=>(a(),l("div",{class:G(["relative py-1.5 pl-4 pr-2 text-sm text-black-400",{"text-black-800 bg-primary-008":e.classId===p.id}]),key:p.id,onClick:O=>h("change",p.id)},[s("span",rt,C(p.name),1)],10,it))),128))])]))}}),ct=""+new URL("../images/offline-black-OiwvbEll.svg",import.meta.url).href,ut=""+new URL("../images/cart-icon-ibBU6cSG.svg",import.meta.url).href,vt=""+new URL("../images/Rob-CY-NIaX_.png",import.meta.url).href,mt=""+new URL("../images/Robed-BOyO2jaS.png",import.meta.url).href,yt={class:"flex items-start justify-between"},ft={class:"w-[90px] h-[90px] relative"},pt=["src"],ht={class:"text-sm flex items-center mb-1.5 relative"},gt={class:"text-sm flex-1 w-0 font-semibold leading-[0.875rem] truncate text-default mr-1"},kt={class:"flex items-center"},xt={class:"flex-1"},bt={class:"mb-2 text-xs leading-normal line-clamp-1 text-black-400"},wt={key:0,class:"flex items-center gap-1"},Tt={class:"inline-flex bg-[#FED73A] items-center gap-1 px-1.5 py-1 text-xs font-bold rounded bg-ratio text-black no-wrap"},$t=s("img",{class:"w-[1rem] h-[1rem]",src:ct},null,-1),_t={key:1,class:"text-sm font-bold"},Ct={class:"flex items-end mt-1"},It=["onClick"],Lt={key:0,class:"w-6 h-6",src:ut},St={key:1,class:"w-6 h-6",src:Ue},qt={key:1,class:"flex w-full"},At={key:0,class:"text-sm font-bold"},Rt={class:"ml-auto"},Nt={key:0,class:"w-5 h-5 mr-2",src:vt},Dt={key:1,class:"w-5 h-5 mr-2",src:mt},Bt=s("div",{class:"flex items-center h-2.5"},[s("div",{class:"h-[1px] w-full bg-black-100"})],-1),Gt=E({props:{data:null,deliveryType:null},emits:["handleAddCart","click"],setup(e,{emit:h}){const i=e,{t:w}=le(),r=async()=>{if(i.data.goods.stock===0&&i.data.goods.goodsTypes!=2){H(w("order.Insufficient stock"));return}i.data.goods.deliveryType===1?h("handleAddCart",i.data.goods):h("click")};return(n,y)=>(a(),l(j,null,[e.data.goods?(a(),l("div",{key:0,class:"w-full py-3 bg-white rounded",onClick:y[0]||(y[0]=p=>h("click"))},[s("section",yt,[s("div",ft,[(e.data.goods.status!=1||!+e.data.goods.stock)&&e.deliveryType!==3&&e.data.goods.goodsTypes!=2?(a(),m(Oe,{key:0,status:e.data.goods.status,stock:e.data.goods.stock},null,8,["status","stock"])):d("",!0),s("img",{src:e.data&&e.data.goods&&e.data.goods.icons&&e.data.goods.icons.split(",")[0]||_(Ae)("images/activity/boutique/squre_empty.png"),class:"rounded w-[90px] h-[90px] aspect-square object-cover"},null,8,pt)]),s("section",{class:G(["flex-1 min-h-[90px] ml-2 flex flex-col",{" justify-between":e.deliveryType==3}])},[s("div",ht,[e.data.goods.type?(a(),m(je,{key:0,type:e.data.goods.type,class:"flex-shrink-0 mr-1"},null,8,["type"])):d("",!0),s("div",gt,C(e.data.goods.goodsName),1)]),s("div",kt,[s("div",xt,[s("div",bt,C(e.data.goods.goodsDesc),1),e.deliveryType===2?(a(),l("div",wt,[s("div",Tt,[$t,xe(" "+C(n.$t("common.offline")),1)]),B(ee,{ratio:e.data.goods.discountRatio},null,8,["ratio"])])):d("",!0),e.deliveryType!==3?(a(),l("div",_t,[e.data.goods.payType!==2?(a(),m(te,{key:0,color:"#000000",class:"mt-1.5 text-base",price:e.data.goods.price},null,8,["price"])):d("",!0),e.data.goods.payType===2||e.data.goods.payType===3?(a(),m(ae,{key:1,color:"#000000",class:"mt-1.5 text-base",price:e.data.goods.cardPrice,symbol:e.data.card&&e.data.card.symbol},null,8,["price","symbol"])):d("",!0)])):d("",!0)])]),s("div",Ct,[s("div",null,[e.data.goods.payType!==2&&Number(e.data.goods.deliveryType)===_(Fe).online&&e.deliveryType!=3?(a(),m(ee,{key:0,class:"flex-shrink-0",tag:n.$t("common.rebate"),ratio:e.data.goods.discountRatio||0},null,8,["tag","ratio"])):d("",!0)]),e.deliveryType!=3?(a(),l("div",{key:0,onClick:be(r,["stop"]),class:"px-1.5 ml-auto"},[e.data.goods.deliveryType===1?(a(),l("img",Lt)):(a(),l("img",St))],8,It)):(a(),l("div",qt,[e.deliveryType===3?(a(),l("div",At,[e.data.goods.payType!==2?(a(),m(te,{key:0,price:e.data.goods.price},null,8,["price"])):d("",!0),e.data.goods.payType===2||e.data.goods.payType===3?(a(),m(ae,{key:1,class:"ml-auto",price:e.data.goods.cardPrice,symbol:e.data.card&&e.data.card.symbol},null,8,["price","symbol"])):d("",!0)])):d("",!0),s("div",Rt,[+e.data.goods.status>=15?(a(),l("img",Nt)):(a(),l("img",Dt))])]))])],2)])])):d("",!0),Bt],64))}}),ne=e=>(Ie("data-v-5232c93a"),e=e(),Le(),e),zt={class:"z-50 overflow-y-auto parent-view mall-header-bg"},Et={class:"sticky top-0 z-50 text-sm font-normal mall-header-bg"},Mt={class:"flex relative justify-center items-center h-[44px] px-2.5"},Ut={class:"absolute left-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},jt={class:"font-semibold"},Ot=ne(()=>s("img",{class:"w-5 h-5",src:ke},null,-1)),Ft=[Ot],Pt={class:"px-2.5 sticky top-[44px]"},Vt={key:0,class:"bg-gradient-7 text-white px-2.5 py-0.5 text-xxs leading-normal rounded-xl"},Ht=ne(()=>s("div",{class:"h-[16px]"},null,-1)),Kt={class:"overflow-hidden shadow-box"},Yt={class:"mall-header-bg mall-header-bg-box"},Xt=E({name:"CategoryShopDetail"});function Jt(e){const{t:h}=le(),i=we(),w=Te(),r=c(1);i.query.deliveryType&&(r.value=Number(i.query.deliveryType));const n=U(()=>i.query.shopId||null),y=c(null);y.value=i.query.shopId;const p=c(null),{y:O}=$e(p);Z(()=>n,async t=>{t.value&&t.value!==y.value&&(y.value=t.value,g.value&&(g.value=null),Q(),L())},{deep:!0});const g=c(null),ie=t=>{g.value!==t&&(g.value=t,L())};Z(()=>i.query.deliveryType,()=>{i.query.deliveryType&&+i.query.deliveryType!=+r.value&&(r.value=Number(i.query.deliveryType),g.value=null,F(),L())},{deep:!0});const f=c(null),re=async()=>{if(!n.value)return;const t=await De(n.value);!t.success||!t.data||(f.value=t.data,L())},de=t=>{r.value!==t&&($.value="",w.replace({path:"category",query:{deliveryType:t,shopId:n.value}}),r.value=t,g.value=null,A.value=[],A.value.unshift({name:"推薦",id:null}),F(),L())},A=c([]),F=async()=>{if(r.value===2){try{const{success:o,data:x}=await Be({shopId:n.value});if(!o)return;const u=(x||[]).filter(R=>R.goodsCount>0).map(R=>({name:R.goodsCategoryName,id:R.goodsCategoryId}));u.unshift({name:"推薦",id:null}),A.value=u}catch(o){console.error("获取线下服务类目数据失败:",o),A.value=[]}return}const t=await He({address:f.value.merchant});t.success&&(A.value=t.data||[],A.value.unshift({name:"推薦",id:null}))},P=c([]),ce=async()=>{const t=await Ge(f.value.merchant);t.success&&(P.value=t.data||[],P.value.unshift({cnName:"推薦",jpName:"推薦する",enName:"recommend",id:null}))},k=c([]),N=c(!1),T=c(!1),I=c(0),V=c(10),D=c(0),ue=c,K=async()=>{!f.value&&n.value||(N.value=!0,I.value+=1,await ve(),setTimeout(()=>{N.value=!1},1500))},$=c(""),ve=async()=>{if(r.value===2){await me();return}await ye()},me=async()=>{var u;let t=null,o=null;g.value===null?(o="desc|goods_sales_volume",t=null):(o=null,t=g.value||null);const x={page:I.value,size:V.value,goodsStatus:1,goodsNameLike:$.value,shopId:((u=f.value)==null?void 0:u.id)||"",goodsCategoryId1:t,sortBy:o},b=await ze(x);if(N.value=!1,!b.success||!b.data||!b.data.total){T.value=!0,k.value=I.value===1?[]:k.value;return}D.value=b.data.total;const S=b.data.records||[];k.value=I.value===1?S:k.value.concat(S),k.value.length>=D.value&&(T.value=!0)},ye=async()=>{var b,S;const t={page:I.value,size:V.value,status:1,subclassId:g.value,deliveryType:r.value,merchant:(b=f.value)==null?void 0:b.merchant,keyword:$.value};let o=null;if(r.value===3?o=await Ee({page:I.value,size:V.value,merchant:(S=f.value)==null?void 0:S.merchant,categoryId:g.value?g.value:null,title:$.value}):o=await Ye(t),N.value=!1,!o.success){T.value=!0;return}if(!o.data||!+o.total){T.value=!0,k.value=I.value===1?[]:k.value;return}D.value=o.total;const x=c([]);r.value===3?x.value=o.data.map(u=>({goods:{...u,goodsName:u.title,icons:u.mainImageUrls,deliveryType:u.shippingMethod}})):x.value=o.data.map(u=>({goods:u.goods,stores:u.stores||ue,card:u.card})),k.value=I.value===1?x.value:k.value.concat(x.value),k.value.length>=D.value&&(T.value=!0)},{loadingToggle:Y}=Ne(),fe=async t=>{if(t.stock===0&&t.goodsTypes!=2){H(h("order.Insufficient stock"));return}Y(!0);const o=await Ke(t.id);Y(!1),o.success&&H(h("cart.addTips"))},X=t=>{w.push(t)},J=c(null),pe=t=>{t.code==="Enter"&&(L(),J.value.blur())},he=()=>{$.value="",L()},L=()=>{if(O.value=0,f.value&&+f.value.status!=1){T.value=!0;return}k.value=[],I.value=0,D.value=0,T.value=!1,K()},ge=t=>{let o={};t.goodsId&&(o.goodsId=t.goodsId),t.storeId&&(o.storeId=t.storeId),w.push({path:"/offlineGoodsDetail",query:o})},Q=async()=>{if(await re(),f.value&&+f.value.status!=1){T.value=!0;return}$.value="",F(),ce()};return _e(()=>{p.value&&p.value.scrollTo(0,O.value)}),Ce(()=>{Q()}),(t,o)=>{var R,W;const x=M("van-icon"),b=M("van-field"),S=M("van-sticky"),u=M("VanList");return a(),l("div",zt,[s("section",Et,[s("section",Mt,[s("div",Ut,[B(Ve,null,{default:z(()=>[s("span",null,C(t.$t("common.return")),1)]),_:1})]),s("div",jt,C(t.$t("shop.Classification")),1),(R=f.value)!=null&&R.merchant?(a(),l("div",{key:0,onClick:o[0]||(o[0]=v=>{var q;return X(`/shopInfo?address=${(q=f.value)==null?void 0:q.merchant}`)}),class:"absolute right-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},Ft)):d("",!0)]),s("section",Pt,[B(b,{ref:(v,q)=>{q.searchRef=v,J.value=v},"model-value":$.value,"onUpdate:model-value":o[1]||(o[1]=v=>$.value=v),clearable:"",class:"flex-1 rounded-3xl flex items-center h-[30px] text-black-300",onKeypress:pe,placeholder:t.$t("mall.Enter search keywords"),onClear:he,enterkeyhint:"search"},{"left-icon":z(()=>[$.value?d("",!0):(a(),m(x,{key:0,name:"search",size:"18"}))]),"right-icon":z(()=>[s("div",{onClick:L},[$.value?(a(),m(x,{key:1,name:"search",size:"18"})):(a(),l("div",Vt,C(t.$t("common.search")),1))])]),_:1},8,["model-value","placeholder"])]),Ht]),s("div",Kt,[B(S,{"offset-top":90},{default:z(()=>[s("div",Yt,[B(ot,{deliveryType:r.value,onChange:de},null,8,["deliveryType"])])]),_:1}),s("div",{class:G(["relative flex bg-white h-[calc(100vh-84px)] overflow-hidden",{"safe-bottom-page":_(n)}])},[B(dt,{shopId:_(n),classId:g.value,list:A.value,flashSaleList:P.value,onChange:ie,deliveryType:r.value},null,8,["shopId","classId","list","flashSaleList","deliveryType"]),s("div",{class:"relative flex-1 h-full overflow-y-auto",ref:(v,q)=>{q.listPageRef=v,p.value=v}},[T.value&&D.value===0?(a(),m(Xe,{key:0,title:t.$t("common.No products")},null,8,["title"])):(a(),m(u,{key:1,loading:N.value,"onUpdate:loading":o[2]||(o[2]=v=>N.value=v),finished:T.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:K,class:"px-2.5 py-2.5"},{default:z(()=>[(a(!0),l(j,null,oe(k.value,v=>(a(),l(j,null,[r.value!==2?(a(),m(Gt,{key:0,data:v,onClick:q=>X(`${r.value==3?"/saleGoodDetail":"/goodsDetail"}?id=${v.goods.id}`),onHandleAddCart:fe,deliveryType:r.value},null,8,["data","onClick","deliveryType"])):(a(),m(Je,{key:1,goods:v,class:"mb-4 :last:mb-0 border-b border-gray-200 pb-4 home-goods-item",onClick:q=>ge(v),"show-store-name":""},null,8,["goods","onClick"]))],64))),256))]),_:1},8,["loading","finished","finished-text","loading-text"]))],512)],2)]),_(n)?(a(),m(Pe,{key:0,shopId:_(n),shopType:(W=f.value)==null?void 0:W.type},null,8,["shopId","shopType"])):d("",!0),r.value!==3?(a(),m(Re,{key:1})):d("",!0)])}}const Qt=E({...Xt,setup:Jt}),xa=se(Qt,[["__scopeId","data-v-5232c93a"]]);export{xa as default};

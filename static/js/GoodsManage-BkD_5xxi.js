import{_ as Y}from"./MCOIN-Bodfn-v1.js";import{_ as H,y as E,w as K,l as Q,a1 as Z,r as w,bf as B,x as W,D as X,bh as ee,bj as oe,E as C,K as v,G as p,N as r,O as c,H as m,a2 as k,P as n,F as P,J as te,Q as g,a0 as b,I as se,R as ne,Y as le,Z as ie}from"./vendor-Ba70TIw4.js";import{C as ae}from"./CommonVanProvider-CqQk6UpZ.js";import{_ as de}from"./OfflineGoods-CAFrr8v4.js";import{S as re}from"./SearchBox-9jKLYmhN.js";import{B as fe}from"./BetweenTab-DPw9h7Hc.js";import{_ as ce}from"./RegionBox-BWszWVCe.js";import{u as ue,e as pe,bJ as me,aF as he,Y as ge}from"./index-DiRx6UeW.js";import{D as ye}from"./goods-BVwS8oFG.js";import{c as f}from"./offlineGoods-DvT2Go6q.js";import{S as _e}from"./shop-CeqcS6K2.js";import"./BackIcon-DkqwcD_b.js";import"./ImgBoutiqueLable-BMjuak4g.js";import"./search-C4fLtTfY.js";import"./filter-DRLh1k_O.js";import"./category-QNgdQFvQ.js";/* empty css                                                               */const ve=y=>(le("data-v-8439bbbc"),y=y(),ie(),y),be={class:"px-3 mt-3"},Se={class:"flex items-center"},Ie=ve(()=>m("img",{src:Y,class:"w-4 h-4 mr-1.5"},null,-1)),xe={class:"text-newOrigin"},Te={class:"relative flex justify-end text-xs mt-3"},we=E({name:"GoodsManage"});function Ce(y){var $;const{t:S}=K(),O=Q(),V=Z(),{getCurrentStoreId:N}=ue(),R=w(null),{accountStore:_,clerkStore:A}=pe(),D=[{label:S("offline.onSale"),value:f.Published},{label:S("shop.watiShelf"),value:f.OffShelf},{label:S("offline.drafts"),value:f.DRAFT}],o=B({shopInfo:null,list:[],total:0,loading:!1,finished:!1}),l=B({shopId:($=o.shopInfo)==null?void 0:$.id,page:0,size:10,goodsNameLike:"",goodsCategoryId1:"",goodsStatus:f.Published,goodsType:null,sortBy:"desc|create_time",distinctFlag:!0}),q=W(()=>{var e;return(e=o==null?void 0:o.shopInfo)==null?void 0:e.type}),G=e=>{O.push(e)},M=async e=>{l.goodsType=(e==null?void 0:e.type)>=_e.SD?e.type:void 0,l.startTime=(e==null?void 0:e.upStartTime)||void 0,l.endTime=(e==null?void 0:e.upEndTime)||void 0,l.goodsCategoryId1=(e==null?void 0:e.subclassId)||void 0,u()},U=e=>{l.goodsStatus=e,O.replace({path:"offlineGoods",query:{status:e}}),u()},F=async(e,t)=>{e.loading=!0;const{success:i}=await me({goodsId:e.goodsId,shopId:e.shopId,goodsStatus:t});e.loading=!1,i&&(o.list=o.list.filter(a=>a.goodsId!==e.goodsId))},u=async()=>{o.finished=!1,o.total=0,o.list=[],l.page=0,I()},I=async()=>{var e,t;if(!((e=o.shopInfo)!=null&&e.id))return o.finished=!0;o.loading=!0,l.shopId=(t=o.shopInfo)==null?void 0:t.id,l.page+=1,await z(),o.loading=!1},z=async()=>{const{success:e,data:t}=await he(l);if(o.loading=!1,!e){o.finished=!0;return}const{records:i,total:a,current:T,pages:s}=t;if(!a||!i||!(i!=null&&i.length)){o.finished=!0;return}o.total=a;const d=w([]);d.value=i.map(J=>({btnLoading:!1,...J})),o.list=l.page===1?d.value:o.list.concat(d.value),+T>=+s&&(o.finished=!0)};let h=null;const j=async()=>{const e=localStorage.getItem("shopOffline_scrollTop");+e?h.scrollTo({top:+e,left:0,behavior:"instant"}):localStorage.removeItem("shopOffline_scrollTop")},x=w(!1),L=()=>{x.value||(x.value=!0,setTimeout(()=>{localStorage.setItem("shopOffline_scrollTop",h.scrollTop+""),x.value=!1},500))};return X(async()=>{var e,t;h=document.querySelector(".shopGoodsPage"),h.addEventListener("scroll",L),(e=V.query)!=null&&e.status&&(l.goodsStatus=Number((t=V.query)==null?void 0:t.status)),o.shopInfo=await N(),I()}),ee(async()=>{A.isClerk&&u();try{j();const e=sessionStorage.getItem("shop_offline_refresh_id");if(e==="add")u();else if(e){const t=await ge(e),i=o.list.findIndex(a=>a.goodsId===e);i>-1?t.data.goodsStatus!==o.list[i].goodsStatus?o.list.splice(i,1):o.list[i]=t.data:u()}}finally{sessionStorage.removeItem("shop_offline_refresh_id")}}),oe(()=>{h.removeEventListener("scroll",L)}),(e,t)=>{const i=C("VanButton"),a=C("VanList"),T=C("router-view");return p(),v(ae,{title:e.$t("offline.sale_services"),class:"bg-gray1 font-Puhui font-normal relative","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(s,d)=>{d.shopGoodsRef=s,R.value=s}},{right:r(()=>[c(ce)]),default:r(()=>[c(fe,{options:D,"label-key":"label","value-key":"value",modelValue:n(l).goodsStatus,"onUpdate:modelValue":t[0]||(t[0]=s=>n(l).goodsStatus=s),onChange:U},null,8,["modelValue"]),m("div",be,[c(re,{modelValue:n(l).goodsNameLike,"onUpdate:modelValue":t[1]||(t[1]=s=>n(l).goodsNameLike=s),deliveryType:n(ye).offeline,shopType:n(q),onOnSubmit:u,onOnFilter:M},null,8,["modelValue","deliveryType","shopType"])]),m("div",{class:ne(["m-3 overflow-y-auto shopGoodsPage",{"safe-body":!n(_).isOnlyView}])},[c(a,{loading:n(o).loading,"onUpdate:loading":t[2]||(t[2]=s=>n(o).loading=s),finished:n(o).finished,"immediate-check":!1,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:I},{default:r(()=>[(p(!0),P(se,null,te(n(o).list,s=>(p(),P("div",{class:"offline-crad-box mb-3",key:s.goodsId},[c(de,{showSale:"",showGoodsType:"",goods:s},{"bottom-price":r(()=>[m("div",Se,[Ie,m("div",xe,g(s.goodsPrice),1)])]),_:2},1032,["goods"]),m("section",Te,[n(l).goodsStatus===n(f).Published&&!n(_).isOnlyView?(p(),v(i,{key:0,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:s.loading,onClick:d=>F(s,n(f).OffShelf)},{default:r(()=>[b(g(e.$t("shop.down")),1)]),_:2},1032,["loading","onClick"])):k("",!0),n(l).goodsStatus===n(f).OffShelf&&!n(_).isOnlyView?(p(),v(i,{key:1,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:s.loading,onClick:d=>F(s,n(f).Published)},{default:r(()=>[b(g(e.$t("shop.up")),1)]),_:2},1032,["loading","onClick"])):k("",!0),c(i,{color:"#FED73A",round:"",class:"!text-b1 font-semibold h-[32px] rounded-md px-3",onClick:d=>G(`/offlineGoodsEditGoods?goodsId=${s.goodsId.toString()}`)},{default:r(()=>[b(g(e.$t("shop.modify")),1)]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])],2),n(_).isOnlyView?k("",!0):(p(),v(i,{key:0,onClick:t[3]||(t[3]=s=>G("/offlineGoodsEditGoods")),class:"bg-btnOrBg w-[calc(100%-32px)] max-w-[343px] mx-auto h-[46px] flex-center text-b1 text-base font-semibold z-50 rounded-3xl"},{default:r(()=>[b(g(e.$t("offline.published_goods")),1)]),_:1})),c(T,{class:"child-view bg-gray1"})]),_:1},8,["title"])}}const ke=E({...we,setup:Ce}),je=H(ke,[["__scopeId","data-v-8439bbbc"]]);export{je as default};

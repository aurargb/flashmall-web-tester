import{W as $}from"./WaterFull-DpMa4XQe.js";import{_ as H,y as b,w as O,l as P,r as c,E as S,F as C,G as g,H as n,O as F,X as z,P as k,a2 as E,Q as D,a4 as L,aH as R,T as j,Y as q,Z as J,z as W,K as B,N as T}from"./vendor-Ba70TIw4.js";import{g as A,b as G,W as I,J as K,aw as U,ax as Q,r as X,av as Y,ao as Z,aO as ee}from"./index-DiRx6UeW.js";/* empty css                                                                 */const te=""+new URL("../images/delete-Cya47K7m.svg",import.meta.url).href,ae=e=>(q("data-v-472ed2de"),e=e(),J(),e),se={class:"w-full h-full bg-white rounded-[10px]"},oe={class:"p-2 font-Puhui"},ie={class:"text-base text-[#222] font-semibold text-left text-ellipsis line-clamp-2"},le={key:0,class:"mt-1.5 flex justify-between items-center"},ne=["onClick"],ce={class:"text-xs text-[#585654] font-normal leading-[18px] text-ellipsis line-clamp-1"},ue=["onClick"],de=["src"],re={class:"text-xs text-[#999] font-normal leading-[18px]"},me={key:1,class:"mt-1.5 flex justify-between items-center"},fe={class:"max-w-[80%] text-sm text-[#999] font-normal text-ellipsis line-clamp-1"},ve=["onClick"],ge=ae(()=>n("img",{src:te,alt:"",class:"shrink-0 w-4 h-4"},null,-1)),he=[ge],xe=b({props:{item:{default:{}},index:{default:0},position:{default:""},extData:{default:{}}},emits:["delete"],setup(e,{emit:_}){const s=e,{t:y}=O(),i=P(),{loadingToggle:u}=X(),o=c(!1),h=()=>{var r,f;let a=((r=s.extData)==null?void 0:r.toDetailLink)+"?noteId="+s.item.storeNoteId;((f=s.extData)==null?void 0:f.toDetailLink)==="/city/cityMap/noteDetail"&&(a=a+"&child=1"),i.push(a)},N=()=>{console.log("clickAvatar")},x=async()=>{if(o.value)return;let a=s.item.addLikeCountFlag;s.item.addLikeCountFlag=!s.item.addLikeCountFlag,o.value=!0,a?(s.item.likeCount++,await U({id:s.item.storeNoteId})):(s.item.likeCount--,await Q({id:s.item.storeNoteId})),o.value=!1},d=()=>{o.value||R.confirm({messageAlign:"center",message:"确认将这篇笔记删除？",confirmButtonText:y("shop.delete"),confirmButtonColor:"#FF507A",cancelButtonText:y("cart.thinkAgain"),cancelButtonColor:"#2E2008"}).then(async()=>{o.value=!0,u(!0);const a=await Y({id:s.item.storeNoteId});o.value=!1,u(!1),a.success&&(w("删除成功","toast-success.svg"),_("delete"))}).catch(()=>{})},w=(a="",r="toast-warn.svg")=>{j({message:a,icon:I(r),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})};return(a,r)=>{const f=S("VanImage");return g(),C("div",{class:"mb-2 text-center",onClick:h},[n("div",se,[F(f,{src:e.item&&e.item.storeNotePics&&e.item.storeNotePics.split(",")[0]||k(A)("images/activity/boutique/squre_empty.png"),alt:"",class:"object-cover w-full h-[120px] aspect-square rounded-t-lg overflow-hidden",style:z(e.position==="left"&&e.index%5===0?"height: 172px":""),fit:"cover"},null,8,["src","style"]),n("div",oe,[n("div",ie,D(e.item.storeNoteTopic||""),1),e.extData.draft?e.extData.draft?(g(),C("div",me,[n("div",fe,D(k(K)(new Date().getTime(),"MM-DD HH:mm")),1),n("div",{onClick:L(d,["stop"])},he,8,ve)])):E("",!0):(g(),C("div",le,[n("div",{class:"max-w-[70%] w-fit flex items-center",onClick:L(N,["stop"])},[F(f,{src:k(A)("images/avatarRing.png"),class:"mr-1 shrink-0 w-4 h-4 rounded-full overflow-hidden",alt:""},null,8,["src"]),n("div",ce,D(k(G)(e.item.userAddress||"","...",5,4)),1)],8,ne),n("div",{class:"shrink-0 flex items-center",onClick:L(x,["stop"])},[n("img",{src:e.item.addLikeCountFlag?k(I)("cityMap/like.svg"):k(I)("cityMap/like-full.svg"),alt:"",class:"mr-0.5 shrink-0 w-4 h-4"},null,8,de),n("div",re,D(e.item.likeCount||0),1)],8,ue)]))])])])}}}),pe=H(xe,[["__scopeId","data-v-472ed2de"]]),ke={key:0,class:"w-full"},ye={key:0},Ne=b({props:{params:{default:{}},extData:{default:{}},toDetailLink:{default:"/city/noteDetail"}},emits:["handleTo"],setup(e,{expose:_,emit:s}){const y=e,i=c([]),u=c(!1),o=c(!1),h=c(0),N=c(10),x=c(0),d=c([]),w=c(null),a=t=>JSON.parse(JSON.stringify(t)),r=async()=>{u.value=!0,h.value+=1,await f(),setTimeout(()=>{u.value=!1},1e3)},f=async()=>{var m,v,l,p;const t=await ee({page:h.value,size:N.value,...y.params});if(!t.success){o.value=!0;return}if(!t.data||!((m=t.data)!=null&&m.total)||!((v=t.data)!=null&&v.records.length)){o.value=!0;return}x.value=((l=t.data)==null?void 0:l.total)||0,d.value=((p=t.data)==null?void 0:p.records)||[],i.value=h.value===1?a(d.value):i.value.concat(a(d.value)),i.value.length>=x.value&&(o.value=!0)},M=()=>{var t;i.value=[],u.value=!1,o.value=!1,h.value=0,x.value=0,d.value=[],(t=w.value)==null||t.clearData(),r()};W(()=>y.params,()=>{M()},{deep:!0,immediate:!0});const V=(t,m)=>{var l;const v=i.value.findIndex(p=>p.storeNoteId==t.storeNoteId);v>-1&&((l=w.value)==null||l.clearData(),i.value.splice(v,1),d.value=a(i.value))};return _({total:x}),(t,m)=>{const v=S("VanList");return g(),B(v,{loading:u.value,"onUpdate:loading":m[1]||(m[1]=l=>u.value=l),finished:o.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:r},{finished:T(()=>[i.value.length>0?(g(),C("span",ye,"没有更多了")):(g(),B(Z,{key:1,name:"暂无数据"}))]),default:T(()=>[i.value.length>0?(g(),C("div",ke,[F($,{ref:(l,p)=>{p.waterFull=l,w.value=l},value:d.value,addTime:0,cardComponent:pe,extData:{...e.extData,toDetailLink:e.toDetailLink},onHandleTo:m[0]||(m[0]=l=>s("handleTo")),onDelete:V},null,8,["value","extData"])])):E("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"])}}});export{Ne as _};

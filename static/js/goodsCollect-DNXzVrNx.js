import{_ as ee,y as E,l as z,x as te,E as I,F as f,G as n,H as s,O as b,P as a,Q as h,X as C,K as _,a4 as G,Z as oe,$ as se,a2 as le,w as ae,be as j,bf as ne,r as $,z as ie,D as ce,bh as de,N as k,J as ue,I as re,a1 as fe,T as me}from"./vendor-BlU_hoYl.js";import{_ as ge}from"./MCOIN-Bodfn-v1.js";import{_ as he}from"./store-odfdGeH-.js";import{_ as pe}from"./shop-arrow-right-BMae5SG7.js";import{R as ve}from"./RatioBox-CfBlBgLi.js";import{_ as _e}from"./ImgBoutiqueLable-BIio6fYG.js";import{d as ye,e as xe,at as ke,W as be,r as Ce,bG as we,bH as $e}from"./index-Clz0Qna-.js";import{C as Ie}from"./CommonVanProvider-CDfGVWR4.js";import{_ as Se}from"./EmptyTipsPop-DRPu7DDc.js";import{B as Te}from"./BetweenTab-BE6o466J.js";import{c as Fe,e as Le}from"./goods-lQayGTeI.js";import"./shop-CeqcS6K2.js";import"./BackIcon-8hcEjDKb.js";/* empty css                                                               */const O=l=>(oe("data-v-98549228"),l=l(),se(),l),Ve=["data-store-name"],Ne={class:"shrink-0 offline-goods-img__wrap w-[80px] h-[80px] overflow-hidden relative"},Be={class:"offline-goods-info__wrap ml-2 flex-1 flex flex-col justify-between min-h-[80px]",style:{width:"calc(100% - 80px - 8px)"}},Ae={class:"w-full flex flex-col items-start"},Ee={class:"w-full"},Oe={class:"font-semibold text-sm line-clamp-1 text-b1"},De={class:"flex items-center justify-start font-Puhui mt-1"},Pe={class:"flex items-center"},Re=O(()=>s("img",{src:ge,class:"w-4 h-4 mr-1"},null,-1)),je={class:"text-b1 font-semibold text-sm"},ze={key:0,class:"mx-2"},Ge={class:"text-b3 text-sm font-normal"},qe={class:"w-full"},Me=O(()=>s("img",{src:he,class:"shrink-0 w-4 h-4 line-clamp-1"},null,-1)),Ue={key:0,class:"line-clamp-1"},He={key:1,class:"line-clamp-1"},Je=O(()=>s("img",{src:pe,class:"w-4 h-4"},null,-1)),Ke=E({props:{goods:{type:Object,default:()=>({})},isOffline:{type:Boolean,default:!1}},emits:["select"],setup(l,{emit:L}){const u=l;z();const V=te(()=>{var m,w;return(u.isOffline||!1?(m=u.goods.goodsIcons)==null?void 0:m.split(","):((w=u.goods.icons)==null?void 0:w.split(","))||[""])[0]}),S=y=>{L("select",y)};return(y,r)=>{const m=I("VanImage");return n(),f("section",{class:"flex items-start","data-store-name":l.goods.shopName},[s("div",Ne,[b(m,{src:a(V),class:"offline-goods-img w-[80px] h-[80px] rounded-lg overflow-hidden",alt:"商品主图",fit:"cover"},null,8,["src"]),b(_e,{type:l.isOffline?+l.goods.goodsType:+l.goods.type},null,8,["type"])]),s("div",Be,[s("div",null,[s("div",Ae,[s("div",Ee,[s("div",Oe,h(l.goods.goodsName||""),1)])]),s("div",De,[s("div",Pe,[Re,s("div",je,h(a(ye)(l.goods.price||l.goods.goodsPrice)),1)]),l.goods.changedAmount?(n(),f("div",ze,[s("p",Ge,[s("span",null,"收藏后"+h(+l.goods.changedAmount>0?"涨":"降")+h(Math.abs(l.goods.changedAmount)),1)])])):C("",!0),l.goods.discountRatio||l.goods.goodsDiscountRatio?(n(),_(ve,{key:1,class:"ratio-box ml-1 !px-1",tag:y.$t("common.rebate"),ratio:l.goods.discountRatio||l.goods.goodsDiscountRatio},null,8,["tag","ratio"])):C("",!0)])]),s("div",qe,[s("div",{class:"font-normal text-b3 text-sm flex items-center justify-start",onClick:r[0]||(r[0]=G(w=>S(l.goods.shopId),["stop"]))},[Me,l.isOffline?(n(),f("span",Ue,h(!l.goods.shopName&&!l.goods.storeName?"--":l.goods.shopName+(l.goods.storeName?"·"+l.goods.storeName:"")),1)):(n(),f("span",He,h(l.goods.storeName||"--"),1)),Je])])])],8,Ve)}}}),Qe=ee(Ke,[["__scopeId","data-v-98549228"]]),We={class:"flex items-center justify-start gap-1"},Xe=["src"],Ze=s("span",{class:"text-b2 text-sm font-normal"},"取消",-1),Ye=[Ze],et=s("span",{class:"text-b2 text-sm font-normal"},"编辑",-1),tt=[et],ot={class:"scrollPage p-3 h-[calc(100vh-83px)] overflow-y-auto"},st={class:"flex items-center justify-start"},lt={key:0,class:"flex-shrink-0 mr-3"},at={class:"w-full"},nt={class:"bg-white rounded-xl p-2.5 mb-2.5"},it={key:0,class:"fixed bottom-0 left-0 right-0 bg-[#F5F5F5] p-3 pb-[calc(12px+env(safe-area-inset-bottom))] flex items-center justify-between"},ct={class:"flex-shrink-0 flex items-center justify-start gap-2 mr-3"},dt={key:0},ut=E({name:"GoodsCollect"});function rt(l){const{regionStore:L}=xe(),u=z(),V=le(),{t:S}=ae(),{loadingToggle:y}=Ce(),[r,m]=j(!1),[w,N]=j(!1),q=[{label:S("shop.on-line"),value:1},{label:S("shop.off-line"),value:2}],M=e=>{c.value=[],p.value=[],g.value=!1,m(!1),t.type=e||1,u.replace({query:{type:e}}),B()},t=ne({type:Number(V.query.type)||1,page:0,size:10,loading:!1,finished:!1,flattenedList:[],total:0}),c=$([]),p=$([]),D=$(null),g=$(!1),U=(e,o)=>{var d,x;t.type===1?r.value?(d=p.value[o])==null||d.toggle():u.push(`/goodsDetail?id=${e.goodsId}&activated=1`):r.value?(x=p.value[o])==null||x.toggle():u.push(`/offlineGoodsDetail?goodsId=${e.goodsId}${e.storeId?`&storeId=${e.storeId}`:""}&activated=1`)},H=(e,o)=>{var d;r.value?(d=p.value[o])==null||d.toggle():u.push(`/category?deliveryType=1&shopId=${e}&activated=1`)},P=()=>{g.value?c.value=t.flattenedList.map(o=>t.type===2?o.collectId:o.goodsId):c.value=[]},J=()=>{var e;(e=D.value)==null||e.toggle(),P()};ie(c,e=>{e.length&&e.length>=t.flattenedList.length?g.value=!0:g.value=!1});const K=async()=>{if(c.value.length===0){me("请选择要删除的商品");return}y(!0);let e=null;t.type===1?e=await Fe({goodsIds:c.value,type:2}):e=await we({ids:c.value}),y(!1),e.success&&(N(!0),B(),c.value=[],p.value=[],g.value=!1),setTimeout(()=>{N(!1)},1e3)},R=async()=>{t.loading=!0,t.page+=1,await Q(),t.loading=!1},Q=async()=>{let e=null;if(t.type===1)e=await Le({page:t.page,size:t.size});else if(t.type===2){const o=await $e({page:t.page,size:t.size,sortBy:"desc|create_time"});e={success:o.success,data:o.data.records||[],total:o.data.total||0}}if(!e.success){t.finished=!0;return}if(!e.data||!e.total){t.finished=!0;return}t.total=e.total,t.flattenedList=t.page===1?e.data:t.flattenedList.concat(e.data),g.value&&(c.value=t.flattenedList.map(o=>t.type===2?o.collectId:o.goodsId)),t.flattenedList.length>=t.total&&(t.finished=!0)},B=()=>{t.page=0,t.total=0,t.finished=!1,t.flattenedList=[],R()};let T=null;const W=async()=>{const e=localStorage.getItem("goodsCollect_scrollTop");+e?(console.log("setCacheScrollTop",+e),T.scrollTo({top:+e,left:0,behavior:"instant"})):localStorage.removeItem("goodsCollect_scrollTop")},A=$(!1),X=()=>{A.value||(A.value=!0,setTimeout(()=>{localStorage.setItem("goodsCollect_scrollTop",T.scrollTop+""),A.value=!1},500))};return ce(()=>{T=document.querySelector(".scrollPage"),T.addEventListener("scroll",X)}),de(()=>{var e,o,d,x;W(),!(((x=(d=(o=(e=u==null?void 0:u.options)==null?void 0:e.history)==null?void 0:o.state)==null?void 0:d.forward)==null?void 0:x.indexOf("activated=1"))>-1&&t.flattenedList.length)&&(c.value=[],p.value=[],g.value=!1,m(!1),B())}),(e,o)=>{const d=I("van-checkbox"),x=I("van-checkbox-group"),Z=I("van-list"),Y=I("VanButton");return n(),_(Ie,{class:"bg-[#F5F5F5] font-Puhui font-normal relative shopGoodsPage",title:"商品收藏","theme-vars":{"field-placeholder-text-color":"#F5F5F5"}},{title:k(()=>[s("div",We,[s("div",null,[s("img",{src:a(be)(`mall/${a(L).country}-flag.svg`),class:"w-4 h-auto"},null,8,Xe)]),s("span",null,h(e.$t("collect.goodsCollect")),1)])]),right:k(()=>[s("div",null,[a(r)===!0?(n(),f("div",{key:0,onClick:o[0]||(o[0]=i=>a(m)(!1))},Ye)):(n(),f("div",{key:1,onClick:o[1]||(o[1]=i=>a(m)(!0))},tt))])]),default:k(()=>[s("div",null,[b(Te,{class:"between-tab__wrap",options:q,"label-key":"label","value-key":"value",modelValue:a(t).type,"onUpdate:modelValue":o[2]||(o[2]=i=>a(t).type=i),onChange:M},null,8,["modelValue"]),s("div",ot,[a(t).flattenedList.length===0&&!a(t).loading?(n(),_(ke,{key:0,name:e.$t("common.No products")},null,8,["name"])):(n(),_(Z,{key:1,loading:a(t).loading,"onUpdate:loading":o[4]||(o[4]=i=>a(t).loading=i),"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),finished:a(t).finished,onLoad:R,"immediate-check":!0},{default:k(()=>[(n(!0),f(re,null,ue(a(t).flattenedList,(i,F)=>(n(),_(x,{key:i.goodsId||i.collectId,modelValue:c.value,"onUpdate:modelValue":o[3]||(o[3]=v=>c.value=v),"checked-color":"#FEA021","icon-size":"16"},{default:k(()=>[s("div",st,[a(r)?(n(),f("div",lt,[a(t).type===2?(n(),_(d,{key:0,name:i.collectId,ref:v=>p.value[F]=v},null,8,["name"])):(n(),_(d,{key:1,name:i.goodsId,ref:v=>p.value[F]=v},null,8,["name"]))])):C("",!0),s("div",at,[s("div",nt,[b(Qe,{"is-offline":a(t).type==2,goods:i,showStoreName:!0,onClick:G(v=>U(i,F),["stop"]),onSelect:v=>H(v,F)},null,8,["is-offline","goods","onClick","onSelect"])])])])]),_:2},1032,["modelValue"]))),128))]),_:1},8,["loading","finished-text","loading-text","finished"]))])]),a(r)?(n(),f("div",it,[s("div",ct,[b(d,{modelValue:g.value,"onUpdate:modelValue":o[5]||(o[5]=i=>g.value=i),"checked-color":"#FEA021","icon-size":"16",ref:i=>D.value=i,onClick:P},null,8,["modelValue"]),s("span",{class:"text-b3 text-sm font-normal",onClick:J},"全选")]),b(Y,{class:"main-btn flex-center text-white font-semibold rounded-full !bg-[#f44] text-base w-full h-[46px]",onClick:K},{default:k(()=>[fe(h(e.$t("common.delete"))+" ",1),c.value.length>0?(n(),f("span",dt," ("+h(c.value.length)+") ",1)):C("",!0)]),_:1})])):C("",!0),a(w)?(n(),_(Se,{key:1,isError:!1,onClose:o[6]||(o[6]=i=>a(N)(!1)),text:"删除成功"})):C("",!0)]),_:1})}}const It=E({...ut,setup:rt});export{It as default};

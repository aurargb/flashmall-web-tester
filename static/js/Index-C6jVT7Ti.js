import{_ as P,y as T,l as O,a2 as X,r as k,x as A,E as M,F as h,G as c,H as d,a4 as G,K as z,P as I,Q as S,Z as H,$ as W,w as J,N as F,J as j,I as D,R as E,z as q,X as N,n as Q,O as L,a1 as Y,Y as B,D as K,U as Z,V as ee,a9 as te}from"./vendor-BlU_hoYl.js";import{_ as ae}from"./down-arrow-IWNxO-Dl.js";import{e as U,at as se,au as oe,W as ne,av as re}from"./index-Clz0Qna-.js";import{_ as le}from"./avatarRing-CLGxkH-F.js";import{O as ce}from"./OfflineMerchantLabel-BcDolHRH.js";import{u as ie}from"./useCityMap-L2xSDWSa.js";const ue=""+new URL("../images/demo-bg-DyaCmFCf.png",import.meta.url).href,de=""+new URL("../images/search-ClCpHcy8.svg",import.meta.url).href,R=s=>(H("data-v-ee9ddf30"),s=s(),W(),s),pe={class:"w-full px-3 py-4 bg-transparent font-Puhui flex flex-row justify-between items-center gap-3"},fe=["onClick"],me={class:"text-sm text-b2 font-normal min-w-[28px] max-w-[56px]"},ve={key:1,class:"line-clamp-1"},ge=R(()=>d("img",{src:ae,class:"w-[9px] h-auto"},null,-1)),he=R(()=>d("div",{class:"divider mx-2 ml-3"},null,-1)),ye=R(()=>d("div",{class:"search-box flex items-center justify-start gap-1"},[d("img",{src:de,class:"w-4 h-4"}),d("p",{class:"text-sm text-b3 font-normal w-full"},S("搜索门店/服务"))],-1)),_e=T({setup(s){const{cityMapStore:r}=U(),n=O(),l=X(),f=k(20);A(()=>{const p=f.value;return p===0?0:p>99?"99+":p});const m=()=>{n.push("/city/search")},_=()=>{n.push({path:"/city/selectArea",query:{mode:"change",from:encodeURIComponent(l.path)}})},t=A(()=>r.currentActiveCity||{});return(p,v)=>{const u=M("van-loading");return c(),h("div",pe,[d("div",{class:"w-full h-[36px] bg-white rounded-3xl flex items-center justify-start px-3 border-solid border-[1px] border-[#F1A840]",onClick:m},[d("div",{class:"city-selector flex items-center justify-start gap-1",onClick:G(_,["stop"])},[d("p",me,[I(t).areaName?(c(),h("span",ve,S(I(t).areaName),1)):(c(),z(u,{key:0,size:"14"}))]),ge],8,fe),he,ye])])}}}),xe=P(_e,[["__scopeId","data-v-ee9ddf30"]]),be=["onClick"],we=["src","alt"],Ce={class:"text-sm text-b1 font-normal text-center no-wrap"},ke=T({props:{categoryList:{type:Array,default:()=>[]}},emits:["handleMenu","changeTab"],setup(s,{emit:r}){const n=s,{t:l}=J(),f=A(()=>n.categoryList||[]),m=k(0),_=A(()=>{let v=f.value.slice(0,5),u=f.value.slice(5),y=[];y.push(v);for(let x=0;x<Math.ceil(u.length/10);x++)y.push(u.slice(x*10,(x+1)*10));return y}),t=v=>{m.value=v},p=v=>{r("handleMenu",v)};return(v,u)=>{const y=M("van-swipe-item"),x=M("van-swipe");return c(),z(x,{class:"font-Puhui linear__wrap min-h-[138.5px] pt-[55px]",loop:!1,onChange:t},{default:F(()=>[(c(!0),h(D,null,j(I(_),(i,$)=>(c(),z(y,{key:$},{default:F(()=>[d("div",{class:E(["w-full px-[10px] flex flex-wrap content-start transition-all gap-y-[1.5px]",m.value===0?"h-[calc(138.5px-55px)]":"h-[calc(211px-55px)]"])},[(c(!0),h(D,null,j(i,(g,o)=>(c(),h("div",{class:"shrink-0 relative w-[20%] h-fit px-3 py-[5.5px] flex flex-col content-start items-center gap-1",key:$+":"+o,onClick:w=>p(g)},[d("img",{class:"shrink-0 w-[36px] h-[36px]",src:g.goodsCategoryIcon||I(le),alt:g.goodsCategoryName+"的分类"},null,8,we),d("div",Ce,S(g.goodsCategoryName),1)],8,be))),128))],2)]),_:2},1024))),128))]),_:1})}}}),Ie=P(ke,[["__scopeId","data-v-e9111fe4"]]),$e=""+new URL("../images/wave-BD0prNuS.svg",import.meta.url).href,Le=["onClick","id"],Se={class:"absolute -bottom-1 left-0 shrink-0 w-full flex justify-center items-center"},Ae={key:0,class:"w-fit h-[8px]",src:$e,alt:""},ze={props:{options:{type:[Array,Object],required:!0},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"value"},modelValue:[String,Number,Object],scrollToSelected:{type:Boolean,default:!0},scrollOffset:{type:Number,default:16}},emits:["update:modelValue","change"],setup(s,{emit:r}){const n=s,l=k(null),f=k(null),m=k([]),_=A(()=>Array.isArray(n.options)?n.options:Object.values(n.options));function t(o){return o[n.valueKey]===n.modelValue}function p(o){r("update:modelValue",o[n.valueKey]),r("change",o[n.valueKey])}q(()=>n.modelValue,async()=>{n.scrollToSelected&&(await Q(),v())},{immediate:!0});function v(){const o=_.value.findIndex(a=>t(a));if(o===-1)return;const w=document.getElementById(`category-tab-item-${o}`),e=l.value;if(w&&e){const a=w.offsetLeft-(n.scrollOffset||0);e.scrollTo({left:a,behavior:"smooth"})}}let u=!1,y=0,x=0;function i(o){u=!0,y=o.touches?o.touches[0].pageX:o.pageX,x=l.value.scrollLeft}function $(o){if(!u)return;const w=o.touches?o.touches[0].pageX:o.pageX,e=y-w;l.value.scrollLeft=x+e}function g(){u=!1}return(o,w)=>(c(),h("div",{class:"category-tab h-[103px] pt-[68px] px-3 linear__wrap",ref:(e,a)=>{a.tabWrapper=e,l.value=e},onMousedown:i,onTouchstart:i,onMousemove:$,onTouchmove:$,onMouseup:g,onMouseleave:g,onTouchend:g},[d("div",{class:"stickyTab flex flex-nowrap justify-start items-start gap-5",ref:(e,a)=>{a.tabList=e,f.value=e}},[(c(!0),h(D,null,j(I(_),(e,a)=>(c(),h("div",{key:e[s.valueKey]??a,class:E(["relative shrink-0 mt-[1px] text-sm text-b2 font-normal last:px-3 last:-ml-3",t(e)?"!mt-0 !text-base !text-b1 !font-semibold":""]),onClick:C=>p(e),ref:(C,b)=>{b.tabItems=C,m.value=C},id:`category-tab-item-${a}`},[d("p",null,S(e[s.labelKey]),1),d("div",Se,[t(e)?(c(),h("img",Ae)):N("",!0)])],10,Le))),128))],512)],544))}},Me=P(ze,[["__scopeId","data-v-634f6dea"]]),Te={class:"shop-img w-[80px] h-[80px] rounded-lg overflow-hidden flex-shrink-0 relative"},Ne={class:"shop-content h-full ml-2 w-full"},Fe={class:"w-full text-base text-b1 font-semibold flex items-center justify-between"},De={class:"line-clamp-1"},Ee={class:"text-sm text-b3 font-normal"},Pe={class:"h-[20px] text-sm text-b3 font-normal mt-[18px] flex items-center justify-between"},Ve={class:"engagement"},je={key:0,class:"distance"},Be={props:{backgroundColor:{type:String,default:""},store:{type:Object,default:()=>({})}},setup(s){const{distanceFormat:r}=ie(),{cityMapStore:n}=U();return(l,f)=>{var _,t,p,v,u,y,x,i;const m=M("van-image");return c(),h("div",{class:"w-full p-3 bg-white rounded-xl flex items-center justify-start",style:B({backgroundColor:s.backgroundColor})},[d("div",Te,[L(m,{width:"80",height:"80",fit:"cover",src:(((_=s.store)==null?void 0:_.storeIcons)||"").split(",")[0]},null,8,["src"]),+((t=s.store)==null?void 0:t.storeGoodsCount)>0?(c(),z(ce,{key:0})):N("",!0)]),d("div",Ne,[d("div",Fe,[d("span",De,S(((p=s.store)==null?void 0:p.storeName)||""),1)]),d("div",Ee,S(((v=s.store)==null?void 0:v.goodsCategoryName3)||"")+" "+S(((u=s.store)==null?void 0:u.areaExtName3)||""),1),d("div",Pe,[d("span",Ve,[+((y=s.store)==null?void 0:y.wantCount)?(c(),h(D,{key:0},[Y(S(s.store.wantCount)+"人想要 ",1)],64)):N("",!0)]),(x=I(n).locationCoords)!=null&&x.lng&&((i=I(n).locationCoords)!=null&&i.lat)?(c(),h("span",je,S(I(r)(s.store.distance)),1)):N("",!0)])])],4)}}},Oe={class:"min-h-[calc(100vh-102px-env(safe-area-inset-bottom)-25px-3.5rem)] p-3 bg-[#f2f0ef] rounded-[20px_20px_0_0]"},Ue=T({props:{storeParams:{default:()=>{}}},setup(s){const r=s,{cityMapStore:n}=U(),l=O(),f=k(!1),m=k(0),_=k(20),t=k(!1),p=k([]),v=()=>{m.value=0,t.value=!1,p.value=[],u()},u=async()=>{m.value+=1,t.value=!1,f.value=!0,await y(),f.value=!1},y=async()=>{var a,C;let i=[];(n.locationCoords.lat&&n.locationCoords.lng||(a=n.currentActiveCity)!=null&&a.areaLatitude&&((C=n.currentActiveCity)!=null&&C.areaLongitude))&&i.push("asc|distance_order"),i.push("desc|store_home_order"),i.push("asc|store_id");let $=i.length?i.join(","):null;const g={page:m.value,size:_.value,...r.storeParams,sortBy:$},{success:o,data:w}=await oe(g);if(!o||!w||!w.total){t.value=!0;return}const e=w.records||[];e.forEach(b=>{b.shopName=b.storeName||b.shopName}),p.value=m.value===1?e:[...p.value,...e],p.value.length>=w.total&&(t.value=!0)},x=i=>{console.log(i),l.push({path:"/city/cityMap/storefront",query:{storeId:i.storeId,child:1}})};return q(()=>r.storeParams,i=>{i.areaIdPreviousLastLeaf&&v()},{immediate:!0,deep:!0}),K(()=>{}),(i,$)=>{const g=M("van-list");return c(),h("div",Oe,[p.value.length===0&&!f.value?(c(),z(se,{key:0,name:i.$t("common.No data yet")},null,8,["name"])):(c(),z(g,{key:1,loading:f.value,"onUpdate:loading":$[0]||($[0]=o=>f.value=o),finished:t.value,"finished-text":i.$t("common.noMore"),onLoad:u},{default:F(()=>[(c(!0),h(D,null,j(p.value,o=>(c(),z(Be,{key:o.goodsId,store:o,class:"mb-3 :last:mb-0",onClick:w=>x(o)},null,8,["store","onClick"]))),128))]),_:1},8,["loading","finished","finished-text"]))])}}}),qe=T({props:{topId:{default:"fm-page"},svg:{default:"cityMap/backTop.svg"},size:{default:50},msize:{default:24},right:{default:16},bottom:{default:16},bg:{default:"#FFF"}},setup(s){const r=s;O();const n=k(null),{width:l,height:f}=Z(),{style:m}=ee(n,{initialValue:{x:l.value-(r.right+r.size),y:f.value-(r.bottom+r.size)},onMove:t=>{t.x>r.right&&(t.x=l.value-(r.right+r.size)),t.x<r.right&&(t.x=r.right),t.y>f.value-r.size&&(t.y=f.value-r.size),t.y<0&&(t.y=0)}}),_=()=>{const t=document.querySelector("#"+r.topId);t&&setTimeout(()=>{t.scrollTo({top:0})},50)};return K(()=>{}),(t,p)=>{const v=M("VanImage");return c(),h("div",{ref:(u,y)=>{y.el=u,n.value=u},style:B([I(m),{"touch-action":"none"}]),onClick:_,class:E(["fixed z-[49] flex items-center justify-center rounded-full shadow-[0_1px_16px_0_rgba(0,0,0,0.16)] cursor-pointer",`w-[${s.size}px] h-[${s.size}px] bg-[${s.bg}]`])},[L(v,{src:I(ne)(s.svg),class:E(["overflow-hidden",`w-[${s.msize}px] h-[${s.msize}px]`]),alt:""},null,8,["src","class"])],6)}}}),Ke=P(qe,[["__scopeId","data-v-97ea034e"]]),Re={class:"header__wrap relative"},Xe={key:1,class:"mt-3"},Ge=T({name:"CityMap"});function He(s){var w;const r=X(),n=O(),{cityMapStore:l}=U(),f=A(()=>{var b;const e=((b=l.currentActiveCity)==null?void 0:b.areaIcon)||null;return{backgroundImage:`url(${e||ue})`}||{}}),m=k([]),_=async()=>{var b,V;const e={areaIdPreviousLastLeaf:((b=l.currentActiveCity)==null?void 0:b.areaId)||"",overseasFlag:((V=l.currentActiveCity)==null?void 0:V.overseasFlag)||!1},{success:a,data:C}=await re(e);a&&(m.value=C||[])};q(l.currentActiveCity,(e,a)=>{console.log("已选城市发生改变",{newCity:e==null?void 0:e.areaName,oldCity:a==null?void 0:a.areaName,hasAreaId:!!(e!=null&&e.areaId)}),e!=null&&e.areaId&&_()},{immediate:!0,deep:!0});const t=()=>{const e=setInterval(()=>{var a;(a=l.currentActiveCity)!=null&&a.areaId&&(_(),clearInterval(e))},500)},p=e=>{console.log(e),n.push({path:"/city/poi",query:{categoryId:e.goodsCategoryId}})},v=A(()=>{let e=m.value.map(a=>({label:a.goodsCategoryName,value:a.goodsCategoryId}));return e.unshift({label:"附近店铺",value:""}),e}),u=k(((w=v.value[0])==null?void 0:w.value)||""),y=e=>{u.value=e},x=A(()=>{var e,a,C,b;return{goodsCategoryId1:u.value,longitude:l.locationCoords.lng||((e=l.currentActiveCity)==null?void 0:e.areaLongitude)||null,latitude:l.locationCoords.lat||((a=l.currentActiveCity)==null?void 0:a.areaLatitude)||null,areaIdPreviousLastLeaf:((C=l.currentActiveCity)==null?void 0:C.areaId)||"",overseasFlag:((b=l.currentActiveCity)==null?void 0:b.overseasFlag)||!1}}),i=A(()=>document.querySelector("#fm-page")),$=k(0),g=k(!1),o=e=>{if(r.path!=="/city/cityMap"){i.value.removeEventListener("scroll",o);return}$.value=e.target.scrollTop,$.value>=81?g.value=!0:g.value=!1};return K(async()=>{await l.init(),t(),i.value.addEventListener("scroll",o)}),te(()=>{i.value.removeEventListener("scroll",o)}),(e,a)=>{const C=M("van-sticky"),b=M("router-view");return c(),h("div",{class:"app-container img__wrap",style:B(I(f))},[L(C,{"z-index":"10"},{default:F(()=>[d("div",Re,[L(xe)])]),_:1}),g.value?(c(),z(C,{key:0,"z-index":"9"},{default:F(()=>[L(Me,{options:I(v),modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=V=>u.value=V),onChange:y,"label-key":"label","value-key":"value"},null,8,["options","modelValue"])]),_:1})):(c(),h("div",Xe,[L(Ie,{categoryList:m.value,tabFixed:g.value,onHandleMenu:p},null,8,["categoryList","tabFixed"])])),g.value?(c(),h("div",{key:2,class:"imgSticky img__wrap sm:w-[375px] w-full h-[68px] fixed top-0 left-1/2 -translate-x-1/2 z-[8]",style:B(I(f))},null,4)):N("",!0),d("div",{class:E(["bg-white pt-[5.5px] mt-[-0.5px]",g.value?"pt-[53px]":""])},[L(Ue,{storeParams:I(x)},null,8,["storeParams"])],2),L(Ke,{size:40,msize:20,bottom:92}),L(b,{class:"child-view !rounded-none"})],4)}}const We=T({...Ge,setup:He}),at=P(We,[["__scopeId","data-v-065b9d53"]]);export{at as default};

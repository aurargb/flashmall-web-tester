import{_ as oo}from"./mall-C69gPh5W.js";import{_ as so}from"./upload-pRJ1Wopi.js";import{_ as z,y as P,E as V,K as T,G as g,N as I,H as s,a3 as to,O as S,F as k,Q as d,a1 as N,Z as O,$ as M,w as H,l as eo,r as x,z as J,I as ao,J as no,X as U,a4 as G,T as w,bf as io,bj as lo,D as co,P as b}from"./vendor-BlU_hoYl.js";import{_ as K}from"./MCOIN-BOqZVkND.js";import{b as ro}from"./mall-BWu47CdE.js";import{u as Q,N as X,e as uo,aa as po,ab as mo,a3 as go,q as fo,T as ho}from"./index-Wb-6_0W_.js";import{B as vo}from"./BackIcon-8hcEjDKb.js";import{u as _o}from"./upload-fNWojfp2.js";const Z=e=>(O("data-v-0578eb03"),e=e(),M(),e),bo={class:"flex gap-2 py-3 relative"},xo={class:"flex flex-col flex-1 h-[65px] justify-between"},yo={class:"flex items-start justify-between"},Io={class:"line-clamp-2"},$o={key:0,class:"flex items-center"},wo={class:"flex items-baseline"},ko={class:"mr-1"},Ro={class:"text-[#999] text-xs font-normal"},So={class:"text-[#FEA021]"},Vo={key:1,class:"flex-center-bw f-wrap flex-1"},Do={class:"flex-center"},Co=Z(()=>s("img",{src:K,class:"w-4 h-4 mr-1.5"},null,-1)),Lo={class:"flex items-baseline"},Fo={class:"mr-1"},Bo={class:"flex items-baseline"},Eo={class:"flex-start mr-1"},Ao={class:"text-[#999] text-xs font-normal flex-shrink-0"},qo={class:"text-[#FEA021]"},To={key:2,class:"flex items-center"},No=Z(()=>s("img",{src:K,class:"w-4 h-4 mr-1.5"},null,-1)),jo={class:"flex items-baseline"},Go={class:"mr-1"},Uo=P({props:{goods:null,card:null,chooseDisabled:{type:Boolean}},setup(e){const{goods:A,card:R}=e;return(y,n)=>{const D=V("VanImage"),l=V("van-checkbox");return g(),T(l,{name:e.goods.id,class:""},{default:I(()=>{var c;return[s("div",bo,[S(D,{src:e.goods.icons&&e.goods.icons.split(",")[0],class:"w-[60px] h-[60px] rounded-md overflow-hidden",alt:"",fit:"cover"},null,8,["src"]),s("div",xo,[s("div",yo,[s("div",Io,d(e.goods.goodsName),1)]),e.goods.payType===2?(g(),k("div",$o,[s("div",wo,[s("div",ko,[s("span",Ro,d(y.$t("piggy.cardPrice")),1),s("span",So,d(e.goods.cardPrice),1),N(d(e.card.symbol),1)])])])):e.goods.payType===3?(g(),k("div",Vo,[s("div",Do,[Co,s("div",Lo,[s("div",Fo,d(e.goods.price)+"Mcoin",1)])]),s("div",Bo,[s("div",Eo,[s("div",Ao,d(y.$t("piggy.cardPrice")),1),s("div",qo,d(e.goods.cardPrice),1),N(" "+d(((c=e.card)==null?void 0:c.symbol)||""),1)])])])):(g(),k("div",To,[No,s("div",jo,[s("div",Go,d(e.goods.price)+"Mcoin",1)])]))])]),to(y.$slots,"default",{},void 0,!0)]}),_:3},8,["name"])}}}),zo=z(Uo,[["__scopeId","data-v-0578eb03"]]),W=e=>(O("data-v-8b7035ee"),e=e(),M(),e),Po={key:0},Oo={key:0,class:"w-full py-2 rounded-lg bg-[#f5f5f5] mb-2"},Mo={class:"font-normal text-default"},Jo=W(()=>s("span",{class:"text-[#000]"},"%",-1)),Ho={class:"font-normal text-default"},Ko=W(()=>s("span",{class:"text-[#000]"},"%",-1)),Qo={key:1,class:"min-h-[200px] text-center py-4 flex items-end justify-center"},Xo=P({props:{shopStatus:null,goodInfos:null},setup(e,{expose:A}){const R=e,{t:y}=H(),n=eo(),D=x(null),l=x([]),c=x([]),C=x(!1),F=x(!1),B=x(0),j=x(10),q=x(0),{getCurrentStoreId:a}=Q();J(()=>l.value,o=>{if(o.length>3)return l.value=l.value.slice(0,3),w(y("common.choose tips"));c.value.forEach(t=>{o.includes(t.goods.id)?t.checked=!0:t.checked=!1})},{deep:!0,immediate:!0}),J(()=>R.goodInfos,()=>{c.value.forEach(o=>{R.goodInfos.map(t=>(o.goods.id===t.goodsId&&(o.goods.balanceDiscountRatio=t.balanceDiscountRatio,o.goods.balanceDiscountRatio=t.balanceDiscountRatio),t))})},{deep:!0,immediate:!0});const r=async()=>{C.value=!0,B.value+=1,await p(),C.value=!1},f=o=>{R.shopStatus===1&&n.push(o)},h=o=>o>30?"30":o||"",$=o=>o>36?"36":o||"",L=o=>{var u,v;const t=Number(o.goods.discountRatio)>9?6:11;+((u=o.goods)==null?void 0:u.discountRatio)>0?o.goods.balanceDiscountRatio=+((v=o.goods)==null?void 0:v.discountRatio)+t:o.goods.balanceDiscountRatio=null},p=async()=>{var u;const o=await ro({merchant:(u=await a())==null?void 0:u.merchant,status:1,type:1,page:B.value,size:j.value,deliveryType:1});if(C.value=!1,!o.success){F.value=!0;return}if(!o.data||!o.total){F.value=!0,c.value=B.value===1?[]:c.value;return}q.value=o.total;const t=x([]);t.value=o.data.map(v=>({btnLoading:!1,...v})),c.value=B.value===1?t.value:c.value.concat(t.value),c.value.length>=q.value&&(F.value=!0)};return A({goodsChecked:l,list:c}),(o,t)=>{const u=V("van-field"),v=V("van-checkbox-group"),_=V("VanList");return g(),T(_,{class:"px-3 min-h-[200px] mb-[70px]",loading:C.value,"onUpdate:loading":t[5]||(t[5]=i=>C.value=i),finished:F.value,"loading-text":o.$t("common.loading"),onLoad:r},{default:I(()=>[S(v,{modelValue:l.value,"onUpdate:modelValue":t[3]||(t[3]=i=>l.value=i),ref:(i,E)=>{E.checkboxGroup=i,D.value=i},max:4,"checked-color":"#FEA021",onClick:t[4]||(t[4]=G(()=>{},["stop"]))},{default:I(()=>[c.value.length>0?(g(),k("div",Po,[(g(!0),k(ao,null,no(c.value,(i,E)=>(g(),T(zo,{key:i.goods.id,index:E,goods:i.goods,card:i.card,class:"relative w-full pl-5"},{default:I(()=>[i.checked?(g(),k("div",Oo,[S(u,{onClick:t[0]||(t[0]=G(()=>{},["stop"])),"input-align":"right",type:"digit",autocomplete:"off",disabled:"",formatter:h,modelValue:i.goods.discountRatio,"onUpdate:modelValue":[m=>i.goods.discountRatio=m,m=>L(i)],placeholder:`${o.$t("shop.pleaseInput")}4-30`},{label:I(()=>[s("div",Mo,d(`${o.$t("goods.discountRatio")} `),1)]),"right-icon":I(()=>[Jo]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),S(u,{onClick:t[1]||(t[1]=G(()=>{},["stop"])),"input-align":"right",type:"digit",autocomplete:"off",modelValue:i.goods.balanceDiscountRatio,"onUpdate:modelValue":m=>i.goods.balanceDiscountRatio=m,formatter:$,disabled:"",placeholder:`${o.$t("shop.pleaseInput")}10-36`},{label:I(()=>[s("div",Ho,d(`*${o.$t("goods.goods balance discount placeholder")} `),1)]),"right-icon":I(()=>[Ko]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])):U("",!0)]),_:2},1032,["index","goods","card"]))),128))])):(g(),k("div",Qo,[s("div",{onClick:t[2]||(t[2]=i=>f("/shopGoods/editGoods")),class:"opacity-60 text-sm font-normal mb-2.5"},d(o.$t("common.goods no data")),1)]))]),_:1},8,["modelValue"])]),_:1},8,["loading","finished","loading-text"])}}}),Zo=z(Xo,[["__scopeId","data-v-8b7035ee"]]),Wo=e=>X("GET","/boutiqueShopApply/last",e),Yo=e=>X("POST","/boutiqueShopApply/sub",e),Y=e=>(O("data-v-f8ddcebe"),e=e(),M(),e),os={class:"bg-[#FEECE9] px-1.5"},ss={class:"flex-start px-1 py-2.5"},ts={key:0,class:"flex-start py-2 px-2.5 border-[2px] border-[#FB1A18] border-solid rounded-xl mb-2.5"},es={class:"text-[#FB1A18] font-sm"},as={class:"bg-white rounded-lg p-3.5 mb-2.5"},ns={class:"mb-5 flex-start"},is=Y(()=>s("img",{src:oo,class:"w-[18px] mr-1"},null,-1)),ds={class:"font-normal mb-2.5"},ls={class:"w-full"},cs=Y(()=>s("img",{src:so,class:"w-[40px] h-[40px] m-auto object-cover"},null,-1)),rs={class:"opacity-60"},us={class:"bg-white rounded-lg"},ps={class:"p-2.5"},ms={class:"absolute bottom-0 left-0 right-0 bg-[#FEECE9] px-2.5 py-4 mx-auto text-center z-10"},gs=P({setup(e){const{accountStore:A}=uo(),{getCurrentStoreId:R}=Q(),{t:y}=H(),n=io({shopInfo:{status:-1},formData:{},imgList:[],goodInfos:[]}),D=x(!1),l=x(null),c=x(!1),C=async()=>{var r;const a=await ho((r=await R())==null?void 0:r.merchant);a.success&&a.data&&(n.shopInfo=a.data)},F=async a=>{const r=po(a.file);if(!r.valid)return n.imgList.length-=1,w(r.tips);const f=mo(a.file);if(!f.valid)return n.imgList.length-=1,w(f.tips);const h=await go(a,"shopScenery"),$=await _o(h);if(!$.success)return w("图片上传失败"),n.imgList.length-=1;n.imgList[n.imgList.length-1]={url:fo.imgUrl+$.data}},B=async()=>{var f,h,$,L;if(A.isOnlyView)return w(y("order.Requires merchant account operation"));let a=[];if(D.value=!1,(h=(f=l.value)==null?void 0:f.goodsChecked)==null||h.map(p=>{var t,u,v,_,i,E;const o=(u=(t=l.value)==null?void 0:t.list)==null?void 0:u.findIndex(m=>m.goods.id===p);if(o>-1){const m=(v=l.value)==null?void 0:v.list[o];if(!((_=m.goods)!=null&&_.discountRatio)||((i=m.goods)==null?void 0:i.discountRatio)<4||((E=m.goods)==null?void 0:E.discountRatio)>30){w(y("shop.emptyRadio")+"4-30"),D.value=!0;return}(+m.goods.discountRatio<4?4:+m.goods.discountRatio)+6,a.push(m)}return p}),D.value)return;c.value=!0;const r=await Yo({shopId:($=await R())==null?void 0:$.id,masterImg:n.imgList.map(p=>p.url).join(","),goodIds:(L=l.value)==null?void 0:L.goodsChecked.join(","),goodInfos:JSON.stringify(a.map(p=>({goodsId:p.goods.id,balanceDiscountRatio:p.goods.balanceDiscountRatio,discountRatio:p.goods.discountRatio})))});setTimeout(()=>{c.value=!1},1e3),r.success&&(w(y("common.submit success wait review")),q())},j=async()=>{var r,f;const a=await Wo({shopId:(r=await R())==null?void 0:r.id});a.success&&(n.formData=a.data||{},n.imgList=(f=a.data)!=null&&f.masterImg?a.data.masterImg.split(",").map(h=>({url:h})):[],n.formData.status<3?l.value.goodsChecked=a.data.goodIds?a.data.goodIds.split(",").map(h=>+h):[]:l.value.goodsChecked=[])},q=async()=>{await C(),n.shopInfo.status===1?j():w({message:y("shop.noShop"),duration:0})};return lo(()=>{w.clear()}),co(async()=>{q()}),(a,r)=>{var L,p,o,t,u,v;const f=V("van-icon"),h=V("van-uploader"),$=V("VanButton");return g(),k("div",os,[s("div",ss,[S(vo),s("div",null,d(a.$t("profile.Featured Display")),1)]),((L=b(n).formData)==null?void 0:L.status)===3&&((p=b(n).formData)!=null&&p.reasonRejection)?(g(),k("div",ts,[S(f,{name:"warning",color:"#FB1A18",size:"20",class:"mr-1.5"}),s("div",es,d(((o=b(n).formData)==null?void 0:o.reasonRejection)||"-"),1)])):U("",!0),s("div",as,[s("div",ns,[is,N(" "+d(((t=b(n).shopInfo)==null?void 0:t.storeName)||"-"),1)]),s("div",ds,d(a.$t("shop.up boutique img")),1),S(h,{class:"w-[150px] h-[150px] bg-[#F4F6F8] rounded-lg flex-center",modelValue:b(n).imgList,"onUpdate:modelValue":r[0]||(r[0]=_=>b(n).imgList=_),accept:"image/*","preview-size":[150,150],"max-count":1,afterRead:F},{default:I(()=>[s("div",ls,[cs,s("div",rs,d(a.$t("shop.img")),1)])]),_:1},8,["modelValue"])]),s("div",us,[s("div",ps,d(a.$t("shop.choose boutique goods"))+d(a.$t("shop.limit three")),1),S(Zo,{ref:(_,i)=>{i.goodsContainer=_,l.value=_},shopStatus:b(n).shopInfo.status,goodInfos:b(n).goodInfos},null,8,["shopStatus","goodInfos"])]),s("div",ms,[b(A).isOnlyView?U("",!0):(g(),T($,{key:0,loading:c.value,disabled:((u=l.value)==null?void 0:u.goodsChecked.length)<=0||b(n).imgList.length<=0||((v=l.value)==null?void 0:v.goodsChecked.length)>3,class:"w-[160px] h-[40px] btn-orange text-white",onClick:B},{default:I(()=>{var _,i;return[N(d(((_=b(n).formData)==null?void 0:_.status)<=2?a.$t("common.edit"):((i=b(n).formData)==null?void 0:i.status)>2?a.$t("common.Resubmit"):a.$t("common.submit")),1)]}),_:1},8,["loading","disabled"]))])])}}}),$s=z(gs,[["__scopeId","data-v-f8ddcebe"]]);export{$s as default};

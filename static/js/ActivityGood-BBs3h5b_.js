import{_ as N,y as L,w as P,l as V,a2 as E,r as o,a7 as H,bh as R,E as D,F as w,G as p,H as s,O as F,N as B,Q as $,K as y,I as j,J,P as b,T as A}from"./vendor-BlU_hoYl.js";import{B as K}from"./BoutiqueGoodItemv2-YL31um0I.js";import{B as M}from"./BackIcon-8hcEjDKb.js";import{a7 as O,r as Q,a8 as U,a9 as W}from"./index-Clz0Qna-.js";import{_ as X}from"./DefaultPage-DQXPcwhv.js";import"./RatioBox-CfBlBgLi.js";import"./GoodsPrice-BNTIqb2J.js";import"./MCOIN-Bodfn-v1.js";import"./ShopMaskTips-CxJi-SfW.js";import"./goods-BVwS8oFG.js";const Y={class:"overflow-y-auto"},Z={class:"header-bar sticky top-0 flex font-normal justify-center text-sm items-center h-[44px] px-2.5 z-50"},tt={class:"absolute left-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},et={class:"font-semibold"},ot={class:"bg-white h-full"},at=L({name:"ActivityGood"});function st(lt){var x;const{t:g}=P(),h=V(),n=E(),S=O(),l=o(1);l.value=+((x=n.query)==null?void 0:x.type)||1;const i=o([]),u=o(!1),r=o(!1),c=o(0),_=o(10),v=o(0),d=o([]),f=o(0),q=H.throttle(()=>{const t=document.querySelector(".list-content");t&&(f.value=t.scrollTop)},200),I=()=>{const t=document.querySelector(".list-content");t&&(t.scrollTop=f.value)};R(()=>{var t,e;l.value!=+((t=n.query)==null?void 0:t.type)&&(l.value=+((e=n.query)==null?void 0:e.type)||1,c.value=0,i.value=[],r.value=!1,v.value=0,d.value=[],f.value=0),T(),I()});const G=async()=>{let t={};+l.value==1?t={page:c.value,size:_.value,status:1,sortType:3,boutiqueTop:!0,isActivity:99}:t={page:c.value,size:_.value,isActivity:1,boutiqueTop:!0};const e=await W(t);if(!e.success||!e.data||!+e.total){r.value=!0,u.value=!1;return}v.value=e.total,d.value=e.data,i.value=c.value===1?d.value.length>0?d.value:[]:i.value.concat(d.value),i.value.length>=v.value&&(r.value=!0)},T=async()=>{u.value=!0,c.value+=1,await G(),setTimeout(()=>{u.value=!1},1e3)},{loadingToggle:k}=Q(),z=async t=>{if(t.stock===0&&t.goodsTypes!=2){A(g("order.Insufficient stock"));return}const e={needlogin:"true",...n.query};h.replace({path:n.path,query:e}),k(!0);const m=await U(t.id);k(!1),m.success&&(A(g("cart.addTips")),S.getCartCount())},C=t=>{h.push(t)};return(t,e)=>{const m=D("VanList");return p(),w("div",Y,[s("section",Z,[s("div",tt,[F(M,null,{default:B(()=>[s("span",null,$(t.$t("common.return")),1)]),_:1})]),s("div",et,$(l.value===1?t.$t("activity.new"):t.$t("active.active")),1)]),s("div",{class:"list-content h-[calc(100vh-44px)] sticky top-[44px] overflow-auto rounded-t-[12px] bg-white",onScroll:e[1]||(e[1]=(...a)=>b(q)&&b(q)(...a))},[s("div",ot,[r.value&&v.value===0?(p(),y(X,{key:0,title:t.$t("common.No products")},null,8,["title"])):(p(),y(m,{key:1,class:"py-5 px-2.5 pt-2",loading:u.value,"onUpdate:loading":e[0]||(e[0]=a=>u.value=a),finished:r.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:T},{default:B(()=>[(p(!0),w(j,null,J(i.value,a=>(p(),y(K,{key:a.id,data:a,onClick:it=>C(`/goodsDetail?id=${a.id}`),onHandleAddCart:z,onHandleTo:C},null,8,["data","onClick"]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"]))])],32)])}}const nt=L({...at,setup:st}),ht=N(nt,[["__scopeId","data-v-6a0ffccf"]]);export{ht as default};

import{_ as He}from"./arrow-down-585654-DxqU-60D.js";import{_ as Te,y as Ue,w as Oe,l as Re,r as y,a2 as je,be as qe,bf as Fe,D as ze,E as x,F as Ae,X as Ge,G as we,H as o,O as i,Q as v,N as C,P as m,I as Je,J as Qe,a1 as We,Z as Xe,$ as Ze,T as N}from"./vendor-BlU_hoYl.js";import{a as Ye,v as es,B as ss}from"./order-pJoL_MtT.js";import{B as as}from"./BackIcon-8hcEjDKb.js";import{R as ts}from"./index-Wb-6_0W_.js";const Ie=f=>(Xe("data-v-caacff9c"),f=f(),Ze(),f),os={key:0,class:"font-Puhui main-bg safe-bottom-page"},rs={class:"header-bar fixed top-0 left-0 right-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 backdrop-blur-md"},ds={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},ns={class:"font-bold text-base text-b1"},ls={class:"safe-bottom pt-[50px] rounded-xl px-3"},is={class:"rounded-xl bg-white overflow-hidden px-3"},ps=Ie(()=>o("img",{src:He,class:"w-4 h-4 m-[2px]",alt:""},null,-1)),cs=Ie(()=>o("div",{class:"h-px bg-[#e5e5e5]"},null,-1)),us={class:"flex justify-center items-center relative h-14 font-bold text-[22px] text-[#3a2e13]"},ms={class:"flex-1 text-center text-base font-semibold text-b1"},fs={class:"pl-4 pr-4 pb-4 h-[calc(100%-56px)] overflow-y-scroll"},hs=["onClick"],ys={class:"text-b1"},xs={class:"popup-footer w-full fixed bottom-0 left-0 right-0 safe-bottom px-3"},vs=Ue({name:"SellerDelivery"});function bs(f){const{t:A}=Oe(),w=Re(),{getMerchantDhKey:b,decryptAddressKey:ke,decryptKey:I,cryptoAESWithSearch:De,encryptKey:k}=ts();y(!1);const D=je(),Ee=D.query.id,Ve=D.query.detail,h=y(null),E=y(!1),Le=async()=>{var d,l,t,_,g,V,L,S,$,B,K,M,P,H,T,U,O,R,j,q,F,z,G,J,Q,W,X,Z,Y,ee,se,ae,te,oe,re,de,ne,le,ie,pe,ce,ue,me,fe,he,ye,xe,ve,be,_e,ge,Ce;const e=await Ye({id:Ee});let s="";if((d=e.data)!=null&&d.userAddress&&(e.data.userAddress.postscript=e.data.postscript),(l=e.data)!=null&&l.userAddress&&((_=(t=e.data)==null?void 0:t.userAddress)!=null&&_.encryptFlag)){const n=await b(e.data.address,(g=e.data)==null?void 0:g.submitUserPubKey);n&&(e.data.userAddress=ke(e.data.userAddress,n),(L=(V=e.data)==null?void 0:V.userAddress)!=null&&L.success&&!((S=e.data)!=null&&S.merchantEns)&&(s+=((B=($=e.data)==null?void 0:$.userAddress)==null?void 0:B.userName)+((M=(K=e.data)==null?void 0:K.userAddress)==null?void 0:M.telNumber)+(((H=(P=e.data)==null?void 0:P.userAddress)==null?void 0:H.postalCode)??"")+((U=(T=e.data)==null?void 0:T.userAddress)==null?void 0:U.provinceName)+((R=(O=e.data)==null?void 0:O.userAddress)==null?void 0:R.cityName)+((q=(j=e.data)==null?void 0:j.userAddress)==null?void 0:q.countyName)+((z=(F=e.data)==null?void 0:F.userAddress)==null?void 0:z.detailInfo)+((J=(G=e.data)==null?void 0:G.userAddress)==null?void 0:J.postscript)))}else(Q=e.data)!=null&&Q.merchantEns||(s+=((X=(W=e.data)==null?void 0:W.userAddress)==null?void 0:X.userName)+((Y=(Z=e.data)==null?void 0:Z.userAddress)==null?void 0:Y.telNumber)+(((se=(ee=e.data)==null?void 0:ee.userAddress)==null?void 0:se.postalCode)??"")+((te=(ae=e.data)==null?void 0:ae.userAddress)==null?void 0:te.provinceName)+((re=(oe=e.data)==null?void 0:oe.userAddress)==null?void 0:re.cityName)+((ne=(de=e.data)==null?void 0:de.userAddress)==null?void 0:ne.countyName)+((ie=(le=e.data)==null?void 0:le.userAddress)==null?void 0:ie.detailInfo)+((ce=(pe=e.data)==null?void 0:pe.userAddress)==null?void 0:ce.postscript));if(e.data.shippingHash){const n=await b(e.data.address,(ue=e.data)==null?void 0:ue.shippingUserPubKey);if(n){const Ne=I(e.data.expressNo,n);Ne.hash===e.data.shippingHash&&(e.data.expressNo=Ne.decrypt,e.data.expressCompany=I(e.data.expressCompany,n).decrypt,(me=e.data)!=null&&me.merchantEns||(s+=((fe=e.data)==null?void 0:fe.expressNo)+((he=e.data)==null?void 0:he.expressCompany)))}else(ye=e.data)!=null&&ye.merchantEns||(s+=((xe=e.data)==null?void 0:xe.expressNo)+((ve=e.data)==null?void 0:ve.expressCompany));(be=e.data)!=null&&be.merchantEns||(s+=((_e=e.data)==null?void 0:_e.hash)+((ge=e.data)==null?void 0:ge.address))}const u=[{id:(Ce=e.data)==null?void 0:Ce.id,merchantEns:await De(s)}].filter(n=>n.merchantEns);u.length>0&&es({enInfoList:u}),h.value=e.data},[Se,$e]=qe(!1),p=y(!1),Be=["无需发货","到付运费","顺丰速运","中国邮政EMS","京东物流","中通快递","圆通速递","韵达快递","申通快递","极兔速递","其他"],a=Fe({expressCompany:"",expressNo:"",orderId:""}),Ke=e=>{a.expressCompany=e,p.value=!1},Me=()=>{p.value=!1},Pe=async()=>{var s;if(E.value)return;c(!0),a.orderId=h.value.id;const e=await b((s=h.value)==null?void 0:s.address);try{if(!a.expressCompany){N.fail(A("order.deliveryCompanyPlaceholder")),c(!1);return}if(a.expressCompany!=="无需发货"&&!a.expressNo){N.fail(A("order.express empty")),c(!1);return}let r={expressCompany:a.expressCompany,expressNo:a.expressNo,orderId:a.orderId,shippingHash:null};if(e){const d=k(a.expressNo,e);r.expressNo=d.encrypt,r.shippingHash=d.hash;const l=k(a.expressCompany,e);r.expressCompany=l.encrypt}if((await ss(r)).success){const d=Ve?-2:-1;w.go(d),setTimeout(()=>{w.replace({path:"/sellerOrderList",query:{active:1,type:1}})},50)}c(!1)}catch(r){c(!1),N.fail(r.message)}},c=(e=!0)=>{$e(e),E.value=e};return ze(async()=>{await Le()}),(e,s)=>{const r=x("van-field"),u=x("van-icon"),d=x("van-popup"),l=x("VanButton");return h.value?(we(),Ae("div",os,[o("section",rs,[o("div",ds,[i(as)]),o("div",ns,v(e.$t("order.deliveryInfo")),1)]),o("div",ls,[o("div",is,[i(r,{modelValue:m(a).expressCompany,"onUpdate:modelValue":s[0]||(s[0]=t=>m(a).expressCompany=t),label:e.$t("order.deliveryCompany"),placeholder:e.$t("order.deliveryCompanyPlaceholder"),border:!1,"input-align":"right",readonly:"",onClick:s[1]||(s[1]=t=>p.value=!0)},{"right-icon":C(()=>[ps]),_:1},8,["modelValue","label","placeholder"]),cs,i(r,{modelValue:m(a).expressNo,"onUpdate:modelValue":s[2]||(s[2]=t=>m(a).expressNo=t),label:e.$t("order.deliveryId"),placeholder:e.$t("order.deliveryPlaceholder"),border:!1,"input-align":"right",maxlength:150},null,8,["modelValue","label","placeholder"]),i(d,{show:p.value,"onUpdate:show":s[3]||(s[3]=t=>p.value=t),position:"bottom",round:"",style:{width:"100%",borderRadius:"20px 20px 0 0",maxHeight:"90vh",height:"660px"}},{default:C(()=>[o("div",us,[o("span",ms,v(e.$t("order.deliveryCompany")),1),i(u,{name:"cross",class:"absolute right-4 top-1/2 -translate-y-1/2 text-2xl",onClick:Me})]),o("div",fs,[(we(),Ae(Je,null,Qe(Be,(t,_)=>o("div",{key:t,class:"text-b1 py-4 border-b border-[#D9D9D9]",onClick:g=>Ke(t)},[o("span",ys,v(t),1)],8,hs)),64))])]),_:1},8,["show"])]),o("div",xs,[i(l,{round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full w-full",loading:m(Se),onClick:Pe},{default:C(()=>[We(v(e.$t("order.Ship")),1)]),_:1},8,["loading"])])])])):Ge("",!0)}}const _s=Object.assign(vs,{setup:bs}),Is=Te(_s,[["__scopeId","data-v-caacff9c"]]);export{Is as default};

import{y as T,F as l,G as s,H as e,a4 as w,P as b,X as r,Q as g,_ as Z,a1 as _,w as D,l as tt,E as R,K as v,O as z,T as q,I as E,z as et,r as $,N as st,bc as H,bd as V,J as ot}from"./vendor-BlU_hoYl.js";import{_ as O}from"./buy-cart-DX6aL7m1.js";import{ap as at,d as it,g as F,a7 as nt,r as lt,a8 as dt}from"./index-UgIL2Smv.js";import{D as W}from"./goods-BVwS8oFG.js";import{_ as M}from"./ShopMaskTips-CxJi-SfW.js";import{S as L}from"./shop-CeqcS6K2.js";import{_ as J}from"./GoodsPrice-CFQUMmEr.js";import{b as ct}from"./mall-DBbHU8Zq.js";import{W as rt}from"./WaterFull-Ce1Oez92.js";const ut=["src"],mt=T({name:"ActivePlaceholder"});function gt(t){return(u,d)=>{var a,f;return s(),l("div",{onClick:d[0]||(d[0]=w(h=>{var o;return b(at)((o=t.info)==null?void 0:o.activePath)},["stop"])),class:"rounded-lg overflow-hidden min-h-[20px]"},[e("img",{src:t.type?(a=t.info)==null?void 0:a.activeImgGrid:(f=t.info)==null?void 0:f.activeImg,alt:""},null,8,ut)])}}const K=T({...mt,props:{info:null,type:null},setup:gt}),vt={key:0,class:"text-xs bg-[#FBA923] rounded-sm px-1 leading-normal mr-2.5 whitespace-nowrap text-white"},Q=T({props:{type:{default:0}},setup(t){return(u,d)=>t.type!==b(L).SD?(s(),l("div",vt,g(t.type===b(L).SL?"精":t.type===b(L).PR?"优":"星"),1)):r("",!0)}}),ft={class:"absolute top-0 right-0 items-center gap-1 px-1.5 py-1 text-xs font-normal bg-ratio text-black-800 no-wrap rounded-tr-lg rounded-bl-lg"},yt={class:"font-semibold"},ht=_("%"),xt=T({props:{ratio:null,tag:null},setup(t){const{ratio:u,tag:d}=t;return(a,f)=>(s(),l("div",ft,[e("span",null,g(t.tag||a.$t("common.ratio")),1),e("span",null,[e("span",yt,g(b(it)(t.ratio||0)),1),ht])]))}}),U=Z(xt,[["__scopeId","data-v-6a6fc0c6"]]),kt={key:1,class:"relative w-full h-full text-right bg-white rounded-lg"},$t={class:"w-full max-h-[250px] relative overflow-hidden"},wt=["src"],bt={class:"px-1.5 pb-2.5"},Tt={key:0,class:"mb-0.5 text-black-900 text-sm mt-1 text-left leading-normal flex items-center"},pt={class:"font-semibold line-clamp-1 h-[22px] leading-[22px]"},Ct={key:1,class:"w-full mb-1"},It={key:2,class:"text-xs leading-tight tracking-tight text-left line-clamp-2 text-black-400"},St={class:"flex items-center mt-1 text-sm font-bold"},Pt={class:"flex-1 pr-1.5"},At={class:"mr-1.5 max-w-[60px] line-clamp-1 opacity-60 text-xxs"},Bt={class:"text-black mr-2.5 flex items-center"},qt={class:"mr-1 underline text-xxs underline-offset-2 whitespace-nowrap"},Ft=e("span",null," > ",-1),Lt=e("div",{class:"w-5 h-5 rounded-full flex justify-center items-center bg-[#FBA923] text-white text-sm"}," + ",-1),Dt=[Lt],Nt=e("img",{class:"w-6 h-6",src:O},null,-1),Gt=[Nt],jt=T({name:"GoodsGridItem"});function Ht(t,{emit:u}){const{t:d}=D(),a=tt(),f=n=>{a.push(n)},h=n=>{n.goods.id&&a.push(`goodsDetail?id=${n.goods.id}`)},o=async n=>{if(n.goods.stock===0&&n.goods.goodsTypes!=2){q(d("order.Insufficient stock"));return}u("handleAddCart",n.goods)};return(n,i)=>{var I;const m=R("van-skeleton");return s(),l("div",{class:"mb-2 text-center",onClick:i[5]||(i[5]=x=>h(t.item))},[(I=t.item)!=null&&I.activeType?(s(),v(K,{key:0,info:t.item,type:"grid",onHandleTo:i[0]||(i[0]=x=>f(x))},null,8,["info"])):t.item.goods?(s(),l("div",kt,[e("div",$t,[(t.item.goods.status!=1||!+t.item.goods.stock)&&t.item.goods.goodsTypes!=2?(s(),v(M,{key:0,status:t.item.goods.status,stock:t.item.goods.stock},null,8,["status","stock"])):r("",!0),e("img",{src:t.item&&t.item.goods&&t.item.goods.icons&&t.item.goods.icons.split(",")[0]||b(F)("images/activity/boutique/squre_empty.png"),alt:"",class:"object-cover w-full h-auto aspect-square rounded-t-lg bg-black-100"},null,8,wt),t.item.goods.payType!==2&&t.item.goods.deliveryType===b(W).online?(s(),v(U,{key:1,tag:n.$t("common.rebate"),ratio:t.item.goods.discountRatio||0},null,8,["tag","ratio"])):r("",!0)]),e("div",bt,[t.item.goods.goodsName?(s(),l("div",Tt,[t.item.goods.type?(s(),v(Q,{key:0,type:t.item.goods.type,class:"inline-block mr-1 align-text-top"},null,8,["type"])):r("",!0),e("span",pt,g(t.item.goods.goodsName||"-"),1)])):r("",!0),t.item.goods.id?r("",!0):(s(),l("div",Ct,[z(m,{row:t.index%2==0?1:2,class:"mx-2","row-width":["100%"]},null,8,["row"])])),t.item.goods.goodsDesc?(s(),l("div",It,g(t.item.goods.goodsDesc),1)):r("",!0),e("div",St,[e("div",Pt,[t.item.goods.payType!==2?(s(),v(J,{key:0,color:"#000000",class:"text-base",price:t.item.goods.price},null,8,["price"])):r("",!0)])]),e("section",{class:"mt-1.5 flex-center-bw",onClick:i[4]||(i[4]=w(()=>{},["stop"]))},[e("div",{class:"items-center text-xs flex-center text-default",onClick:i[1]||(i[1]=w(x=>f(`/category?deliveryType=1&shopId=${t.item.stores.id}`),["stop"]))},[e("span",At,g(t.item.stores.storeName),1),e("div",Bt,[e("div",qt,g(n.$t("collect.intoShop")),1),Ft])]),t.item.goods.deliveryType===1?(s(),l("div",{key:0,onClick:i[2]||(i[2]=w(x=>o(t.item),["stop"])),class:""},Dt)):(s(),l("div",{key:1,onClick:i[3]||(i[3]=w(x=>h(t.item),["stop"]))},Gt))])])])):r("",!0)])}}const Vt=T({...jt,props:{item:null,index:null},emits:["handleAddCart"],setup:Ht}),Rt={class:"w-[110px] h-[110px] relative"},zt=["src"],Et={class:"ml-2 flex-1 w-[0px]"},Ot={class:"text-sm flex items-center mb-1.5 relative"},Wt={class:"text-sm font-semibold leading-[0.875rem] truncate text-default"},Mt={class:"flex items-center"},Jt={class:"flex-1"},Kt={class:"mb-2 text-xs leading-normal line-clamp-1 text-black-400"},Qt={class:"flex text-sm font-bold items-center mt-1.5"},Ut={class:"items-center text-xs flex-center text-default"},Xt={class:"mr-1 underline text-xxs"},Yt=e("span",null," > ",-1),Zt={key:0,class:"text-xxs text-black-400"},_t=["onClick"],te={key:0,class:"w-5 h-5 rounded-full flex justify-center items-center bg-[#FBA923] text-white text-sm"},ee={key:1,class:"w-6 h-6",src:O},se=e("div",{class:"flex items-center h-2.5"},[e("div",{class:"h-[1px] w-full bg-black-100"})],-1),oe=T({props:{data:null},emits:["handleTo","handleAddCart","click"],setup(t,{emit:u}){const d=t,{t:a}=D(),f=async()=>{if(d.data.goods.stock===0&&d.data.goods.goodsTypes!=2){q(a("order.Insufficient stock"));return}d.data.goods.deliveryType===1?u("handleAddCart",d.data.goods):u("click")};return(h,o)=>{var n,i;return s(),l(E,null,[(n=t.data)!=null&&n.activeType?(s(),v(K,{key:0,info:t.data,onHandleTo:o[0]||(o[0]=m=>u("handleTo",m))},null,8,["info"])):(i=t.data)!=null&&i.goods?(s(),l("section",{key:1,class:"flex items-start justify-between rounded-lg bg-white p-2.5 w-full",onClick:o[4]||(o[4]=m=>u("click"))},[e("div",Rt,[(t.data.goods.status!=1||!+t.data.goods.stock)&&t.data.goods.goodsTypes!=2?(s(),v(M,{key:0,status:t.data.goods.status,stock:t.data.goods.stock},null,8,["status","stock"])):r("",!0),e("img",{src:t.data&&t.data.goods&&t.data.goods.icons&&t.data.goods.icons.split(",")[0]||b(F)("images/activity/boutique/squre_empty.png"),alt:"",class:"rounded-lg w-[110px] h-[110px] aspect-square object-cover"},null,8,zt),t.data.goods.payType!==2&&+t.data.goods.deliveryType===b(W).online?(s(),v(U,{key:1,class:"flex-shrink-0 ml-auto",tag:h.$t("common.rebate"),ratio:t.data.goods.discountRatio||0},null,8,["tag","ratio"])):r("",!0)]),e("section",Et,[e("div",Ot,[t.data.goods.type?(s(),v(Q,{key:0,type:t.data.goods.type,class:"mr-1",style:{flex:"0 0 auto"}},null,8,["type"])):r("",!0),e("div",Wt,g(t.data.goods.goodsName),1)]),e("div",Mt,[e("div",Jt,[e("div",Kt,g(t.data.goods.goodsDesc),1),e("div",Qt,[t.data.goods.payType!==2?(s(),v(J,{key:0,price:t.data.goods.price,class:"text-base",color:"#000000"},null,8,["price"])):r("",!0)])])]),e("section",{class:"mt-5 flex-center-bw",onClick:o[3]||(o[3]=w(()=>{},["stop"]))},[e("div",Ut,[e("span",{class:"mr-1.5 max-w-[100px] line-clamp-1 text-xxs text-[#999999]",onClick:o[1]||(o[1]=w(m=>u("handleTo",`/category?deliveryType=1&shopId=${t.data.stores.id}`),["stop"]))},g(t.data.stores.storeName),1),e("div",{class:"text-black mr-2.5 flex items-center",onClick:o[2]||(o[2]=w(m=>u("handleTo",`/category?deliveryType=1&shopId=${t.data.stores.id}`),["stop"]))},[e("div",Xt,g(h.$t("collect.intoShop")),1),Yt]),t.data.goods.volume15>=100?(s(),l("div",Zt,g(h.$t("mall.15th sale",{salesVolume:t.data.goods.volume15||0})),1)):r("",!0)]),e("div",{onClick:w(f,["stop"]),class:"px-2"},[t.data.goods.deliveryType===1?(s(),l("div",te," + ")):(s(),l("img",ee))],8,_t)])])])):r("",!0),se],64)}}}),ae={key:0},ie=T({name:"mallGoodsList"});function ne(t,{expose:u,emit:d}){const a=t,{t:f}=D(),h=nt();et(()=>a.viewFormat,c=>{c===1&&console.log(c)},{deep:!0});const o=$([]),n=$(!1),i=$(!1),m=$(0),I=$(10),x=$(0),C=$([]),S=$(0),X=$,N=async()=>{a.isSearchPage&&!a.searchParam.keyword&&!a.searchParam.classId||(n.value=!0,m.value+=1,await Y(),setTimeout(()=>{n.value=!1},1e3))},Y=async()=>{var y,P,k,A,B;const c=await ct({page:m.value,size:I.value,status:1,...a.searchParam,sortType:a.sortType});if(!c.success){i.value=!0;return}if(!c.data||!c.total||!((y=c.data)!=null&&y.length)){i.value=!0;return}if(x.value=c.total,C.value=c.data.map(p=>({goods:p.goods,stores:p.stores||X,card:p.card})),m.value===1&&!a.isSearchPage){const p={activeType:1,activePath:"/boutique-goods",activeImg:F("images/activity/advertise/Boutique.png"),activeImgGrid:F("images/activity/advertise/Boutique-grid.png")};S.value+=1,C.value.unshift(p)}if(m.value===2&&((P=a.activeInfo)!=null&&P.id)){const p={activeType:1,activePath:(k=a.activeInfo)==null?void 0:k.url,activeImg:((A=a.activeInfo)==null?void 0:A.activityListImgs)||null,activeImgGrid:((B=a.activeInfo)==null?void 0:B.activityWaterfallImgs)||null,...a.activeInfo};C.value.unshift(p),S.value+=1}o.value=m.value===1?C.value:o.value.concat(C.value),o.value.length-S.value>=x.value&&(i.value=!0)},{loadingToggle:G}=lt(),j=async c=>{if(c.stock===0&&c.goodsTypes!=2){q(f("order.Insufficient stock"));return}G(!0);const y=await dt(c.id);G(!1),y.success&&(d("successAdd"),q(f("cart.addTips")),h.getCartCount())};return u({handleSearch:async()=>{o.value=[],m.value=0,x.value=0,S.value=0,i.value=!1,document.querySelector("#fm-page").scrollTo(0,0),await N()},list:o}),(c,y)=>{const P=R("VanList");return s(),v(P,{loading:n.value,"onUpdate:loading":y[2]||(y[2]=k=>n.value=k),finished:i.value,"finished-text":c.$t("common.noMore"),"loading-text":c.$t("common.loading"),onLoad:N},{default:st(()=>[o.value.length>0?(s(),l("div",ae,[H(z(rt,{isSearchPage:t.isSearchPage,value:C.value,addTime:200,cardComponent:Vt,onHandleTo:y[0]||(y[0]=k=>d("handleTo",k)),onHandleAddCart:j},null,8,["isSearchPage","value"]),[[V,t.viewFormat===0]]),H(e("div",null,[(s(!0),l(E,null,ot(o.value,(k,A)=>(s(),v(oe,{key:A,data:k,onClick:()=>d("handleTo",`${t.goodsPath}?id=${k.goods.id}`),onHandleTo:y[1]||(y[1]=B=>d("handleTo",B)),onHandleAddCart:j},null,8,["data","onClick"]))),128))],512),[[V,t.viewFormat===1]])])):r("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"])}}const he=T({...ie,props:{searchParam:{default:()=>({keyword:"",sortType:1,orderBy:1,classId:null})},sortType:null,goodsPath:{default:"/goodsDetail"},viewFormat:{default:0},isSearchPage:{type:Boolean,default:!1},activeInfo:null},emits:["handleTo","successAdd"],setup:ne});export{he as _,K as a};

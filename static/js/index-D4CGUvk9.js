import{_ as xe}from"./kefu-B-s0jZtS.js";import{_ as oe,y as M,x as O,F as n,G as s,X as d,P as $,R as G,Q as _,H as a,I as F,J as le,w as ne,K as y,O as R,a1 as be,a4 as we,T as U,a2 as Te,l as $e,r as c,a8 as _e,z as ee,bh as Ce,D as Ie,E as j,N as E,Z as Se,$ as Le}from"./vendor-BlU_hoYl.js";import{e as qe,v as Ae,g as Ne,a7 as De,bo as Be,r as Re,a8 as Ge,X as ze,bp as Ee,bq as Me,aL as je,bd as Oe}from"./index-UgIL2Smv.js";import{a as Fe}from"./shop-CeqcS6K2.js";import{_ as Pe}from"./buy-cart-DX6aL7m1.js";import{_ as Ve}from"./BoutiqueLable-negN2DKs.js";import{R as te}from"./RatioBox-CBosZpIg.js";import{_ as He}from"./ShopMaskTips-CxJi-SfW.js";import{_ as se}from"./GoodsPrice-CFQUMmEr.js";import{_ as ae}from"./CardPrice-CwWzcSMy.js";import{D as Ue}from"./goods-BVwS8oFG.js";import{M as Ke}from"./MallTabBar-CSJ4nE1c.js";import{B as Xe}from"./BackIcon-8hcEjDKb.js";import{a as Ye}from"./category-aaGcZXZl.js";import{b as Je}from"./mall-DBbHU8Zq.js";import{_ as Qe}from"./DefaultPage-BqGLOR9t.js";import{H as We}from"./HomeGoodsItem-C3EQZz96.js";import"./MCOIN-BOqZVkND.js";import"./store-CbLb3G6E.js";import"./useCityMap-CU72MCNW.js";import"./ImgBoutiqueLable-BIio6fYG.js";const Ze="/static/images/flashSale-DOaFK4_-.png",et="/static/images/unflashSale-CjYqec_P.png",tt={class:"relative z-20 whitespace-nowrap flex justify-center gap-16 px-12 py-2.5 overflow-hidden bg-white rounded-t-lg sort-shadow text-black-400 text-sm font-normal"},st={class:"flex items-center gap-1"},at={key:0,class:"w-4 h-4",src:Ze},ot={key:1,class:"w-4 h-4",src:et},lt=M({props:{deliveryType:null},emits:["change"],setup(e,{emit:f}){const{useShopStore:i}=qe(),b=O(()=>i.shopMenus&&i.shopMenus.includes(4)),q=O(()=>i.shopMenus&&i.shopMenus.includes(3));return(o,r)=>(s(),n("div",tt,[$(b)?(s(),n("div",{key:0,class:G({active:e.deliveryType===1}),onClick:r[0]||(r[0]=g=>f("change",1))},_(o.$t("common.send")),3)):d("",!0),$(b)?(s(),n("div",{key:1,class:G({active:e.deliveryType===2}),onClick:r[1]||(r[1]=g=>f("change",2))},_(o.$t("shop.offline server")),3)):d("",!0),$(q)?(s(),n("div",{key:2,class:G({active:e.deliveryType===3}),onClick:r[2]||(r[2]=g=>f("change",3))},[a("div",st,[e.deliveryType===3?(s(),n("img",at)):(s(),n("img",ot)),a("span",null,_(o.$t("order.onesale order")),1)])],2)):d("",!0)]))}}),nt=oe(lt,[["__scopeId","data-v-3069830c"]]),it={class:"relative w-[100px] h-full overflow-hidden border-solid border-r-2 border-primary-008"},rt={class:"w-[98px] h-full overflow-y-auto flex flex-col gap-2 py-4"},dt=["onClick"],ct={class:"font-normal leading-6 text-center"},ut=M({props:{list:{default:()=>[]},flashSaleList:{default:()=>[]},classId:{default:null},shopId:null,deliveryType:null},emits:["change"],setup(e,{emit:f}){const i=e,{currentLocale:b}=Ae(),q=O(()=>i.deliveryType===3?i.flashSaleList.map(o=>({...o,name:o[`${Fe[b.value]}Name`]})):i.list.filter(o=>+o.type==+i.deliveryType||!o.type));return(o,r)=>(s(),n("div",it,[a("div",rt,[(s(!0),n(F,null,le($(q),g=>(s(),n("div",{class:G(["relative py-1.5 pl-4 pr-2 text-sm text-black-400",{"text-black-800 bg-primary-008":e.classId===g.id}]),key:g.id,onClick:z=>f("change",g.id)},[a("span",ct,_(g.name),1)],10,dt))),128))])]))}}),vt="/static/images/offline-black-OiwvbEll.svg",yt="/static/images/cart-icon-ibBU6cSG.svg",mt="/static/images/Rob-CY-NIaX_.png",ft="/static/images/Robed-BOyO2jaS.png",gt={class:"flex items-start justify-between"},pt={class:"w-[90px] h-[90px] relative"},ht=["src"],kt={class:"text-sm flex items-center mb-1.5 relative"},xt={class:"text-sm flex-1 w-0 font-semibold leading-[0.875rem] truncate text-default mr-1"},bt={class:"flex items-center"},wt={class:"flex-1"},Tt={class:"mb-2 text-xs leading-normal line-clamp-1 text-black-400"},$t={key:0,class:"flex items-center gap-1"},_t={class:"inline-flex bg-[#FED73A] items-center gap-1 px-1.5 py-1 text-xs font-bold rounded bg-ratio text-black no-wrap"},Ct=a("img",{class:"w-[1rem] h-[1rem]",src:vt},null,-1),It={key:1,class:"text-sm font-bold"},St={class:"flex items-end mt-1"},Lt=["onClick"],qt={key:0,class:"w-6 h-6",src:yt},At={key:1,class:"w-6 h-6",src:Pe},Nt={key:1,class:"flex w-full"},Dt={key:0,class:"text-sm font-bold"},Bt={class:"ml-auto"},Rt={key:0,class:"w-5 h-5 mr-2",src:mt},Gt={key:1,class:"w-5 h-5 mr-2",src:ft},zt=a("div",{class:"flex items-center h-2.5"},[a("div",{class:"h-[1px] w-full bg-black-100"})],-1),Et=M({props:{data:null,deliveryType:null},emits:["handleAddCart","click"],setup(e,{emit:f}){const i=e,{t:b}=ne(),q=async()=>{if(i.data.goods.stock===0&&i.data.goods.goodsTypes!=2){U(b("order.Insufficient stock"));return}i.data.goods.deliveryType===1?f("handleAddCart",i.data.goods):f("click")};return(o,r)=>(s(),n(F,null,[e.data.goods?(s(),n("div",{key:0,class:"w-full py-3 bg-white rounded",onClick:r[0]||(r[0]=g=>f("click"))},[a("section",gt,[a("div",pt,[(e.data.goods.status!=1||!+e.data.goods.stock)&&e.deliveryType!==3&&e.data.goods.goodsTypes!=2?(s(),y(He,{key:0,status:e.data.goods.status,stock:e.data.goods.stock},null,8,["status","stock"])):d("",!0),a("img",{src:e.data&&e.data.goods&&e.data.goods.icons&&e.data.goods.icons.split(",")[0]||$(Ne)("images/activity/boutique/squre_empty.png"),class:"rounded w-[90px] h-[90px] aspect-square object-cover"},null,8,ht)]),a("section",{class:G(["flex-1 min-h-[90px] ml-2 flex flex-col",{" justify-between":e.deliveryType==3}])},[a("div",kt,[e.data.goods.type?(s(),y(Ve,{key:0,type:e.data.goods.type,class:"flex-shrink-0 mr-1"},null,8,["type"])):d("",!0),a("div",xt,_(e.data.goods.goodsName),1)]),a("div",bt,[a("div",wt,[a("div",Tt,_(e.data.goods.goodsDesc),1),e.deliveryType===2?(s(),n("div",$t,[a("div",_t,[Ct,be(" "+_(o.$t("common.offline")),1)]),R(te,{ratio:e.data.goods.discountRatio},null,8,["ratio"])])):d("",!0),e.deliveryType!==3?(s(),n("div",It,[e.data.goods.payType!==2?(s(),y(se,{key:0,color:"#000000",class:"mt-1.5 text-base",price:e.data.goods.price},null,8,["price"])):d("",!0),e.data.goods.payType===2||e.data.goods.payType===3?(s(),y(ae,{key:1,color:"#000000",class:"mt-1.5 text-base",price:e.data.goods.cardPrice,symbol:e.data.card&&e.data.card.symbol},null,8,["price","symbol"])):d("",!0)])):d("",!0)])]),a("div",St,[a("div",null,[e.data.goods.payType!==2&&Number(e.data.goods.deliveryType)===$(Ue).online&&e.deliveryType!=3?(s(),y(te,{key:0,class:"flex-shrink-0",tag:o.$t("common.rebate"),ratio:e.data.goods.discountRatio||0},null,8,["tag","ratio"])):d("",!0)]),e.deliveryType!=3?(s(),n("div",{key:0,onClick:we(q,["stop"]),class:"px-1.5 ml-auto"},[e.data.goods.deliveryType===1?(s(),n("img",qt)):(s(),n("img",At))],8,Lt)):(s(),n("div",Nt,[e.deliveryType===3?(s(),n("div",Dt,[e.data.goods.payType!==2?(s(),y(se,{key:0,price:e.data.goods.price},null,8,["price"])):d("",!0),e.data.goods.payType===2||e.data.goods.payType===3?(s(),y(ae,{key:1,class:"ml-auto",price:e.data.goods.cardPrice,symbol:e.data.card&&e.data.card.symbol},null,8,["price","symbol"])):d("",!0)])):d("",!0),a("div",Bt,[+e.data.goods.status>=15?(s(),n("img",Rt)):(s(),n("img",Gt))])]))])],2)])])):d("",!0),zt],64))}}),ie=e=>(Se("data-v-98da3930"),e=e(),Le(),e),Mt={class:"z-50 overflow-y-auto parent-view mall-header-bg"},jt={class:"sticky top-0 z-50 text-sm font-normal mall-header-bg"},Ot={class:"flex relative justify-center items-center h-[44px] px-2.5"},Ft={class:"absolute left-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},Pt={class:"font-semibold"},Vt=ie(()=>a("img",{class:"w-5 h-5",src:xe},null,-1)),Ht=[Vt],Ut={class:"px-2.5 sticky top-[44px]"},Kt={key:0,class:"bg-gradient-7 text-white px-2.5 py-0.5 text-xxs leading-normal rounded-xl"},Xt=ie(()=>a("div",{class:"h-[16px]"},null,-1)),Yt={class:"overflow-hidden shadow-box"},Jt={class:"mall-header-bg mall-header-bg-box"},Qt=M({name:"CategoryShopDetail"});function Wt(e){const{t:f}=ne(),i=Te(),b=$e(),q=De(),o=c(1);i.query.deliveryType&&(o.value=Number(i.query.deliveryType));const r=O(()=>i.query.shopId||null),g=c(null);g.value=i.query.shopId;const z=c(null),{y:K}=_e(z);ee(()=>r,async t=>{t.value&&t.value!==g.value&&(g.value=t.value,p.value&&(p.value=null),W(),I())},{deep:!0});const p=c(null),re=t=>{p.value!==t&&(p.value=t,I())};ee(()=>i.query.deliveryType,()=>{i.query.deliveryType&&+i.query.deliveryType!=+o.value&&(o.value=Number(i.query.deliveryType),p.value=null,P(),I())},{deep:!0});const m=c(null),de=async()=>{if(!r.value)return;const t=await ze(r.value);!t.success||!t.data||(m.value=t.data,I())},ce=t=>{o.value!==t&&(T.value="",b.replace({path:"category",query:{deliveryType:t,shopId:r.value}}),o.value=t,p.value=null,A.value=[],A.value.unshift({name:"推薦",id:null}),P(),I())},A=c([]),P=async()=>{if(o.value===2){try{const{success:l,data:k}=await Ee({shopId:r.value});if(!l)return;const u=(k||[]).filter(N=>N.goodsCount>0).map(N=>({name:N.goodsCategoryName,id:N.goodsCategoryId}));u.unshift({name:"推薦",id:null}),A.value=u}catch(l){console.error("获取线下服务类目数据失败:",l),A.value=[]}return}const t=await Ye({address:m.value.merchant});t.success&&(A.value=t.data||[],A.value.unshift({name:"推薦",id:null}))},V=c([]),ue=async()=>{const t=await Me(m.value.merchant);t.success&&(V.value=t.data||[],V.value.unshift({cnName:"推薦",jpName:"推薦する",enName:"recommend",id:null}))},h=c([]),D=c(!1),w=c(!1),C=c(0),H=c(10),B=c(0),ve=c,X=async()=>{!m.value&&r.value||(D.value=!0,C.value+=1,await ye(),setTimeout(()=>{D.value=!1},1500))},T=c(""),ye=async()=>{if(o.value===2){await me();return}await fe()},me=async()=>{var u;let t=null,l=null;p.value===null?(l="desc|goods_sales_volume,asc|goods_id",t=null):(l="asc|goods_id",t=p.value||null);const k={page:C.value,size:H.value,goodsStatus:1,goodsNameLike:T.value,shopId:((u=m.value)==null?void 0:u.id)||"",goodsCategoryId1:t,sortBy:l,distinctFlag:!0},x=await je(k);if(D.value=!1,!x.success||!x.data||!x.data.total){w.value=!0,h.value=C.value===1?[]:h.value;return}B.value=x.data.total;const S=x.data.records||[];h.value=C.value===1?S:h.value.concat(S),h.value.length>=B.value&&(w.value=!0)},fe=async()=>{var x,S;const t={page:C.value,size:H.value,status:1,subclassId:p.value,deliveryType:o.value,merchant:(x=m.value)==null?void 0:x.merchant,keyword:T.value};let l=null;if(o.value===3?l=await Oe({page:C.value,size:H.value,merchant:(S=m.value)==null?void 0:S.merchant,categoryId:p.value?p.value:null,title:T.value}):l=await Je(t),D.value=!1,!l.success){w.value=!0;return}if(!l.data||!+l.total){w.value=!0,h.value=C.value===1?[]:h.value;return}B.value=l.total;const k=c([]);o.value===3?k.value=l.data.map(u=>({goods:{...u,goodsName:u.title,icons:u.mainImageUrls,deliveryType:u.shippingMethod}})):k.value=l.data.map(u=>({goods:u.goods,stores:u.stores||ve,card:u.card})),h.value=C.value===1?k.value:h.value.concat(k.value),h.value.length>=B.value&&(w.value=!0)},{loadingToggle:Y}=Re(),ge=async t=>{if(t.stock===0&&t.goodsTypes!=2){U(f("order.Insufficient stock"));return}Y(!0);const l=await Ge(t.id);Y(!1),l.success&&(U(f("cart.addTips")),q.getCartCount())},J=t=>{b.push(t)},Q=c(null),pe=t=>{t.code==="Enter"&&(I(),Q.value.blur())},he=()=>{T.value="",I()},I=()=>{if(K.value=0,m.value&&+m.value.status!=1){w.value=!0;return}h.value=[],C.value=0,B.value=0,w.value=!1,X()},ke=t=>{let l={};t.goodsId&&(l.goodsId=t.goodsId),t.storeId&&(l.storeId=t.storeId),b.push({path:"/offlineGoodsDetail",query:l})},W=async()=>{if(await de(),m.value&&+m.value.status!=1){w.value=!0;return}T.value="",P(),ue()};return Ce(()=>{z.value&&z.value.scrollTo(0,K.value)}),Ie(()=>{W()}),(t,l)=>{var N,Z;const k=j("van-icon"),x=j("van-field"),S=j("van-sticky"),u=j("VanList");return s(),n("div",Mt,[a("section",jt,[a("section",Ot,[a("div",Ft,[R(Xe,null,{default:E(()=>[a("span",null,_(t.$t("common.return")),1)]),_:1})]),a("div",Pt,_(t.$t("shop.Classification")),1),(N=m.value)!=null&&N.merchant?(s(),n("div",{key:0,onClick:l[0]||(l[0]=v=>{var L;return J(`/shopInfo?address=${(L=m.value)==null?void 0:L.merchant}`)}),class:"absolute right-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},Ht)):d("",!0)]),a("section",Ut,[R(x,{ref:(v,L)=>{L.searchRef=v,Q.value=v},"model-value":T.value,"onUpdate:model-value":l[1]||(l[1]=v=>T.value=v),clearable:"",class:"flex-1 rounded-3xl flex items-center h-[30px] text-black-300",onKeypress:pe,placeholder:t.$t("mall.Enter search keywords"),onClear:he,enterkeyhint:"search"},{"left-icon":E(()=>[T.value?d("",!0):(s(),y(k,{key:0,name:"search",size:"18"}))]),"right-icon":E(()=>[a("div",{onClick:I},[T.value?(s(),y(k,{key:1,name:"search",size:"18"})):(s(),n("div",Kt,_(t.$t("common.search")),1))])]),_:1},8,["model-value","placeholder"])]),Xt]),a("div",Yt,[R(S,{"offset-top":90},{default:E(()=>[a("div",Jt,[R(nt,{deliveryType:o.value,onChange:ce},null,8,["deliveryType"])])]),_:1}),a("div",{class:G(["relative flex bg-white h-[calc(100vh-84px)] overflow-hidden",{"safe-bottom-page":$(r)}])},[R(ut,{shopId:$(r),classId:p.value,list:A.value,flashSaleList:V.value,onChange:re,deliveryType:o.value},null,8,["shopId","classId","list","flashSaleList","deliveryType"]),a("div",{class:"relative flex-1 h-full overflow-y-auto",ref:(v,L)=>{L.listPageRef=v,z.value=v}},[w.value&&B.value===0?(s(),y(Qe,{key:0,title:t.$t("common.No products")},null,8,["title"])):(s(),y(u,{key:1,loading:D.value,"onUpdate:loading":l[2]||(l[2]=v=>D.value=v),finished:w.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:X,class:"px-2.5 py-2.5"},{default:E(()=>[(s(!0),n(F,null,le(h.value,v=>(s(),n(F,null,[o.value!==2?(s(),y(Et,{key:0,data:v,onClick:L=>J(`${o.value==3?"/saleGoodDetail":"/goodsDetail"}?id=${v.goods.id}`),onHandleAddCart:ge,deliveryType:o.value},null,8,["data","onClick","deliveryType"])):(s(),y(We,{key:1,goods:v,class:"mb-4 :last:mb-0 border-b border-gray-200 pb-4 home-goods-item",onClick:L=>ke(v),"show-store-name":""},null,8,["goods","onClick"]))],64))),256))]),_:1},8,["loading","finished","finished-text","loading-text"]))],512)],2)]),$(r)?(s(),y(Ke,{key:0,shopId:$(r),shopType:(Z=m.value)==null?void 0:Z.type},null,8,["shopId","shopType"])):d("",!0),o.value!==3?(s(),y(Be,{key:1})):d("",!0)])}}const Zt=M({...Qt,setup:Wt}),bs=oe(Zt,[["__scopeId","data-v-98da3930"]]);export{bs as default};

import{_ as V,y as D,w as Y,x as J,F as $,G as x,H as n,I as j,J as ce,X as pe,P as o,a2 as L,Q as h,a1 as me,r as S,O as g,be as B,D as Q,E as P,K as H,N as R,a0 as A,$ as Te,T as G,Y as he,Z as ve,l as Oe,z as Re,bf as Fe,bh as Ee,R as de}from"./vendor-Ba70TIw4.js";import{U as d,M as ke,a as Me,b as Ae}from"./Merchant-C6Bm0tm8.js";import{W as _,e as q,r as Le,T as Z,Q as Be,b as ge,_ as xe,m as Pe}from"./index-Bsb9uxb4.js";import{P as O}from"./profileEnum-CXsMKuND.js";import{q as De,o as Ue}from"./order-Bt6BXfCD.js";import{g as He}from"./notice-BEEb9qPK.js";import{f as Ve}from"./mall-BukQeouS.js";import{_ as qe}from"./close-BkqxFSX4.js";import{L as ze,I as je}from"./LevelPop-DK65hjHI.js";import{s as Ge,i as Je,b as Qe,c as fe,d as Xe,u as Ke,e as We}from"./user-BLLKodgI.js";import{_ as Ye}from"./RecommendationFeed-C9Nt-Dyn.js";import{A as Ze}from"./AddParentIdPop-DbrvK36A.js";import"./level-mfpPkzkt.js";import"./offlineGoods-DvT2Go6q.js";import"./UpgradeStorePop-ClMsTUe1.js";import"./BoutiqueLable-RObK-asU.js";import"./shop-CeqcS6K2.js";import"./PopHeader-CPr5VpPI.js";import"./TokenBalance-Z2S1XeSE.js";import"./level-BnNYjXLw.js";import"./GoodsList-KFQaczxr.js";import"./buy-cart-m4kq4Bzt.js";import"./goods-BVwS8oFG.js";import"./ShopMaskTips-pbij6JLk.js";import"./GoodsPrice-DfhrvFCM.js";import"./MCOIN-Bodfn-v1.js";import"./WaterFull-DpMa4XQe.js";/* empty css                                                              */import"./cart-0_V967CA.js";import"./useShowActiveInfo-j41I9hXz.js";import"./festivalActivities-UX_5zNcM.js";import"./nft-B6UOn8EF.js";const et={class:"w-full h-fit py-[16px] px-[12px] bg-white rounded-[12px] flex flex-wrap font-Puhui"},tt=["onClick"],ot={class:"relative"},st=["src"],nt={key:0,class:"absolute top-[-5px] right-[1px] translate-x-1/2 min-w-[6px] w-fit h-[14px] px-1 bg-[#F44] rounded-[12px] text-white text-[10px] leading-[14px] font-normal text-center border-[1px] border-solid border-white box-content"},at={key:1,class:"absolute top-[-5px] right-[1px] translate-x-1/2 min-w-[6px] w-fit h-[14px] px-1 bg-[#F44] rounded-[12px] text-white text-[10px] leading-[14px] font-normal text-center border-[1px] border-solid border-white box-content"},rt={class:"mt-[4px] text-[14px] text-[#2E2008] font-normal font-Puhui leading-[20px] text-center"},lt={class:"mt-[16px] w-full h-fit py-[16px] px-[12px] bg-white rounded-[12px] flex flex-wrap font-Puhui"},it=["onClick"],ut={class:"relative"},ct=["src"],pt={class:"mt-[4px] text-[14px] text-[#2E2008] font-normal font-Puhui leading-[20px] text-center"},dt=D({props:{unreadCount:null,messageCount:null},emits:["handleMenu"],setup(a,{emit:f}){const{t:s}=Y(),y=m=>m===0?0:m>99?"99+":m,v=J(()=>[{text:s("user.payRecord"),img:_("profile2/consumerOption/PaymentHistory.svg"),type:d.INTERNL,url:"/buyerBill"},{text:s("user.pointsDetails"),img:_("profile2/consumerOption/PointsChangeDetails.svg"),type:d.INTERNL,url:"/integralDetail"},{text:s("user.balanceDetails"),img:_("profile2/consumerOption/BalanceChangeDetails.svg"),type:d.INTERNL,url:" /balanceDetail"},{text:s("profile.collect"),img:_("profile2/consumerOption/GoodsCollect.svg"),type:d.INTERNL,url:"/goodsCollect"},{text:s("collect.shopsCollect"),img:_("profile2/consumerOption/ShopAttention.svg"),type:d.INTERNL,url:"/shopsCollect"},{text:s("order.receive address"),img:_("profile2/consumerOption/DeliveryAddress.svg"),type:d.INTERNL,url:"/userAddress"},{text:s("voucher.voucher"),img:_("profile2/consumerOption/Vouchers.svg"),type:d.INTERNL,url:"/voucher"},{text:s("profile.announcement"),img:_("profile2/consumerOption/Announcement.svg"),type:d.INTERNL,url:"/postList"},{text:s("flashSale.flashSaleOrder"),img:_("profile2/consumerOption/LightningPurchaseOrders.svg"),type:d.INTERNL,url:"/buyerFlashSaleOrder?type=2"},{text:s("user.comminicate"),img:_("profile2/consumerOption/CommunityExchangeSection.svg"),type:d.OPTIONS,key:"concat"},{text:s("user.browsingHistory"),img:_("profile2/consumerOption/browsingHistory.svg"),type:d.INTERNL,url:"/browsingHistory"},{text:s("profile.notice"),img:_("profile2/consumerOption/Message.svg"),type:d.OPTIONS,key:"message"}]),w=J(()=>[{text:s("user.Improve Maker Level"),img:_("profile2/consumerOption/ImproveMakerLevel.svg"),type:d.OPTIONS,key:"level"},{text:s("ecology.otc"),img:_("profile2/consumerOption/OTC-Transactions.svg"),type:d.INTERNL,url:"/ecology-otcTransaction"},{text:s("common.inviteFriend"),img:_("profile2/consumerOption/InviteFriends.svg"),type:d.OPTIONS,key:"invite"},{text:s("common.myNft"),img:_("profile2/consumerOption/MyNFT.svg"),type:d.OPTIONS,key:"nft"},{text:s("ranking.Ecological help list"),img:_("profile2/consumerOption/ranking.svg"),type:d.INTERNL,url:"/talentRankingV1?type=2&cycleType=2"}]);return(m,N)=>(x(),$(j,null,[n("div",et,[(x(!0),$(j,null,ce(o(v),(t,r)=>(x(),$("div",{class:"w-[25%] flex flex-col items-center",style:pe(r<Math.floor((o(v).length-1)/4)*4?"margin-bottom: 16px":""),key:r,onClick:()=>f("handleMenu",t)},[n("div",ot,[n("img",{class:"shrink-0 w-[24px] h-[24px]",src:t.img,alt:""},null,8,st),t.url==="/postList"&&+a.unreadCount.totalUnread>0?(x(),$("div",nt,h(y(a.unreadCount.totalUnread)),1)):L("",!0),t.key==="message"&&+a.messageCount.totalUnread>0?(x(),$("div",at,h(y(a.messageCount.totalUnread)),1)):L("",!0)]),n("div",rt,h(t.text),1)],12,tt))),128))]),n("div",lt,[(x(!0),$(j,null,ce(o(w),(t,r)=>(x(),$("div",{class:"w-[25%] flex flex-col items-center",style:pe(r<Math.floor((o(w).length-1)/4)*4?"margin-bottom: 16px":""),key:r,onClick:()=>f("handleMenu",t)},[n("div",ut,[n("img",{class:"shrink-0 w-[24px] h-[24px]",src:t.img,alt:""},null,8,ct)]),n("div",pt,h(t.text),1)],12,it))),128))])],64))}}),ft=V(dt,[["__scopeId","data-v-d3156efc"]]),mt=D({emits:["handleTo","handleReplace","handleMenu"],setup(a,{expose:f,emit:s}){const y=me(),{accountStore:v}=q(),w=S({afterSales:0,completed:0,toBeDelivered:0,waitingForReceipt:0}),m=async()=>{const c=await De({type:2});c.success&&(w.value=c.data)},N=S({afterSales:0,completed:0,toBeDelivered:0,waitingForReceipt:0}),t=async()=>{var C;const c=await Ue({orderCustomerAddress:v.account||((C=v.sign)==null?void 0:C.address)});c.success&&(N.value=c.data)},r=S({versionUnread:0,platformUnread:0,totalUnread:0}),i=async()=>{const c=await He();c.success&&(r.value=c.data)},p=S({}),l=async()=>{const c=await Ve({type:1});c.success&&(p.value=c.data)},b=c=>{c==="online"?m():c==="offline"&&t()};return f({init:async()=>{var C;console.log("consumer init");const c=((C=y.query)==null?void 0:C.tab)||"online";b(c),i(),l()}}),(c,C)=>(x(),$(j,null,[g(ke,{activeTab:o(O).CONSUMER,orderCount:w.value,offlineOrderCount:N.value,onHandleTo:C[0]||(C[0]=T=>s("handleTo",T)),onHandleReplace:C[1]||(C[1]=(T,U)=>s("handleReplace",T,U)),onUpdateOrderData:b},null,8,["activeTab","orderCount","offlineOrderCount"]),g(ft,{unreadCount:r.value,messageCount:p.value,onHandleMenu:C[2]||(C[2]=T=>s("handleMenu",T))},null,8,["unreadCount","messageCount"])],64))}}),ht=a=>(he("data-v-2c4ddcca"),a=a(),ve(),a),vt={class:"w-[85vw] max-w-[375px] px-5 py-6 bg-popBg"},gt={class:"pb-5 flex-center-bw"},xt={class:"flex-start"},yt=ht(()=>n("img",{src:qe,class:"w-[10px] h-[10px]",alt:""},null,-1)),wt=[yt],Ct=A("%"),_t={class:"mt-5 flex-center"},It=D({props:{show:{type:Boolean}},emits:["close"],setup(a,{emit:f}){const{show:s}=a,{t:y}=Y(),{accountStore:v}=q(),{loadingToggle:w}=Le(),[m,N]=B(!1),t=S(0),r=async()=>{w(!0);const l=await Z(v.account);l.success&&l.data&&(t.value=l.data.discountRatio),w(!1)},i=l=>l>80?80:l,p=async()=>{if(!Number(t.value)){G.fail(y("common.pleaseInput"));return}N(!0),(await Be({discountRatio:t.value})).success&&(N(!1),f("close"),setTimeout(()=>{r()},1e3))};return Q(()=>{r()}),(l,b)=>{const F=P("van-field"),c=P("VanButton"),C=P("VanPopup");return x(),H(C,{show:a.show,"onUpdate:show":b[2]||(b[2]=T=>Te(s)?s.value=T:null),round:""},{default:R(()=>[n("div",vt,[n("div",gt,[n("div",xt,[n("span",null,h(l.$t("common.ratiodEdit")),1)]),n("div",{onClick:b[0]||(b[0]=T=>f("close"))},wt)]),n("div",null,[g(F,{class:"bg-gray1 rounded-3xl","input-align":"center",modelValue:t.value,"onUpdate:modelValue":b[1]||(b[1]=T=>t.value=T),type:"digit",placeholder:l.$t("shop.pleaseInputPoint"),formatter:i,disabled:o(m)},{"right-icon":R(()=>[Ct]),_:1},8,["modelValue","placeholder","disabled"]),n("div",_t,[g(c,{class:"px-20 font-bold text-white h-9 btn-orange",onClick:p,loading:o(m)},{default:R(()=>[A(h(l.$t("common.edit")),1)]),_:1},8,["loading"])])])])]),_:1},8,["show"])}}}),St=V(It,[["__scopeId","data-v-2c4ddcca"]]),bt=a=>(he("data-v-720e2866"),a=a(),ve(),a),Nt={class:"flex flex-col items-center justify-center"},$t={class:"text-sm"},Tt={class:"text-primary"},Ot=A(" 嘗試遷移店舖信息至您的地址 "),Rt={class:"text-primary"},Ft=A(" 是否同意遷移。 "),Et={key:0,class:"border border-primary rounded-lg p-2.5 mt-4 bg-[#FFFAF4] flex items-start"},kt=bt(()=>n("div",{class:"text-xs opacity-70 ml-1.5 leading-5"}," 監測到當前地址下有店舖信息，同意遷移將合併新舊店舖信息 ",-1)),Mt={class:"flex items-center justify-center w-full gap-3 mt-4"},At={key:1,class:"mt-3 text-xs font-normal"},Lt=D({props:{show:{type:Boolean},info:null},emits:["close"],setup(a,{emit:f}){const s=a,{accountStore:y}=q(),v=s.info[0].shop,w=S(null),m=async()=>{var l;const{data:i,success:p}=await Je((v==null?void 0:v.id)||((l=s.info[0])==null?void 0:l.id));p&&(w.value=i)},N=S(-1),t=async i=>{var l;if(await m(),w.value&&i!==3){G("已經遷移過，請勿重複操作");return}(await Ge({id:(l=s.info[0])==null?void 0:l.id,status:i})).success&&(i===3?G("拒绝成功"):G("同意成功"),i===3?f("close",i):f("close"))},r=async()=>{var p;const i=await Z(((p=y.store)==null?void 0:p.merchant)||y.account);i.success&&i.data&&(N.value=i.data.status)};return Q(()=>{r()}),(i,p)=>{const l=P("van-icon"),b=P("VanButton");return x(),H(xe,{show:a.show,noBorder:!0,noClose:!0,onClose:p[2]||(p[2]=()=>{f("close")})},{default:R(()=>{var F;return[n("div",Nt,[n("div",$t,[n("span",Tt,h((F=o(v))==null?void 0:F.storeName),1),Ot,n("span",Rt,h(o(ge)(o(y).account)),1),Ft]),N.value===1?(x(),$("div",Et,[g(l,{name:"warning",color:"#FEA021",size:"18"}),kt])):L("",!0),n("div",Mt,[g(b,{round:"",class:"border border-solid border-[#CDCDCD] h-[40px] w-full flex-1 font-medium text-sm",onClick:p[0]||(p[0]=c=>t(3))},{default:R(()=>[n("span",null,h(i.$t("common.reject")),1)]),_:1}),g(b,{round:"",class:"btn-yellow h-[40px] w-full flex-1 font-semibold text-sm",onClick:p[1]||(p[1]=c=>t(2))},{default:R(()=>[A(h(i.$t("common.agree")),1)]),_:1})]),a.info.length>0?(x(),$("div",At,h(i.$t("user.migrate length",{num:a.info.length})),1)):L("",!0)])]}),_:1},8,["show"])}}}),Bt=V(Lt,[["__scopeId","data-v-720e2866"]]),Pt={class:"flex flex-col items-center justify-center"},Dt={class:"text-sm"},Ut={class:"text-primary"},Ht={class:"text-primary"},Vt={key:0,class:"border border-primary rounded-lg p-2.5 mt-4 bg-[#FFFAF4] flex items-start"},qt={class:"text-xs opacity-70 ml-1.5 leading-5"},zt={class:"w-full flex items-center justify-center gap-3 mt-4"},jt={key:1,class:"text-xs font-normal mt-3"},Gt=D({props:{show:{type:Boolean},approveInfo:null,approveIndex:null},emits:["close"],setup(a,{emit:f}){const s=a,{accountStore:y}=q(),v=s.approveInfo[s.approveIndex].shop,w=S(-1),m=async t=>{(await Qe({id:s.approveInfo[s.approveIndex].id,status:t})).success&&(t===3?f("close",t):f("close"))},N=async()=>{var r;const t=await Z(((r=y.store)==null?void 0:r.merchant)||y.account);t.success&&t.data&&(w.value=t.data.status)};return Q(()=>{N()}),(t,r)=>{const i=P("van-icon"),p=P("VanButton");return x(),H(xe,{show:a.show,noBorder:!0,noClose:!0,onClose:r[2]||(r[2]=()=>{f("close")})},{default:R(()=>[n("div",Pt,[n("div",Dt,[n("span",Ut,h(o(v).storeName),1),A(" "+h(t.$t("user.use tips"))+" ",1),n("span",Ht,h(o(ge)(o(y).account)),1),A(" "+h(t.$t("user.approveShop")),1)]),w.value===1?(x(),$("div",Vt,[g(i,{name:"warning",color:"#FEA021",size:"18"}),n("div",qt,h(t.$t("user.approve shop tips2")),1)])):L("",!0),n("div",zt,[g(p,{round:"",class:"border border-solid border-[#CDCDCD] h-[40px] w-full flex-1 font-medium text-sm",onClick:r[0]||(r[0]=l=>m(3))},{default:R(()=>[n("span",null,h(t.$t("common.reject")),1)]),_:1}),g(p,{round:"",class:"btn-yellow h-[40px] w-full flex-1 font-semibold text-sm",onClick:r[1]||(r[1]=l=>m(2))},{default:R(()=>[A(h(t.$t("common.agree")),1)]),_:1})]),a.approveInfo.length>0?(x(),$("div",jt,h(t.$t("user.approve length",{num:a.approveInfo.length})),1)):L("",!0)])]),_:1},8,["show"])}}}),Jt=V(Gt,[["__scopeId","data-v-57d700dc"]]),Qt={class:"linear-bg"},Xt={class:"mt-[16px] w-full z-[10] overflow-hidden px-[12px]"},Kt={class:"flex items-start gap-[24px]"},Wt=D({name:"Profile"});function Yt(a){const{t:f}=Y(),s=Oe(),y=me(),{accountStore:v}=q(),[w,m]=B(!1),[N,t]=B(!1),[r,i]=B(!1),[p,l]=B(!1),[b,F]=B(!1),[c,C]=B(!1),{isUserExists:T}=Pe();Re(()=>y.path,(e,u)=>{u==="/clerk/index"&&e==="/profile"&&K()});const U=S(null),z=S(null),ee=S(0),ye=()=>{t(!1),i(!0)},X=Fe({userInfo:{address:v.account}}),we=J(()=>[{id:O.CONSUMER,name:f("common.consumerSide")},{id:O.MERCHANT,name:f("common.merchantSide")}]),E=J(()=>{var e;return((e=y.query)==null?void 0:e.path)??O.CONSUMER}),te=S(!1),Ce=e=>{e.id!==E.value&&(e.id===O.MERCHANT&&fe(),localStorage.setItem("profile_query",JSON.stringify({path:e.id})),s.push(`/profile?path=${e.id}`),te.value=!0,setTimeout(()=>{te.value=!1,ue()},500))},k=e=>{s.push(e)},oe=(e,u)=>{localStorage.setItem("profile_query",JSON.stringify(u)),s.replace({path:e,query:u})},_e=()=>{m(!1),se()},Ie=()=>{F(!1),K()},se=async()=>{var u,I;const e=await Xe({type:2,page:1,size:99});U.value=(u=e.data)==null?void 0:u.filter(M=>M.status===1).reverse(),((I=U.value)==null?void 0:I.length)>0&&(m(!0),ee.value=0)},Se=async()=>{var u,I,M;const e=await We({type:2,page:1,size:99});if(((u=e.data)==null?void 0:u.findIndex(W=>W.status===2))>-1){z.value=[];return}z.value=(I=e.data)==null?void 0:I.filter(W=>W.status===1).reverse(),((M=z.value)==null?void 0:M.length)>0&&F(!0)},ne=async e=>{if(e.type===d.INTERNL&&e.url)return k(e.url);if(e.type===d.OPTIONS){if(e.key==="invite"&&i(!0),e.key==="level"&&t(!0),e.key==="ratio"&&l(!0),e.key==="concat"&&k("/concat"),e.key==="nft"){if(ae.value)return k("/matrixNFT");C(!0)}e.key==="message"&&(k("/orderMessage?type=1"),sessionStorage.setItem("orderMessage_refreshFlag","1"))}else e.type===d.EXTERNAL&&e.url&&window.open(e.url,"_blank")},be=async()=>{const e=await Ke(v.account);!e.success||!e.data||(X.userInfo=e.data)},ae=S(!1),re=async()=>{const e=await T();ae.value=e},Ne=()=>{re(),k("/matrixNFT")},$e=S(!1),le=S(null),ie=S(null),ue=async()=>{var e,u;E.value===O.CONSUMER?(e=le.value)==null||e.init():(u=ie.value)==null||u.init()},K=async()=>{await v.changeStore({}),$e.value=!0,await be(),se(),Se(),re(),E.value===O.MERCHANT&&fe()};return Q(async()=>{}),Ee(()=>{console.log("onActivated"),K(),ue()}),(e,u)=>(x(),$("div",Qt,[g(Me,{info:o(X).userInfo,active:o(E),"tab-list":o(we),onChangeTab:Ce,onSetLevelShow:u[0]||(u[0]=I=>o(t)(!0))},null,8,["info","active","tab-list"]),n("div",Xt,[n("div",Kt,[n("div",{class:de(["shrink-0 w-full transition delay-0 duration-500 ease-in-out",{"consumer-in-merchant-out":o(E)===o(O).CONSUMER,"consumer-out-merchant-in":o(E)===o(O).MERCHANT}])},[g(mt,{ref:(I,M)=>{M.ConsumerRef=I,le.value=I},onHandleTo:k,onHandleMenu:ne,onHandleReplace:oe},null,512)],2),n("div",{class:de(["shrink-0 w-full transition delay-0 duration-500 ease-in-out",{"consumer-out-merchant-in":o(E)===o(O).MERCHANT,"consumer-in-merchant-out":o(E)===o(O).CONSUMER}])},[g(Ae,{ref:(I,M)=>{M.MerchantRef=I,ie.value=I},onHandleTo:k,onHandleMenu:ne,onHandleReplace:oe},null,512)],2)]),g(ze,{show:o(N),userInfo:o(X).userInfo,onClose:u[1]||(u[1]=I=>o(t)(!1)),onInvite:ye,onHandleTo:k},null,8,["show","userInfo"]),g(je,{show:o(r),onClose:u[2]||(u[2]=I=>o(i)(!1))},null,8,["show"]),g(St,{show:o(p),onClose:u[3]||(u[3]=I=>o(l)(!1))},null,8,["show"]),o(w)?(x(),H(Jt,{key:0,show:o(w),approveInfo:U.value,approveIndex:ee.value,onClose:_e},null,8,["show","approveInfo","approveIndex"])):L("",!0),o(b)?(x(),H(Bt,{key:1,show:o(b),info:z.value,onClose:Ie},null,8,["show","info"])):L("",!0),g(Ye,{"title-text":o(f)("common.recommend_for_you")},null,8,["title-text"]),g(Ze,{show:o(c),onClose:u[4]||(u[4]=I=>o(C)(!1)),onOnSuccess:Ne},null,8,["show"])])]))}const Zt=D({...Wt,setup:Yt}),ko=V(Zt,[["__scopeId","data-v-19815c62"]]);export{ko as default};

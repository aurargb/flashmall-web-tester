import{_ as U}from"./USDT-CNsbs3BR.js";import{_ as E}from"./MCOIN-BOqZVkND.js";import{_ as M,y as L,l as q,a2 as z,w as F,r as x,x as Y,bf as T,z as H,D as J,E as k,K,G as f,N as p,O as u,H as n,P as r,F as g,J as Q,I as w,Q as y,Z as W,$ as Z}from"./vendor-BlU_hoYl.js";import{C as j}from"./CommonVanProvider-CDfGVWR4.js";import{_ as X}from"./OfflineGoods-NsfElKHP.js";import{_ as ee}from"./OfflineStore-CFeVI8_T.js";import{B as se}from"./BetweenTab-BE6o466J.js";import{e as oe,d as O,bR as te,bS as ae}from"./index-UgIL2Smv.js";import{a as I,O as re}from"./offlineGoods-DvT2Go6q.js";import{u as ne}from"./usePaymentBalance-BSJrmoFe.js";import{P as le}from"./order-H59PKTFP.js";import{_ as de}from"./RegionBox-ExMr1J4R.js";import"./BackIcon-8hcEjDKb.js";import"./ImgBoutiqueLable-BIio6fYG.js";import"./shop-CeqcS6K2.js";/* empty css                                                               */import"./piggyBank-swFyWePk.js";const m=_=>(W("data-v-3c2c777e"),_=_(),Z(),_),ie={class:"mx-3 py-3 safe-body overflow-y-auto"},ce=["onClick"],ue={class:"text-b3"},fe={class:"flex items-center font-semibold"},pe=m(()=>n("img",{src:U,class:"w-4 h-4 mr-1"},null,-1)),me=m(()=>n("span",{class:"text-b3 ml-1"},"(",-1)),_e=m(()=>n("img",{src:E,class:"w-4 h-4 mr-1"},null,-1)),he={class:"text-b1"},ge=m(()=>n("span",{class:"text-b3"},")",-1)),ye=m(()=>n("img",{src:E,class:"w-4 h-4 mr-1"},null,-1)),Ie={class:"text-b1"},be=L({name:"ConsumerOrders"});function ve(_){const{accountStore:l}=oe(),P=q(),b=z(),{t:h}=F(),$=x(null),N=Y(()=>[{label:h("order.To be confirmed"),value:I.PAYMENT_SUCCESS},{label:h("order.canceled"),value:I.CANCELLED},{label:h("order.completed"),value:I.COMPLETED},{label:h("common.all"),value:-1}]),{getPaymentBySource:A}=ne(x(!0)),s=T({status:-1,shopInfo:null,list:[],total:0,loading:!1,finished:!1}),c=T({shopId:null,orderCustomerAddress:l==null?void 0:l.account,page:0,size:20,orderStatus:-1,sortBy:"desc|create_time"}),B=o=>{s.status=o,P.replace({path:"offlineConsumerorders",query:{status:o}}),D()},R=o=>{var t;return(t=N.value.find(a=>+a.value==+o))==null?void 0:t.label},v=o=>{P.push(o)},D=async()=>{s.finished=!1,s.total=0,s.list=[],c.page=0,C()},C=async()=>{if(!(l!=null&&l.sign.address))return s.finished=!0;s.loading=!0,c.orderCustomerAddress=l==null?void 0:l.sign.address,c.page+=1,await V(),s.loading=!1},V=async()=>{s.status<0?delete c.orderStatus:c.orderStatus=s.status;const{success:o,data:t}=await te(c);if(s.loading=!1,!o){s.finished=!0;return}const{records:a,total:d,current:e,pages:i}=t;if(!d||!a||!(a!=null&&a.length)){s.finished=!0;return}s.total=d;const S=x([]);S.value=a.map(G=>({btnLoading:!1,...G})),s.list=c.page===1?S.value:s.list.concat(S.value),+e>=+i&&(s.finished=!0)};return H(()=>b.path,async o=>{if(o==="/offlineConsumerorders"){const t=sessionStorage.getItem("consumer_offline_refresh_chainOrderId");if(t){const a=s.list.findIndex(d=>d.orderId==t);if(a>-1&&s.status===I.PAYMENT_SUCCESS)s.list.splice(a,1);else if(a>-1&&s.status===-1){const d=await ae({id:t});d.success&&(s.list[a]=d.data||{})}sessionStorage.removeItem("consumer_offline_refresh_chainOrderId")}}},{deep:!0}),J(async()=>{var o,t;(o=b.query)!=null&&o.status&&(s.status=Number((t=b.query)==null?void 0:t.status)),C()}),(o,t)=>{const a=k("VanList"),d=k("router-view");return f(),K(j,{title:o.$t("offline.main title"),class:"bg-gray1 font-Puhui font-normal relative shopGoodsPage","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(e,i)=>{i.shopGoodsRef=e,$.value=e}},{right:p(()=>[u(de)]),default:p(()=>[u(se,{options:r(N),"label-key":"label","value-key":"value",modelValue:r(s).status,"onUpdate:modelValue":t[0]||(t[0]=e=>r(s).status=e),onChange:B},null,8,["options","modelValue"]),n("div",ie,[u(a,{loading:r(s).loading,"onUpdate:loading":t[1]||(t[1]=e=>r(s).loading=e),finished:r(s).finished,"immediate-check":!1,"finished-text":o.$t("common.noMore"),"loading-text":o.$t("common.loading"),onLoad:C},{default:p(()=>[(f(!0),g(w,null,Q(r(s).list,e=>(f(),g("div",{class:"offline-crad-box mb-3",key:e.orderId,onClick:i=>v(`/offlineConsumerDetail?id=${e.orderId}`)},[u(ee,{shop:{images:e.shopPics,name:e.shopName},showOrderStatus:"",status:R(e.orderStatus)},null,8,["shop","status"]),u(X,{"show-order-type":"",class:"mt-3",goods:{goodsName:e.relName,goodsIcons:e.relIcons,orderType:e.orderType,areaExtName2:e.areaExtName2,storeName:e.storeName},onImageClick:i=>e.orderType===r(re).GOODS?v("/offlineConsumerorders/offlineGoodsDetail?goodsId="+e.relId+(e.storeId?`&storeId=${e.storeId}`:"")+"&child=1"):v("/shop?shopId="+e.relId)},{"bottom-left":p(()=>{var i;return[n("div",ue,y(o.$t((i=r(A)(e.orderPaySource))==null?void 0:i.name)),1)]}),"bottom-price":p(()=>[n("div",fe,[e.orderPaySource===r(le).USDT_WALLET?(f(),g(w,{key:0},[pe,n("span",null,y(r(O)(e==null?void 0:e.orderRealUsdt)),1),me,_e,n("span",he,y(r(O)(e==null?void 0:e.orderRealAmount)),1),ge],64)):(f(),g(w,{key:1},[ye,n("span",Ie,y(r(O)(e==null?void 0:e.orderRealAmount)),1)],64))])]),_:2},1032,["goods","onImageClick"])],8,ce))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])]),u(d,{class:"child-view bg-gray1"})]),_:1},8,["title"])}}const Ce=L({...be,setup:ve}),Ue=M(Ce,[["__scopeId","data-v-3c2c777e"]]);export{Ue as default};

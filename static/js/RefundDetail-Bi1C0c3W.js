import{_ as Re,y as Ie,w as $e,r as T,a1 as Se,x as f,be as Ae,D as Ee,bj as Fe,F as i,G as r,O as v,N as u,l as De,E as $,a2 as l,K as S,P as n,I as Ne,J as Ve,H as a,Q as o,a0 as y,R as je,a4 as ae,T as M,Y as Le,Z as Be}from"./vendor-Ba70TIw4.js";import{_ as de}from"./copy-CQ_1jpuF.js";import{o as Ke,R as Oe,h as ne,b as re,l as Pe,r as He}from"./index-Bsb9uxb4.js";import{R as Me}from"./RefundGoodItem-CvKBnn3F.js";import{_ as Ue}from"./RecommendationFeed-C9Nt-Dyn.js";import{C as Ge}from"./CommonVanProvider-CqQk6UpZ.js";import{P as K}from"./flashSale-DDyqLyYN.js";import{a as Je,c as ie,n as le}from"./order-Bt6BXfCD.js";import{g as We}from"./refund-BilSleEw.js";import{b as ze,c as U,d as Ye}from"./useRefund-Dpqhghzq.js";import{m as qe}from"./useOrderActionButtons-B52Gt0Da.js";import"./avatarRing-CLGxkH-F.js";import"./GoodsItem-DbDIwpYs.js";import"./credit-EZuPIBEN.js";import"./mcoin-logo-1-Deho8IWN.js";import"./useShipTemplate-CJrw2UwP.js";import"./enums-DlE-aiss.js";import"./useOrderStatus-eiwKm5Dv.js";import"./GoodsList-KFQaczxr.js";import"./buy-cart-m4kq4Bzt.js";import"./goods-BVwS8oFG.js";import"./ShopMaskTips-pbij6JLk.js";import"./shop-CeqcS6K2.js";import"./GoodsPrice-DfhrvFCM.js";import"./MCOIN-Bodfn-v1.js";import"./mall-BukQeouS.js";import"./WaterFull-DpMa4XQe.js";/* empty css                                                              */import"./cart-0_V967CA.js";import"./useShowActiveInfo-j41I9hXz.js";import"./festivalActivities-UX_5zNcM.js";import"./BackIcon-DkqwcD_b.js";import"./orderTime-DGNmmu3-.js";const Qe=""+new URL("../images/ic_round-auto-mode-l7j5TmeY.png",import.meta.url).href,G=F=>(Le("data-v-d0467e2e"),F=F(),Be(),F),Ze={class:"refund-detail__container bg-transparent bg-gray1"},Xe={key:0,class:"px-2 py-4 mt-3 bg-white rounded-xl"},et={key:0},tt={class:"flex items-start",style:{}},st={class:"w-2/6"},ot={key:0,class:"flex-1 w-full pl-1 ml-1 opacity-60 line flex-nowrap"},at={key:1,class:"text-[#2E2008] text-xs"},nt={key:0,class:"flex-1 mt-2 text-xs opacity-60"},rt={key:1},it={class:"flex items-center justify-between"},lt={class:"gap-2 flex-start"},dt=G(()=>a("img",{src:Qe,class:"w-[16px]"},null,-1)),ut={class:"text-[#2E2008] font-semibold"},ct={class:"flex items-center justify-between mt-3"},ft={class:"opacity-60 text-[#2E2008]"},pt={class:"font-semibold"},mt={key:0},vt={key:1},ht={key:2},yt={key:3},_t={key:0,class:"mt-2 text-xs opacity-60"},wt={key:1,class:"mt-2 text-xs opacity-60"},xt={key:2,class:"opacity-60 text-[#2E2008] mt-3"},gt={class:"mt-4 flex-center-bw"},kt={class:"opacity-60"},bt={class:"mt-4 flex-center-bw"},Tt={class:"opacity-60"},Ct={key:1},Rt={class:"mt-4 flex-center-bw"},It={class:"opacity-60"},$t=G(()=>a("img",{src:de,class:"w-4 h-4 ml-2",alt:""},null,-1)),St={class:"mt-4 flex-center-bw"},At={class:"opacity-60"},Et=G(()=>a("img",{src:de,class:"w-4 h-4 ml-2",alt:""},null,-1)),Ft={class:"mt-4 flex-center-bw"},Dt={class:"opacity-60"},Nt={class:"mt-4 flex-center-bw"},Vt={class:"opacity-60"},jt={class:"flex justify-between gap-2 mt-4 text-right break-all"},Lt={class:"opacity-60 whitespace-nowrap"},Bt={key:2,class:"flex flex-wrap items-center justify-center gap-[20px] mt-[15px] overflow-hidden"},Kt=y(" 未發貨強制退款 "),Ot={key:3,class:"flex justify-center text-sm text-[#2E2008]"},Pt={class:"text-sm leading-6 text-black"},Ht={class:"text-primary"},Mt={key:4,class:"flex justify-center text-[#2E2008] text-xs text-center mt-5 pb-5"},Ut={key:5,class:"flex justify-center text-[#2E2008] text-xs text-center mt-5 pb-5"},Gt={key:6,class:"flex justify-center text-[#2E2008] text-xs text-center mt-5 pb-5"},Jt=Ie({setup(F){const{loadingToggle:J}=He(),{senderForceCancel:ue,senderCancelUnsend:ce}=Ke(),{getUserDhKey:W,decryptAddressKey:fe,decryptKey:z}=Oe(),{t:p}=$e(),pe=Se(),Y=De(),t=T(null),me=pe.query.id,D=T(0),_=T(null),C=T(!1),N=f(()=>{var e,s,d;if(((s=(e=t.value)==null?void 0:e.refundInfo)==null?void 0:s.interveneStatus)===2&&((d=t.value)!=null&&d.platformInterventionCustomerTime)){const w=new Date(t.value.systemTime).getTime();return+t.value.platformInterventionCustomerTime+24*60*60*1e3*10-w}return null}),V=T(!1),ve=()=>{V.value=!0},O=T(!1),he=()=>{O.value=!0},j=f(()=>{var e,s;return((s=(e=t.value)==null?void 0:e.refundInfo)==null?void 0:s.refundStatus)===1}),P=f(()=>{var e,s;return((s=(e=t.value)==null?void 0:e.refundInfo)==null?void 0:s.refundStatus)===6}),q=f(()=>ze(t.value)),Q=e=>{var s;return e!==1||((s=t.value)==null?void 0:s.payType)===K.STORE_CARD||!j.value?!1:D.value>0&&!O.value},ye=f(()=>j.value),_e=f(()=>N.value<=0||V.value),Z=f(()=>!t.value||t.value.payType===K.STORE_CARD||!j.value?!1:D.value<=0||O.value),we=f(()=>U(t.value)&&N.value>0&&!V.value),xe=f(()=>U(t.value)&&(N.value<=0||V.value)),A=async()=>{var d,w,E,I,x,L,g,k;const e=JSON.parse(JSON.stringify(t.value)),s=await Je({id:me});if((d=s.data)!=null&&d.userAddress&&(s.data.userAddress.postscript=s.data.postscript),(w=s.data)!=null&&w.userAddress&&((I=(E=s.data)==null?void 0:E.userAddress)!=null&&I.encryptFlag)){const c=await W(s.data.stores.id,(x=s.data)==null?void 0:x.submitMerchantPubKey);c&&(s.data.userAddress=fe(s.data.userAddress,c))}if(s.data.shippingHash){const c=await W(s.data.stores.id,(L=s.data)==null?void 0:L.shippingMerchantPubKey);if(c){const b=z(s.data.expressNo,c);b.hash===s.data.shippingHash&&(s.data.expressNo=b.decrypt,s.data.expressCompany=z(s.data.expressCompany,c).decrypt)}}if(t.value=s.data,t.value.refundStatus===1){const c=new Date(t.value.systemTime).getTime(),b=new Date(t.value.autoRefundTime).getTime();D.value=b-c}C.value&&(e.payType==t.value.payType&&((g=e.refundInfo)==null?void 0:g.refundStatus)==((k=t.value.refundInfo)==null?void 0:k.refundStatus)||(C.value=!1))},ge=f(()=>t.value.payType===K.STORE_CARD?[{title:p("refund.apply refund"),value:0},{title:p("order.status4"),value:1},{title:p("refund.refund success tips"),value:3}]:[{title:p("refund.apply refund"),value:0},{title:p("refund.waiting deal with"),value:1},{title:p("order.blok comfirm"),value:2},{title:p("refund.refund success tips"),value:4}]),[H,X]=Ae(!1),ke=f(()=>Ye(t.value,!0)),be=async()=>{J(!0);const{success:e}=await We({orderId:t.value.id});J(!1),e&&(M(p("common.revoke success")),Y.replace({path:"/refundList"}))},ee=()=>{Y.push(`/category?deliveryType=1&shopId=${t.value.stores.id}`)},R=T(!1),Te=async()=>{R.value=!0;try{const s=(await ie({orderIds:t.value.id+""})).data.ordIds,d=await ue(s[0]);if(!d.success||!(await le({ordIds:s,hash:d.result.transactionHash})).success)return;C.value=!0,setTimeout(()=>{A(),_.value=setInterval(()=>{C.value?A():(clearInterval(_.value),_.value=null)},3e3)},1500)}catch(e){M(e.message||e)}finally{R.value=!1}},Ce=async()=>{R.value=!0;try{const s=(await ie({orderIds:t.value.id+""})).data.ordIds,d=await ce(s[0]);if(!d.success||!(await le({ordIds:s,hash:d.result.transactionHash})).success)return;C.value=!0,setTimeout(()=>{A(),_.value=setInterval(()=>{C.value?A():(clearInterval(_.value),_.value=null)},3e3)},1500)}catch(e){M(e.message||e)}finally{R.value=!1}};return Ee(async()=>{await A()}),Fe(()=>{clearInterval(_.value),_.value=null}),(e,s)=>{const d=$("van-count-down"),w=$("VanStep"),E=$("VanSteps"),I=$("van-icon"),x=$("VanButton"),L=$("i18n-t");return r(),i("div",Ze,[v(Ge,{title:e.$t("order.refund title"),class:"bg-gray1 font-Puhui font-normal relative shopGoodsPage h-full px-3","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(g,k)=>{k.shopGoodsRef=g}},{default:u(()=>{var g,k,c,b,te,se;return[t.value?(r(),i("div",Xe,[n(j)?(r(),i("div",et,[v(E,{direction:"vertical",active:(g=t.value.refundInfo)==null?void 0:g.refundStatus},{default:u(()=>[(r(!0),i(Ne,null,Ve(n(ge),(h,m)=>(r(),S(w,{class:je(["text-xs",{"van-icon-checked::before":m===1}]),key:m},{default:u(()=>{var oe;return[a("div",tt,[a("div",st,o(m===1&&((oe=t.value.refundInfo)==null?void 0:oe.refundStatus)==2?e.$t("refund.shop completed"):h.title),1),Q(m)?(r(),i("div",ot,[v(d,{time:D.value,onFinish:he},{default:u(B=>[y(o(e.$t("common.shop will",{time:B.days+e.$t("common.days")+B.hours+e.$t("common.hours")+B.minutes+e.$t("common.minutes")+B.seconds+e.$t("common.seconds")})),1)]),_:1},8,["time"])])):m===1?(r(),i("div",at,o(e.$t("refund.not delivered the goods")),1)):l("",!0)]),Q(m)?(r(),i("div",nt,o(e.$t("refund.waiting refund tips")),1)):l("",!0)]}),_:2},1032,["class"]))),128))]),_:1},8,["active"])])):(r(),i("div",rt,[a("div",it,[a("div",lt,[dt,a("div",ut,o(e.$t("refund.order status")),1)])]),a("div",ct,[a("div",ft,o(e.$t("order.Current status of after-sales order")),1),a("div",pt,[n(P)?(r(),i("span",mt,"撤销售后")):n(q)?n(q)?(r(),i("span",ht,o(((c=(k=t.value.refundInfo)==null?void 0:k.phase)==null?void 0:c.label)||"--"),1)):(r(),i("span",yt," -- ")):(r(),i("span",vt," 售后已结束 "))])]),n(P)?(r(),i("div",_t,o(n(p)("refund.cancel order tips")),1)):l("",!0),n(P)?(r(),i("div",wt,o(e.$t("common.cancel refund time"))+" ："+o(t.value.refundCancelTime||"-"),1)):l("",!0),(b=t.value.refundInfo)!=null&&b.successTime?(r(),i("div",xt,o(((te=t.value.refundInfo)==null?void 0:te.successTime)||"--"),1)):l("",!0)]))])):l("",!0),t.value?(r(),S(Me,{key:1,order:t.value,isService:""},{default:u(()=>{var h;return[a("div",gt,[a("div",kt,o(e.$t("refund.No")),1),a("div",null,o(t.value.id),1)]),a("div",bt,[a("div",Tt,o(e.$t("refund.reason text")),1),a("div",null,o(n(ke)),1)]),n(H)?l("",!0):(r(),i("div",{key:0,class:"mt-4 text-center text-[#2E2008]",onClick:s[0]||(s[0]=ae(m=>n(X)(!0),["stop"]))},[a("span",null,o(e.$t("common.check more")),1),v(I,{class:"ml-2",name:"arrow-down"})])),n(H)?(r(),i("div",Ct,[a("div",Rt,[a("div",It,o(e.$t("order.hash")),1),a("div",{class:"flex items-center",onClick:s[1]||(s[1]=m=>n(ne)(t.value.hash))},[y(o(n(re)(t.value.hash,"***",9,5)||"-")+" ",1),$t])]),a("div",St,[a("div",At,o(e.$t("order.payAddress")),1),a("div",{class:"flex items-center",onClick:s[2]||(s[2]=m=>n(ne)(t.value.stores.merchant))},[y(o(n(re)(t.value.stores.merchant,"...",5,5))+" ",1),Et])]),a("div",Ft,[a("div",Dt,o(e.$t("order.payTime")),1),a("div",null,o(n(Pe)(t.value.createTime)),1)]),a("div",Nt,[a("div",Vt,o(e.$t("order.orderNumber")),1),a("div",null,o(t.value.id),1)]),a("div",jt,[a("div",Lt,o(e.$t("order.orderRemark")),1),a("div",null,o(((h=t.value.userAddress)==null?void 0:h.postscript)||"-"),1)])])):l("",!0),n(H)?(r(),i("div",{key:2,class:"mt-4 text-center text-[#2E2008]",onClick:s[3]||(s[3]=ae(m=>n(X)(!1),["stop"]))},[y(o(e.$t("refund.put way")),1),v(I,{class:"ml-2",name:"arrow-up"})])):l("",!0)]}),_:1},8,["order"])):l("",!0),t.value?(r(),i("div",Bt,[n(ye)?(r(),S(x,{key:0,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold",onClick:be},{default:u(()=>[y(o(e.$t("refund.cancel refund")),1)]),_:1})):(r(),S(x,{key:1,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold",onClick:ee},{default:u(()=>[y(o(e.$t("refund.make order")),1)]),_:1})),n(U)(t.value)?(r(),S(x,{key:2,loading:R.value,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold",onClick:Te,disabled:!n(_e)},{default:u(()=>[y(o(e.$t("order.forced refund")),1)]),_:1},8,["loading","disabled"])):l("",!0),n(Z)?(r(),S(x,{key:3,onClick:Ce,loading:R.value,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold"},{default:u(()=>[Kt]),_:1},8,["loading"])):l("",!0),v(x,{class:"text-[#FEA021] h-[40px] min-w-[130px] px-4 font-semibold btn-border",onClick:ee},{default:u(()=>[y(o(e.$t("refund.concat sales")),1)]),_:1})])):l("",!0),n(we)?(r(),i("div",Ot,[v(I,{name:"info-o",color:"red",size:"18px ",class:"mr-1"}),a("div",Pt,[v(d,{time:n(N),onFinish:ve},{default:u(h=>[v(L,{keypath:"refund.userShopLockRefundTip",tag:"span"},{time:u(()=>[a("span",Ht,o(e.$t("refund.time",{days:h.days,hours:h.hours,minutes:h.minutes,seconds:h.seconds})),1)]),_:2},1024)]),_:1},8,["time"])])])):l("",!0),n(xe)?(r(),i("div",Mt," *"+o(e.$t("refund.directly force a refund")),1)):l("",!0),n(Z)?(r(),i("div",Ut," *"+o(e.$t("refund.not delivered the goods")),1)):l("",!0),((se=t.value)==null?void 0:se.payType)!==n(K).STORE_CARD&&n(qe)(t.value)?(r(),i("div",Gt," *"+o(e.$t("refund.refund has been forced")),1)):l("",!0),v(Ue,{"title-text":n(p)("common.recommend_for_you"),class:"pt-[10px]"},null,8,["title-text"])]}),_:1},8,["title"])])}}}),Rs=Re(Jt,[["__scopeId","data-v-d0467e2e"]]);export{Rs as default};

import{_ as ee,y as W,w as te,be as X,r as C,D as Z,E as u,K as S,G as f,N as d,H as o,O as m,X as V,a4 as L,bF as se,P as c,bE as oe,Q as b,a1 as P,T as D,bs as ae,Z as ne,$ as le,bf as Q,z as re,F as $,bD as ie,J as de,R as ce,I as ue,n as pe}from"./vendor-BlU_hoYl.js";import{_ as me}from"./search-B34EARrH.js";import{_ as ge}from"./checked-CkJ-Z4or.js";import{W as q,aa as xe,ab as fe,a3 as ve,q as _e,aU as he,aV as j}from"./index-UgIL2Smv.js";import{i as be}from"./offlineGoods-DvT2Go6q.js";import{u as Be}from"./upload-DlQgyGlV.js";const ye="/static/images/deleteImg-D8x_oyov.svg",E=v=>(ne("data-v-8bdecdb8"),v=v(),le(),v),we={class:"w-full p-4 bg-b6 rounded-[10px] overflow-hidden font-Puhui"},Ce=E(()=>o("header",{class:"text-center felx-1 relative mx-1"},[o("div",{class:"text-base font-bold"},"添加品牌")],-1)),Fe={class:"title"},ke={class:"border-b4 border-b border-solid"},Ve=E(()=>o("div",{class:"text-sm text-[#2E2008] font-semibold"},b("品牌名称"),-1)),Ie={class:"flex justify-between items-center py-4 border-b4 border-b border-solid"},$e=E(()=>o("div",{class:"text-sm text-[#2E2008] font-semibold"},b("品牌LOGO"),-1)),Se={class:"van-uploader__wrapper gap-3"},Ee=["onClick"],Ne={class:"van-image van-uploader__preview-image",style:{width:"60px",height:"60px","border-radius":"6px"}},Ae=["onClick"],De=E(()=>o("img",{class:"w-[15px] h-[15px]",src:ye,alt:""},null,-1)),Le=[De],Pe={class:"w-[60px] h-[60px] bg-b5 rounded-xl text-center flex flex-col justify-center items-center text-[#d9d9d9]"},ze=["src"],Oe={class:"text-xs font-light text-center text-b1 opacity-30"},Te={class:"py-4"},Ue=E(()=>o("div",{class:"text-sm text-[#2E2008] font-semibold"},b("品牌描述"),-1)),Re={class:"flex items-center gap-x-3"},Ge=P(" 确认添加 "),He=W({emits:["close","success"],setup(v,{emit:_}){const{t:w}=te(),[z,F]=X(!1),O=C(!0),t=C({storeBrandName:null,storeBrandIcon:null,storeBrandDesc:null}),i=C([]),p=C(1),T=async r=>{if(i.value.length>=p.value)return;const a=xe(r.file);if(!a.valid)return B(a.tips);const x=fe(r.file);if(!x.valid)return B(x.tips);D.loading({message:w("common.uploading"),forbidClick:!0,duration:0});const y=await ve(r,"goodsDesc"),k=await Be(y);if(D.clear(),!k.success)return B("图片上传失败");i.value.push({id:G(),url:_e.imgUrl+k.data})},U=r=>{i.value.splice(r,1)},R=r=>{ae({images:i.value.map(a=>a.url),startPosition:r})},G=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var a=Math.random()*16|0,x=r==="x"?a:a&3|8;return x.toString(16)}),B=(r="",a="toast-warn.svg")=>{D({message:r,icon:q(a),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})},H=async()=>{if(!t.value.storeBrandName)return B("请输入品牌名称");if(!i.value.length)return B("请上传品牌主图");F(!0);const r=i.value.map(y=>y.url);t.value.storeBrandIcon=r.join(",");const{success:a,data:x}=await he(t.value);F(!1),a&&(B("添加成功","toast-success.svg"),setTimeout(()=>{_("success",{...t.value,id:null})},2e3))};return Z(()=>{}),(r,a)=>{const x=u("van-field"),y=u("VanImage"),k=u("van-uploader"),K=u("VanButton"),s=u("VanPopup");return f(),S(s,{teleport:"body",show:O.value,position:"bottom",round:"","close-on-click-overlay":!1,onClickOverlay:a[3]||(a[3]=e=>r.$emit("close")),"overlay-class":"categoryOverlay",class:"sm:w-[375px] sm:left-[50%] sm:translate-x-[-50%]",style:{"min-height":"30%","border-radius":"16px 16px 0 0"}},{default:d(()=>[o("div",we,[Ce,o("div",Fe,[o("div",ke,[m(x,{"input-align":"right",maxlength:12,modelValue:t.value.storeBrandName,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value.storeBrandName=e),placeholder:"请输入品牌名称",class:"no-bt"},{label:d(()=>[Ve]),_:1},8,["modelValue"])]),o("div",Ie,[$e,o("div",Se,[m(c(oe),se({class:"flex flex-wrap gap-3",modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),"item-key":"id"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"}),{item:d(({element:e,index:n})=>[o("div",{class:"van-uploader__preview",onClick:L(g=>R(n),["stop"])},[o("div",Ne,[m(y,{src:e.url,class:"van-image__img",radius:"6px",fit:"cover"},null,8,["src"])]),o("div",{class:"absolute top-[4.25px] right-[4px] z-[9]",onClick:L(g=>U(n),["stop"]),tabindex:"0"},Le,8,Ae)],8,Ee)]),_:1},16,["modelValue"]),i.value.length<p.value?(f(),S(k,{key:0,accept:c(be),afterRead:T},{default:d(()=>[o("div",Pe,[o("img",{src:c(q)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,ze),o("div",Oe,b(r.$t("common.add img")),1)])]),_:1},8,["accept"])):V("",!0)])]),o("div",Te,[Ue,m(x,{modelValue:t.value.storeBrandDesc,"onUpdate:modelValue":a[2]||(a[2]=e=>t.value.storeBrandDesc=e),rows:"2",autosize:"",type:"textarea",placeholder:"请输入品牌描述",class:"no-bt",style:{"padding-top":"8px !important","padding-bottom":"0 !important"},maxlength:"150","show-word-limit":""},null,8,["modelValue"])])]),o("div",Re,[m(K,{class:"submit-btn flex-1 bg-yellow text-b1 text-base font-semibold border-none h-[46px]",round:"",onClick:H,loading:c(z)},{default:d(()=>[Ge]),_:1},8,["loading"])])])]),_:1},8,["show"])}}}),Ke=ee(He,[["__scopeId","data-v-8bdecdb8"]]),Me={class:"w-full py-4 px-3 safe-bottom bg-b6 rounded-[10px] overflow-hidden font-Puhui"},je={class:"text-center felx-1 relative mx-1"},qe=["onClick"],Je={class:"text-base font-bold"},Qe={class:"absolute right-0 top-0 pl-2"},We={key:0,class:"flex-1 bg-b5 rounded-3xl mx-1 mt-4 mb-2"},Xe=o("div",null,[o("img",{src:me,class:"w-4 h-4"})],-1),Ze={class:"flex-1 flex items-center gap-1 text-sm"},Ye={class:"flex-1"},et={key:0},tt={class:"text-b3 line-clamp-1"},st={key:0,class:"w-4 h-4",src:ge,alt:""},ot={key:1,class:"flex items-center gap-x-3 pt-4"},at=P(" 全分店（含增补） "),nt=P(b("选择分店")),pt=W({props:{brand:null,includeAllStoreFlag:{type:Boolean},selectStore:{type:Boolean},level:null},emits:["close","selectBrand","selectStore","selectAllStore","add"],setup(v,{emit:_}){const w=v,[z,F]=X(!1),O=C(!0),t=Q({total:0,loading:!1,finished:!1,list:[],currentBrand:[]}),i=Q({page:0,size:100,storeBrandNameLike:void 0,showNotHaveStoresFlag:!0}),p=C([]),T=C(null),U=s=>{p.value=[s.storeBrandId],R()},R=()=>{var e;const s=(e=t.list||[])==null?void 0:e.find(n=>n.storeBrandId===p.value[0]);_("selectBrand",s),w.selectStore||_("close")},G=()=>{if(!p.value.length)return y("请选择品牌");_("selectAllStore")},B=()=>{if(!p.value.length)return y("请选择品牌");_("selectStore"),_("close")},H=s=>{const e=document.getElementById(s);e&&e.scrollIntoView({behavior:"smooth"})};re(()=>w.brand,async s=>{s!=null&&s.storeBrandId&&(await pe(),H(s==null?void 0:s.storeBrandId))},{immediate:!0,deep:!0});const r=()=>{t.finished=!1,t.list=[],i.page=0,a()},a=async()=>{t.loading=!0,i.page+=1,await x(),t.loading=!1},x=async()=>{const{success:s,data:e}=await j(i);if(!s){t.finished=!0;return}const{records:n,total:g,current:h,pages:I}=e;if(!g||!n||!(n!=null&&n.length)){t.finished=!0;return}if(t.total=g,t.currentBrand.length&&!i.storeBrandNameLike){let N=n.filter(M=>M.storeBrandId!=t.currentBrand[0].storeBrandId);t.list=i.page===1?t.currentBrand.concat(N):t.list.concat(N)}else t.list=i.page===1?n:t.list.concat(n);+h>=+I&&(t.finished=!0)},y=(s="",e="toast-warn.svg")=>{D({message:s,icon:q(e),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})},k=()=>{F(!0)},K=async s=>{t.loading=!0;const e=await j({page:1,size:1,storeBrandNameLike:s==null?void 0:s.storeBrandName,showNotHaveStoresFlag:!0});if(e.success){const{records:n,total:g}=e.data;g&&n&&(n!=null&&n.length)&&(t.currentBrand=n)}r(),F(!1),_("add",s)};return Z(async()=>{var s,e,n;if((s=w.brand)!=null&&s.storeBrandId){p.value=[(e=w.brand)==null?void 0:e.storeBrandId],t.loading=!0;const g=await j({page:1,size:1,storeBrandNameLike:(n=w.brand)==null?void 0:n.storeBrandName,showNotHaveStoresFlag:!0});if(g.success){const{records:h,total:I}=g.data;I&&h&&(h!=null&&h.length)&&(t.currentBrand=h)}}a()}),(s,e)=>{const n=u("van-icon"),g=u("VanField"),h=u("VanImage"),I=u("van-checkbox"),N=u("van-checkbox-group"),M=u("VanList"),J=u("VanButton"),Y=u("VanPopup");return f(),S(Y,{teleport:"body",show:O.value,position:"bottom",round:"","close-on-click-overlay":!1,onClickOverlay:e[5]||(e[5]=l=>s.$emit("close")),"overlay-class":"categoryOverlay",class:"sm:w-[375px] sm:left-[50%] sm:translate-x-[-50%]",style:{"min-height":"50%","border-radius":"16px 16px 0 0"}},{default:d(()=>[o("div",Me,[o("header",je,[o("div",{class:"absolute left-0 top-0 pr-2 text-sm text-newOrigin",onClick:L(k,["stop"])}," 添加品牌 ",8,qe),o("div",Je,b(s.$t("offline.select_store_brand")),1),o("div",Qe,[m(n,{name:"cross",size:"20",onClick:e[0]||(e[0]=L(()=>{_("close")},["stop"]))})])]),v.level?V("",!0):(f(),$("div",We,[m(g,{modelValue:c(i).storeBrandNameLike,"onUpdate:modelValue":e[1]||(e[1]=l=>c(i).storeBrandNameLike=l),placeholder:s.$t("offline.input_store_name"),class:"w-[100%-20px] text-center bg-transparent items-center",clearable:"",onClear:r,onKeyup:ie(r,["enter"])},{"left-icon":d(()=>[Xe]),"right-icon":d(()=>[o("div",{class:"text-newOrigin pl-1 ml-2",onClick:r},b(s.$t("common.search")),1)]),_:1},8,["modelValue","placeholder","onKeyup"])])),m(M,{loading:c(t).loading,"onUpdate:loading":e[3]||(e[3]=l=>c(t).loading=l),finished:c(t).finished,"immediate-check":!1,"loading-text":s.$t("common.loading"),onLoad:a,class:"shopList mx-1 overflow-y-auto h-[calc(100vh-200px)]"},{default:d(()=>[m(N,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=l=>p.value=l),ref:(l,A)=>{A.checkboxGroup=l,T.value=l},max:1},{default:d(()=>[(f(!0),$(ue,null,de(c(t).list,l=>(f(),S(I,{key:l.storeBrandId,name:l.storeBrandId,id:l.storeBrandId,"label-position":"left",class:"flex flex-1 justify-between py-4 border-b border-b-b4 last:border-none",onClick:A=>U(l)},{icon:d(A=>[A.checked?(f(),$("img",st)):V("",!0)]),default:d(()=>[o("div",Ze,[m(h,{src:((l==null?void 0:l.storeBrandIcon)||"").split(",")[0],radius:"4px",width:"32px",height:"32px",fit:"cover"},null,8,["src"]),o("div",Ye,[o("div",{class:ce([{"text-newOrigin font-semibold":p.value.includes(l.storeBrandId)},"line-clamp-1"])},[P(b(l.storeBrandName)+" ",1),p.value.includes(l.storeBrandId)&&v.includeAllStoreFlag?(f(),$("span",et,"（当前选择该品牌全分店含增补）")):V("",!0)],2),o("div",tt,b(l.storeBrandDesc),1)])])]),_:2},1032,["name","id","onClick"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["loading","finished","loading-text"]),!c(t).loading&&v.selectStore?(f(),$("div",ot,[m(J,{class:"submit-btn flex-1 bg-white text-b1 text-base font-normal border border-solid border-b4 h-[46px]",round:"",onClick:G},{default:d(()=>[at]),_:1}),m(J,{class:"submit-btn flex-1 bg-yellow text-b1 text-base font-semibold border-none h-[46px]",round:"",onClick:B},{default:d(()=>[nt]),_:1})])):V("",!0)]),c(z)?(f(),S(Ke,{key:0,onSuccess:K,onClose:e[4]||(e[4]=l=>c(F)(!1))})):V("",!0)]),_:1},8,["show"])}}});export{pt as _,ye as a};

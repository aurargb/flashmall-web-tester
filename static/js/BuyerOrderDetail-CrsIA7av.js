import{y as _e,x as T,F as p,G as l,H as e,Q as i,X as m,O,w as Q,B as U,P as n,I as H,a1 as L,E as Ht,K as S,N as z,a4 as Qe,r as $,D as Z,a9 as fe,o as Ut,_ as Gt,a2 as Vt,be as E,T as B,R as Wt,l as Kt}from"./vendor-BlU_hoYl.js";import{d as J,q as A,b as $e,h as te,l as ce,R as zt,e as Jt,o as Zt,f as Xe,s as se,C as Ce,B as Qt,bA as Xt}from"./index-UgIL2Smv.js";import{a as Yt,_ as Ye,b as es,c as ts}from"./remark-CnqNNofH.js";import{B as ss,V as os}from"./VoucherConfirm-BnCXAURd.js";import{_ as tt}from"./CountdownLabel-CPOIew63.js";import{_ as oe}from"./MCOIN-BOqZVkND.js";import{_ as ns}from"./USDT-CNsbs3BR.js";import{_ as rs}from"./FMCP-yoa9RTPy.js";import{_ as as}from"./link-CItP-_Ep.js";import{_ as ne}from"./copy-w-Dr8nkqKW.js";import{P as q}from"./order-H59PKTFP.js";import{P as is}from"./flashSale-DDyqLyYN.js";import{p as ls}from"./useOrderStatus-D1Cw0BRr.js";import{_ as ke}from"./SubmitApprove-DXvMhooF.js";import{e as st,h as us,i as ds,j as ot,k as cs,f as ms,l as fs}from"./useOrderActionButtons-BOt9swVU.js";import{P as hs}from"./PaySwitchPop-B-FiDltW.js";import{g as nt,a as Ae}from"./orderTime-CrHWsAnM.js";import{_ as et}from"./EmptyTipsPop-DGM583dh.js";import{B as ys}from"./BackIcon-8hcEjDKb.js";import{d as vs,u as ps}from"./useRefund-CagomE1G.js";import{a as xs,C as bs,l as ws,D as gs,c as me,n as Se,E as Ts,F as $s,t as Cs,u as ks}from"./order-ClP3Ze4h.js";import{p as Ss}from"./piggyBank-swFyWePk.js";import"./credit-0laLclE7.js";import"./useShipTemplate-C35bKCd2.js";import"./enums-DlE-aiss.js";import"./default-avatar-DfqlD94j.js";import"./selected-icon-CfPkLSlb.js";const _s={class:"p-3 break-all bg-white rounded-xl"},As={class:"font-semibold text-sm text-b1"},Ds={class:"mt-1 text-b2 text-sm font-normal"},Is={class:"ml-1"},Rs=_e({props:{order:null,showCopy:{type:Boolean,default:!0}},setup(o){const{order:c}=o;return T(()=>`${c.userAddress.provinceName??""}${c.userAddress.cityName??""}${c.userAddress.countyName??""}${c.userAddress.detailInfo??""} ${c.userAddress.userName??""} ${c.userAddress.telNumber??""}`),(v,D)=>(l(),p("div",_s,[e("div",As,i(c.userAddress.provinceName??"")+i(c.userAddress.cityName??"")+i(c.userAddress.countyName??"")+i(c.userAddress.detailInfo??""),1),e("div",Ds,[e("span",null,i(c.userAddress.userName),1),e("span",Is,i(c.userAddress.telNumber??""),1)])]))}}),Bs={key:0,class:"p-3 break-all bg-white rounded-xl"},Fs={class:"font-semibold text-base text-b1"},Ps=e("span",null,"请在",-1),Ls={class:"text-[#FF8812] mx-1"},Ns=e("span",null,"内支付",-1),Os=e("div",{class:"mt-1 font-normal text-sm text-b2"}," 倒计时结束后订单将超时关闭 ",-1),Es={props:{order:{type:Object,required:!0}},emits:["timeDone"],setup(o,{emit:c}){return(v,D)=>o.order.status===0?(l(),p("div",Bs,[e("div",Fs,[Ps,e("span",Ls,[O(tt,{class:"inline-block w-auto",startTime:o.order.createTime,duration:15,durationType:"minutes",showZero:!0,onDone:D[0]||(D[0]=C=>c("timeDone"))},null,8,["startTime"])]),Ns]),Os])):m("",!0)}},js={class:"p-3 py-4 break-all bg-white rounded-xl"},Ms={class:"title text-b1 text-sm font-semibold"},qs={class:"content"},Hs={class:"flex justify-between items-center mt-4"},Us={class:"text-b3 text-sm font-normal"},Gs={class:"text-b1 text-sm font-normal text-right"},Vs={class:"flex justify-between items-center mt-4"},Ws={class:"text-b3 text-sm font-normal"},Ks={class:"text-b1 text-sm font-normal text-right flex items-center"},zs=e("div",{class:"flex-shrink-0"},[e("img",{class:"w-4 h-4",src:oe})],-1),Js={class:"ml-1"},Zs={key:0,class:"flex justify-between items-center mt-4"},Qs={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},Xs={class:"text-b1 text-sm font-normal text-right flex items-center"},Ys={class:"mr-1"},eo=e("div",{class:"flex-shrink-0"},[e("img",{class:"w-4 h-4",src:oe})],-1),to={class:"ml-1"},so={key:1,class:"flex justify-between items-center mt-4"},oo={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},no={class:"text-b1 text-sm font-normal text-right flex items-center"},ro=e("div",{class:"mr-1"},"-",-1),ao=e("div",{class:"flex-shrink-0"},[e("img",{class:"w-4 h-4",src:oe})],-1),io={class:"ml-1"},lo={class:"flex justify-between items-center mt-4"},uo={class:"text-b3 text-sm font-normal"},co={class:"text-b1 text-sm font-normal text-right flex items-center gap-1"},mo=e("img",{class:"w-4 h-4",src:ns},null,-1),fo=L("( "),ho=e("img",{class:"w-4 h-4",src:oe},null,-1),yo=e("div",{class:"flex-shrink-0"},[e("img",{class:"w-4 h-4",src:oe})],-1),vo=e("span",{class:"text-[#999]"},"+",-1),po=e("img",{class:"w-4 h-4",src:rs},null,-1),xo={class:"flex justify-between items-center mt-4"},bo={class:"text-b3 text-sm font-normal"},wo={class:"text-b1 text-sm font-normal text-right"},go={class:"flex items-center"},To={class:"flex justify-between items-center mt-4"},$o={class:"text-b3 text-sm font-normal"},Co=["href"],ko=e("img",{src:as,class:"w-5 h-5 ml-1",alt:""},null,-1),So={key:1},_o={class:"flex justify-between items-center mt-4"},Ao={class:"text-b3 text-sm font-normal"},Do=e("img",{src:ne,class:"w-5 h-5 ml-1",alt:""},null,-1),Io={class:"flex justify-between items-center mt-4"},Ro={class:"text-b3 text-sm font-normal"},Bo=e("img",{src:ne,class:"w-5 h-5 ml-1",alt:""},null,-1),Fo={key:2,class:"flex justify-between items-center mt-4"},Po={class:"text-b3 text-sm font-normal"},Lo={class:"text-b1 text-sm font-normal text-right"},No={key:3,class:"flex justify-between items-center mt-4"},Oo={class:"text-b3 text-sm font-normal"},Eo={class:"text-b1 text-sm font-normal text-right"},jo={key:4,class:"flex justify-between items-center mt-4"},Mo={class:"text-b3 text-sm font-normal"},qo={class:"text-b1 text-sm font-normal text-right"},Ho={key:5,class:"flex justify-between items-center mt-4"},Uo={class:"text-b3 text-sm font-normal"},Go={class:"text-b1 text-sm font-normal text-right"},Vo={key:6,class:"flex justify-between items-center mt-4"},Wo={class:"text-b3 text-sm font-normal whitespace-nowrap"},Ko={class:"text-b1 text-sm font-normal text-right flex items-center"},zo={class:"break-all flex-1"},Jo=e("img",{src:ne,class:"w-5 h-5",alt:""},null,-1),Zo=[Jo],Qo={key:7,class:"flex justify-between items-center mt-4"},Xo=e("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 发货物流公司 ",-1),Yo={class:"text-b1 text-sm font-normal text-right break-all"},en={key:8,class:"flex justify-between items-center mt-4"},tn=e("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 发货运单号 ",-1),sn={class:"text-b1 text-sm font-normal text-right flex items-center"},on={class:"break-all flex-1"},nn=e("img",{src:ne,class:"w-5 h-5",alt:""},null,-1),rn=[nn],an={key:9,class:"flex justify-between items-center mt-[16px]"},ln=e("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 退货物流公司 ",-1),un={class:"text-b1 text-sm font-normal text-right break-all"},dn={key:10,class:"flex justify-between items-center mt-[16px]"},cn=e("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 退货运单号 ",-1),mn={class:"text-b1 text-sm font-normal text-right flex items-center"},fn={class:"break-all flex-1"},hn=e("img",{src:ne,class:"w-5 h-5",alt:""},null,-1),yn=[hn],vn={props:{order:{type:Object,required:!0}},setup(o){const c=o,{t:v}=Q(),D=T(()=>{var a,y,g;return(a=c==null?void 0:c.order)!=null&&a.payAddress?(y=c==null?void 0:c.order)==null?void 0:y.payAddress:(g=c==null?void 0:c.order)==null?void 0:g.address}),C=T(()=>{let a=0;return a=new U(c.order.totalAmount||0).minus(c.order.voucherAmount||0),J(a)}),h=T(()=>{var y;const a=c.order.orderGoods||[];return a.length>0?a[0].discountRatio||0:((y=c.order.stores)==null?void 0:y.discountRatio)||0});return(a,y)=>{var g,f,x,s,w,k;return l(),p("div",js,[e("div",Ms,[e("span",null,i(a.$t("order.orderInfo")),1)]),e("div",qs,[e("div",Hs,[e("div",Us,i(a.$t("common.pay type method")),1),e("div",Gs,i(n(ls)(+o.order.paySource)),1)]),e("div",Vs,[e("div",Ws,i(a.$t("order.total price detail")),1),e("div",Ks,[zs,e("div",Js,i(n(J)(o.order.totalAmountOriginal||o.order.totalAmount)),1)])]),o.order.merchantAdjustAmount?(l(),p("div",Zs,[e("div",Qs,i(a.$t("order.merchant modify price")),1),e("div",Xs,[e("div",Ys,i(o.order.merchantAdjustAmount>0?"+":"-"),1),eo,e("div",to,i(Math.abs(o.order.merchantAdjustAmount)||0),1)])])):m("",!0),o.order.fmGeneralActivity&&o.order.activityReduceAmount?(l(),p("div",so,[e("div",oo,i(((g=o.order.fmGeneralActivity)==null?void 0:g.name)||"-"),1),e("div",no,[ro,ao,e("div",io,i(n(J)(o.order.activityReduceAmount)),1)])])):m("",!0),e("div",lo,[e("div",uo,i(a.$t("order.total price actual buyer")),1),e("div",co,[+o.order.paySource===n(q).USDT_WALLET?(l(),p(H,{key:0},[mo,L(" "+i(n(J)(o.order.totalUsdt))+" ",1),o.order.payType===n(is).STORE_CARD?(l(),p(H,{key:0},[L(" （"+i(n(J)(o.order.totalAmount))+i((f=o.order.fmStoredCard)==null?void 0:f.symbol)+"） ",1)],64)):(l(),p(H,{key:1},[fo,ho,L(i(n(C))+" Mcoin)",1)],64))],64)):(l(),p(H,{key:1},[yo,e("div",null,i(n(C)),1),o.order.voucherAmount?(l(),p(H,{key:0},[vo,po,L(" "+i(n(J)(o.order.voucherAmount||0)),1)],64)):m("",!0)],64))])]),e("div",xo,[e("div",bo,i(a.$t("common.ratio")),1),e("div",wo,[e("div",go,i(n(h))+"%",1)])]),e("div",To,[e("div",$o,i(a.$t("order.hash")),1),o.order.hash?(l(),p("a",{key:0,class:"text-sm font-normal text-right flex items-center underline text-[#FF8812]",href:`${n(A).chainConfig.blockExplorerUrls[0]}/tx/${o.order.hash}`},[L(i(n($e)(o.order.hash,"***",9,5)||"--")+" ",1),ko],8,Co)):(l(),p("span",So," -- "))]),e("div",_o,[e("div",Ao,i(a.$t("order.orderAddress")),1),e("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:y[0]||(y[0]=F=>n(te)(o.order.address))},[L(i(n($e)(o.order.address,"...",5,5))+" ",1),Do])]),e("div",Io,[e("div",Ro,i(a.$t("order.payAddress")),1),e("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:y[1]||(y[1]=F=>n(te)(n(D)))},[L(i(n($e)(n(D),"...",5,5))+" ",1),Bo])]),o.order.createTime?(l(),p("div",Fo,[e("div",Po,i(a.$t("order.createTime")),1),e("div",Lo,i(n(ce)(o.order.createTime)),1)])):m("",!0),o.order.chainCreateTime?(l(),p("div",No,[e("div",Oo,i(a.$t("order.chainFinishTime")),1),e("div",Eo,i(n(ce)(o.order.chainCreateTime)),1)])):m("",!0),o.order.expressTime?(l(),p("div",jo,[e("div",Mo,i(a.$t("order.expressTime")),1),e("div",qo,i(n(ce)(o.order.expressTime)),1)])):m("",!0),o.order.finishTime?(l(),p("div",Ho,[e("div",Uo,i(a.$t("order.finishTime")),1),e("div",Go,i(o.order.finishTime?n(ce)(o.order.finishTime):"-"),1)])):m("",!0),o.order.id&&o.order.status!==0?(l(),p("div",Vo,[e("div",Wo,i(a.$t("order.orderNumber")),1),e("div",Ko,[e("div",zo,i(o.order.id),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:y[2]||(y[2]=F=>n(te)(o.order.id))},Zo)])])):m("",!0),o.order.expressCompany?(l(),p("div",Qo,[Xo,e("div",Yo,i(o.order.expressCompany),1)])):m("",!0),o.order.expressNo?(l(),p("div",en,[tn,e("div",sn,[e("div",on,i(o.order.expressNo),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:y[3]||(y[3]=F=>n(te)(o.order.expressNo))},rn)])])):m("",!0),(x=o.order.refundInfo)!=null&&x.expressCompany?(l(),p("div",an,[ln,e("div",un,i((s=o.order.refundInfo)==null?void 0:s.expressCompany),1)])):m("",!0),(w=o.order.refundInfo)!=null&&w.expressNo?(l(),p("div",dn,[cn,e("div",mn,[e("div",fn,i((k=o.order.refundInfo)==null?void 0:k.expressNo),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:y[4]||(y[4]=F=>{var N;return n(te)((N=o.order.refundInfo)==null?void 0:N.expressNo)})},yn)])])):m("",!0)])])}}},pn={class:"flex justify-between items-center gap-3 mt-5 fixed left-0 right-0 bottom-0 safe-bottom px-3"},xn={key:0,class:"flex justify-between items-center gap-3 w-full"},bn={class:"relative w-full flex-1"},wn={class:"relative w-full flex-1"},gn={key:0},Tn={props:{order:{type:Object,required:!0},btnLoading:{type:Boolean,default:!1},nowTime:{type:Number,default:0},continuePayLoading:{type:Boolean,default:!1},cancelLoading:{type:Boolean,default:!1},voucherPrice:{type:Number,default:0}},emits:["handleDelay","handleDelayReceipt","handleTo","cancelOrder","continuePay","timeDone"],setup(o,{emit:c}){const v=o,{t:D}=Q(),C=T(()=>{const f=v.order||{};return st(f)}),h=T(()=>{const f=v.order||{};return us(f)}),a=T(()=>{const f=v.order||{};return ds(f)}),y=T(()=>{const f=v.order||{},x=v.nowTime;return ot(f,x)}),g=()=>{const f=v.order;if(cs(f))c("handleTo",`/refundDetail?id=${f.id}`);else{console.log("order.creditFlag",f.creditFlag);let s=`/buyerOrderList/refundService?id=${f.id}`;f.creditFlag&&(s+="&type=credit"),c("handleTo",s)}};return(f,x)=>{const s=Ht("VanButton");return l(),p("div",pn,[o.order.status===0&&!o.order.hash?(l(),p("div",xn,[e("div",bn,[o.order.hash?m("",!0):(l(),S(s,{key:0,round:"",class:"w-full flex-1 gray-btn border-btn font-normal text-base h-[46px] rounded-full",loading:o.btnLoading||o.cancelLoading,disabled:o.continuePayLoading||o.order.hash,onClick:x[0]||(x[0]=Qe(w=>f.$emit("cancelOrder"),["stop"]))},{default:z(()=>[L(i(f.$t("order.cancelOrder")),1)]),_:1},8,["loading","disabled"]))]),e("div",wn,[o.order.paySource!=n(q).PIGGY_BANK&&o.order.paySource!=n(q).WITHDRAW_POINTS?(l(),p("div",gn,[o.order.paySource==n(q).USDT_WALLET?(l(),S(ke,{key:0,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:n(A).order,token:n(A).USDT,symbol:"USDT",loading:o.btnLoading,approveAmount:Number(o.order.paySource==n(q).USDT_WALLET?o.order.totalUsdt:0)},null,8,["contract","token","loading","approveAmount"])):m("",!0),o.order.paySource!=n(q).USDT_WALLET?(l(),S(ke,{key:1,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:n(A).order,token:n(A).MCOIN,symbol:"mcoin",loading:o.btnLoading,approveAmount:Number(o.order.paySource===n(q).USDT_WALLET?0:o.order.totalAmount)},null,8,["contract","token","loading","approveAmount"])):m("",!0)])):m("",!0),o.order.paySource==n(q).WITHDRAW_POINTS&&o.voucherPrice&&o.voucherPrice>0?(l(),S(ke,{key:1,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:n(A).order,token:n(A).FMCP,symbol:f.$t("voucher.voucher"),loading:o.btnLoading,approveAmount:Number(o.voucherPrice)},null,8,["contract","token","symbol","loading","approveAmount"])):m("",!0),o.order.hash?m("",!0):(l(),S(s,{key:2,round:"",class:"w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",disabled:o.order.hash,loading:o.continuePayLoading||o.btnLoading,onClick:x[1]||(x[1]=Qe(w=>f.$emit("continuePay"),["stop"]))},{default:z(()=>[e("span",null,i(f.$t("order.continuePay")),1),O(tt,{class:"inline-block ml-1",startTime:o.order.createTime,duration:15,durationType:"minutes",showZero:!1},null,8,["startTime"])]),_:1},8,["disabled","loading"]))])])):m("",!0),n(a)?(l(),S(s,{key:1,round:"",class:"flex-1 border-btn gray-btn font-semibold text-b2 text-base h-[46px] rounded-full",onClick:g,loading:o.btnLoading},{default:z(()=>[L(i(f.$t("order.afterSale")),1)]),_:1},8,["loading"])):m("",!0),n(y).visible?(l(),S(s,{key:2,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",disabled:n(y).disabled,onClick:x[2]||(x[2]=w=>f.$emit("handleForcedRefund")),loading:o.btnLoading},{default:z(()=>[L(i(f.$t("order.forced refund")),1)]),_:1},8,["disabled","loading"])):m("",!0),n(C)?(l(),S(s,{key:3,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:x[3]||(x[3]=w=>f.$emit("handleDelayReceipt")),loading:o.btnLoading},{default:z(()=>[L(i(f.$t("order.confirmGeted")),1)]),_:1},8,["loading"])):m("",!0),n(h)?(l(),S(s,{key:4,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:g,loading:o.btnLoading},{default:z(()=>[L(i(f.$t("order.refund")),1)]),_:1},8,["loading"])):m("",!0)])}}},$n={key:0,class:"p-3 mt-3 break-all bg-white rounded-xl"},Cn={class:"font-semibold text-base text-b1"},kn=e("span",null,"请在",-1),Sn={class:"text-[#FF8812] mx-1"},_n=e("span",null,"内确认收货",-1),An=e("div",{class:"mt-1 font-normal text-sm text-b2"}," 倒计时结束后商家可确认收货 ",-1),Dn={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone"],setup(o,{emit:c}){const v=o,{t:D}=Q(),C=$(Date.now());let h=null;const a=T(()=>{const x=nt(v.order.expressTime,v.order.confirmLimit,v.nowTime);return x>0?x:0}),y=T(()=>a.value>0),g=T(()=>{const x=a.value;if(x<=0)return"00天00时00分00秒";const s=Math.floor(x/(1e3*60*60*24)),w=Math.floor(x%(1e3*60*60*24)/(1e3*60*60)),k=Math.floor(x%(1e3*60*60)/(1e3*60)),F=Math.floor(x%(1e3*60)/1e3);return`${s.toString().padStart(2,"0")}天${w.toString().padStart(2,"0")}时${k.toString().padStart(2,"0")}分${F.toString().padStart(2,"0")}秒`}),f=()=>{C.value=Date.now(),a.value<=0&&h&&(clearInterval(h),h=null,c("timeDone"))};return Z(()=>{f(),a.value>0&&(h=setInterval(f,1e3))}),fe(()=>{h&&(clearInterval(h),h=null)}),(x,s)=>n(y)?(l(),p("div",$n,[e("div",Cn,[kn,e("span",Sn,i(n(g)),1),_n]),An])):m("",!0)}},In={key:0,class:"p-3 break-all bg-white rounded-xl"},Rn={class:"font-semibold text-base text-b1"},Bn=e("span",null,"请在",-1),Fn={class:"text-[#FF8812] mx-1"},Pn=e("span",null,"内确认收货",-1),Ln=e("div",{class:"mt-1 font-normal text-sm text-b2"}," 商家已确认收货，倒计时结束后将自动确认收货 ",-1),Nn={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone","handleDelay"],setup(o,{emit:c}){const v=o,{t:D}=Q(),C=$(Date.now());let h=null;const a=T(()=>{const s=Ae(v.order.merchantsConfirm,v.nowTime);return s>0?s:0}),y=T(()=>a.value>0),g=T(()=>{const s=a.value;if(s<=0)return"00天00时00分00秒";const w=Math.floor(s/(1e3*60*60*24)),k=Math.floor(s%(1e3*60*60*24)/(1e3*60*60)),F=Math.floor(s%(1e3*60*60)/(1e3*60)),N=Math.floor(s%(1e3*60)/1e3);return`${w.toString().padStart(2,"0")}天${k.toString().padStart(2,"0")}时${F.toString().padStart(2,"0")}分${N.toString().padStart(2,"0")}秒`}),f=()=>{C.value=Date.now(),a.value<=0&&h&&(clearInterval(h),h=null,c("timeDone"))},x=()=>{c("handleExtend")};return Z(()=>{f(),a.value>0&&(h=setInterval(f,1e3))}),fe(()=>{h&&(clearInterval(h),h=null)}),(s,w)=>n(y)?(l(),p("div",In,[e("div",Rn,[e("span",null,[Bn,e("span",Fn,i(n(g)),1),Pn]),e("span",{class:"text-sm text-[#FF8812] ml-auto font-normal",onClick:x,role:"button"},"延长收货")]),Ln])):m("",!0)}},On={key:0,class:"p-3 break-all bg-white rounded-xl"},En=e("span",null,"商家已同意请及时寄回商品",-1),jn=e("div",{class:"mt-1 font-normal text-sm text-b2"},[e("span",null,"待商家确认收到退回商品后退款")],-1),Mn={props:{order:{type:Object,required:!0}},emits:["handleExpress"],setup(o,{emit:c}){const v=o,D=T(()=>{const h=v.order||{};return ms(h)}),C=()=>{c("handleExpress")};return(h,a)=>n(D)?(l(),p("div",On,[e("div",{class:"font-semibold text-base text-b1 flex items-center justify-start"},[En,e("span",{class:"text-sm text-[#FF8812] ml-auto font-normal",onClick:C,role:"button"},"退货寄件")]),jn])):m("",!0)}},qn={key:0,class:"p-3 break-all bg-white rounded-xl"},Hn={class:"font-semibold text-base text-b1"},Un={class:"text-b1"},Gn=e("span",{class:"mr-1"},"待商家确认",-1),Vn={class:"text-[#FF8812] mx-1"},Wn=L("商家未确认您可申请强制退款"),Kn=e("span",null,null,-1),zn=e("div",{class:"mt-1 font-normal text-sm text-b2"}," 倒计时结束后商家未确认您可申请强制退款 ",-1),Jn=_e({props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone"],setup(o,{emit:c}){const v=o,{t:D}=Q(),C=$(Date.now());let h=null;const a=T(()=>{const s=nt(v.order.expressTime,v.order.confirmLimit,v.nowTime);return s>0?s*1e3:0}),y=T(()=>a.value>0),g=T(()=>{const s=Ut(a.value).unix();if(s<=0)return"00秒";const w=Math.floor(s/(1e3*60*60*24)),k=Math.floor(s%(1e3*60*60*24)/(1e3*60*60)),F=Math.floor(s%(1e3*60*60)/(1e3*60)),N=Math.floor(s%(1e3*60)/1e3);let W="";return w>0&&(W+=`${w}天`),(k>0||w>0)&&(W+=`${k.toString().padStart(2,"0")}时`),(F>0||k>0||w>0)&&(W+=`${F.toString().padStart(2,"0")}分`),W+=`${N.toString().padStart(2,"0")}秒`,W}),f=()=>{C.value=Date.now(),a.value<=0&&h&&(clearInterval(h),h=null,c("timeDone"))},x=T(()=>{const s=v.order||{},w=v.nowTime||Date.now()/1e3;return ot(s,w).visible});return Z(()=>{f(),a.value>0&&(h=setInterval(f,1e3))}),fe(()=>{h&&(clearInterval(h),h=null)}),(s,w)=>n(x)?(l(),p("div",qn,[e("div",Hn,[e("span",Un,[n(y)?(l(),p(H,{key:0},[Gn,e("span",Vn,i(n(g)),1)],64)):(l(),p(H,{key:1},[Wn],64))]),Kn]),zn])):m("",!0)}}),Zn={key:0,class:"p-3 break-all bg-white rounded-xl"},Qn={class:"font-semibold text-base text-b1 flex items-center justify-start"},Xn=e("span",null,"买家发起平台介入-",-1),Yn=e("div",{class:"mt-1 font-normal text-sm text-b2"},[e("span",null,"待店铺审核人处理")],-1),er=e("span",null,"平台支持售后，请及时寄回商品",-1),tr=e("div",{class:"mt-1 font-normal text-sm text-b2"},[e("span",null,"待商家确认收到退回商品后退款")],-1),sr={class:"font-semibold text-base text-b1 flex items-center justify-start"},or=e("span",null,"请在",-1),nr={class:"text-[#FF8812] mx-1"},rr=e("span",null,"内确认收货",-1),ar=e("div",{class:"mt-1 font-normal text-sm text-b2"},[e("span",null,"倒计时结束后商家可确认收货")],-1),ir={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["handleExpress","handleDelay"],setup(o,{emit:c}){const v=o,D=T(()=>{const s=v.order||{};return fs(s)}),C=$(v.nowTime?v.nowTime*1e3:Date.now());let h=null;const a=T(()=>{var k;if(((k=v.order.refundInfo)==null?void 0:k.interveneStatus)!==3)return 0;const s=Math.floor(C.value/1e3),w=Ae(v.order.merchantsConfirm,s);return w>0?w:0}),y=T(()=>{const s=a.value;if(s<=0)return"00天00时00分00秒";const w=Math.floor(s/(1e3*60*60*24)),k=Math.floor(s%(1e3*60*60*24)/(1e3*60*60)),F=Math.floor(s%(1e3*60*60)/(1e3*60)),N=Math.floor(s%(1e3*60)/1e3);return`${w.toString().padStart(2,"0")}天${k.toString().padStart(2,"0")}时${F.toString().padStart(2,"0")}分${N.toString().padStart(2,"0")}秒`}),g=()=>{C.value=Date.now(),a.value<=0&&h&&(clearInterval(h),h=null)},f=()=>{c("handleExpress")},x=()=>{c("handleDelay")};return Z(()=>{var s;g(),((s=v.order.refundInfo)==null?void 0:s.interveneStatus)===3&&a.value>0&&(h=setInterval(g,1e3))}),fe(()=>{h&&(clearInterval(h),h=null)}),(s,w)=>n(D)?(l(),p("div",Zn,[o.order.refundInfo.interveneStatus==1?(l(),p(H,{key:0},[e("div",Qn,[Xn,e("span",null,i(n(vs)(o.order,!1)||""),1)]),Yn],64)):m("",!0),o.order.refundInfo.interveneStatus==2?(l(),p(H,{key:1},[e("div",{class:"font-semibold text-base text-b1 flex items-center justify-start"},[er,e("span",{class:"text-sm text-[#FF8812] ml-auto font-normal",onClick:f,role:"button"},"退货寄件")]),tr],64)):m("",!0),o.order.refundInfo.interveneStatus==3?(l(),p(H,{key:2},[e("div",sr,[e("span",null,[or,e("span",nr,i(n(y)),1),rr]),e("span",{class:"text-sm text-[#FF8812] ml-auto font-normal",onClick:x,role:"button"},"延长收货")]),ar],64)):m("",!0)])):m("",!0)}},lr={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},ur={class:"font-bold text-base text-b1"},dr={class:"px-3 safe-bottom pt-[50px] flex flex-col gap-3"},cr=_e({props:{nowTime:null},setup(o){const c=o,{getUserDhKey:v,decryptAddressKey:D,decryptKey:C,cryptoAESWithBuyerSearch:h}=zt(),{t:a}=Q(),y=Kt(),g=Vt(),{reloadStore:f}=Jt(),x=g.query.id,s=$(null),[w,k]=E(!1),[F,N]=E(!1),[W,he]=E(!1),[rt,De]=E(!1),Ie=$(null),Re=$(!1),at=t=>{const r=t.target.scrollTop;Re.value=r>25},[it,Be]=E(!1),[lt,Fe]=E(!1),ut=$(null),X=$(0),[dt,re]=E(!1),Pe=$("");$(0);const ye=$(!1),Le=$(0),ae=$(0),Ne=$(0),Oe=$(0),Ee=$(0),[ct,Y]=E(!1);$(!1);const{confirm:je,senderDelay:mt,submit:ft,senderForceCancel:ht}=Zt(),{pointBalances:yt,mcoinRate:vt}=Xe(),{userMerchantCashs:pt,userTotalAmount:xt}=Ss(),ve=$(null),Me=T(()=>ve.value?1/ve.value:1),qe=$(0),He=$([]),G=async()=>{var r,d,u,b,I,_,V,j,M,K,le,ue,ee;const t=await xs({id:x});if((r=t.data)!=null&&r.userAddress&&(t.data.userAddress.postscript=t.data.postscript),(d=t.data)!=null&&d.userAddress&&((b=(u=t.data)==null?void 0:u.userAddress)!=null&&b.encryptFlag)){const R=await v(t.data.stores.id,(I=t.data)==null?void 0:I.submitMerchantPubKey);R&&(t.data.userAddress=D(t.data.userAddress,R))}if((_=t.data)!=null&&_.shippingHash){const R=await v(t.data.stores.id,(V=t.data)==null?void 0:V.shippingMerchantPubKey);if(R){const de=C(t.data.expressNo,R);de.hash===t.data.shippingHash&&(t.data.expressNo=de.decrypt,t.data.expressCompany=C(t.data.expressCompany,R).decrypt)}}if(!((j=t.data)!=null&&j.userEns)&&((M=t.data)!=null&&M.id)&&setTimeout(async()=>{let R=[];R.push(await bt(a)),R.filter(de=>de.userEns),R.length&&bs({enInfoList:R})}),(le=(K=t.data)==null?void 0:K.refundInfo)!=null&&le.shippingHash){const R=await v(t.data.stores.id,(ee=(ue=t.data)==null?void 0:ue.refundInfo)==null?void 0:ee.shippingMerchantPubKey);R&&(t.data.refundInfo.expressNo=C(t.data.refundInfo.expressNo,R).decrypt),R&&(t.data.refundInfo.expressCompany=C(t.data.refundInfo.expressCompany,R).decrypt)}s.value=t.data},bt=async t=>{var r,d,u,b,I,_,V,j,M;try{let le=((M=[(r=t==null?void 0:t.userAddress)==null?void 0:r.postscript,""+(((d=t==null?void 0:t.userAddress)==null?void 0:d.provinceName)||"")+(((u=t==null?void 0:t.userAddress)==null?void 0:u.cityName)||"")+(((b=t==null?void 0:t.userAddress)==null?void 0:b.countyName)||"")+(((I=t==null?void 0:t.userAddress)==null?void 0:I.detailInfo)||""),(_=t==null?void 0:t.userAddress)==null?void 0:_.telNumber,t==null?void 0:t.address,(V=t==null?void 0:t.stores)==null?void 0:V.storeName,(j=t==null?void 0:t.stores)==null?void 0:j.merchant,t==null?void 0:t.expressNo,t==null?void 0:t.expressCompany].filter(ee=>ee||ee===0))==null?void 0:M.join(""))||"",ue=await h(le);return{id:t.id,userEns:ue}}catch{}},wt=async()=>{const t=await ws({page:1,size:999,status:2,type:2});t.success&&(qe.value=t.total,He.value=t.data.filter(r=>(!r.merchantsConfirm||Ae(r.merchantsConfirm,c.nowTime)>0)&&st(r)))},pe=$(1),{tradeContributeSelfRate:gt}=Xe(),Tt=T(()=>{var r;if(!((r=s.value)!=null&&r.orderGoods))return 0;let t=new U(0);return s.value.orderGoods.forEach(d=>{if(+s.value.payType==1&&+d.payType==3||+d.payType!=2&&+d.payType!=3){const u=new U(d.price).times(d.number).minus(d.goodsActivityReduceAmount||0).plus(d.goodsAdjustChangeAmount||0).times(new U(d.discountRatio||0).div(100));t=t.plus(u)}}),t.times(pe.value).toNumber()}),xe=T(()=>{var u;if(!((u=s.value)!=null&&u.orderGoods)||ae.value<=0)return 0;const t=Tt.value||0,r=pe.value;return Math.min(ae.value,new U(t).div(r).times(.5).toNumber())});Z(async()=>{pe.value=await gt()});const $t=async()=>{try{const{balanceOf:t}=se(A.MCOIN),r=await t();Le.value=+r;const d=await se(A.FMCP).balanceOf();ae.value=+d;const u=await se(A.USDT).balanceOf();Ne.value=+u,Oe.value=+await yt(),await kt()}catch(t){console.error("获取余额失败:",t)}},Ct=async()=>{try{ve.value=await vt()}catch(t){console.error("获取汇率失败:",t)}},kt=async()=>{try{const{success:t,result:r}=await pt();if(!t)return;let d=0;const u=+await xt(),b=r.amounts.map(_=>Qt(_));r.cashIds.map(_=>+_).forEach((_,V)=>{_!==0&&(d=+U(d).plus(b[V]||0).toString())}),Ee.value=+U(u).minus(d)}catch(t){console.error("获取余额宝余额失败:",t)}},St=()=>{Fe(!1),G()},_t=t=>{y.push(t)},[Ue,be]=E(!1),[At,we]=E(!1),Ge=async()=>{we(!0)},Dt=async()=>{if(Ue.value)return;be(!0),(await gs({orderId:s.value.id})).success?(B.success(a("common. cancel success")),be(!1),y.go(-1),setTimeout(()=>{y.replace({path:"/buyerOrderList",query:{active:4,type:1}})},50),setTimeout(()=>{location.reload()},100)):be(!1)},ge=async(t,r)=>{try{const{allowance:d}=se(t);return+(await d(r)).result}catch{return 0}},It=async()=>{var t,r,d;try{const u=(t=s.value)==null?void 0:t.paySource,b=(r=s.value)==null?void 0:r.totalAmount,I=Math.max(((d=s.value)==null?void 0:d.voucherAmount)||0,xe.value);if(I&&u==q.WITHDRAW_POINTS&&await ge(A.FMCP,A.order)<xe.value)return B({message:a("common.approve")+a("voucher.voucher"),forbidClick:!0,duration:2e3}),!1;if(u==1){if(Le.value<b)return Y(!0),!1;if(await ge(A.MCOIN,A.order)<b)return B({message:a("common.approve")+"MCOIN",forbidClick:!0,duration:2e3}),!1}else if(u==5){if(Ne.value<b*Me.value)return Y(!0),!1;if(await ge(A.USDT,A.order)<b*Me.value)return B({message:a("common.approve")+"USDT",forbidClick:!0,duration:2e3}),!1}else if(u==4){if(+U(Oe.value).times(.9)<+U(b).minus(I))return Y(!0),!1}else if(u==2&&Ee.value<b)return Y(!0),!1;return!0}catch{return!1}finally{k(!1),P(!1)}},Ve=async()=>{if(await It())try{if(!s.value.id||!s.value.allOrderId){B.fail(a("order.orderIdError")),P(!1);return}P(!0),await G();const r=await Ts({allOrderId:s.value.allOrderId,orderId:s.value.id});if(!r.success){P(!1);return}const{allOrderId:d,merchants:u,discounts:b,amounts:I,sources:_}=r.data;if(s.value.allOrderId=d,!(await $s({allOrderId:s.value.allOrderId})).data){B.fail("有一笔交易正在进行中，请稍候再试"),P(!1);return}const j=await ft(d,u,b,I,_);if(!j.success){Cs({allOrderId:d}),P(!1),await G();return}if(B.loading({message:a("order.wait block chain"),forbidClick:!0,duration:0}),await ks({allOrderId:d,hash:j.result.hash,orderId:s.value.id}),B.clear(),ut.value=j.result.hash,!j.result.hash){P(!1);return}let M;const K=async()=>{if(X.value>=5){P(!1),Fe(!0),X.value=0,await G();return}if(M=await Xt(j.result.hash),(M==null?void 0:M.status)===1){P(!1),Be(!0),X.value=0,setTimeout(()=>{y.go(-1),setTimeout(()=>{y.replace({path:"/buyerOrderList",query:{active:1,type:1}})},50),setTimeout(()=>{location.reload()},100)},1e3);return}setTimeout(async()=>{X.value++,K()},5e3)};K()}catch{P(!1),X.value=0}},We=$(!1),[Rt,P]=E(!1),Ke=async()=>{var r;P(!0),We.value=!0;try{await G()}catch{P(!1);return}if(((r=s.value)==null?void 0:r.status)!==0){B.fail("已支付订单，无需重复支付"),P(!1);return}if(ze()){ye.value=!0,P(!1);return}await Ve()},ie=()=>{G()},Te=async()=>{N(!0)},Bt=async t=>{k(!0);try{const d=(await me({orderIds:t.id})).data.ordIds;if(!(await mt(d)).success)return;t.delayReceiveFlag=!0,t.confirmLimit=c.nowTime+A.datePeriod*10,N(!1),B.success(a("order.delaySuccess")),setTimeout(()=>{f.reload()},3e3)}finally{k(!1)}},Ft=async t=>{var r;k(!0);try{const u=(await me({orderIds:t})).data.ordIds,b=await je(u);if(!b.success||!(await Se({ordIds:u,hash:b.result.hash})).success)return;s.value.status=4,Ie.value.showToastPop(((r=b.result)==null?void 0:r.logs)||[])||(B.success(a("order.confirmSuccess")),y.replace({path:"/buyerOrderList",query:{active:3,type:1}}),setTimeout(()=>{g.params.refresh="1",y.push("/evaluate-my")},2e3))}finally{k(!1)}},Pt=async()=>{qe.value>1?he(!0):Ft(x)},Lt=async t=>{const r=t.join();De(!0);try{const u=(await me({orderIds:r})).data.ordIds,b=await je(u);if(!b.success||!(await Se({ordIds:u,hash:b.result.hash})).success)return;s.value.status=4,he(!1),B.success(a("order.confirmSuccess")),y.replace({path:"/buyerOrderList",query:{active:3,type:1}}),setTimeout(()=>{g.params.refresh="1",y.push("/evaluate-my")},2e3)}finally{De(!1)}},Nt=()=>{var t,r;((t=g.params)==null?void 0:t.quick)==="quickPay"&&Ot(),((r=g.params)==null?void 0:r.quick)==="quickCancel"&&Et()},Ot=()=>{B.loading({message:a("order.continuePay"),forbidClick:!0,duration:2e3}),Ke()},Et=()=>{Ge()},jt=()=>{re(!1),ye.value&&(ye.value=!1,Ve())},ze=()=>{var b,I;if(!((b=s.value)!=null&&b.id))return!1;const t="orderMerchantAdjustMap";let r={};try{r=JSON.parse(localStorage.getItem(t)||"{}")}catch{r={}}const d=r[s.value.id],u=(I=s.value)==null?void 0:I.merchantAdjustAmount;return u&&(d===void 0||d!==String(u))?(sessionStorage.setItem("refreshOrderID",s.value.id.toString()),Pe.value="订单金额发生变动，请留意订单信息变化",re(!0),r[s.value.id]=String(u),localStorage.setItem(t,JSON.stringify(r)),!0):!1},Je=async()=>{if(!ps(s.value,"USER_RETURN_GOODS","visible")){B.fail("您没有权限退货寄回");return}y.push({path:"/refundExpress",query:{id:s.value.id}})},[Mt,Ze]=E(!1),qt=async()=>{Ze(!0);try{const r=(await me({orderIds:s.value.id+""})).data.ordIds,d=await ht(r[0]);if(!d.success||!(await Se({ordIds:r,hash:d.result.transactionHash})).success)return}catch(t){B(t.message||t)}finally{Ze(!1),await G()}};return Z(async()=>{var t,r,d,u;if(((t=g.params)==null?void 0:t.quick)==="quickPay"&&(B.loading({message:a("order.continuePay"),forbidClick:!0,duration:6e3}),P(!0)),wt(),await G(),await $t(),await Ct(),((r=s.value)==null?void 0:r.paySource)==q.WITHDRAW_POINTS){const b=await se(A.FMCP).balanceOf();ae.value=+b}((d=s.value)==null?void 0:d.status)===0&&!((u=g.params)!=null&&u.quick)&&ze(),Nt()}),(t,r)=>{var d;return s.value?(l(),p("div",{key:0,class:"app-container font-Puhui main-bg safe-bottom-page",onScroll:at},[e("section",{class:Wt(["header-bar fixed top-0 left-0 right-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 backdrop-blur-md transition-all duration-300",{"bg-white":Re.value}])},[e("div",lr,[O(ys)]),e("div",ur,[e("span",null,i(t.$t("order.orderDetail")),1)])],2),e("section",dr,[O(ir,{order:s.value,nowTime:o.nowTime,onHandleExpress:Je,onHandleDelay:Te},null,8,["order","nowTime"]),O(Mn,{order:s.value,onHandleExpress:Je},null,8,["order"]),O(Jn,{order:s.value,nowTime:o.nowTime,onTimeDone:ie},null,8,["order","nowTime"]),s.value.status===2?(l(),S(Dn,{key:0,order:s.value,nowTime:o.nowTime,onTimeDone:ie},null,8,["order","nowTime"])):m("",!0),s.value.status===2?(l(),S(Nn,{key:1,order:s.value,nowTime:o.nowTime,onTimeDone:ie,onHandleDelay:Te},null,8,["order","nowTime"])):m("",!0),s.value.status===0&&!s.value.hash?(l(),S(Es,{key:2,order:s.value,onTimeDone:ie},null,8,["order"])):m("",!0),s.value.userAddress?(l(),S(Rs,{key:3,order:s.value,showCopy:!1},null,8,["order"])):m("",!0),O(Yt,{order:s.value,"show-price":!1,"show-shipping-template":!0},null,8,["order"]),s.value.status===0?(l(),S(Ye,{key:4,order:s.value,isBuyer:""},null,8,["order"])):m("",!0),s.value.status===0&&!s.value.hash?(l(),S(es,{key:5,order:s.value,isBuyer:""},null,8,["order"])):m("",!0),s.value.status!==0||s.value.hash?(l(),S(vn,{key:6,order:s.value},null,8,["order"])):m("",!0),s.value.status!==0?(l(),S(Ye,{key:7,order:s.value,isBuyer:""},null,8,["order"])):m("",!0),s.value.id&&s.value.status===0?(l(),S(ts,{key:8,order:s.value},null,8,["order"])):m("",!0),s.value.status==0&&s.value.hash?m("",!0):(l(),S(Tn,{key:9,voucherPrice:n(xe),order:s.value,btnLoading:n(w),cancelLoading:n(Ue),continuePayLoading:n(Rt),nowTime:o.nowTime,forceCancelLoading:n(Mt),onHandleDelay:Te,onHandleDelayReceipt:Pt,onHandleTo:_t,onCancelOrder:Ge,onContinuePay:Ke,onHandleForcedRefund:qt},null,8,["voucherPrice","order","btnLoading","cancelLoading","continuePayLoading","nowTime","forceCancelLoading"]))]),O(Ce,{show:n(F),title:t.$t("order.delayConfirm"),content:t.$t("order.delayTips"),showConfirm:!0,showReject:!0,confirmText:"确定",rejectText:"取消",noClose:"",onClose:r[0]||(r[0]=u=>n(N)(!1)),onReject:r[1]||(r[1]=u=>n(N)(!1)),onConfirm:r[2]||(r[2]=u=>Bt(s.value))},null,8,["show","title","content"]),O(ss,{loading:n(rt),show:n(W),list:He.value,currentId:+n(x),onClose:r[3]||(r[3]=u=>n(he)(!1)),onReceipt:Lt},null,8,["loading","show","list","currentId"]),O(os,{ref:(u,b)=>{b.voucherConfirmRef=u,Ie.value=u},onReload:r[4]||(r[4]=u=>n(f).reload()),onHandleTo:r[5]||(r[5]=()=>{n(y).push("/voucher?active=1")})},null,512),n(it)?(l(),S(et,{key:0,onClose:r[6]||(r[6]=u=>n(Be)(!1)),text:t.$t("common.pay success")},null,8,["text"])):m("",!0),n(lt)?(l(),S(et,{key:1,isError:!0,onClose:St,text:t.$t("order.fail")},null,8,["text"])):m("",!0),O(hs,{paySource:+((d=s.value)==null?void 0:d.paySource),show:n(ct),onClose:r[7]||(r[7]=u=>n(Y)(!1))},null,8,["paySource","show"]),O(Ce,{show:n(dt),title:t.$t("common.tip"),content:Pe.value,showConfirm:!0,showReject:We.value,confirmText:"确定",noClose:"",onClose:r[8]||(r[8]=u=>n(re)(!1)),onConfirm:jt,onReject:r[9]||(r[9]=u=>n(re)(!1))},null,8,["show","title","content","showReject"]),O(Ce,{show:n(At),title:t.$t("order.cancelOrder"),content:t.$t("order.cancelOrderTips"),showConfirm:!0,showReject:!0,confirmText:"确定",noClose:"",onClose:r[10]||(r[10]=u=>n(we)(!1)),onConfirm:Dt,onReject:r[11]||(r[11]=u=>n(we)(!1))},null,8,["show","title","content"])],32)):m("",!0)}}}),jr=Gt(cr,[["__scopeId","data-v-f74734a6"]]);export{jr as default};

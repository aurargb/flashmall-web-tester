import{_ as ve,a as Y,G as fe,S as pe,b as ge,c as he,d as Ie,e as ye}from"./ShareGoodPopup-Lt5NrG2B.js";import{y as E,bf as xe,x as b,z as J,F as I,G as i,P as l,I as X,H as n,Q as w,a1 as j,J as we,K as N,bs as _e,_ as K,a2 as Q,X as x,a4 as q,Z as W,$ as Z,l as Se,w as be,be as $e,r as S,D as Ne,bj as Te,by as Ce,O as R,R as ke,T as De,n as Be}from"./vendor-BlU_hoYl.js";import{aE as Ae,e as ee,h as Fe,W as te,aF as Le,r as Ee,Y as Pe,X as Ge}from"./index-Clz0Qna-.js";import{u as ae}from"./useCityMap-L2xSDWSa.js";import{G as qe,_ as Re}from"./GivePointsLable-DaN3ty1D.js";import{R as Oe}from"./RemovedShelves-D9xIciHL.js";import{S as je}from"./shop-CeqcS6K2.js";import{O as He}from"./offlineGoods-DvT2Go6q.js";import{D as O}from"./goods-BVwS8oFG.js";import"./avatarRing-CLGxkH-F.js";import"./shop-arrow-right-BMae5SG7.js";import"./BoutiqueLabelInLogo-BBB_wfVh.js";import"./RatioBox-CfBlBgLi.js";import"./kefu-DRX49rvc.js";import"./goods-lQayGTeI.js";import"./convertToImage-B2yuKPNR.js";import"./browser-DFlSdkZC.js";import"./upload-Bd5o3h4D.js";import"./active_empty-OYjsVrLW.js";import"./HelpPop-B80flZ_3.js";import"./MCOIN-Bodfn-v1.js";import"./enums-DlE-aiss.js";import"./logo-D1FnEJzd.js";import"./flashSale-DDyqLyYN.js";import"./BackIcon-8hcEjDKb.js";const Me={class:"relative mb-3 w-full flex justify-between items-center"},ze={class:"text-base font-semibold text-b1 text-left"},Ue={class:"text-xs text-b3 font-normal flex justify-center items-center"},Ve=n("img",{src:Y,class:"w-3 h-3",alt:""},null,-1),Xe={key:1,class:"text-base font-semibold text-b1 text-left"},Ye=E({props:{goodsId:null},emits:["handleTo"],setup(s,{emit:p}){const f=s,c=xe({commentList:[],total:0}),d=b(()=>Number(c.total)>100?100:c.total),_=async()=>{const r=await Ae({goodsId:f.goodsId,page:1,size:1,commentStatus:1,sortBy:"desc|comment_time"});r.success&&(c.commentList=r.data.records||[],c.total=r.data.total)},T=b(()=>{if(c.commentList&&c.commentList.length>0){const r=[];for(let u=0;u<c.commentList.length;u++)c.commentList[u].commentPics&&c.commentList[u].commentPics.length>0&&r.push(...c.commentList[u].commentPics.split(","));return r}return[]}),C=r=>{const u=T.value.findIndex(m=>m===r);_e({images:T.value,closeable:!0,showIndex:!0,startPosition:u})};return J(()=>f.goodsId,()=>{_()},{immediate:!0}),(r,u)=>(i(),I("div",{class:"px-4 py-3 mt-2 bg-white text-base",onClick:u[0]||(u[0]=m=>p("handleTo",`/offline-evaluate-home?goodsId=${s.goodsId}`))},[l(c).commentList.length>0?(i(),I(X,{key:0},[n("div",Me,[n("div",ze,w(r.$t("evaluate.Buyer Reviews"))+"（"+w(l(d))+"） ",1),n("div",Ue,[j(w(r.$t("common.all"))+" ",1),Ve])]),(i(!0),I(X,null,we(l(c).commentList,(m,t)=>(i(),N(ve,{onImgPre:C,key:m.id,data:m,isOffline:""},null,8,["data"]))),128))],64)):(i(),I("div",Xe,w(r.$t("evaluate.Buyer Reviews none")),1))]))}}),oe=s=>(W("data-v-36f9cd59"),s=s(),Z(),s),Je={class:"px-4 py-3 mt-2 bg-white text-base"},Ke={class:"relative mb-3 w-full flex justify-start items-center"},Qe={class:"text-base text-b1 font-semibold text-left"},We=["onClick"],Ze=oe(()=>n("img",{src:Y,class:"w-3 h-3",alt:""},null,-1)),et={key:0,class:"w-full h-full map-texture-bg flex items-center justify-between p-2"},tt={class:"text-xs text-[#2E2008] leading-[18px] font-semibold"},at={class:"mt-1 text-xs text-[#585654] leading-[18px] line-clamp-1"},ot={key:0,class:"mr-1"},st=["src"],rt=oe(()=>n("div",{class:"mt-[1px] text-xs text-[#585654] leading-[18px]"},"复制",-1)),lt=E({props:{store:null,goods:null,storeTitle:null},emits:["handleTo","toStorefrontDetail"],setup(s,{emit:p}){const f=s,c=Q(),{cityMapStore:d}=ee(),{distanceFormat:_}=ae(),T=()=>{const C=c.path.replace("offlineGoodsDetail","availableStores");p("handleTo",`${C}?goodsId=${f.goods.goodsId}`+(f.store.storeId?`&storeId=${f.store.storeId}`:""))};return(C,r)=>{var u,m,t,v,g,A,F;return i(),I("div",Je,[n("div",Ke,[n("div",Qe,w(s.storeTitle),1),+s.store.storeCount>0?(i(),I("div",{key:0,class:"absolute right-0 top-0 text-xs leading-[18px] text-b3 flex justify-center items-center",onClick:q(T,["stop"])},[j(w(s.store.storeCount)+"店可用 ",1),Ze],8,We)):x("",!0)]),n("div",{class:"map-texture w-full h-fit rounded-lg overflow-hidden mt-3",onClick:r[1]||(r[1]=q(P=>p("toStorefrontDetail"),["stop"]))},[(u=s.store)!=null&&u.storeAddress?(i(),I("div",et,[n("div",null,[n("p",tt,w((m=s.store)==null?void 0:m.storeName),1),n("div",at,[(t=s.store)!=null&&t.distance&&((v=l(d).locationCoords)!=null&&v.lat)&&((g=l(d).locationCoords)!=null&&g.lng)?(i(),I("span",ot,w(l(_)(((A=s.store)==null?void 0:A.distance)||0,2,999,"距您直线")),1)):x("",!0),j(w((F=s.store)==null?void 0:F.storeAddress),1)])]),n("div",{class:"shrink-0 flex flex-col items-center",onClick:r[0]||(r[0]=q(P=>{var k;return l(Fe)((k=s.store)==null?void 0:k.storeAddress)},["stop"]))},[n("img",{class:"w-4 h-4",src:l(te)("cityMap/copy.svg"),alt:""},null,8,st),rt])])):x("",!0)])])}}}),nt=K(lt,[["__scopeId","data-v-36f9cd59"]]),se=s=>(W("data-v-6821f95c"),s=s(),Z(),s),dt={class:"relative w-full h-full !bg-[#F6F6F5] detail-page font-Puhui detail__wrap"},it={key:0},ct=se(()=>n("img",{class:"w-8 h-8",src:Ie},null,-1)),ut=[ct],mt=se(()=>n("img",{class:"w-8 h-8",src:ye},null,-1)),vt=[mt],ft={class:"pb-[calc(76px+8px-12px)] -translate-y-3 bg-[#F6F6F5]"},pt=E({name:"GoodsDetail"});function gt(s){const p=Q(),f=Se(),{orderGoodsStore:c,cityMapStore:d}=ee(),{loadingToggle:_}=Ee(),{getUserLocation:T}=ae(),{t:C}=be(),[r,u]=$e(!1),m=b(()=>{var a;return(a=p.query)!=null&&a.child?document.querySelector(".detail-page"):document.getElementById("fm-page")}),t=S(null),v=S(null),g=S({}),A=b(()=>h.value?"当前门店":"最近门店"),F=b(()=>{var a;return h.value==((a=t.value)==null?void 0:a.recentStoreId)}),P=S(!1),k=S(p.query.goodsId),h=b(()=>p.query.storeId),re=b(()=>window.location.origin+`/#/offlineGoodsDetail?goodsId=${k.value}`+(h.value?`&storeId=${h.value}`:"")),H=async()=>{var y,$,U,V;const a=k.value;if(a==null||a==="")return;let o={id:a,longitude:((y=d.locationCoords)==null?void 0:y.lng)||(($=d.currentActiveCity)==null?void 0:$.areaLongitude),latitude:((U=d.locationCoords)==null?void 0:U.lat)||((V=d.currentActiveCity)==null?void 0:V.areaLatitude)};h.value&&(o.storeId=h.value);const e=await Pe(o);t.value=e.data,t.value.icons=t.value.goodsIcons,t.value.type=t.value.goodsType,t.value.deliveryType=O.offeline,t.value.price=t.value.goodsPrice,!h.value||F.value?g.value={storeId:e.data.recentStoreId,storeName:e.data.recentStoreName,storeAddress:e.data.recentStoreAddress,areaExtName1:e.data.recentAreaExtName1,areaExtName2:e.data.recentAreaExtName2,areaExtName3:e.data.recentAreaExtName3,areaId1:e.data.recentAreaId1,areaId2:e.data.recentAreaId2,areaId3:e.data.recentAreaId3,areaName1:e.data.recentAreaName1,areaName2:e.data.recentAreaName2,areaName3:e.data.recentAreaName3,areaPath:e.data.recentAreaPath,distance:e.data.recentDistance,storeCount:e.data.storeCount,storeBrandId:e.data.storeBrandId,storeBrandName:e.data.storeBrandName,storeBrandIcon:e.data.storeBrandIcon}:g.value={storeId:e.data.storeId,storeName:e.data.storeName,storeAddress:e.data.storeAddress,areaExtName1:e.data.areaExtName1,areaExtName2:e.data.areaExtName2,areaExtName3:e.data.areaExtName3,areaId1:e.data.areaId1,areaId2:e.data.areaId2,areaId3:e.data.areaId3,areaName1:e.data.areaName1,areaName2:e.data.areaName2,areaName3:e.data.areaName3,areaPath:e.data.areaPath,distance:e.data.distance,storeCount:e.data.storeCount,storeBrandId:e.data.storeBrandId,storeBrandName:e.data.storeBrandName,storeBrandIcon:e.data.storeBrandIcon}},M=async()=>{var e;if(!((e=t.value)!=null&&e.shopId))return;const{success:a,data:o}=await Ge(t.value.shopId);a&&(v.value=o)},D=S(null),B=a=>{f.push(a)},le=()=>{var e;const a=p.path.replace("offlineGoodsDetail","storefront"),o={storeId:h.value||((e=g.value)==null?void 0:e.storeId),child:"1"};f.push({path:a,query:o})},ne=()=>{De({message:C("common.Saved successfully"),icon:te("toast-success.svg"),duration:3e3})},de=()=>{try{window.history.state.back?f.back():window.history.length>2?window.history.back():f.replace({path:"/mall"})}catch{f.push("/")}},ie=()=>{var o,e;c.changeOfflineInfo({goods:t.value,shop:v.value});let a=`/offlineSubmit?key=${k.value}&orderType=${He.GOODS}`;(h.value||(o=g.value)!=null&&o.storeId)&&(a+=`&storeId=${h.value||((e=g.value)==null?void 0:e.storeId)}`),B(a)},z=S(0);let L=S(!0);const G=Ce(()=>{z.value=m.value.scrollY||m.value.scrollTop,z.value<100?(L.value=!1,D.value&&D.value.resumeSwiper()):(L.value=!0,D.value&&D.value.pauseSwiper())},100),ce=()=>{m.value.addEventListener("scroll",G),G()},ue=async()=>{var a,o;if(d.availableStore){let e={goodsId:p.query.goodsId,storeId:(a=d.availableStore)==null?void 0:a.storeId};(o=p.query)!=null&&o.child&&(e.child="1"),d.setSelectedAvailableStore(null),f.replace({path:p.path,query:e}),setTimeout(async()=>{_(!0),await H(),await M(),_(!1)},50);return}_(!0),await H(),await M(),_(!1)},me=b(()=>{var a,o,e;return{longitude:d.locationCoords.lng||((a=d.currentActiveCity)==null?void 0:a.areaLongitude)||null,latitude:d.locationCoords.lat||((o=d.currentActiveCity)==null?void 0:o.areaLatitude)||null,areaIdPreviousLastLeaf:((e=d.currentActiveCity)==null?void 0:e.areaId)||""}});return J(()=>me.value,async(a,o)=>{a!=null&&a.areaIdPreviousLastLeaf&&(await Be(),ue())},{immediate:!0,deep:!0}),Ne(async()=>{d.currentActiveCity||await T(),ce()}),Te(()=>{m.value&&m.value.removeEventListener("scroll",G)}),(a,o)=>{var e;return i(),I("div",dt,[t.value&&v.value&&+t.value.goodsStatus==1&&+v.value.status!=3&&+v.value.status!=4&&+v.value.status!=0?(i(),I("div",it,[n("header",{class:ke(["flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[50px] px-3 py-[9px] fixed transition-all duration-200",{"bg-white":l(L)," bg-black/0":!l(L)}])},[n("div",{class:"flex flex-wrap items-center",onClick:de},ut),n("div",{onClick:o[0]||(o[0]=y=>l(u)(!0))},vt)],2),R(qe,{ref:(y,$)=>{$.goodsImgRef=y,D.value=y},imgs:(t.value.goodsIcons||"").split(","),goodsTypes:l(O).offeline},null,8,["imgs","goodsTypes"]),R(fe,{shops:v.value,goods:t.value,discountRatio:t.value.goodsDiscountRatio,class:"relative z-10"},null,8,["shops","goods","discountRatio"]),n("div",ft,[R(Ye,{onHandleTo:B,goodsId:t.value.goodsId},null,8,["goodsId"]),v.value.id?(i(),N(pe,{key:0,shop:v.value,onHandleTo:B},null,8,["shop"])):x("",!0),(e=g.value)!=null&&e.storeId?(i(),N(nt,{key:1,store:g.value,goods:t.value,storeTitle:l(A),onHandleTo:B,onToStorefrontDetail:le},null,8,["store","goods","storeTitle"])):x("",!0),t.value.goodsDesc||t.value.goodsPics?(i(),N(Re,{key:2,text:t.value.goodsDesc,imgs:t.value.goodsPics?t.value.goodsPics.split(","):[]},null,8,["text","imgs"])):x("",!0)]),t.value.goodsId?(i(),N(ge,{key:0,goods:t.value,goodsId:t.value.goodsId,boutiqueFlag:t.value.goodsType>=l(je).SD,isFollow:P.value,deliveryType:l(O).offeline,shop:v.value,onHandleConnect:o[1]||(o[1]=y=>{var $;return B(`/shopInfo?address=${($=v.value)==null?void 0:$.merchant}`)}),onHandleOffine:o[2]||(o[2]=y=>ie())},null,8,["goods","goodsId","boutiqueFlag","isFollow","deliveryType","shop"])):x("",!0)])):t.value&&!l(Le)?(i(),N(Oe,{key:1,type:"good"})):x("",!0),l(r)?(i(),N(he,{key:2,show:l(r),onOnSuceess:ne,onClose:o[3]||(o[3]=y=>l(u)(!1)),goods:t.value,"code-url":l(re)},null,8,["show","goods","code-url"])):x("",!0)])}}const ht=E({...pt,setup:gt}),Mt=K(ht,[["__scopeId","data-v-6821f95c"]]);export{Mt as default};

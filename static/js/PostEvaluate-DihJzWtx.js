import{_ as $,y as F,w as U,a2 as z,l as D,r as c,z as R,E as m,F as x,X as T,G as b,O as l,H as t,I as P,J as A,Q as p,N as w,Y as G,P as N,T as r}from"./vendor-BlU_hoYl.js";import{_ as q}from"./GoodInfo-DSQBiii_.js";import{g as O,aa as H,ab as Y,a3 as j,q as J,W as C}from"./index-Clz0Qna-.js";import{_ as M}from"./EvalHeader-DJqjKwds.js";import{u as Q}from"./upload-Bd5o3h4D.js";import{s as W,g as X}from"./order-oH4Sz-Mc.js";import"./GoodsPrice-BNTIqb2J.js";import"./MCOIN-Bodfn-v1.js";import"./CardPrice-CwWzcSMy.js";import"./order-H59PKTFP.js";import"./BackIcon-8hcEjDKb.js";const K={key:0,class:"px-2.5 font-normal text-black"},Z={class:"mt-4 text-base font-normal bg-white rounded-xl"},ee={class:"flex items-center px-2.5 pt-2.5"},te={class:"mr-1"},ae={class:"flex items-center p-2.5 border-b border-solid border-[#F6F6F5]"},oe={class:"mr-1"},se={class:"p-2.5"},ne={class:"rounded-xl bg-[#F6F6F5]"},le={class:"mt-4 text-base font-normal bg-white px-2.5 pt-[14px] rounded-xl"},re={class:""},ie={class:"mr-[8px] mb-[8px] w-full h-full"},de=["src"],ue={class:"mt-1 text-xs font-light text-center text-default"},ce={class:"flex justify-center pb-10 mt-10"},me={class:"text-base"},pe=F({name:"EvaluatePost"});function ve(_e){const{t:L}=U(),v=z(),f=D(),S=c(null),_=c(!1),i=c(null),V=async()=>{_.value=!0;const e=await X({orderId:S.value});e.success&&(_.value=!1,e.data.dataList=e.data.dataList.map(a=>a.commentStatus===1?{...a,commentStar:5,commentShopStar:5,imgList:[]}:{...a,imgList:[]}),i.value=e.data,i.value.dataList[0].commentStatus===2&&setTimeout(()=>{y("您已对该订单完成评价，无需重复操作"),setTimeout(()=>{f.back()},2e3)},50))},y=(e="",a="toast-warn.svg")=>{r({message:e,icon:C(a),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})},I=async(e,a)=>{const s=H(e.file);if(!s.valid)return a.imgList.length-=1,r(s.tips);const d=Y(e.file);if(!d.valid)return a.imgList.length-=1,r(d.tips);const g=await j(e,"goodsImg"),u=await Q(g);if(!u.success)return r("图片上传失败"),a.imgList.length-=1;a.imgList[a.imgList.length-1]={url:J.imgUrl+u.data}},h=c(!1),E=async()=>{const e=i.value.dataList.map(s=>({orderGoodsId:s.id,commentContent:s.commentContent,commentStar:s.commentStar,commentShopStar:s.commentShopStar,commentImages:s.imgList.map(d=>d.url).join(",")}));h.value=!0;const a=await W({dataList:e});h.value=!1,a.success&&(r.setDefaultOptions({forbidClick:!0}),r({message:L("evaluate.Evaluation success"),icon:C("toast-success.svg"),duration:2e3}),setTimeout(()=>{v.params.refresh="1",f.back()},2e3))},k=e=>{f.push(e)};return R(()=>v.query.orderId,e=>{v.path==="/evaluate-post"&&e&&(S.value=e,V(),r.setDefaultOptions({forbidClick:!0}))},{deep:!0,immediate:!0}),(e,a)=>{const s=m("van-rate"),d=m("van-field"),g=m("van-uploader"),u=m("VanButton");return i.value?(b(),x("div",K,[l(M,{title:e.$t("evaluate.Post a review")},null,8,["title"]),(b(!0),x(P,null,A(i.value.dataList,(o,B)=>(b(),x("div",{class:"mb-8",key:B},[l(q,{orderGoodInfo:o,order:i.value.order,onHandleTo:k},null,8,["orderGoodInfo","order"]),t("div",Z,[t("div",ee,[t("span",te,p(e.$t("evaluate.Product Rating")),1),l(s,{modelValue:o.commentStar,"onUpdate:modelValue":n=>o.commentStar=n,size:20,color:"#FEA021"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",ae,[t("span",oe,p(e.$t("evaluate.Store Rating")),1),l(s,{modelValue:o.commentShopStar,"onUpdate:modelValue":n=>o.commentShopStar=n,size:20,color:"#FEA021"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",se,[t("div",ne,[l(d,{maxlength:"200",modelValue:o.commentContent,"onUpdate:modelValue":n=>o.commentContent=n,rows:"8",autosize:"",label:"",type:"textarea","show-word-limit":"",placeholder:o.commentStar<3&&o.commentStar>0?e.$t("evaluate.help merchants improve"):e.$t("evaluate.praise")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])]),t("div",le,[t("div",re,[l(g,{modelValue:o.imgList,"onUpdate:modelValue":n=>o.imgList=n,accept:"image/*","max-count":3,"preview-size":"100%",afterRead:n=>{I(n,o)}},{default:w(()=>[t("div",ie,[t("div",{style:G(o.imgList.length==0?"height: 100px;width: 100px":""),class:"flex flex-col items-center justify-center w-full h-full text-center text-black border border-dashed border-black-400"},[t("img",{src:N(O)("images/addPic.png"),class:"w-[50px] h-[50px]"},null,8,de),t("div",ue,p(o.imgList.length==2?e.$t("evaluate.You can also add one"):e.$t("common.add img")),1)],4)])]),_:2},1032,["modelValue","onUpdate:modelValue","afterRead"])])])]))),128)),t("div",ce,[l(u,{loading:h.value,onClick:E,disabled:_.value,round:"",class:"h-10 min-w-[180px] px-5 font-semibold text-white btn-linear-primary"},{default:w(()=>[t("span",me,p(e.$t("evaluate.Post a review")),1)]),_:1},8,["loading","disabled"])])])):T("",!0)}}const fe=F({...pe,setup:ve}),Ie=$(fe,[["__scopeId","data-v-6c6a78e2"]]);export{Ie as default};

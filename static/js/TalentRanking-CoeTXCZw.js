import{_ as K,y as q,r as u,be as M,D as oe,E as D,F as x,G as i,H as l,O as k,N as A,K as B,P as a,I as se,a4 as E,Q as T,w as Be,$ as Ae,o as H,Y as fe,Z as me,J as ge,R as O,a2 as z,l as Ee,U as Me,x as ee,bz as Ne,br as ze,X as Ue}from"./vendor-Ba70TIw4.js";import{N as qe}from"./NoRanking-Cm63JCbs.js";import{R as we,_ as Ye,a as je}from"./RankingShopItem-Btt0OVA9.js";import{u as Qe,T as He,g as ve,b as Oe,bp as he,W as Ke,C as We}from"./index-Bsb9uxb4.js";import{q as te,a as Ge,b as Je}from"./beiRanking-tv2uu_jO.js";import{q as Xe}from"./user-BLLKodgI.js";import{b as _e}from"./beiExtRewardContract-CupycHP6.js";import{_ as Ze}from"./calendar-yellow-Dx3USFLv.js";import{S as et}from"./ShopVotePop-ByikDSoK.js";import{V as tt}from"./VoteRewardPop-D9G1UZB2.js";import{C as ot}from"./CommonVanProvider-CqQk6UpZ.js";import{B as st}from"./BackIcon-DkqwcD_b.js";import"./Lottie_v2-CV1u9nMf.js";import"./member-BZWba7V1.js";import"./SkewCard-DeGtIyUY.js";import"./shop-CeqcS6K2.js";import"./beiConstContract-BV9J705g.js";const nt=""+new URL("../images/house-DNyMjcNF.png",import.meta.url).href,at=""+new URL("../images/store_title-D2qn3MNS.png",import.meta.url).href,lt=""+new URL("../images/search-line-DiUN1tEO.svg",import.meta.url).href,rt=""+new URL("../images/cat-ip-rRx8dUh9.png",import.meta.url).href,ut=["onClick"],it={class:"box-bg"},ct=["onClick"],pt=q({props:{month:null},emits:["toApply","toApplyShop","toQuit"],setup(v,{expose:w,emit:h}){const{voteMonthTimestampView:L}=_e(),P=Qe().getCurrentAccount(),e=u(null),f=u(null),m=()=>{var p,s;(p=e.value)!=null&&p.id&&((s=e.value)==null?void 0:s.status)===1?h("toApply"):h("toApplyShop")},[_,y]=M(!0),g=async()=>{y(!0);const{success:p,data:s}=await He();if(!p||(s==null?void 0:s.status)!==1){if(e.value={...s,status:0,shopAddress:P},!e.value.storeName){const{success:$,data:c}=await Xe();$&&(c!=null&&c.nickName)&&(e.value.storeName=c==null?void 0:c.nickName)}y(!1);return}e.value=s,e.value.shopAddress=s==null?void 0:s.merchant,e.value.shopId=s==null?void 0:s.id,b()},b=async()=>{var c,d,r;if(!((c=e.value)!=null&&c.shopId))return;y(!0);const{result:p}=await L(),{success:s,data:$}=await te({shopId:(d=e.value)==null?void 0:d.shopId,month:+p.thisMonthTime});y(!1),!(!s||!$)&&(f.value=$,((r=f.value)==null?void 0:r.status)!==1&&(f.value.sort=null))};return oe(()=>{g()}),w({getRankingInfo:b}),(p,s)=>{var c;const $=D("VanLoading");return i(),x("div",{class:"fixed bottom-0 w-full sm:w-[375px] mx-auto",onClick:E(m,["stop"])},[l("div",it,[k(we,{rankItem:f.value||e.value,hideScore:((c=f.value)==null?void 0:c.status)!==1,showPower:!0,class:"pl-4 pr-5"},{right:A(()=>{var d,r,N,C;return[a(_)?(i(),B($,{key:0,size:"20"})):(i(),x(se,{key:1},[((d=e.value)==null?void 0:d.status)===1&&((r=f.value)==null?void 0:r.status)===1?(i(),x("div",{key:0,class:"bg-[#FFF8EC] text-[#7D3619] font-semibold rounded-md px-3 py-1.5 min-w-[52px]",onClick:s[0]||(s[0]=E(S=>h("toQuit"),["stop"]))},T(p.$t("ranking.Exit list")),1)):(i(),x("div",{key:1,class:"btn-linear text-b6 font-semibold px-3 py-1.5 min-w-[52px]",onClick:E(m,["stop"])},T((N=e.value)!=null&&N.id&&((C=e.value)==null?void 0:C.status)===1?p.$t("ranking.Go and apply"):p.$t("shop.applyShop")),9,ct))],64))]}),_:1},8,["rankItem","hideScore"])])],8,ut)}}}),dt=K(pt,[["__scopeId","data-v-481becc4"]]),vt=v=>(fe("data-v-1ed5e45f"),v=v(),me(),v),ht=vt(()=>l("img",{class:"w-4 h-4",src:Ze,alt:""},null,-1)),ft={key:0},mt={key:1},gt={class:"flex items-end px-5 py-4 text-sm"},wt=q({props:{pageType:null},emits:["changeTime"],setup(v,{emit:w}){const h=v,{t:L}=Be(),[P,e]=M(!1),{voteMonthTimestampView:f}=_e(),m=u(),_=u(new Date),y=u(new Date),g=u(""),b=u(""),p=()=>{m.value=_.value,b.value=H(m.value).format("MM"),g.value=H(m.value).format("YYYY"),e(!1),w("changeTime",{years:g.value,cycle:b.value})},s=async()=>{const{result:d}=await f();_.value=new Date(+d.thisMonthTime*1e3),b.value=H(_.value).format("MM"),g.value=H(_.value).format("YYYY")},$=()=>{m.value=null,_.value=y.value,b.value="",g.value="",e(!1),w("changeTime",{years:1e4})},c=(d,r)=>d==="month"?`${r}${L("common.month")}`:r;return oe(async()=>{h.pageType!=="record"&&await s(),g.value&&w("changeTime",{years:g.value,cycle:b.value})}),(d,r)=>{const N=D("van-datetime-picker"),C=D("van-popup");return i(),x("div",{class:"text-[#4D2E0F] font-semibold flex flex-shrink-0 pl-1.5 pr-2 items-center gap-0.5 h-7 bg-[#FFF8EC] rounded-3xl",onClick:r[3]||(r[3]=S=>a(e)(!0))},[ht,g.value&&b.value?(i(),x("span",ft,T(g.value+"-"+b.value),1)):(i(),x("span",mt,T(d.$t("ranking.overall_ranking")),1)),k(C,{round:"",teleport:"body",show:a(P),"onUpdate:show":r[2]||(r[2]=S=>Ae(P)?P.value=S:null),position:"bottom",style:{height:"40%"}},{default:A(()=>[l("div",gt,[l("div",{class:"opacity-50",onClick:$},T(d.$t("ranking.overall_ranking")),1),l("div",{class:"ml-auto text-[#FEA021] text-sm",onClick:r[0]||(r[0]=S=>p())},T(d.$t("common.confirm")),1)]),k(N,{"swipe-duration":"200",modelValue:_.value,"onUpdate:modelValue":r[1]||(r[1]=S=>_.value=S),type:"year-month",title:"","max-date":y.value,"show-toolbar":!1,formatter:c},null,8,["modelValue","max-date"])]),_:1},8,["show"])])}}}),_t=K(wt,[["__scopeId","data-v-1ed5e45f"]]),kt={class:"flex items-end justify-center mx-[7px] mt-12"},xt=["onClick"],yt=["onClick"],$t={class:"relative w-[50px] h-[50px] rounded-full avatar-img mx-auto"},Ct=["src"],bt=["src"],St=["onClick"],It={class:"max-w-[90%] line-clamp-1 text-center text-[#7D3100]"},Tt={key:0,class:"flex flex-col items-center"},Rt={class:"text-xs text-b2 leading-[18px]"},Vt=["onClick"],Ft={class:"relative text-[#4D2E0F] text-right text-[22px] font-BebasNeue"},Dt={key:0,class:"absolute right-[-22px] bottom-0 text-xs flex gap-x-1 min-w-fit"},Lt=q({props:{rankingTopList:null,showPower:{type:Boolean}},emits:["voteShop","toDetail"],setup(v,{emit:w}){const{rankingTopList:h}=v;return(L,P)=>(i(),x("div",kt,[(i(!0),x(se,null,ge(v.rankingTopList,(e,f)=>(i(),x("div",{key:f,class:O(["min-h-[120px] text-center relative px-1",`bg-linear__${f==1?"one":f==0?"two":"three"}`]),onClick:E(m=>w("voteShop",e),["stop"])},[l("div",{class:"-mt-[15px] relative",onClick:E(m=>w("toDetail",e),["stop"])},[l("div",$t,[l("img",{src:((e==null?void 0:e.logo)||"").split()[0]||a(ve)("images/ranking/noPosition.png"),class:"object-cover w-full h-full rounded-full"},null,8,Ct),l("img",{src:a(ve)(`images/ranking/top_${f}.png`),class:"w-8 h-auto absolute -top-4 -left-4"},null,8,bt)])],8,yt),l("div",{class:"mt-2 flex justify-center items-center",onClick:E(m=>w("toDetail",e),["stop"])},[l("div",It,T((e==null?void 0:e.storeName)||L.$t("ranking.Waiting for a vacant position")),1)],8,St),e?(i(),x("div",Tt,[l("div",Rt,T(a(Oe)(e==null?void 0:e.shopAddress,"**",0,4)),1),l("div",{class:"flex items-center justify-center gap-x-1 mt-2",onClick:E(m=>w("voteShop",e),["stop"])},[l("div",Ft,[k(Ye,{score:e==null?void 0:e.score},null,8,["score"]),v.showPower?(i(),x("div",Dt,[k(je,{direction:e==null?void 0:e.direction,onCompletePlay:()=>{e.direction=null}},null,8,["direction","onCompletePlay"])])):z("",!0)])],8,Vt),l("div",{class:O(["-mt-6 w-8 h-4 font-bold text-base text-center text-[#995C1F] index-number",{up:(e==null?void 0:e.preHeat)&&+(e==null?void 0:e.sort)<+(e==null?void 0:e.preHeat),down:(e==null?void 0:e.preHeat)&&+(e==null?void 0:e.sort)>+(e==null?void 0:e.preHeat)}])},null,2)])):z("",!0)],10,xt))),128))]))}}),Pt=K(Lt,[["__scopeId","data-v-5aa8ab90"]]),Y=v=>(fe("data-v-657d63d8"),v=v(),me(),v),Bt={class:"parent-view",id:"ranking"},At={class:"flex flex-col w-full h-auto bg-mask parent-view"},Et={class:"h-[50px] text-b2 flex items-center justify-between px-3"},Mt={class:"px-4 pt-5 pb-3 relative"},Nt=Y(()=>l("img",{src:nt,class:"w-[156px] h-auto absolute left-10 -top-6 -z-[11]"},null,-1)),zt=Y(()=>l("div",{class:"min-h-[44px] relative -z-10"},[l("img",{src:at,class:"w-[200px] h-auto"})],-1)),Ut={class:"mt-5 flex items-center gap-x-2 relative"},qt=Y(()=>l("img",{src:lt,class:"w-4 h-4"},null,-1)),Yt=[qt],jt=Y(()=>l("img",{src:rt,class:"w-[150px] h-auto absolute left-[203px] -top-3 -z-0"},null,-1)),Qt=["onClick"],Ht=Y(()=>l("span",{class:"text-sm text-[#663D15]"},"奖励记录",-1)),Ot=q({name:"TalentRanking"});function Kt(v){const w=Ee(),h=u(null),L=u(),{height:P}=Me(),e=u(null),f=o=>{+o.years>=1e4?h.value=1e4:h.value=he(`${o.years}-${o.cycle}`),Re()},m=u(!1),_=u(!1),y=u(!1),g=u(0),b=u(20),p=u(0),s=u([]),$=u(null),[c,d]=M(!1),[r,N]=M(!1),C=u(null),S=ee(()=>+he()==+h.value),ke=async()=>{const{success:o,data:t,params:V}=await Je({page:g.value,size:b.value,month:h.value,shopNameLike:C.value});if(!o||!t||!(t!=null&&t.total)||V.month&&+V.month!=+h.value){p.value=t==null?void 0:t.total,y.value=!0;return}const I=(t==null?void 0:t.records)||[];p.value=t.total,s.value=g.value===1?I:s.value.concat(I),s.value&&s.value.length>=p.value&&(y.value=!0)},ne=ee(()=>s.value?r.value?s.value:s.value.slice(3):[]),xe=ee(()=>r.value?[]:[s.value[1],s.value[0],s.value[2]]),R=u({shopId:null,score:null}),[ae,le]=M(!1),re=o=>{!(o!=null&&o.shopId)||!S.value||(R.value=o,le(!0))},ue=o=>{o!=null&&o.shopId&&(R.value=o,U(`/talentRanking/rankingShop?shopId=${o.shopId}`))},[ye,j]=M(!1),[$e,ie]=M(!1),Ce=async()=>{var t;ie(!0);const{success:o}=await Ge();j(!1),o&&(Q(),(t=e.value)==null||t.getRankingInfo(),ie(!1))},ce=async()=>{_.value=!0,g.value+=1,await ke(),_.value=!1},W=u(null);u(null);const be=async(o,t,V=!1)=>{var I;o!=null&&o.shopId&&(t.direct===200?o.score+=t==null?void 0:t.differ:o.score-=t==null?void 0:t.differ,o.direction=t.direct,e.value&&((I=e.value)==null||I.getRankingInfo()),setTimeout(()=>{o.direction=null,V&&W.value&&W.value.handleShowReward()},2e3),setTimeout(async()=>{const{success:X,data:Z}=await te({shopId:o==null?void 0:o.shopId,month:h.value});X&&(o.score=Z.score)},5e3))},Se=async()=>{var V,I;if(!(R!=null&&R.value.shopId))return;const{success:o,data:t}=await te({shopId:(V=R.value)==null?void 0:V.shopId,month:h.value});o&&(R.value.score=t.score,e.value&&((I=e.value)==null||I.getRankingInfo()))},Ie=()=>{var o;$.value&&((o=$.value)==null||o.focus())},Q=()=>{g.value=0,y.value=!1,s.value=[],ce()},G=()=>{var o;N(!!(C!=null&&C.value)),(o=$.value)==null||o.blur(),Q()},Te=()=>{m.value=!1,Q()},Re=()=>{J&&(Fe.value=J.scrollTop),Q()},U=o=>{w.push(o)},Ve=()=>{w.options.history.state.back.toString().includes("talentRanking")?w.replace("/rankingReward"):U("/rankingReward")};let J=null;const Fe=u(0);return oe(()=>{L.value=P.value,J=document.querySelector(".list__wrap")}),(o,t)=>{const V=D("VanField"),I=D("VanConfigProvider"),X=D("VanImage"),Z=D("VanList"),De=D("van-pull-refresh"),Le=D("router-view");return i(),B(ot,{class:"h-full font-Puhui font-normal relative",style:Ue([{background:"linear-gradient(180deg, #fed820 3%, #fea020 30%, #fed820 85%)"},{minHeight:`${L.value}px`}]),themeVars:{navBarBackgroundColor:"transparent",navBarIconColor:"#000"}},{default:A(()=>{var pe;return[l("div",Bt,[l("div",At,[l("div",Et,[k(st),l("div",{class:"pl-2",onClick:t[0]||(t[0]=n=>U("/talentRanking/rankingRule"))},T("规则"))]),l("div",Mt,[Nt,zt,l("div",Ut,[k(_t,{pageType:"list",onChangeTime:f}),k(I,{"theme-vars":{"field-placeholder-text-color":"#4D2E0F","field-input-text-color":"#4D2E0F"},class:"flex-1"},{default:A(()=>[k(V,{ref:(n,F)=>{F.searchRef=n,$.value=n},class:O(["bg-[#FFF8EC] rounded-full h-7 flex items-center font-normal pl-1.5 pr-2 transition-all duration-300 relative z-10",a(c)||C.value?"flex-1":"w-[60px]"]),onFocus:t[1]||(t[1]=n=>a(d)(!0)),onBlur:t[2]||(t[2]=n=>a(d)(!1)),modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=n=>C.value=n),clearable:"",placeholder:a(c)?"":o.$t("common.search"),onClear:G,onKeyup:Ne(G,["enter"]),enterkeyhint:"search"},ze({"left-icon":A(()=>[l("div",{onClick:Ie},Yt)]),_:2},[a(c)||C.value?{name:"right-icon",fn:A(()=>[l("div",{class:"text-newOrigin font-semibold",onClick:G},T(o.$t("common.search")),1)])}:void 0]),1032,["class","modelValue","placeholder","onKeyup"])]),_:1})]),jt]),k(De,{modelValue:m.value,"onUpdate:modelValue":t[6]||(t[6]=n=>m.value=n),onRefresh:Te,class:"list__wrap relative flex-1 overflow-auto rounded-t-xl mx-2"},{default:A(()=>[a(r)?z("",!0):(i(),x("div",{key:0,class:"absolute z-10 -right-1 top-4 w-fit h-fit py-[5px] px-2 bg-[#FFE4AD] border border-solid border-[rgba(255,255,255,0.64)] rounded-s-full flex items-center min-w-fit",onClick:E(Ve,["stop"])},[Ht,k(X,{class:"ml-[2px] w-4 h-4",src:a(Ke)("ranking/record_arrow.svg")},null,8,["src"])],8,Qt)),!a(r)&&s.value.length>0?(i(),B(Pt,{key:1,rankingTopList:a(xe),showPower:a(S),onVoteShop:t[4]||(t[4]=n=>re(n)),onToDetail:t[5]||(t[5]=n=>ue(n))},null,8,["rankingTopList","showPower"])):z("",!0),!_.value&&y.value&&p.value==0?(i(),B(qe,{key:2})):(i(),B(Z,{key:3,loading:_.value,finished:y.value,"finished-text":o.$t("common.noMore"),"immediate-check":!1,class:"min-h-[40vh] pb-[100px] relative z-10",onLoad:ce},{default:A(()=>[(i(!0),x(se,null,ge(a(ne),(n,F)=>{var de;return i(),B(we,{key:n.id,rankItem:n,showPower:a(S),onVoteShop:Pe=>re(n),onToDetail:Pe=>ue(n),class:O(["relative",{"active-bottom":F+1!==((de=a(ne))==null?void 0:de.length)}])},null,8,["rankItem","showPower","onVoteShop","onToDetail","class"])}),128))]),_:1},8,["loading","finished","finished-text"]))]),_:1},8,["modelValue"])]),a(S)&&!a(r)?(i(),B(dt,{key:0,ref:(n,F)=>{F.userOwnerRef=n,e.value=n},month:h.value,onToApply:t[7]||(t[7]=n=>U("/joinRanking")),onToApplyShop:t[8]||(t[8]=n=>U("/editShopInfo")),onToQuit:t[9]||(t[9]=n=>a(j)(!0))},null,8,["month"])):z("",!0)]),a(ae)?(i(),B(et,{key:0,show:a(ae),shopId:(pe=R.value)==null?void 0:pe.shopId,teleport:"#ranking",onClose:t[10]||(t[10]=n=>a(le)(!1)),onVoteSuccess:t[11]||(t[11]=(n,F)=>be(R.value,n,F))},null,8,["show","shopId"])):z("",!0),k(tt,{ref:(n,F)=>{F.voteRewardRef=n,W.value=n}},null,512),k(We,{show:a(ye),content:"您的店铺本月已存在被投票充电记录，本次退出榜单操作将在下月生效",showConfirm:!0,showReject:!0,loading:a($e),confirmText:"确认退榜",noClose:"","content-class":"text-b1 font-semibold",onClose:t[12]||(t[12]=n=>a(j)(!1)),onConfirm:Ce,onReject:t[13]||(t[13]=n=>a(j)(!1))},null,8,["show","loading"]),k(Le,{class:"child-view",onVoteSuccess:Se})]}),_:1},8,["style"])}}const Wt=q({...Ot,setup:Kt}),ho=K(Wt,[["__scopeId","data-v-657d63d8"]]);export{ho as default};

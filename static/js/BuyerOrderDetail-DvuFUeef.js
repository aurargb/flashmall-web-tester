import{y as Se,x as g,F as v,G as i,H as e,Q as l,a2 as m,O as L,w as Q,B as U,P as r,I as H,a0 as N,E as Ht,K as k,N as z,a4 as Ze,r as T,D as Z,a9 as me,o as Ut,_ as Gt,a1 as Vt,be as O,T as B,R as Wt,l as Kt}from"./vendor-Ba70TIw4.js";import{d as J,q as A,b as Qe,h as ue,l as de,R as zt,e as Jt,o as Zt,f as Ye,s as te,C as $e,B as Qt,by as Yt}from"./index-DiRx6UeW.js";import{a as Xt,_ as Xe,b as es,c as ts}from"./remark-D7OZkNrR.js";import{B as ss,V as os}from"./VoucherConfirm-CHDfB3Ga.js";import{_ as tt}from"./CountdownLabel-sxxOKP2T.js";import{_ as se}from"./MCOIN-Bodfn-v1.js";import{_ as ns}from"./USDT-Dlu99aCg.js";import{_ as rs}from"./FMCP-f3k58DsE.js";import{_ as as}from"./link-DvRTrysK.js";import{_ as fe}from"./copy-w-F2Lv8QkV.js";import{P as q}from"./order-H59PKTFP.js";import{P as is}from"./flashSale-DDyqLyYN.js";import{p as ls}from"./useOrderStatus-eiwKm5Dv.js";import{_ as Ce}from"./SubmitApprove-tMIzKbJG.js";import{e as st,h as us,i as ds,j as ot,k as cs,f as ms,l as fs}from"./useOrderActionButtons-4LDlDPp1.js";import{P as hs}from"./PaySwitchPop-Dr9UdZ48.js";import{g as nt,a as _e}from"./orderTime-Bq3OFFOk.js";import{_ as et}from"./EmptyTipsPop-BnhhUp92.js";import{B as ys}from"./BackIcon-DkqwcD_b.js";import{d as vs,u as ps}from"./useRefund-Dpqhghzq.js";import{a as xs,C as bs,l as ws,D as gs,c as ce,n as ke,E as Ts,F as $s,t as Cs,u as ks}from"./order-BCbQIOFq.js";import{p as Ss}from"./piggyBank-C2UuAs55.js";import"./credit-EZuPIBEN.js";import"./useShipTemplate-CJrw2UwP.js";import"./enums-DlE-aiss.js";import"./default-avatar-BIKCDGrQ.js";import"./selected-icon-Dcrtmy6G.js";const _s={class:"p-3 break-all bg-white rounded-xl"},As={class:"font-semibold text-sm text-b1"},Ds={class:"mt-1 text-b2 text-sm font-normal"},Is={class:"ml-1"},Rs=Se({props:{order:null,showCopy:{type:Boolean,default:!0}},setup(o){const{order:h}=o;return g(()=>`${h.userAddress.provinceName??""}${h.userAddress.cityName??""}${h.userAddress.countyName??""}${h.userAddress.detailInfo??""} ${h.userAddress.userName??""} ${h.userAddress.telNumber??""}`),(y,D)=>(i(),v("div",_s,[e("div",As,l(h.userAddress.provinceName??"")+l(h.userAddress.cityName??"")+l(h.userAddress.countyName??"")+l(h.userAddress.detailInfo??""),1),e("div",Ds,[e("span",null,l(h.userAddress.userName),1),e("span",Is,l(h.userAddress.telNumber??""),1)])]))}}),Bs={key:0,class:"p-3 break-all bg-white rounded-xl"},Fs={class:"font-semibold text-base text-b1"},Ps=e("span",null,"请在",-1),Ls={class:"text-[#FF8812] mx-1"},Ns=e("span",null,"内支付",-1),Os=e("div",{class:"mt-1 font-normal text-sm text-b2"}," 倒计时结束后订单将超时关闭 ",-1),Es={props:{order:{type:Object,required:!0}},emits:["timeDone"],setup(o,{emit:h}){return(y,D)=>o.order.status===0?(i(),v("div",Bs,[e("div",Fs,[Ps,e("span",Ls,[L(tt,{class:"inline-block w-auto",startTime:o.order.createTime,duration:15,durationType:"minutes",showZero:!0,onDone:D[0]||(D[0]=S=>h("timeDone"))},null,8,["startTime"])]),Ns]),Os])):m("",!0)}},js={class:"p-3 py-4 break-all bg-white rounded-xl"},Ms={class:"title text-b1 text-sm font-semibold"},qs={class:"content"},Hs={class:"flex justify-between items-center mt-4"},Us={class:"text-b3 text-sm font-normal"},Gs={class:"text-b1 text-sm font-normal text-right"},Vs={class:"flex justify-between items-center mt-4"},Ws={class:"text-b3 text-sm font-normal"},Ks={class:"text-b1 text-sm font-normal text-right flex items-center"},zs=e("div",{class:"flex-shrink-0"},[e("img",{class:"w-4 h-4",src:se})],-1),Js={class:"ml-1"},Zs={key:0,class:"flex justify-between items-center mt-4"},Qs={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},Ys={class:"text-b1 text-sm font-normal text-right flex items-center"},Xs={class:"mr-1"},eo=e("div",{class:"flex-shrink-0"},[e("img",{class:"w-4 h-4",src:se})],-1),to={class:"ml-1"},so={key:1,class:"flex justify-between items-center mt-4"},oo={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},no={class:"text-b1 text-sm font-normal text-right flex items-center"},ro=e("div",{class:"mr-1"},"-",-1),ao=e("div",{class:"flex-shrink-0"},[e("img",{class:"w-4 h-4",src:se})],-1),io={class:"ml-1"},lo={class:"flex justify-between items-center mt-4"},uo={class:"text-b3 text-sm font-normal"},co={class:"text-b1 text-sm font-normal text-right flex items-center gap-1"},mo=e("img",{class:"w-4 h-4",src:ns},null,-1),fo=N("( "),ho=e("img",{class:"w-4 h-4",src:se},null,-1),yo=e("div",{class:"flex-shrink-0"},[e("img",{class:"w-4 h-4",src:se})],-1),vo=e("span",{class:"text-[#999]"},"+",-1),po=e("img",{class:"w-4 h-4",src:rs},null,-1),xo={class:"flex justify-between items-center mt-4"},bo={class:"text-b3 text-sm font-normal"},wo={class:"text-b1 text-sm font-normal text-right"},go={class:"flex items-center"},To={class:"flex justify-between items-center mt-4"},$o={class:"text-b3 text-sm font-normal"},Co=["href"],ko=e("img",{src:as,class:"w-5 h-5 ml-1",alt:""},null,-1),So={key:1},_o={class:"flex justify-between items-center mt-4"},Ao={class:"text-b3 text-sm font-normal"},Do=e("img",{src:fe,class:"w-5 h-5 ml-1",alt:""},null,-1),Io={key:2,class:"flex justify-between items-center mt-4"},Ro={class:"text-b3 text-sm font-normal"},Bo={class:"text-b1 text-sm font-normal text-right"},Fo={key:3,class:"flex justify-between items-center mt-4"},Po={class:"text-b3 text-sm font-normal"},Lo={class:"text-b1 text-sm font-normal text-right"},No={key:4,class:"flex justify-between items-center mt-4"},Oo={class:"text-b3 text-sm font-normal"},Eo={class:"text-b1 text-sm font-normal text-right"},jo={key:5,class:"flex justify-between items-center mt-4"},Mo={class:"text-b3 text-sm font-normal"},qo={class:"text-b1 text-sm font-normal text-right"},Ho={key:6,class:"flex justify-between items-center mt-4"},Uo={class:"text-b3 text-sm font-normal whitespace-nowrap"},Go={class:"text-b1 text-sm font-normal text-right flex items-center"},Vo={class:"break-all flex-1"},Wo=e("img",{src:fe,class:"w-5 h-5",alt:""},null,-1),Ko=[Wo],zo={key:7,class:"flex justify-between items-center mt-4"},Jo=e("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 发货物流公司 ",-1),Zo={class:"text-b1 text-sm font-normal text-right break-all"},Qo={key:8,class:"flex justify-between items-center mt-4"},Yo=e("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 发货运单号 ",-1),Xo={class:"text-b1 text-sm font-normal text-right flex items-center"},en={class:"break-all flex-1"},tn=e("img",{src:fe,class:"w-5 h-5",alt:""},null,-1),sn=[tn],on={key:9,class:"flex justify-between items-center mt-[16px]"},nn=e("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 退货物流公司 ",-1),rn={class:"text-b1 text-sm font-normal text-right break-all"},an={key:10,class:"flex justify-between items-center mt-[16px]"},ln=e("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 退货运单号 ",-1),un={class:"text-b1 text-sm font-normal text-right flex items-center"},dn={class:"break-all flex-1"},cn=e("img",{src:fe,class:"w-5 h-5",alt:""},null,-1),mn=[cn],fn={props:{order:{type:Object,required:!0}},setup(o){const h=o,{t:y}=Q(),D=g(()=>{let a=0;return a=new U(h.order.totalAmount||0).minus(h.order.voucherAmount||0),J(a)}),S=g(()=>{var c;const a=h.order.orderGoods||[];return a.length>0?a[0].discountRatio||0:((c=h.order.stores)==null?void 0:c.discountRatio)||0});return(a,c)=>{var w,$,f,p,s,b;return i(),v("div",js,[e("div",Ms,[e("span",null,l(a.$t("order.orderInfo")),1)]),e("div",qs,[e("div",Hs,[e("div",Us,l(a.$t("common.pay type method")),1),e("div",Gs,l(r(ls)(+o.order.paySource)),1)]),e("div",Vs,[e("div",Ws,l(a.$t("order.total price detail")),1),e("div",Ks,[zs,e("div",Js,l(r(J)(o.order.totalAmountOriginal||o.order.totalAmount)),1)])]),o.order.merchantAdjustAmount?(i(),v("div",Zs,[e("div",Qs,l(a.$t("order.merchant modify price")),1),e("div",Ys,[e("div",Xs,l(o.order.merchantAdjustAmount>0?"+":"-"),1),eo,e("div",to,l(Math.abs(o.order.merchantAdjustAmount)||0),1)])])):m("",!0),o.order.fmGeneralActivity&&o.order.activityReduceAmount?(i(),v("div",so,[e("div",oo,l(((w=o.order.fmGeneralActivity)==null?void 0:w.name)||"-"),1),e("div",no,[ro,ao,e("div",io,l(r(J)(o.order.activityReduceAmount)),1)])])):m("",!0),e("div",lo,[e("div",uo,l(a.$t("order.total price actual buyer")),1),e("div",co,[+o.order.paySource===r(q).USDT_WALLET?(i(),v(H,{key:0},[mo,N(" "+l(r(J)(o.order.totalUsdt))+" ",1),o.order.payType===r(is).STORE_CARD?(i(),v(H,{key:0},[N(" （"+l(r(J)(o.order.totalAmount))+l(($=o.order.fmStoredCard)==null?void 0:$.symbol)+"） ",1)],64)):(i(),v(H,{key:1},[fo,ho,N(l(r(D))+" Mcoin)",1)],64))],64)):(i(),v(H,{key:1},[yo,e("div",null,l(r(D)),1),o.order.voucherAmount?(i(),v(H,{key:0},[vo,po,N(" "+l(r(J)(o.order.voucherAmount||0)),1)],64)):m("",!0)],64))])]),e("div",xo,[e("div",bo,l(a.$t("common.ratio")),1),e("div",wo,[e("div",go,l(r(S))+"%",1)])]),e("div",To,[e("div",$o,l(a.$t("order.hash")),1),o.order.hash?(i(),v("a",{key:0,class:"text-sm font-normal text-right flex items-center underline text-[#FF8812]",href:`${r(A).chainConfig.blockExplorerUrls[0]}/tx/${o.order.hash}`},[N(l(r(Qe)(o.order.hash,"***",9,5)||"--")+" ",1),ko],8,Co)):(i(),v("span",So," -- "))]),e("div",_o,[e("div",Ao,l(a.$t("order.payAddress")),1),e("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:c[0]||(c[0]=C=>r(ue)(o.order.address))},[N(l(r(Qe)(o.order.address,"...",5,5))+" ",1),Do])]),o.order.createTime?(i(),v("div",Io,[e("div",Ro,l(a.$t("order.createTime")),1),e("div",Bo,l(r(de)(o.order.createTime)),1)])):m("",!0),o.order.chainCreateTime?(i(),v("div",Fo,[e("div",Po,l(a.$t("order.chainFinishTime")),1),e("div",Lo,l(r(de)(o.order.chainCreateTime)),1)])):m("",!0),o.order.expressTime?(i(),v("div",No,[e("div",Oo,l(a.$t("order.expressTime")),1),e("div",Eo,l(r(de)(o.order.expressTime)),1)])):m("",!0),o.order.finishTime?(i(),v("div",jo,[e("div",Mo,l(a.$t("order.finishTime")),1),e("div",qo,l(o.order.finishTime?r(de)(o.order.finishTime):"-"),1)])):m("",!0),o.order.id&&o.order.status!==0?(i(),v("div",Ho,[e("div",Uo,l(a.$t("order.orderNumber")),1),e("div",Go,[e("div",Vo,l(o.order.id),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:c[1]||(c[1]=C=>r(ue)(o.order.id))},Ko)])])):m("",!0),o.order.expressCompany?(i(),v("div",zo,[Jo,e("div",Zo,l(o.order.expressCompany),1)])):m("",!0),o.order.expressNo?(i(),v("div",Qo,[Yo,e("div",Xo,[e("div",en,l(o.order.expressNo),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:c[2]||(c[2]=C=>r(ue)(o.order.expressNo))},sn)])])):m("",!0),(f=o.order.refundInfo)!=null&&f.expressCompany?(i(),v("div",on,[nn,e("div",rn,l((p=o.order.refundInfo)==null?void 0:p.expressCompany),1)])):m("",!0),(s=o.order.refundInfo)!=null&&s.expressNo?(i(),v("div",an,[ln,e("div",un,[e("div",dn,l((b=o.order.refundInfo)==null?void 0:b.expressNo),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:c[3]||(c[3]=C=>{var P;return r(ue)((P=o.order.refundInfo)==null?void 0:P.expressNo)})},mn)])])):m("",!0)])])}}},hn={class:"flex justify-between items-center gap-3 mt-5 fixed left-0 right-0 bottom-0 safe-bottom px-3"},yn={key:0,class:"flex justify-between items-center gap-3 w-full"},vn={class:"relative w-full flex-1"},pn={class:"relative w-full flex-1"},xn={key:0},bn={props:{order:{type:Object,required:!0},btnLoading:{type:Boolean,default:!1},nowTime:{type:Number,default:0},continuePayLoading:{type:Boolean,default:!1},cancelLoading:{type:Boolean,default:!1},voucherPrice:{type:Number,default:0}},emits:["handleDelay","handleDelayReceipt","handleTo","cancelOrder","continuePay","timeDone"],setup(o,{emit:h}){const y=o,{t:D}=Q(),S=g(()=>{const f=y.order||{};return st(f)}),a=g(()=>{const f=y.order||{};return us(f)}),c=g(()=>{const f=y.order||{};return ds(f)}),w=g(()=>{const f=y.order||{},p=y.nowTime;return ot(f,p)}),$=()=>{const f=y.order;if(cs(f))h("handleTo",`/refundDetail?id=${f.id}`);else{console.log("order.creditFlag",f.creditFlag);let s=`/buyerOrderList/refundService?id=${f.id}`;f.creditFlag&&(s+="&type=credit"),h("handleTo",s)}};return(f,p)=>{const s=Ht("VanButton");return i(),v("div",hn,[o.order.status===0&&!o.order.hash?(i(),v("div",yn,[e("div",vn,[o.order.hash?m("",!0):(i(),k(s,{key:0,round:"",class:"w-full flex-1 gray-btn border-btn font-normal text-base h-[46px] rounded-full",loading:o.btnLoading||o.cancelLoading,disabled:o.continuePayLoading||o.order.hash,onClick:p[0]||(p[0]=Ze(b=>f.$emit("cancelOrder"),["stop"]))},{default:z(()=>[N(l(f.$t("order.cancelOrder")),1)]),_:1},8,["loading","disabled"]))]),e("div",pn,[o.order.paySource!=r(q).PIGGY_BANK&&o.order.paySource!=r(q).WITHDRAW_POINTS?(i(),v("div",xn,[o.order.paySource==r(q).USDT_WALLET?(i(),k(Ce,{key:0,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:r(A).order,token:r(A).USDT,symbol:"USDT",loading:o.btnLoading,approveAmount:Number(o.order.paySource==r(q).USDT_WALLET?o.order.totalUsdt:0)},null,8,["contract","token","loading","approveAmount"])):m("",!0),o.order.paySource!=r(q).USDT_WALLET?(i(),k(Ce,{key:1,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:r(A).order,token:r(A).MCOIN,symbol:"mcoin",loading:o.btnLoading,approveAmount:Number(o.order.paySource===r(q).USDT_WALLET?0:o.order.totalAmount)},null,8,["contract","token","loading","approveAmount"])):m("",!0)])):m("",!0),o.order.paySource==r(q).WITHDRAW_POINTS&&o.voucherPrice&&o.voucherPrice>0?(i(),k(Ce,{key:1,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:r(A).order,token:r(A).FMCP,symbol:f.$t("voucher.voucher"),loading:o.btnLoading,approveAmount:Number(o.voucherPrice)},null,8,["contract","token","symbol","loading","approveAmount"])):m("",!0),o.order.hash?m("",!0):(i(),k(s,{key:2,round:"",class:"w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",disabled:o.order.hash,loading:o.continuePayLoading||o.btnLoading,onClick:p[1]||(p[1]=Ze(b=>f.$emit("continuePay"),["stop"]))},{default:z(()=>[e("span",null,l(f.$t("order.continuePay")),1),L(tt,{class:"inline-block ml-1",startTime:o.order.createTime,duration:15,durationType:"minutes",showZero:!1},null,8,["startTime"])]),_:1},8,["disabled","loading"]))])])):m("",!0),r(c)?(i(),k(s,{key:1,round:"",class:"flex-1 border-btn gray-btn font-semibold text-b2 text-base h-[46px] rounded-full",onClick:$,loading:o.btnLoading},{default:z(()=>[N(l(f.$t("order.afterSale")),1)]),_:1},8,["loading"])):m("",!0),r(w).visible?(i(),k(s,{key:2,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",disabled:r(w).disabled,onClick:p[2]||(p[2]=b=>f.$emit("handleForcedRefund")),loading:o.btnLoading},{default:z(()=>[N(l(f.$t("order.forced refund")),1)]),_:1},8,["disabled","loading"])):m("",!0),r(S)?(i(),k(s,{key:3,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:p[3]||(p[3]=b=>f.$emit("handleDelayReceipt")),loading:o.btnLoading},{default:z(()=>[N(l(f.$t("order.confirmGeted")),1)]),_:1},8,["loading"])):m("",!0),r(a)?(i(),k(s,{key:4,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:$,loading:o.btnLoading},{default:z(()=>[N(l(f.$t("order.refund")),1)]),_:1},8,["loading"])):m("",!0)])}}},wn={key:0,class:"p-3 mt-3 break-all bg-white rounded-xl"},gn={class:"font-semibold text-base text-b1"},Tn=e("span",null,"请在",-1),$n={class:"text-[#FF8812] mx-1"},Cn=e("span",null,"内确认收货",-1),kn=e("div",{class:"mt-1 font-normal text-sm text-b2"}," 倒计时结束后商家可确认收货 ",-1),Sn={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone"],setup(o,{emit:h}){const y=o,{t:D}=Q(),S=T(Date.now());let a=null;const c=g(()=>{const p=nt(y.order.expressTime,y.order.confirmLimit,y.nowTime);return p>0?p:0}),w=g(()=>c.value>0),$=g(()=>{const p=c.value;if(p<=0)return"00天00时00分00秒";const s=Math.floor(p/(1e3*60*60*24)),b=Math.floor(p%(1e3*60*60*24)/(1e3*60*60)),C=Math.floor(p%(1e3*60*60)/(1e3*60)),P=Math.floor(p%(1e3*60)/1e3);return`${s.toString().padStart(2,"0")}天${b.toString().padStart(2,"0")}时${C.toString().padStart(2,"0")}分${P.toString().padStart(2,"0")}秒`}),f=()=>{S.value=Date.now(),c.value<=0&&a&&(clearInterval(a),a=null,h("timeDone"))};return Z(()=>{f(),c.value>0&&(a=setInterval(f,1e3))}),me(()=>{a&&(clearInterval(a),a=null)}),(p,s)=>r(w)?(i(),v("div",wn,[e("div",gn,[Tn,e("span",$n,l(r($)),1),Cn]),kn])):m("",!0)}},_n={key:0,class:"p-3 break-all bg-white rounded-xl"},An={class:"font-semibold text-base text-b1"},Dn=e("span",null,"请在",-1),In={class:"text-[#FF8812] mx-1"},Rn=e("span",null,"内确认收货",-1),Bn=e("div",{class:"mt-1 font-normal text-sm text-b2"}," 商家已确认收货，倒计时结束后将自动确认收货 ",-1),Fn={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone","handleDelay"],setup(o,{emit:h}){const y=o,{t:D}=Q(),S=T(Date.now());let a=null;const c=g(()=>{const s=_e(y.order.merchantsConfirm,y.nowTime);return s>0?s:0}),w=g(()=>c.value>0),$=g(()=>{const s=c.value;if(s<=0)return"00天00时00分00秒";const b=Math.floor(s/(1e3*60*60*24)),C=Math.floor(s%(1e3*60*60*24)/(1e3*60*60)),P=Math.floor(s%(1e3*60*60)/(1e3*60)),j=Math.floor(s%(1e3*60)/1e3);return`${b.toString().padStart(2,"0")}天${C.toString().padStart(2,"0")}时${P.toString().padStart(2,"0")}分${j.toString().padStart(2,"0")}秒`}),f=()=>{S.value=Date.now(),c.value<=0&&a&&(clearInterval(a),a=null,h("timeDone"))},p=()=>{h("handleExtend")};return Z(()=>{f(),c.value>0&&(a=setInterval(f,1e3))}),me(()=>{a&&(clearInterval(a),a=null)}),(s,b)=>r(w)?(i(),v("div",_n,[e("div",An,[e("span",null,[Dn,e("span",In,l(r($)),1),Rn]),e("span",{class:"text-sm text-[#FF8812] ml-auto font-normal",onClick:p,role:"button"},"延长收货")]),Bn])):m("",!0)}},Pn={key:0,class:"p-3 break-all bg-white rounded-xl"},Ln=e("span",null,"商家已同意请及时寄回商品",-1),Nn=e("div",{class:"mt-1 font-normal text-sm text-b2"},[e("span",null,"待商家确认收到退回商品后退款")],-1),On={props:{order:{type:Object,required:!0}},emits:["handleExpress"],setup(o,{emit:h}){const y=o,D=g(()=>{const a=y.order||{};return ms(a)}),S=()=>{h("handleExpress")};return(a,c)=>r(D)?(i(),v("div",Pn,[e("div",{class:"font-semibold text-base text-b1 flex items-center justify-start"},[Ln,e("span",{class:"text-sm text-[#FF8812] ml-auto font-normal",onClick:S,role:"button"},"退货寄件")]),Nn])):m("",!0)}},En={key:0,class:"p-3 break-all bg-white rounded-xl"},jn={class:"font-semibold text-base text-b1"},Mn={class:"text-b1"},qn=e("span",{class:"mr-1"},"待商家确认",-1),Hn={class:"text-[#FF8812] mx-1"},Un=N("商家未确认您可申请强制退款"),Gn=e("span",null,null,-1),Vn=e("div",{class:"mt-1 font-normal text-sm text-b2"}," 倒计时结束后商家未确认您可申请强制退款 ",-1),Wn=Se({props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone"],setup(o,{emit:h}){const y=o,{t:D}=Q(),S=T(Date.now());let a=null;const c=g(()=>{const s=nt(y.order.expressTime,y.order.confirmLimit,y.nowTime);return s>0?s*1e3:0}),w=g(()=>c.value>0),$=g(()=>{const s=Ut(c.value).unix();if(s<=0)return"00秒";const b=Math.floor(s/(1e3*60*60*24)),C=Math.floor(s%(1e3*60*60*24)/(1e3*60*60)),P=Math.floor(s%(1e3*60*60)/(1e3*60)),j=Math.floor(s%(1e3*60)/1e3);let W="";return b>0&&(W+=`${b}天`),(C>0||b>0)&&(W+=`${C.toString().padStart(2,"0")}时`),(P>0||C>0||b>0)&&(W+=`${P.toString().padStart(2,"0")}分`),W+=`${j.toString().padStart(2,"0")}秒`,W}),f=()=>{S.value=Date.now(),c.value<=0&&a&&(clearInterval(a),a=null,h("timeDone"))},p=g(()=>{const s=y.order||{},b=y.nowTime||Date.now()/1e3;return ot(s,b).visible});return Z(()=>{f(),c.value>0&&(a=setInterval(f,1e3))}),me(()=>{a&&(clearInterval(a),a=null)}),(s,b)=>r(p)?(i(),v("div",En,[e("div",jn,[e("span",Mn,[r(w)?(i(),v(H,{key:0},[qn,e("span",Hn,l(r($)),1)],64)):(i(),v(H,{key:1},[Un],64))]),Gn]),Vn])):m("",!0)}}),Kn={key:0,class:"p-3 break-all bg-white rounded-xl"},zn={class:"font-semibold text-base text-b1 flex items-center justify-start"},Jn=e("span",null,"买家发起平台介入-",-1),Zn=e("div",{class:"mt-1 font-normal text-sm text-b2"},[e("span",null,"待店铺审核人处理")],-1),Qn=e("span",null,"平台支持售后，请及时寄回商品",-1),Yn=e("div",{class:"mt-1 font-normal text-sm text-b2"},[e("span",null,"待商家确认收到退回商品后退款")],-1),Xn={class:"font-semibold text-base text-b1 flex items-center justify-start"},er=e("span",null,"请在",-1),tr={class:"text-[#FF8812] mx-1"},sr=e("span",null,"内确认收货",-1),or=e("div",{class:"mt-1 font-normal text-sm text-b2"},[e("span",null,"倒计时结束后商家可确认收货")],-1),nr={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["handleExpress","handleDelay"],setup(o,{emit:h}){const y=o,D=g(()=>{const s=y.order||{};return fs(s)}),S=T(y.nowTime?y.nowTime*1e3:Date.now());let a=null;const c=g(()=>{var C;if(((C=y.order.refundInfo)==null?void 0:C.interveneStatus)!==3)return 0;const s=Math.floor(S.value/1e3),b=_e(y.order.merchantsConfirm,s);return b>0?b:0}),w=g(()=>{const s=c.value;if(s<=0)return"00天00时00分00秒";const b=Math.floor(s/(1e3*60*60*24)),C=Math.floor(s%(1e3*60*60*24)/(1e3*60*60)),P=Math.floor(s%(1e3*60*60)/(1e3*60)),j=Math.floor(s%(1e3*60)/1e3);return`${b.toString().padStart(2,"0")}天${C.toString().padStart(2,"0")}时${P.toString().padStart(2,"0")}分${j.toString().padStart(2,"0")}秒`}),$=()=>{S.value=Date.now(),c.value<=0&&a&&(clearInterval(a),a=null)},f=()=>{h("handleExpress")},p=()=>{h("handleDelay")};return Z(()=>{var s;$(),((s=y.order.refundInfo)==null?void 0:s.interveneStatus)===3&&c.value>0&&(a=setInterval($,1e3))}),me(()=>{a&&(clearInterval(a),a=null)}),(s,b)=>r(D)?(i(),v("div",Kn,[o.order.refundInfo.interveneStatus==1?(i(),v(H,{key:0},[e("div",zn,[Jn,e("span",null,l(r(vs)(o.order,!1)||""),1)]),Zn],64)):m("",!0),o.order.refundInfo.interveneStatus==2?(i(),v(H,{key:1},[e("div",{class:"font-semibold text-base text-b1 flex items-center justify-start"},[Qn,e("span",{class:"text-sm text-[#FF8812] ml-auto font-normal",onClick:f,role:"button"},"退货寄件")]),Yn],64)):m("",!0),o.order.refundInfo.interveneStatus==3?(i(),v(H,{key:2},[e("div",Xn,[e("span",null,[er,e("span",tr,l(r(w)),1),sr]),e("span",{class:"text-sm text-[#FF8812] ml-auto font-normal",onClick:p,role:"button"},"延长收货")]),or],64)):m("",!0)])):m("",!0)}},rr={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},ar={class:"font-bold text-base text-b1"},ir={class:"px-3 safe-bottom pt-[50px] flex flex-col gap-3"},lr=Se({props:{nowTime:null},setup(o){const h=o,{getUserDhKey:y,decryptAddressKey:D,decryptKey:S,cryptoAESWithBuyerSearch:a}=zt(),{t:c}=Q(),w=Kt(),$=Vt(),{reloadStore:f}=Jt(),p=$.query.id,s=T(null),[b,C]=O(!1),[P,j]=O(!1),[W,he]=O(!1),[rt,Ae]=O(!1),De=T(null),Ie=T(!1),at=t=>{const n=t.target.scrollTop;Ie.value=n>25},[it,Re]=O(!1),[lt,Be]=O(!1),ut=T(null),Y=T(0),[dt,oe]=O(!1),Fe=T("");T(0);const ye=T(!1),Pe=T(0),ne=T(0),Le=T(0),Ne=T(0),Oe=T(0),[ct,X]=O(!1);T(!1);const{confirm:Ee,senderDelay:mt,submit:ft,senderForceCancel:ht}=Zt(),{pointBalances:yt,mcoinRate:vt}=Ye(),{userMerchantCashs:pt,userTotalAmount:xt}=Ss(),ve=T(null),je=g(()=>ve.value?1/ve.value:1),Me=T(0),qe=T([]),G=async()=>{var n,d,u,x,I,_,V,E,M,K,ae,ie,ee;const t=await xs({id:p});if((n=t.data)!=null&&n.userAddress&&(t.data.userAddress.postscript=t.data.postscript),(d=t.data)!=null&&d.userAddress&&((x=(u=t.data)==null?void 0:u.userAddress)!=null&&x.encryptFlag)){const R=await y(t.data.stores.id,(I=t.data)==null?void 0:I.submitMerchantPubKey);R&&(t.data.userAddress=D(t.data.userAddress,R))}if((_=t.data)!=null&&_.shippingHash){const R=await y(t.data.stores.id,(V=t.data)==null?void 0:V.shippingMerchantPubKey);if(R){const le=S(t.data.expressNo,R);le.hash===t.data.shippingHash&&(t.data.expressNo=le.decrypt,t.data.expressCompany=S(t.data.expressCompany,R).decrypt)}}if(!((E=t.data)!=null&&E.userEns)&&((M=t.data)!=null&&M.id)&&setTimeout(async()=>{let R=[];R.push(await bt(c)),R.filter(le=>le.userEns),R.length&&bs({enInfoList:R})}),(ae=(K=t.data)==null?void 0:K.refundInfo)!=null&&ae.shippingHash){const R=await y(t.data.stores.id,(ee=(ie=t.data)==null?void 0:ie.refundInfo)==null?void 0:ee.shippingMerchantPubKey);R&&(t.data.refundInfo.expressNo=S(t.data.refundInfo.expressNo,R).decrypt),R&&(t.data.refundInfo.expressCompany=S(t.data.refundInfo.expressCompany,R).decrypt)}s.value=t.data},bt=async t=>{var n,d,u,x,I,_,V,E,M;try{let ae=((M=[(n=t==null?void 0:t.userAddress)==null?void 0:n.postscript,""+(((d=t==null?void 0:t.userAddress)==null?void 0:d.provinceName)||"")+(((u=t==null?void 0:t.userAddress)==null?void 0:u.cityName)||"")+(((x=t==null?void 0:t.userAddress)==null?void 0:x.countyName)||"")+(((I=t==null?void 0:t.userAddress)==null?void 0:I.detailInfo)||""),(_=t==null?void 0:t.userAddress)==null?void 0:_.telNumber,t==null?void 0:t.address,(V=t==null?void 0:t.stores)==null?void 0:V.storeName,(E=t==null?void 0:t.stores)==null?void 0:E.merchant,t==null?void 0:t.expressNo,t==null?void 0:t.expressCompany].filter(ee=>ee||ee===0))==null?void 0:M.join(""))||"",ie=await a(ae);return{id:t.id,userEns:ie}}catch{}},wt=async()=>{const t=await ws({page:1,size:999,status:2,type:2});t.success&&(Me.value=t.total,qe.value=t.data.filter(n=>(!n.merchantsConfirm||_e(n.merchantsConfirm,h.nowTime)>0)&&st(n)))},pe=T(1),{tradeContributeSelfRate:gt}=Ye(),Tt=g(()=>{var n;if(!((n=s.value)!=null&&n.orderGoods))return 0;let t=new U(0);return s.value.orderGoods.forEach(d=>{if(+s.value.payType==1&&+d.payType==3||+d.payType!=2&&+d.payType!=3){const u=new U(d.price).times(d.number).minus(d.goodsActivityReduceAmount||0).plus(d.goodsAdjustChangeAmount||0).times(new U(d.discountRatio||0).div(100));t=t.plus(u)}}),t.times(pe.value).toNumber()}),xe=g(()=>{var u;if(!((u=s.value)!=null&&u.orderGoods)||ne.value<=0)return 0;const t=Tt.value||0,n=pe.value;return Math.min(ne.value,new U(t).div(n).times(.5).toNumber())});Z(async()=>{pe.value=await gt()});const $t=async()=>{try{const{balanceOf:t}=te(A.MCOIN),n=await t();Pe.value=+n;const d=await te(A.FMCP).balanceOf();ne.value=+d;const u=await te(A.USDT).balanceOf();Le.value=+u,Ne.value=+await yt(),await kt()}catch(t){console.error("获取余额失败:",t)}},Ct=async()=>{try{ve.value=await vt()}catch(t){console.error("获取汇率失败:",t)}},kt=async()=>{try{const{success:t,result:n}=await pt();if(!t)return;let d=0;const u=+await xt(),x=n.amounts.map(_=>Qt(_));n.cashIds.map(_=>+_).forEach((_,V)=>{_!==0&&(d=+U(d).plus(x[V]||0).toString())}),Oe.value=+U(u).minus(d)}catch(t){console.error("获取余额宝余额失败:",t)}},St=()=>{Be(!1),G()},_t=t=>{w.push(t)},[He,be]=O(!1),[At,we]=O(!1),Ue=async()=>{we(!0)},Dt=async()=>{if(He.value)return;be(!0),(await gs({orderId:s.value.id})).success?(B.success(c("common. cancel success")),be(!1),w.go(-1),setTimeout(()=>{w.replace({path:"/buyerOrderList",query:{active:4,type:1}})},50),setTimeout(()=>{location.reload()},100)):be(!1)},ge=async(t,n)=>{try{const{allowance:d}=te(t);return+(await d(n)).result}catch{return 0}},It=async()=>{var t,n,d;try{const u=(t=s.value)==null?void 0:t.paySource,x=(n=s.value)==null?void 0:n.totalAmount,I=Math.max(((d=s.value)==null?void 0:d.voucherAmount)||0,xe.value);if(I&&u==q.WITHDRAW_POINTS&&await ge(A.FMCP,A.order)<xe.value)return B({message:c("common.approve")+c("voucher.voucher"),forbidClick:!0,duration:2e3}),!1;if(u==1){if(Pe.value<x)return X(!0),!1;if(await ge(A.MCOIN,A.order)<x)return B({message:c("common.approve")+"MCOIN",forbidClick:!0,duration:2e3}),!1}else if(u==5){if(Le.value<x*je.value)return X(!0),!1;if(await ge(A.USDT,A.order)<x*je.value)return B({message:c("common.approve")+"USDT",forbidClick:!0,duration:2e3}),!1}else if(u==4){if(+U(Ne.value).times(.9)<+U(x).minus(I))return X(!0),!1}else if(u==2&&Oe.value<x)return X(!0),!1;return!0}catch{return!1}finally{C(!1),F(!1)}},Ge=async()=>{if(await It())try{if(!s.value.id||!s.value.allOrderId){B.fail(c("order.orderIdError")),F(!1);return}F(!0),await G();const n=await Ts({allOrderId:s.value.allOrderId,orderId:s.value.id});if(!n.success){F(!1);return}const{allOrderId:d,merchants:u,discounts:x,amounts:I,sources:_}=n.data;if(s.value.allOrderId=d,!(await $s({allOrderId:s.value.allOrderId})).data){B.fail("有一笔交易正在进行中，请稍候再试"),F(!1);return}const E=await ft(d,u,x,I,_);if(!E.success){Cs({allOrderId:d}),F(!1),await G();return}if(B.loading({message:c("order.wait block chain"),forbidClick:!0,duration:0}),await ks({allOrderId:d,hash:E.result.hash,orderId:s.value.id}),B.clear(),ut.value=E.result.hash,!E.result.hash){F(!1);return}let M;const K=async()=>{if(Y.value>=5){F(!1),Be(!0),Y.value=0,await G();return}if(M=await Yt(E.result.hash),(M==null?void 0:M.status)===1){F(!1),Re(!0),Y.value=0,setTimeout(()=>{w.go(-1),setTimeout(()=>{w.replace({path:"/buyerOrderList",query:{active:1,type:1}})},50),setTimeout(()=>{location.reload()},100)},1e3);return}setTimeout(async()=>{Y.value++,K()},5e3)};K()}catch{F(!1),Y.value=0}},Ve=T(!1),[Rt,F]=O(!1),We=async()=>{var n;F(!0),Ve.value=!0;try{await G()}catch{F(!1);return}if(((n=s.value)==null?void 0:n.status)!==0){B.fail("已支付订单，无需重复支付"),F(!1);return}if(Ke()){ye.value=!0,F(!1);return}await Ge()},re=()=>{G()},Te=async()=>{j(!0)},Bt=async t=>{C(!0);try{const d=(await ce({orderIds:t.id})).data.ordIds;if(!(await mt(d)).success)return;t.delayReceiveFlag=!0,t.confirmLimit=h.nowTime+A.datePeriod*10,j(!1),B.success(c("order.delaySuccess")),setTimeout(()=>{f.reload()},3e3)}finally{C(!1)}},Ft=async t=>{var n;C(!0);try{const u=(await ce({orderIds:t})).data.ordIds,x=await Ee(u);if(!x.success||!(await ke({ordIds:u,hash:x.result.hash})).success)return;s.value.status=4,De.value.showToastPop(((n=x.result)==null?void 0:n.logs)||[])||(B.success(c("order.confirmSuccess")),w.replace({path:"/buyerOrderList",query:{active:3,type:1}}),setTimeout(()=>{$.params.refresh="1",w.push("/evaluate-my")},2e3))}finally{C(!1)}},Pt=async()=>{Me.value>1?he(!0):Ft(p)},Lt=async t=>{const n=t.join();Ae(!0);try{const u=(await ce({orderIds:n})).data.ordIds,x=await Ee(u);if(!x.success||!(await ke({ordIds:u,hash:x.result.hash})).success)return;s.value.status=4,he(!1),B.success(c("order.confirmSuccess")),w.replace({path:"/buyerOrderList",query:{active:3,type:1}}),setTimeout(()=>{$.params.refresh="1",w.push("/evaluate-my")},2e3)}finally{Ae(!1)}},Nt=()=>{var t,n;((t=$.params)==null?void 0:t.quick)==="quickPay"&&Ot(),((n=$.params)==null?void 0:n.quick)==="quickCancel"&&Et()},Ot=()=>{B.loading({message:c("order.continuePay"),forbidClick:!0,duration:2e3}),We()},Et=()=>{Ue()},jt=()=>{oe(!1),ye.value&&(ye.value=!1,Ge())},Ke=()=>{var x,I;if(!((x=s.value)!=null&&x.id))return!1;const t="orderMerchantAdjustMap";let n={};try{n=JSON.parse(localStorage.getItem(t)||"{}")}catch{n={}}const d=n[s.value.id],u=(I=s.value)==null?void 0:I.merchantAdjustAmount;return u&&(d===void 0||d!==String(u))?(sessionStorage.setItem("refreshOrderID",s.value.id.toString()),Fe.value="订单金额发生变动，请留意订单信息变化",oe(!0),n[s.value.id]=String(u),localStorage.setItem(t,JSON.stringify(n)),!0):!1},ze=async()=>{if(!ps(s.value,"USER_RETURN_GOODS","visible")){B.fail("您没有权限退货寄回");return}w.push({path:"/refundExpress",query:{id:s.value.id}})},[Mt,Je]=O(!1),qt=async()=>{Je(!0);try{const n=(await ce({orderIds:s.value.id+""})).data.ordIds,d=await ht(n[0]);if(!d.success||!(await ke({ordIds:n,hash:d.result.transactionHash})).success)return}catch(t){B(t.message||t)}finally{Je(!1),await G()}};return Z(async()=>{var t,n,d,u;if(((t=$.params)==null?void 0:t.quick)==="quickPay"&&(B.loading({message:c("order.continuePay"),forbidClick:!0,duration:6e3}),F(!0)),wt(),await G(),await $t(),await Ct(),((n=s.value)==null?void 0:n.paySource)==q.WITHDRAW_POINTS){const x=await te(A.FMCP).balanceOf();ne.value=+x}((d=s.value)==null?void 0:d.status)===0&&!((u=$.params)!=null&&u.quick)&&Ke(),Nt()}),(t,n)=>{var d;return s.value?(i(),v("div",{key:0,class:"app-container font-Puhui main-bg safe-bottom-page",onScroll:at},[e("section",{class:Wt(["header-bar fixed top-0 left-0 right-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 backdrop-blur-md transition-all duration-300",{"bg-white":Ie.value}])},[e("div",rr,[L(ys)]),e("div",ar,[e("span",null,l(t.$t("order.orderDetail")),1)])],2),e("section",ir,[L(nr,{order:s.value,nowTime:o.nowTime,onHandleExpress:ze,onHandleDelay:Te},null,8,["order","nowTime"]),L(On,{order:s.value,onHandleExpress:ze},null,8,["order"]),L(Wn,{order:s.value,nowTime:o.nowTime,onTimeDone:re},null,8,["order","nowTime"]),s.value.status===2?(i(),k(Sn,{key:0,order:s.value,nowTime:o.nowTime,onTimeDone:re},null,8,["order","nowTime"])):m("",!0),s.value.status===2?(i(),k(Fn,{key:1,order:s.value,nowTime:o.nowTime,onTimeDone:re,onHandleDelay:Te},null,8,["order","nowTime"])):m("",!0),s.value.status===0&&!s.value.hash?(i(),k(Es,{key:2,order:s.value,onTimeDone:re},null,8,["order"])):m("",!0),s.value.userAddress?(i(),k(Rs,{key:3,order:s.value,showCopy:!1},null,8,["order"])):m("",!0),L(Xt,{order:s.value,"show-price":!1,"show-shipping-template":!0},null,8,["order"]),s.value.status===0?(i(),k(Xe,{key:4,order:s.value,isBuyer:""},null,8,["order"])):m("",!0),s.value.status===0&&!s.value.hash?(i(),k(es,{key:5,order:s.value,isBuyer:""},null,8,["order"])):m("",!0),s.value.status!==0||s.value.hash?(i(),k(fn,{key:6,order:s.value},null,8,["order"])):m("",!0),s.value.status!==0?(i(),k(Xe,{key:7,order:s.value,isBuyer:""},null,8,["order"])):m("",!0),s.value.id&&s.value.status===0?(i(),k(ts,{key:8,order:s.value},null,8,["order"])):m("",!0),s.value.status==0&&s.value.hash?m("",!0):(i(),k(bn,{key:9,voucherPrice:r(xe),order:s.value,btnLoading:r(b),cancelLoading:r(He),continuePayLoading:r(Rt),nowTime:o.nowTime,forceCancelLoading:r(Mt),onHandleDelay:Te,onHandleDelayReceipt:Pt,onHandleTo:_t,onCancelOrder:Ue,onContinuePay:We,onHandleForcedRefund:qt},null,8,["voucherPrice","order","btnLoading","cancelLoading","continuePayLoading","nowTime","forceCancelLoading"]))]),L($e,{show:r(P),title:t.$t("order.delayConfirm"),content:t.$t("order.delayTips"),showConfirm:!0,showReject:!0,confirmText:"确定",rejectText:"取消",noClose:"",onClose:n[0]||(n[0]=u=>r(j)(!1)),onReject:n[1]||(n[1]=u=>r(j)(!1)),onConfirm:n[2]||(n[2]=u=>Bt(s.value))},null,8,["show","title","content"]),L(ss,{loading:r(rt),show:r(W),list:qe.value,currentId:+r(p),onClose:n[3]||(n[3]=u=>r(he)(!1)),onReceipt:Lt},null,8,["loading","show","list","currentId"]),L(os,{ref:(u,x)=>{x.voucherConfirmRef=u,De.value=u},onReload:n[4]||(n[4]=u=>r(f).reload()),onHandleTo:n[5]||(n[5]=()=>{r(w).push("/voucher?active=1")})},null,512),r(it)?(i(),k(et,{key:0,onClose:n[6]||(n[6]=u=>r(Re)(!1)),text:t.$t("common.pay success")},null,8,["text"])):m("",!0),r(lt)?(i(),k(et,{key:1,isError:!0,onClose:St,text:t.$t("order.fail")},null,8,["text"])):m("",!0),L(hs,{paySource:+((d=s.value)==null?void 0:d.paySource),show:r(ct),onClose:n[7]||(n[7]=u=>r(X)(!1))},null,8,["paySource","show"]),L($e,{show:r(dt),title:t.$t("common.tip"),content:Fe.value,showConfirm:!0,showReject:Ve.value,confirmText:"确定",noClose:"",onClose:n[8]||(n[8]=u=>r(oe)(!1)),onConfirm:jt,onReject:n[9]||(n[9]=u=>r(oe)(!1))},null,8,["show","title","content","showReject"]),L($e,{show:r(At),title:t.$t("order.cancelOrder"),content:t.$t("order.cancelOrderTips"),showConfirm:!0,showReject:!0,confirmText:"确定",noClose:"",onClose:n[10]||(n[10]=u=>r(we)(!1)),onConfirm:Dt,onReject:n[11]||(n[11]=u=>r(we)(!1))},null,8,["show","title","content"])],32)):m("",!0)}}}),Nr=Gt(lr,[["__scopeId","data-v-f74734a6"]]);export{Nr as default};

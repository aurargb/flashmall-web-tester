import{_ as I,y as E,r as l,D as R,E as N,F as V,G as i,H as d,O as T,a1 as u,Q as r,N as S,Z as Q,$ as X,be as Y,x,B as A,K as _,P as c,X as D}from"./vendor-BlU_hoYl.js";import{l as O}from"./luckyShopContract-DfQD8nlF.js";import{O as z}from"./OrderGoodsBox-BNx2eQs9.js";import{_ as J}from"./OrderPopBorder-DiHG6LWm.js";import{f as L,d as U,q as W}from"./index-UgIL2Smv.js";import{_ as ee}from"./ApproveButton-FviueR9l.js";const te="/static/images/success-DvZwai7Y.png",se=o=>(Q("data-v-3c4bb187"),o=o(),X(),o),oe={class:"pt-6 pb-10"},ae={class:"text-base text-[#2E2008]"},ne={class:"mr-1 font-semibold"},ce=se(()=>d("img",{src:te,class:"w-[178px] h-[144px] object-cover my-10 mx-auto"},null,-1)),le=E({props:{id:null},emits:["close"],setup(o,{emit:m}){const{id:t}=o,{commodities:h}=O(),p=l(0),g=async()=>{const a=await h(t);p.value=a.endTime*1e3-new Date().getTime()};return R(()=>{g()}),(a,n)=>{const f=N("van-count-down"),v=N("VanButton");return i(),V("div",oe,[d("div",ae,[d("span",ne,[T(f,{millisecond:"",time:p.value,format:"HH:mm:ss:SS"},null,8,["time"])]),u(r(a.$t("order.no group tips")),1)]),ce,T(v,{class:"btn-detail w-[200px] h-[40px] rounded-3xl text-[#FB1A18] font-semibold",onClick:n[0]||(n[0]=()=>{m("close")})},{default:S(()=>[u(r(a.$t("common.return")),1)]),_:1})])}}}),ie=I(le,[["__scopeId","data-v-3c4bb187"]]),re={key:0},ue={class:"pt-4 text-left"},de={class:"text-[#FB1A18] text-lg"},me=E({props:{show:{type:Boolean,default:!1},goods:null,remaining:null,limitEach:null},emits:["close","success"],setup(o,{emit:m}){const t=o,{payToken:h,buy:p,commodities:g}=O(),{tradeContributeSelfRate:a}=L(),n=l(!1),[f,v]=Y(!1),b=l(null),s=l(1),k=l(0),B=x(()=>{var e;return+A((e=t.goods)==null?void 0:e.price).times(s.value)}),M=x(()=>U($.value/100*B.value*k.value)),w=x(()=>Math.min(+t.remaining,+t.limitEach)),F=e=>{if(e<1)s.value=1;else{if(+w.value<+e){s.value=+w.value;return}s.value=+e}},$=l(null),H=async()=>{var y;const e=await g((y=t.goods)==null?void 0:y.id);$.value=+A(+e.discountRate).div(1e4).toNumber()||20},P=async()=>{k.value=await a()},C=()=>{v(!1),s.value=1,m("close")},G=async()=>{P(),H(),await K(),await Z()},Z=async()=>{},j=async()=>{n.value=!0;const e=await p(t.goods.id,s.value);n.value=!1,e.success&&q()},q=()=>{m("success",s.value),v(!0)},K=async()=>{b.value=await h()};return R(()=>{G()}),(e,y)=>(i(),_(J,{show:t.show,onClose:C,title:c(f)?e.$t("order.purchase success"):e.$t("order.submitOrder")},{default:S(()=>[c(f)?(i(),_(ie,{key:1,id:t.goods.id,onClose:C},null,8,["id"])):(i(),V("div",re,[t.goods?(i(),_(z,{key:0,isDisabledEdit:!0,orderInfo:t.goods,number:s.value,"max-number":+c(w),onChangeNumber:F,needMask:!1},null,8,["orderInfo","number","max-number"])):D("",!0),d("div",ue,[u(r(e.$t("order.group intergral")),1),d("span",de,r(c(M)),1),u(" "+r(e.$t("common.credit")),1)]),b.value?(i(),_(ee,{key:1,contract:c(W).luckyShop,token:b.value,approveAmount:c(B),loading:n.value,fallBack:j,class:"text-sm my-8 h-[40px] min-w-[150px] rounded-3xl text-white btn-pink"},{default:S(()=>[u(r(e.$t("flashSale.buyNow")),1)]),_:1},8,["contract","token","approveAmount","loading"])):D("",!0)]))]),_:1},8,["show","title"]))}}),be=I(me,[["__scopeId","data-v-35283b72"]]);export{be as S};

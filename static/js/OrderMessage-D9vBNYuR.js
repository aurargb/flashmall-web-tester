import{_ as re}from"./clear-post-DEgIZooW.js";import{B as ie}from"./BackIcon-DkqwcD_b.js";import{_ as X,r as g,x as q,z as ce,F as b,G as c,H as s,I as te,J as ae,R as de,a2 as M,a3 as ue,Q as i,P as k,n as fe,w as ne,y as me,l as pe,a1 as xe,be as ve,D as ge,bh as be,bj as he,E as j,O as F,K as P,br as Y,N as f,T as A}from"./vendor-Ba70TIw4.js";import{l as Z}from"./shop-CeqcS6K2.js";import{v as ye,l as _e}from"./index-DGR86ePT.js";import{f as we,r as ke,q as Te,a as De}from"./mall-BBin_ClU.js";const Ue=["onClick","id"],Ce={class:"text-sm text-b3 font-normal flex items-center"},Le={class:"label__wrap"},Oe={key:0,class:"fm-tab-underline"},Ie={props:{options:{type:[Array,Object],required:!0},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"value"},modelValue:[String,Number,Object],scrollToSelected:{type:Boolean,default:!0},scrollOffset:{type:Number,default:16}},emits:["update:modelValue","change"],setup(d,{emit:D}){const u=d,r=g(null),O=g(null),S=g([]),T=q(()=>Array.isArray(u.options)?u.options:Object.values(u.options));function p(o){return o[u.valueKey]===u.modelValue}function R(o){D("update:modelValue",o[u.valueKey]),D("change",o[u.valueKey])}ce(()=>u.modelValue,async()=>{u.scrollToSelected&&(await fe(),U())},{immediate:!0});function U(){const o=T.value.findIndex(m=>p(m));if(o===-1)return;const L=document.getElementById(`fm-tab-item-${o}`),e=r.value;if(L&&e){const m=L.offsetLeft-(u.scrollOffset||0);e.scrollTo({left:m,behavior:"smooth"})}}let V=!1,_=0,w=0;function h(o){V=!0,_=o.touches?o.touches[0].pageX:o.pageX,w=r.value.scrollLeft}function C(o){if(!V)return;const L=o.touches?o.touches[0].pageX:o.pageX,e=_-L;r.value.scrollLeft=w+e}function I(){V=!1}return(o,L)=>(c(),b("div",{class:"fm-tab",ref:(e,m)=>{m.tabWrapper=e,r.value=e},onMousedown:h,onTouchstart:h,onMousemove:C,onTouchmove:C,onMouseup:I,onMouseleave:I,onTouchend:I},[s("div",{class:"flex flex-nowrap justify-start items-center gap-4",ref:(e,m)=>{m.tabList=e,O.value=e}},[(c(!0),b(te,null,ae(k(T),(e,m)=>(c(),b("div",{key:e[d.valueKey]??m,class:de([["fm-tab-item",{active:p(e)}],"relative last:pr-4"]),onClick:n=>R(e),ref:(n,B)=>{B.tabItems=n,S.value=n},id:`fm-tab-item-${m}`},[s("p",Ce,[s("span",Le,i(e[d.labelKey]),1),ue(o.$slots,"badge"+m,{},void 0,!0)]),p(e)?(c(),b("div",Oe)):M("",!0)],10,Ue))),128))],512)],544))}},ee=X(Ie,[["__scopeId","data-v-524e1736"]]),$e={class:"w-full bg-white rounded-xl p-3 overflow-x-hidden"},Me={class:"title__wrap w-full flex justify-start items-center"},Se={key:0,class:"w-[8px] h-[8px] rounded-full mr-1.5 bg-[#FF8812] flex-shrink-0"},Ve={class:"text-base text-b1 font-normal text-ellipsis line-clamp-1 flex-1 min-w-0"},Ee={key:1,class:"text-xs font-normal border border-[#FF8812] rounded-[2px] px-1 text-[#FF8812] ml-1 flex-shrink-0"},Fe=["innerHTML"],qe={class:"time__wrap w-full mt-2 no-wrap text-right"},Re={class:"text-sm text-b3 font-normal"},Be={props:{item:{type:Object,default:()=>{}}},setup(d){const D=d,{t:u}=ne(),{currentLocale:r}=ye(),O={1:"支付结果",2:"物流",3:"售后",4:"线下服务",5:"审核",11:"物流",12:"售后",13:"补货",14:"审核",15:"线下服务"},S=q(()=>{const T=D.item[`content${Z[r.value]}`]||D.item.contentCn||D.item.contentEn;return T?T.replace(/<[^>]*>/g,""):""});return(T,p)=>(c(),b("div",$e,[s("div",Me,[d.item.readFlag?M("",!0):(c(),b("div",Se)),s("p",Ve,i(d.item[`title${k(Z)[k(r)]}`]||d.item.titleCn||d.item.titleEn),1),d.item.category?(c(),b("p",Ee,i(O[d.item.category]),1)):M("",!0)]),s("div",{class:"content__wrap w-full text-sm text-b2 font-normal mt-2 line-clamp-2",innerHTML:k(S)},null,8,Fe),s("div",qe,[s("p",Re,i(k(_e)(d.item.updateTime||d.item.createTime)),1)])]))}},je=X(Be,[["__scopeId","data-v-059c4392"]]),Ae={class:"w-full h-full bg-[#f2f0ef]"},Ke={class:"header-bar sticky top-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 bg-white"},Ne={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},ze={class:"font-bold text-base text-b1"},Pe={key:1,class:"w-5 h-5",src:re,alt:"一键清空已读"},Xe={key:0},He={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ge={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},We={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Je={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Qe={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ye={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ze={key:1},et={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},tt={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},at={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},nt={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},st={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},lt={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},ot={class:"list__wrap w-full h-[calc(100vh-50px-34px)] z-10 overflow-y-auto scroll-smooth px-3 scrollPage"},rt=me({name:"OrderMessage"});function it(d){var J,Q;const{t:D}=ne(),u=pe(),r=xe(),O=q(()=>{var t;return((t=r.query)==null?void 0:t.type)==1?"consumer":"merchant"}),S=q(()=>[{label:"全部",value:null},{label:"支付结果",value:1},{label:"物流",value:2},{label:"售后",value:3},{label:"审核",value:5},{label:"线下服务",value:4}]),T=q(()=>[{label:"全部",value:null},{label:"物流",value:11},{label:"售后",value:12},{label:"补货",value:13},{label:"审核",value:14},{label:"线下服务",value:15}]),p=g((J=r.query)!=null&&J.category?+((Q=r.query)==null?void 0:Q.category):null),R=t=>{let l={...r.query,category:t};t||delete l.category,u.replace({path:"/orderMessage",query:l}),setTimeout(()=>{C()})},U=g(0),V=g(20),_=g(!1),w=g(!1),h=g([]),C=()=>{U.value=0,h.value=[],w.value=!1,I(),B()},I=()=>{w.value||(_.value=!0,U.value+=1,o())},o=()=>{var a;const t=p.value,l={page:U.value,size:V.value,type:(a=r.query)==null?void 0:a.type,category:t};Te(l).then(v=>{if(v.success===!1){A(v.message||"获取数据失败"),w.value=!0;return}if(t!=p.value){w.value=!0;return}const E=v.data||[],z=v.total||0;h.value=U.value===1?E:h.value.concat(E),(h.value.length>=z||E.length===0)&&(w.value=!0)}).catch(v=>{console.error("获取订单消息列表失败:",v),A("网络错误，请稍后重试"),w.value=!0}).finally(()=>{_.value=!1})},L=t=>{const l=t.id;t.readFlag=!0,m(l),t.goodsId;const a=t.orderId;switch(t.remindType){case 101:e("/buyerOrderList/buyerOrderDetail?id="+a);break;case 102:e("/buyerOrderList/buyerOrderDetail?id="+a);break;case 103:e("/buyerOrderList/buyerOrderDetail?id="+a);break;case 104:e("/refundDetail?id="+a);break;case 105:e("/refundDetail?id="+a);break;case 107:e("/buyerOrderList/buyerOrderDetail?id="+a);break;case 108:e("/buyerOrderList/buyerOrderDetail?id="+a);break;case 109:e("/evaluate-post?orderId="+a);break;case 110:e("/refundDetail?id="+a);break;case 111:e("/refundDetail?id="+a);break;case 112:e("/refundDetail?id="+a);break;case 201:e("/sellerOrderDetail?id="+a);break;case 205:e("/sellerOrderDetail?id="+a);break;case 2010:e("/sellerOrderDetail?id="+a);break;case 202:e("/merchantRefundDetail?id="+a);break;case 203:e("/shopGoods");break;case 204:e("/profile?path=merchant");break;case 106:e("/editShopInfo");break;case 206:e("/sellerOrderDetail?id="+a);break;case 207:e("/merchantRefundDetail?id="+a);break;case 208:e("/merchantRefundDetail?id="+a);break;case 209:e("/merchantRefundDetail?id="+a);break;case 210:e("/merchantRefundDetail?id="+a);break;case 100102:e("/offlineConsumerDetail?id="+a);break;case 100103:e("/offlineConsumerDetail?id="+a);break;case 100104:e("/offlineEvaluateSubmit?id="+a);break;case 100202:e("/offlineMerchantDetail?id="+a);break;case 1002020:e("/offlineMerchantDetail?id="+a);break;case 100203:e("/offlineMerchantDetail?id="+a);break}},e=t=>{u.push(t)},m=async t=>{await De({id:t})},n=g({}),B=async()=>{var l;const t=await we({type:(l=r.query)==null?void 0:l.type});if(t.success){n.value=t.data||{};return}console.log(t.data)},x=t=>t===0?0:t>99?"99+":t,[H,G]=ve(!1),K=g(null),se=()=>{var a;if(H.value)return;const t=Date.now();if(K.value&&t-K.value<2e3){A("请勿频繁点击");return}const l={type:(a=r.query)==null?void 0:a.type};G(!0),ke(l).then(v=>{v.success&&(A("已清除未读消息"),le(),C())}).catch(v=>{console.error("清空已读失败:",v)}).finally(()=>{G(!1)}),K.value=t},le=async()=>{h.value.forEach(t=>{t.readFlag=!0})};let $=null;const oe=async()=>{const t=sessionStorage.getItem("orderMessage_scrollTop");+t?$.scrollTo({top:+t,left:0,behavior:"instant"}):sessionStorage.removeItem("orderMessage_scrollTop")},N=g(!1),W=()=>{N.value||(N.value=!0,setTimeout(()=>{console.log($.scrollTop),sessionStorage.setItem("orderMessage_scrollTop",$.scrollTop+""),N.value=!1},500))};return ge(()=>{B(),$=document.querySelector(".scrollPage"),$.addEventListener("scroll",W)}),be(()=>{var t,l;console.log("onActivated");try{oe(),sessionStorage.getItem("orderMessage_refreshFlag")&&U.value>0&&(p.value=(t=r.query)!=null&&t.category?+((l=r.query)==null?void 0:l.category):null,C())}finally{sessionStorage.removeItem("orderMessage_refreshFlag")}}),he(()=>{$.removeEventListener("scroll",W)}),(t,l)=>{const a=j("van-loading"),v=j("Empty"),E=j("van-list"),z=j("van-pull-refresh");return c(),b("div",Ae,[s("section",Ke,[s("div",Ne,[F(ie)]),s("div",ze,i(t.$t("home.Order Message")),1),s("div",{class:"absolute right-4 flex items-center gap-1 -translate-y-1/2 top-1/2 w-5 h-5",onClick:se},[k(H)?(c(),P(a,{key:0,size:"20"})):(c(),b("img",Pe))])]),k(O)==="consumer"?(c(),b("section",Xe,[F(ee,{options:k(S),modelValue:p.value,"onUpdate:modelValue":l[0]||(l[0]=y=>p.value=y),onChange:R,"label-key":"label","value-key":"value"},Y({_:2},[n.value.totalUnread>0?{name:"badge0",fn:f(()=>[s("span",He,i(x(n.value.totalUnread)),1)])}:void 0,n.value.paymentUnread>0?{name:"badge1",fn:f(()=>[s("span",Ge,i(x(n.value.paymentUnread)),1)])}:void 0,n.value.logisticsUnread>0?{name:"badge2",fn:f(()=>[s("span",We,i(x(n.value.logisticsUnread)),1)])}:void 0,n.value.aftersaleUnread>0?{name:"badge3",fn:f(()=>[s("span",Je,i(x(n.value.aftersaleUnread)),1)])}:void 0,n.value.reviewUnread>0?{name:"badge4",fn:f(()=>[s("span",Qe,i(x(n.value.reviewUnread)),1)])}:void 0,n.value.offlineUnread>0?{name:"badge5",fn:f(()=>[s("span",Ye,i(x(n.value.offlineUnread)),1)])}:void 0]),1032,["options","modelValue"])])):M("",!0),k(O)==="merchant"?(c(),b("section",Ze,[F(ee,{options:k(T),modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=y=>p.value=y),onChange:R,"label-key":"label","value-key":"value"},Y({_:2},[n.value.totalUnread>0?{name:"badge0",fn:f(()=>[s("span",et,i(x(n.value.totalUnread)),1)])}:void 0,n.value.logisticsUnread>0?{name:"badge1",fn:f(()=>[s("span",tt,i(x(n.value.logisticsUnread)),1)])}:void 0,n.value.aftersaleUnread>0?{name:"badge2",fn:f(()=>[s("span",at,i(x(n.value.aftersaleUnread)),1)])}:void 0,n.value.restockUnread>0?{name:"badge3",fn:f(()=>[s("span",nt,i(x(n.value.restockUnread)),1)])}:void 0,n.value.reviewUnread>0?{name:"badge4",fn:f(()=>[s("span",st,i(x(n.value.reviewUnread)),1)])}:void 0,n.value.offlineUnread>0?{name:"badge5",fn:f(()=>[s("span",lt,i(x(n.value.offlineUnread)),1)])}:void 0]),1032,["options","modelValue"])])):M("",!0),s("section",ot,[F(z,{modelValue:_.value,"onUpdate:modelValue":l[3]||(l[3]=y=>_.value=y),onRefresh:C,"animation-duration":"0"},{default:f(()=>[h.value.length===0&&!_.value?(c(),P(v,{key:0,name:"暂无消息"})):M("",!0),F(E,{loading:_.value,"onUpdate:loading":l[2]||(l[2]=y=>_.value=y),finished:w.value,"finished-text":h.value.length===0?"":"没有更多了",onLoad:I},{default:f(()=>[(c(!0),b(te,null,ae(h.value,y=>(c(),P(je,{key:y.id,item:y,class:"mb-3 first:mt-3",onClick:dt=>L(y)},null,8,["item","onClick"]))),128))]),_:1},8,["loading","finished","finished-text"])]),_:1},8,["modelValue"])])])}}const ct=Object.assign(rt,{setup:it}),gt=X(ct,[["__scopeId","data-v-333d8282"]]);export{gt as default};

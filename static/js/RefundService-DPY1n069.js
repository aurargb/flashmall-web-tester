import{y as de,l as me,r as g,x as G,B as ee,D as pe,E as I,F as c,G as l,H as e,a3 as Oe,a4 as H,P as r,Q as a,I as J,J as se,O as x,a2 as $,a0 as B,_ as Ue,w as ze,a1 as qe,be as L,bf as Me,K as N,N as b,bQ as Ge,$ as le,T as p,a7 as He,bc as M,bd as te,bp as Je,bF as Ke,bG as Qe,R as ue,bs as We,Y as Ye,Z as Ze}from"./vendor-Ba70TIw4.js";import{_ as fe}from"./arrow-down-x_dmP0bG.js";import{_ as he}from"./check-CyxOtqoc.js";import{B as Xe}from"./BackIcon-DkqwcD_b.js";import{_ as et}from"./credit-0laLclE7.js";import{_ as ve}from"./MCOIN-BOqZVkND.js";import{_ as tt}from"./USDT-CNsbs3BR.js";import{u as st}from"./useOrderStatus-eiwKm5Dv.js";import{P as ot}from"./order-H59PKTFP.js";import{f as at,d as ie,o as nt,r as lt,W as ut,a3 as it,q as rt}from"./index-DGR86ePT.js";import{u as ct}from"./useShipTemplate-CJrw2UwP.js";import{a as re}from"./useRefund-Dpqhghzq.js";import{d as dt}from"./default-avatar-DfqlD94j.js";import{_ as mt}from"./EmptyTipsPop-AMgmP7g9.js";import{c as pt,a as ft}from"./order-DXFBu85c.js";import{b as ht,c as vt,d as _t,f as xt}from"./refund-DRt_sEsn.js";import{i as ce}from"./offlineGoods-DvT2Go6q.js";import{u as bt}from"./upload-28Y_C7H9.js";import"./enums-DlE-aiss.js";const gt={class:"p-3 mt-3 bg-white rounded-xl font-Puhui"},yt={class:"flex justify-between"},wt={class:"flex items-center overflow-hidden"},Et=["src"],kt={class:"text-sm font-semibold text-b1 line-clamp-1 ml-1"},$t={class:"font-semibold text-[#FF8812] text-sm line-clamp-1"},Bt={key:0},Ft={key:0},Ct={key:1},Rt={key:2},St={class:"flex w-full gap-2"},Tt={class:"w-[calc(100%-40px-60px)] flex-1 flex flex-col min-h-[5rem] justify-between"},It={class:"flex items-baseline justify-between font-semibold"},Dt={class:"text-base text-b1 font-semibold line-clamp-1 text-ellipsis"},At={key:0,class:"flex-shrink-0 flex items-center text-xs text-[#34C2A9]"},Pt=e("img",{src:et,class:"w-5 h-5"},null,-1),Lt={class:"text-sm text-b3 font-normal h-[40px]"},Nt={class:"ml-1"},jt={key:0,class:"flex justify-between"},Vt={class:"text-sm font-normal text-b3 line-clamp-1"},Ot={class:"text-b1 text-sm font-semibold"},Ut={key:0,class:"flex items-center"},zt=e("img",{class:"w-4 h-4 mr-1 font-normal text-sm",src:ve},null,-1),qt={key:1,class:"flex items-center"},Mt=e("img",{class:"w-4 h-4 mr-1 font-normal text-sm",src:tt},null,-1),Gt=B("( "),Ht=e("img",{class:"w-4 h-4 mr-1 font-normal text-sm",src:ve},null,-1),Jt=de({props:{order:null,isList:{type:Boolean},showPrice:{type:Boolean,default:!0},showShippingTemplate:{type:Boolean,default:!1}},setup(d){const S=d,K=me(),V=st(S.order),O=g(null),D=G(()=>1/O.value),U=async()=>{const{mcoinRate:n}=at();O.value=await n()};G(()=>{var n;return!((n=S.order)!=null&&n.totalAmount)||!D.value?0:new ee(S.order.totalAmount).times(D.value).toNumber()});const A=n=>{K.push(n)},{getExpressTypeText:E}=ct(),F=n=>{const h=new ee(n.price).times(n.number).minus(n.goodsActivityReduceAmount||0).plus(n.goodsAdjustChangeAmount||0).toNumber();return ie(h||0)},Q=n=>{const h=new ee(n.price).times(n.number).minus(n.goodsActivityReduceAmount||0).plus(n.goodsAdjustChangeAmount||0).times(D.value).toNumber();return ie(h||0)};return pe(async()=>{await U()}),(n,h)=>{const P=I("VanImage");return l(),c("div",gt,[e("div",yt,[e("div",{class:"flex-start",onClick:h[0]||(h[0]=H(f=>A(`/category?deliveryType=1&shopId=${d.order.stores.id}`),["stop"]))},[e("div",wt,[e("img",{src:d.order.stores.logo||r(dt),class:"flex-shrink-0 w-[24px] h-[24px] rounded-[4px] object-cover"},null,8,Et),e("div",kt,a(d.order.stores.storeName||"--"),1)])]),e("div",$t,[r(re)(d.order).available?(l(),c("span",Bt,a(r(re)(d.order).label),1)):(l(),c(J,{key:1},[d.order.status==-1?(l(),c("span",Ft,a(n.$t("order.canceled")),1)):d.order.status===0&&d.order.hash?(l(),c("span",Ct,a(n.$t("order.wait block chain")),1)):(l(),c("span",Rt,a(r(V)[d.order.status+""]),1))],64))])]),(l(!0),c(J,null,se(d.order.orderGoods,f=>(l(),c("div",{class:"mt-4",key:f.goodsName},[e("div",null,[e("div",St,[x(P,{onClick:H(o=>A(`/buyerOrderList/detail?id=${f.goodsId}`),["stop"]),src:(f.icons||"").split(",")[0],class:"shrink-0 w-20 h-20 overflow-hidden rounded-[8px]",alt:"",fit:"cover"},null,8,["onClick","src"]),e("div",Tt,[e("div",null,[e("div",It,[e("div",Dt,[B(a(f.goodsName)+" ",1),f.creditFlag?(l(),c("div",At,[Pt,B(" "+a(n.$t("order.Credit Collection")),1)])):$("",!0)])]),e("div",Lt,[e("span",null,a(n.$t("order.quantity",{number:f.number||0})),1),e("span",Nt,a(r(E)(f)),1)]),d.showPrice?(l(),c("div",jt,[e("span",Vt,a(n.$t("common.total"))+"： ",1),e("div",Ot,[+d.order.paySource!==r(ot).USDT_WALLET?(l(),c("div",Ut,[zt,e("span",null,a(F(f)),1)])):(l(),c("div",qt,[Mt,B(" "+a(Q(f))+" ",1),e("span",null,[Gt,Ht,B(" "+a(F(f))+")",1)])]))])])):$("",!0)])])])])]))),128)),Oe(n.$slots,"default")])}}}),j=d=>(Ye("data-v-5bbc6782"),d=d(),Ze(),d),Kt={class:"px-3 pb-[100px] main-bg"},Qt={class:"header-bar fixed top-0 left-0 right-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 backdrop-blur-md bg-[#FED73A]"},Wt={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},Yt={class:"font-bold text-base text-b1"},Zt={class:"safe-bottom pt-[50px]"},Xt={class:"px-3 mt-3 bg-white rounded-xl font-semibold"},es=j(()=>e("p",{class:"text-b1 font-semibold text-sm"},"退款类型",-1)),ts={class:"ml-auto flex items-center gap-0"},ss={class:"text-b3 font-normal text-sm not-italic"},os={key:0,class:"line-clamp-1"},as={key:1},ns=j(()=>e("img",{src:fe,class:"w-4 h-4"},null,-1)),ls=j(()=>e("p",{class:"text-b1 font-semibold text-sm"},"退款原因",-1)),us={class:"ml-auto flex items-center gap-0"},is={class:"text-b3 font-normal text-sm not-italic"},rs={key:0,class:"line-clamp-1"},cs={key:1},ds=j(()=>e("img",{src:fe,class:"w-4 h-4"},null,-1)),ms={class:"px-3 py-4 mt-3 bg-white rounded-xl font-semibold min-h-[100px]"},ps={class:"text-b1 text-sm font-semibold"},fs={class:"text-count"},hs={class:"text-sm text-b3 font-normal text-right"},vs={class:"van-uploader__wrapper gap-1.5 mt-2"},_s=["onClick"],xs={class:"van-image van-uploader__preview-image overflow-hidden",style:{width:"73px",height:"73px"}},bs=["src"],gs=["onClick"],ys=j(()=>e("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),ws=[ys],Es={class:"w-[73px] h-[73px] bg-transparent rounded-md border-b3 border-dashed border text-center flex flex-col justify-center items-center text-[#d9d9d9]"},ks=["src"],$s={class:"text-xs font-light text-center text-b3"},Bs={class:"text-xxs font-light text-center text-b3"},Fs={class:"fixed bottom-0 left-0 right-0 p-4 px-3 bg-transparent safe-bottom w-full"},Cs={class:"mt-[16px] mb-[16px] text-center font-bold text-base"},Rs={class:"px-4 reason-list"},Ss=["onClick"],Ts={class:"ml-auto"},Is={src:he,class:"w-5 h-5",alt:"已选"},Ds={class:"text-center w-full p-4"},As={class:"mt-[16px] mb-[16px] text-center font-bold text-base bg-transparent"},Ps={class:"px-4 reason-list"},Ls=["onClick"],Ns={class:"ml-auto"},js={src:he,class:"w-5 h-5",alt:"已选"},Vs={class:"text-center w-full p-4"},Os=de({setup(d){const{loadingToggle:S}=lt(),{senderProtest:K}=nt(),V=qe(),O=me(),{locale:D,t:U}=ze(),A=V.query.id;V.query.role;const E=g({}),[F,Q]=L(!0),[n,h]=L(!1),[P,f]=L(!1);Me({reasonList:[],checked:null});const o=g({type:null,typeId:null,reasonId:null,reason:null,content:"",pictures:[]}),_e=G(()=>Y.value.orderStatus==1?"未收到货-":Y.value.orderStatus==2?"已收到货-":""),xe=G(()=>!o.value.typeId||!o.value.reasonId),v=g([]),W=g(3),be=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var s=Math.random()*16|0,u=t==="x"?s:s&3|8;return u.toString(16)}),ge=t=>{let s=!1;const u=ce.split(",");for(let m=0;m<u.length;m++)if((t==null?void 0:t.type)===u[m]){s=!0;break}return s||p(U("common.uploadImgTypeTips",{format:u.map(m=>m.slice(6)).join("/")})),s},ye=async t=>{if(v.value.length>=W.value||!ge(t.file))return;p.loading({message:U("common.uploading"),forbidClick:!0,duration:0});const s=await it(t,"goodsImg"),u=await bt(s);p.clear(),u.success&&v.value.push({id:be(),url:rt.imgUrl+u.data})},we=t=>{v.value.splice(t,1)},Ee=t=>{We({images:v.value.map(s=>s.url),startPosition:t})},ke=async()=>{const t=await ft({id:A});E.value=t.data,Q(!1)},$e=async()=>{try{h(!0);const t=await pt({orderIds:E.value.id+""}),s=t.data.ordIds&&t.data.ordIds[0],u=await K(s);return u&&u.success}catch(t){return p(t.message||t),!1}},Be=async(t,s)=>{try{h(!0);const{success:u}=await t(s);u&&Ce()}catch(u){p(u.message||u)}finally{h(!1)}},Fe=async()=>{var i;if(!o.value.typeId){p("请选择退款类型");return}if(!o.value.reasonId){p("请选择退款原因");return}if(!((i=o.value.type)!=null&&i.optionType)){p("退款类型错误，无法继续");return}const t={imgs:v.value.length>0?v.value.map(_=>_.url).join(","):"",content:o.value.content||""},s={orderId:E.value.id,refundType:o.value.type.refundType,refundReasonId:o.value.reason.id,evidence:He.isEmpty(t)?null:JSON.stringify(t)},u=E.value.creditFlag||null,m=o.value.type.optionType,C=o.value.type.refundType;let T=!1;(m==2&&C==1||m==1&&u==1)&&(T=!0);let k=null;if(m==3?k=ht:m==2?k=vt:m==1&&(k=_t),!!k){if(T&&!await $e()){h(!1);return}await Be(k,s)}},Ce=()=>{setTimeout(()=>{Re()},1500)},Re=()=>{O.push("/buyerOrderList?active=-1")},Y=g({orderStatus:null}),z=g([]),y=g(null),[Z,oe]=L(!1),Se=()=>{y.value=o.value.type,oe(!0)},Te=()=>{oe(!1)},Ie=t=>{if(!t||!t.id){p("请选择退款类型");return}y.value=t},De=()=>{if(!y.value){p("请选择退款类型");return}o.value.type=y.value,o.value.typeId=y.value.id,o.value.reasonId=null,o.value.reason=null,w.value=null,q.value=z.value.find(s=>s.id===y.value.id).reasonList||[];const t=Ne(D.value);q.value.forEach(s=>{s.name=s[t]||s.jtName||"--"}),Te(),setTimeout(()=>{ne()},200)},w=g(null),[X,ae]=L(!1),q=g([]),ne=()=>{w.value=o.value.reason,ae(!0)},Ae=()=>{if(!w.value){p("请选择退款原因");return}o.value.reason=w.value,o.value.reasonId=w.value.id,ae(!1)},Pe=t=>{w.value=t},Le=()=>{const t=A||"";if(!t){p("缺少订单信息，无法获取售后业务！");return}xt(t).then(s=>{if(s.success){Y.value=s.data||{};const u=s.data.options||[];if(u.length<=0){p("暂无售后选项，请确认订单状态");return}let m=1;u.forEach(C=>{C.id=m++}),z.value=u}else p("获取售后类型失败")}).catch(s=>{})},Ne=t=>{let s="cnFtName";switch(t){case"zh-CN":s="jtName";break;case"zh-HK":s="cnFtName";break;case"en-US":s="enName";break;case"ja-JP":s="japanName";break}return s},je=async()=>{S(!0),await ke(),await Le(),S(!1)};return pe(async()=>{await je()}),(t,s)=>{const u=I("van-skeleton"),m=I("van-uploader"),C=I("VanButton"),T=I("Empty"),k=I("VanPopup");return l(),c("div",Kt,[e("section",Qt,[e("div",Wt,[x(Xe)]),e("div",Yt,a(t.$t("order.deliver")),1)]),e("section",Zt,[x(u,{title:"",row:3,loading:r(F),round:"",class:"p-3 mt-3 bg-white rounded-xl"},{default:b(()=>[E.value?(l(),N(Jt,{key:0,class:"!mt-0",order:E.value,showShippingTemplate:""},null,8,["order"])):$("",!0)]),_:1},8,["loading"]),e("section",Xt,[x(u,{title:"",row:1,loading:r(F),round:"",class:"p-1"},{default:b(()=>[e("div",{class:"cell-item flex items-center justify-start",onClick:Se},[es,e("span",ts,[e("span",ss,[o.value.typeId?(l(),c("span",os,a(o.value.type.optionTitle||"--"),1)):(l(),c("span",as,a(t.$t("shop.pleaseSelect")),1))]),ns])]),o.value.typeId?(l(),c("div",{key:0,class:"cell-item flex items-center justify-start",onClick:ne},[ls,e("span",us,[e("span",is,[o.value.reasonId?(l(),c("span",rs,a(o.value.reason.name),1)):(l(),c("span",cs,a(t.$t("shop.pleaseSelect")),1))]),ds])])):$("",!0)]),_:1},8,["loading"])]),x(Ge,{name:"appeal-fade"},{default:b(()=>[M(e("section",ms,[e("p",ps,a(t.$t("order.appeal content")),1),M(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=i=>o.value.content=i),placeholder:"输入凭证有利于平台与商家更好处理售后问题",maxlength:150,class:"w-full h-full bg-transparent min-h-[60px] text-sm font-normal resize-none mt-2"},null,512),[[Je,o.value.content,void 0,{trim:!0}]]),e("div",fs,[e("div",hs,a(o.value.content?o.value.content.length:0)+" / 150 ",1)]),e("div",vs,[x(r(Ke),Qe({class:"flex flex-wrap gap-1.5 h-[73px]",modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=i=>v.value=i),"item-key":"id",distance:"12",delay:"200",touchStartThreshold:"15"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"},{handle:".handle"}),{item:b(({element:i,index:_})=>[e("div",{class:"van-uploader__preview overflow-hidden",onClick:H(R=>Ee(_),["stop"])},[e("div",xs,[e("img",{src:i.url,class:"van-image__img rounded-md",style:{"object-fit":"cover"}},null,8,bs)]),e("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"Delete",onClick:H(R=>we(_),["stop"])},ws,8,gs)],8,_s)]),_:1},16,["modelValue","handle"]),v.value&&v.value.length<W.value?(l(),N(m,{key:0,accept:r(ce),afterRead:ye},{default:b(()=>[e("div",Es,[e("img",{src:r(ut)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,ks),e("div",$s,a(t.$t("common.add img")),1),e("div",Bs,a(v.value.length+1)+" / "+a(W.value),1)])]),_:1},8,["accept"])):$("",!0)])],512),[[te,o.value.typeId&&o.value.reasonId&&o.value.type.optionType!=1]])]),_:1}),e("div",Fs,[x(C,{loading:r(n),disabled:r(xe),class:"w-full main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:Fe},{default:b(()=>[B(a(t.$t("ecology.submitApplication")),1)]),_:1},8,["loading","disabled"])])]),x(k,{show:r(Z),"onUpdate:show":s[2]||(s[2]=i=>le(Z)?Z.value=i:null),round:"",position:"bottom",closeable:"",style:{height:"auto",maxHeight:"80%"}},{default:b(()=>[e("div",Cs,a(t.$t("refund.select refund type")),1),e("div",Rs,[z.value.length===0&&!r(F)?(l(),N(T,{key:0,name:"无可选退款类型"})):$("",!0),(l(!0),c(J,null,se(z.value,i=>{var _,R;return l(),c("div",{key:i.id,class:"select-item w-full h-[52px] border-b border-[#D9D9D9] flex items-center justify-start font-normal :last:border-b-0",onClick:Ve=>Ie(i)},[e("div",{class:ue(["text-sm flex items-center whitespace-pre-wrap",[((_=y.value)==null?void 0:_.id)==i.id?"text-[#FF8812] font-semibold":"text-b1 font-normal"]])},[e("span",null,a(i.optionTitle),1)],2),e("div",Ts,[M(e("img",Is,null,512),[[te,((R=y.value)==null?void 0:R.id)==i.id]])])],8,Ss)}),128))]),e("div",Ds,[x(C,{loading:r(n),disabled:!y.value,class:"w-full main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:De},{default:b(()=>[B(a(t.$t("common.next step")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]),x(k,{show:r(X),"onUpdate:show":s[3]||(s[3]=i=>le(X)?X.value=i:null),round:"",position:"bottom",closeable:!0,style:{height:"auto",maxHeight:"80%"}},{default:b(()=>[e("div",As,a(t.$t("refund.reason")),1),e("div",Ps,[q.value.length===0&&!r(F)?(l(),N(T,{key:0,name:"无可选退款原因"})):$("",!0),(l(!0),c(J,null,se(q.value,i=>{var _,R;return l(),c("div",{key:i.id,class:"select-item w-full h-[52px] border-b border-[#D9D9D9] flex items-center justify-start font-normal :last:border-b-0",onClick:Ve=>Pe(i)},[e("div",{class:ue(["text-sm flex items-center whitespace-pre-wrap",[((_=w.value)==null?void 0:_.id)==i.id?"text-[#FF8812] font-semibold":"text-b1 font-normal"]])},[e("span",null,a(r(_e))+a(i.name),1)],2),e("div",Ns,[M(e("img",js,null,512),[[te,((R=w.value)==null?void 0:R.id)==i.id]])])],8,Ls)}),128))]),e("div",Vs,[x(C,{loading:r(n),disabled:!w.value,class:"w-full main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:Ae},{default:b(()=>[B(a(t.$t("common.confirm")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]),r(P)?(l(),N(mt,{key:0,onClose:s[4]||(s[4]=i=>r(f)(!1)),text:t.$t("shop.shippingTemplate.submitSuccess")},null,8,["text"])):$("",!0)])}}}),lo=Ue(Os,[["__scopeId","data-v-5bbc6782"]]);export{lo as default};

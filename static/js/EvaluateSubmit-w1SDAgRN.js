import{_ as te,y as j,w as ae,l as se,a2 as oe,r as i,be as x,x as N,D as le,E as y,K as D,G as b,N as _,H as e,X as ne,O as p,F as R,P as o,a1 as L,Q as u,bc as re,bp as ie,T as n,Z as ue,$ as ce}from"./vendor-BlU_hoYl.js";import{_ as me}from"./USDT-Dlu99aCg.js";import{_ as z}from"./MCOIN-Bodfn-v1.js";import{u as de}from"./upload-Bd5o3h4D.js";import{d as C,W as U,bX as pe,bS as ve,aa as fe,ab as _e,a3 as he,q as ge,bY as xe}from"./index-Clz0Qna-.js";import{P as be}from"./order-H59PKTFP.js";import{o as Se}from"./offlineGoods-DvT2Go6q.js";import{u as we}from"./usePaymentBalance-CdD8IrLf.js";import{p as ye}from"./useOrderStatus-D1Cw0BRr.js";import{_ as Ce}from"./OfflineGoods-BGXEfi-E.js";import{_ as Pe}from"./OfflineStore-CFeVI8_T.js";import{C as Ee}from"./CommonVanProvider-CDfGVWR4.js";import{_ as Fe}from"./EmptyTipsPop-DRPu7DDc.js";import"./piggyBank-CijQhzOF.js";import"./ImgBoutiqueLable-BIio6fYG.js";import"./shop-CeqcS6K2.js";import"./BackIcon-8hcEjDKb.js";const A=""+new URL("../images/light-star-CbzxYf8w.png",import.meta.url).href,$=""+new URL("../images/dark-star-C-m8XRO0.png",import.meta.url).href,v=h=>(ue("data-v-b9cf18bc"),h=h(),ce(),h),Ie={class:"content__wrap px-3 pb-20 flex flex-col gap-3 overflow-y-auto"},Te={class:"w-full p-3 rounded-xl bg-white"},ke={class:"text-b3"},Ve={class:"text-b1 text-sm font-normal text-right"},Be={key:0,class:"flex justify-start items-center"},Ne={class:"text-b1 text-sm font-semibold ml-1 flex justify-end items-center"},De={class:"flex justify-start items-center"},Re=v(()=>e("img",{class:"w-[17px] h-[17px]",src:me},null,-1)),Le={class:"flex justify-start items-center ml-1"},Ue=v(()=>e("span",{class:"text-b3"},"(",-1)),Ae=v(()=>e("img",{class:"w-[17px] h-[17px]",src:z},null,-1)),$e=v(()=>e("span",{class:"text-b3"}," ) ",-1)),je={key:1,class:"flex justify-start items-center"},ze=v(()=>e("img",{class:"w-[17px] h-[17px]",src:z},null,-1)),Me={class:"text-b1 text-sm font-semibold ml-1"},Oe={class:"w-full min-h-[140px] p-3 rounded-xl bg-white"},Xe={class:"check-star__wrap"},Ge={class:"flex items-center justify-start"},qe={class:"text-b1 text-sm font-normal h-6 leading-6"},We={class:"ml-2 h-6"},Ye={class:"flex items-center justify-start mt-3"},He={class:"text-b1 text-sm font-normal h-6 leading-6"},Ke={class:"ml-2 h-6"},Qe={class:"mt-3"},Ze={class:"w-full min-h-[100px] p-2 rounded-lg bg-[#f5f5f5]"},Je=["placeholder"],et={class:"mt-3"},tt={class:"w-[60px] h-[60px] bg-b5 rounded-md text-center flex flex-col justify-center items-center text-[#d9d9d9]"},at=["src"],st={class:"text-xxs font-light text-center text-b1 opacity-30"},ot=v(()=>e("br",null,null,-1)),lt={class:"text-[8px]"},nt={class:"fixed w-full left-0 right-0 bottom-0 safe-bottom px-3 bg-transparent"},rt=j({name:"OfflineEvaluateSubmit"});function it(h){var B;const{t:c}=ae(),P=se(),M=oe();we(i(!0));const E=3,[O,S]=x(!1),[X,F]=x(!1),[ct,I]=x(!1),G=i(c("evaluate.Published successfully")),q=i(!1),T=i(!0),k=i({}),f=i(((B=M.query)==null?void 0:B.id)||null),a=i({orderPaySource:null}),W=async()=>{if(!f.value)return;n.loading({message:c("common.loading"),forbidClick:!0}),I(!0);const t=await ve({id:f.value});I(!1),n.clear(),t.success&&t.data&&(a.value=t.data||{},l.value.orderId=f.value)};N(()=>Se(a.value.orderType));const Y=N(()=>{let t=c("evaluate.praise");return l.value.commentStar>0&&l.value.commentStar<3?t=c("evaluate.Communicate issues in detail to help merchants improve"):l.value.commentStar>=3&&(t=c("evaluate.praise")),t||""}),l=i({orderId:null,commentStar:5,commentShopStar:5,commentContent:"",commentPics:""}),m=i([]),[H,V]=x(!1),K=async t=>{const s=fe(t.file);if(!s.valid)return m.value.length-=1,n(s.tips);const d=_e(t.file);if(!d.valid)return m.value.length-=1,n(d.tips);n.loading({message:c("common.uploading"),forbidClick:!0,duration:0}),V(!0);const w=await he(t,"goodsImg"),g=await de(w);if(V(!1),n.clear(),!g.success)return n("图片上传失败"),m.value.length-=1;m.value[m.value.length-1]={url:ge.imgUrl+g.data}},Q=async()=>{if(H.value){n(c("common.uploading"));return}if(!l.value.commentStar){n(c("evaluate.Please give a service rating"));return}if(!l.value.commentShopStar){n(c("evaluate.Please give a store rating"));return}const t={...l.value,commentPics:m.value.map(d=>d.url).join(",")||""};if(console.log(t),S(!0),!(await xe(t)).success){S(!1);return}S(!1),F(!0),sessionStorage.setItem("evaluate_refresh_flag","1"),setTimeout(()=>{P.back()},800)},Z=async()=>{const t=await pe({id:f.value});t.success&&t.data&&(T.value=!1,k.value=t.data||{},k.value.commentStatus===1&&setTimeout(()=>{J("您已对该订单完成评价，无需重复操作"),setTimeout(()=>{P.back()},2e3)},50))},J=(t="",s="toast-warn.svg")=>{n({message:t,icon:U(s),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})};return i(!1),le(()=>{f.value&&(Z(),W())}),(t,s)=>{const d=y("van-rate"),w=y("van-uploader"),g=y("VanButton");return b(),D(Ee,{title:t.$t("evaluate.Post a review"),class:"bg-[#F2F0EF] font-Puhui font-normal relative app-container","theme-vars":{"field-placeholder-text-color":"#A6A6A6",navBarBackgroundColor:"#F2F0EF"},ref:(r,ee)=>{ee.EvaluateDetailRef=r}},{default:_(()=>[e("section",Ie,[e("div",Te,[p(Pe,{"show-order-evaluate":"",shop:{images:a.value.shopPics||a.value.relIcons,name:a.value.shopName}},null,8,["shop"]),p(Ce,{"show-order-type":"",class:"mt-3",number:a.value.relNumber,goods:{goodsName:a.value.relName||"-",goodsIcons:a.value.relIcons,goodsPrice:a.value.relPrice||0,orderType:a.value.orderType,areaExtName2:a.value.areaExtName2,storeName:a.value.storeName}},{"bottom-left":_(()=>[e("div",ke,u(a.value.orderPaySource?o(ye)(+a.value.orderPaySource):"--"),1)]),"bottom-price":_(()=>[e("div",Ve,[+a.value.orderPaySource===o(be).USDT_WALLET?(b(),R("div",Be,[e("span",Ne,[e("span",De,[Re,L(" "+u(o(C)(a.value.orderRealUsdt||0)),1)]),e("span",Le,[Ue,Ae,e("span",null,u(o(C)(a.value.orderRealAmount||0)),1),$e])])])):(b(),R("div",je,[ze,e("span",Me,[e("span",null,u(o(C)(a.value.orderRealAmount)),1)])]))])]),_:1},8,["number","goods"])]),e("div",Oe,[e("div",Xe,[e("div",Ge,[e("div",qe,u(t.$t("evaluate.service Rating")),1),e("div",We,[p(d,{modelValue:l.value.commentStar,"onUpdate:modelValue":s[0]||(s[0]=r=>l.value.commentStar=r),size:24,gutter:12,icon:o(A),"void-icon":o($)},null,8,["modelValue","icon","void-icon"])])]),e("div",Ye,[e("div",He,u(t.$t("evaluate.Store Rating")),1),e("div",Ke,[p(d,{modelValue:l.value.commentShopStar,"onUpdate:modelValue":s[1]||(s[1]=r=>l.value.commentShopStar=r),size:24,gutter:12,icon:o(A),"void-icon":o($)},null,8,["modelValue","icon","void-icon"])])])]),e("div",Qe,[e("div",Ze,[re(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=r=>l.value.commentContent=r),maxlength:200,class:"w-full h-full bg-transparent min-h-[100px] text-sm font-normal resize-none",placeholder:o(Y)},null,8,Je),[[ie,l.value.commentContent]])])]),e("div",et,[p(w,{modelValue:m.value,"onUpdate:modelValue":s[3]||(s[3]=r=>m.value=r),accept:"image/*","max-count":E,"preview-size":"60",afterRead:K},{default:_(()=>[e("div",tt,[e("img",{src:o(U)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,at),e("div",st,[e("span",null,u(t.$t("offline.add_image")),1),ot,e("span",lt,u(m.value.length+1)+" / "+u(E),1)])])]),_:1},8,["modelValue"])])])]),e("section",nt,[p(g,{round:"",class:"w-full main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:Q,loading:o(O),disabled:T.value},{default:_(()=>[L(u(t.$t("evaluate.Post a review")),1)]),_:1},8,["loading","disabled"])]),o(X)?(b(),D(Fe,{key:0,onClose:s[4]||(s[4]=r=>o(F)(!1)),"is-error":q.value,text:G.value},null,8,["is-error","text"])):ne("",!0)]),_:1},8,["title"])}}const ut=j({...rt,setup:it}),It=te(ut,[["__scopeId","data-v-b9cf18bc"]]);export{It as default};

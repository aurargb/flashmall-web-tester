import{_ as Ne,y as Pe,w as Fe,be as Ae,r as A,z as ze,o as Ce,x as xe,bf as Ve,D as Ge,E as $,F as x,G as f,H as s,O as b,N as v,bD as We,P as o,Q as a,X as G,I as ne,J as ge,K as J,a1 as B,R as ye,a4 as je,a0 as Se,Y as Re,Z as Ye,$ as qe,bw as Be,T as R,B as be,a2 as Je,l as Qe,t as Xe}from"./vendor-BlU_hoYl.js";import{_ as Ze}from"./avatarRing-DtI_kRg6.js";import{_ as et}from"./credit-0laLclE7.js";import{_ as tt}from"./MCOIN-BOqZVkND.js";import{_ as st}from"./copy-w-Dr8nkqKW.js";import{U as nt}from"./UnfreezePop-Bc69tqDd.js";import{u as Ke,ad as ke,e as ot,o as at,b as Ee,l as se,h as it,d as rt,R as lt,C as dt}from"./index-Wb-6_0W_.js";import{a as Le}from"./refund-B5IEjYwn.js";import{P as ct}from"./flashSale-DDyqLyYN.js";import{w as ut,c as mt,l as Me,v as ft}from"./order-pJoL_MtT.js";import{c as Oe,d as pt,a as He,u as Ue}from"./useRefund-CagomE1G.js";import{d as ht}from"./useOrderActionButtons-CwgowcAa.js";import{h as vt,_ as yt,e as xt}from"./excel-B8sCVOEn.js";import{a as gt}from"./category-DR69a6kO.js";import{f as bt}from"./useOrderStatus-D1Cw0BRr.js";const wt="/static/images/search-Cgf_Px26.svg",Tt="/static/images/filter-DJhknPyE.svg",Ie=i=>(Ye("data-v-692c6171"),i=i(),qe(),i),_t={class:"pb-2.5 pt-3.5 flex items-center"},kt={class:"flex-1 bg-white rounded-3xl"},Ct=Ie(()=>s("img",{src:wt,class:"w-5 h-5"},null,-1)),Rt=[Ct],$t=Ie(()=>s("img",{src:Tt,class:"w-5 h-5"},null,-1)),At=[$t],St=Ie(()=>s("img",{src:yt,class:"w-5 h-5"},null,-1)),It=[St],Et={class:"flex flex-col h-[75vh] justify-between px-5 pb-[80px]"},Lt={class:"mt-[18px] pb-2.5 font-semibold text-base text-center"},Nt={class:"overflow-y-auto flex-1"},Pt={class:"text-base font-semibold"},Ft={class:"flex items-center gap-2 mt-3"},Vt={class:"pt-3 flex-start"},Dt=Ie(()=>s("div",{class:"mx-3"},"-",-1)),jt={key:0,class:"pt-4"},Bt={class:"text-base font-semibold"},Mt={class:"flex items-center justify-start gap-5 mt-3"},Ot={key:1},Ht={class:"text-base font-semibold mt-[16px]"},Ut={class:"flex flex-wrap items-center gap-2 gap-y-3 mt-3"},Gt={key:2,class:"pt-4"},Yt={class:"text-base font-semibold"},qt={class:"p-4 flex justify-between gap-6 fixed bottom-0 left-0 right-0 bg-white"},Kt=Pe({props:{modelValue:null,noType:{type:Boolean},active:null},emits:["update:modelValue","onSubmit","onFilter","getList","onExport"],setup(i,{expose:M,emit:k}){const I=i,{getCurrentStoreId:E}=Ke(),{t:O}=Fe(),[S,Q]=Ae(!1),q=A(!1),n=A(!1),g=A([]),H=A([]);ze(()=>I.active,u=>{d.state=null,d.waitBuyerReceive=null,d.waitSellerReceive=null});const L=Ce().format("YYYY-MM-DD"),l=Ce().subtract("days",7).format("YYYY-MM-DD"),X=Ce().subtract("month",1).format("YYYY-MM-DD"),oe=Ce().subtract("month",3).format("YYYY-MM-DD"),we=xe(()=>[{id:1,label:O("shop.Last 7 days")},{id:2,label:O("shop.last month")},{id:3,label:O("shop.last 3 months")}]),_e=xe(()=>[{id:1,label:O("common.confirmed buyer_received")},{id:2,label:O("common.confirmed seller_received")}]),ce=xe(()=>[{id:1,label:O("goods.commonOrderWaitDeal"),value:[1]},{id:2,label:O("goods.creditPendingUnfreeze"),value:[11]},{id:3,label:O("refund.Platform intervention"),value:[10]}]),Z=async()=>{var u;ut({page:1,size:300,shopId:(u=await E())==null?void 0:u.id}).then(c=>{g.value=c.data.map(F=>({id:F.id,content:F.content,colorHex:F.colorHex})),q.value=!1,g.value.length>=c.total&&(n.value=!0)})},[K,z]=Ae(!1),[ue,ae]=Ae(!1),V=A(),r=A(),p=A(),C=A(new Date(new Date("2020/1/1").getTime())),U=A(),d=Ve({startTime:null,endTime:null,state:null,waitBuyerReceive:!1,waitSellerReceive:!1}),ee=(u=!0)=>{d.endTime=null,d.startTime=null,d.state=null,d.waitBuyerReceive=null,d.waitSellerReceive=null,_.value=null,re.value=null,V.value=null,r.value=null,p.value=null,H.value=[],u&&D()},Te=()=>{z(!1),ae(!1),(!d.startTime||!d.endTime)&&(d.endTime=null,d.startTime=null)},m=u=>{V.value=new Date(ke(u)),U.value=new Date(new Date(u).getTime()),d.startTime=ke(V.value),_.value=null,z(!1),ae(!0)},y=u=>{r.value=new Date(ke(u)),d.startTime=ke(V.value),d.endTime=ke(u),_.value=null,ae(!1)},w=()=>{var c;return{createStartTime:d.startTime||null,createEndTime:d.endTime||null,subclassId:re.value,orderLabelIdList:H.value,refundStatusList:p.value?(c=ce.value.find(F=>F.id===p.value))==null?void 0:c.value:null,waitBuyerReceive:d.waitBuyerReceive||null,waitSellerReceive:d.waitSellerReceive||null}},D=()=>{const u=w();k("getList",u),Q(!1)},j=A(null),T=()=>{k("onSubmit"),j.value.blur()},_=A(null),W=u=>{if(_.value!==u){switch(r.value=new Date(L),d.endTime=L,u){case 1:d.startTime=l,V.value=new Date(l),U.value=new Date(new Date(l).getTime()+60*1e3);break;case 2:d.startTime=X,V.value=new Date(X),U.value=new Date(new Date(X).getTime()+60*1e3);break;case 3:d.startTime=oe,V.value=new Date(oe),U.value=new Date(new Date(oe).getTime()+60*1e3);break}_.value=u}},h=u=>{d.state===u?d.state=null:d.state=u,d.state==1?(d.waitBuyerReceive=!0,d.waitSellerReceive=!1):d.state==2?(d.waitBuyerReceive=!1,d.waitSellerReceive=!0):(d.waitBuyerReceive=!1,d.waitSellerReceive=!1)},ie=A([]),re=A(null),te=async()=>{var c;const u=await gt({address:(c=await E())==null?void 0:c.merchant});ie.value=u.data||[]},me=xe(()=>I.active&&(I.active==2||I.active==4)),le=()=>{var c;const u={createStartTime:d.startTime||null,createEndTime:d.endTime||null,subclassId:re.value,orderLabelIdList:H.value,refundStatusList:p.value?(c=ce.value.find(F=>F.id===p.value))==null?void 0:c.value:null,waitBuyerReceive:d.waitBuyerReceive||null,waitSellerReceive:d.waitSellerReceive||null};k("onExport",u)};return Ge(()=>{te(),Z()}),M({onLoadTagList:Z,handleReset:ee}),(u,c)=>{const F=$("VanField"),t=$("VanButton"),fe=$("van-datetime-picker"),de=$("van-popup"),pe=$("van-icon"),he=$("van-checkbox"),ve=$("van-checkbox-group"),N=$("van-list"),Y=$("VanPopup");return f(),x(ne,null,[s("div",_t,[s("div",kt,[b(F,{ref:(e,P)=>{P.searchRef=e,j.value=e},onKeyup:We(T,["enter"]),"model-value":i.modelValue,"onUpdate:modelValue":c[0]||(c[0]=e=>k("update:modelValue",e)),placeholder:u.$t("common.searchTips"),class:"w-[100% - 20px] text-center bg-transparent iconfont",clearable:"",enterkeyhint:"search"},{"right-icon":v(()=>[s("div",{onClick:T},Rt)]),_:1},8,["onKeyup","model-value","placeholder"])]),s("div",{class:"flex-shrink-0 w-5 ml-3",onClick:c[1]||(c[1]=e=>o(Q)(!0))},At),s("div",{class:"flex-shrink-0 w-5 ml-3",onClick:le},It)]),b(Y,{teleport:"body",show:o(S),"onUpdate:show":c[10]||(c[10]=e=>Se(S)?S.value=e:null),round:"",position:"bottom",closeable:"",style:{height:"75vh"},"close-on-click-overlay":"",onClickOverlay:c[11]||(c[11]=e=>o(Q)(!1)),onClickCloseIcon:c[12]||(c[12]=e=>o(Q)(!1))},{default:v(()=>[s("div",Et,[s("div",Lt,a(u.$t("common.OrderScreening")),1),s("div",Nt,[s("div",Pt,a(u.$t("common.orderTime")),1),s("div",Ft,[(f(!0),x(ne,null,ge(o(we),e=>(f(),J(t,{class:ye(["rounded text-sm px-3 h-[35px] flex-1 text-black whitespace-nowrap border-0",_.value==e.id?"bg-yellow text-black":"bg-[#F5F5F5] text-black"]),key:e.id,onClick:P=>W(e.id)},{default:v(()=>[B(a(e.label),1)]),_:2},1032,["class","onClick"]))),128))]),s("div",Vt,[s("div",{class:"rounded bg-[#F5F5F5] h-[35px] van-cell p-0 leading-[35px] flex justify-center",onClick:c[2]||(c[2]=je(e=>o(z)(!0),["stop"]))},[s("div",{class:ye({"opacity-30":!o(d).startTime})},a(o(d).startTime||u.$t("goods.selectStartTime")),3)]),b(de,{show:o(K),"onUpdate:show":c[4]||(c[4]=e=>Se(K)?K.value=e:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:v(()=>[b(fe,{modelValue:V.value,"onUpdate:modelValue":c[3]||(c[3]=e=>V.value=e),"min-date":C.value,type:"date",title:u.$t("goods.selectStartTime"),onCancel:Te,onConfirm:m},null,8,["modelValue","min-date","title"])]),_:1},8,["show"]),Dt,s("div",{class:"rounded bg-[#F5F5F5] h-[35px] van-cell p-0 leading-[35px] flex justify-center",onClick:c[5]||(c[5]=je(e=>o(z)(!0),["stop"]))},[s("div",{class:ye({"opacity-30":!o(d).endTime})},a(o(d).endTime||u.$t("goods.selectEndTime")),3)]),b(de,{show:o(ue),"onUpdate:show":c[7]||(c[7]=e=>Se(ue)?ue.value=e:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:v(()=>[b(fe,{modelValue:r.value,"onUpdate:modelValue":c[6]||(c[6]=e=>r.value=e),onConfirm:y,"min-date":U.value,onCancel:Te,type:"date",title:u.$t("goods.selectEndTime")},null,8,["modelValue","min-date","title"])]),_:1},8,["show"])]),o(me)?(f(),x("div",jt,[s("div",Bt,a(u.$t("common.confirmedStatus")),1),s("div",Mt,[(f(!0),x(ne,null,ge(o(_e),e=>(f(),J(t,{class:ye(["rounded text-sm px-3 h-[35px] text-black min-w-min border-0",o(d).state==e.id?"bg-yellow text-black":"bg-[#F5F5F5] text-black"]),key:e.id,onClick:P=>h(e.id)},{default:v(()=>[B(a(e.label),1)]),_:2},1032,["class","onClick"]))),128))])])):G("",!0),i.noType?G("",!0):(f(),x("div",Ot,[s("div",Ht,a(u.$t("common.category")),1),s("div",Ut,[(f(!0),x(ne,null,ge(o(ce),e=>(f(),J(t,{class:ye(["rounded text-sm px-3 h-[35px] text-black whitespace-nowrap border-0",p.value==e.id?"bg-yellow text-black":"bg-[#F5F5F5] text-black"]),key:e.id,onClick:P=>p.value=e.id},{default:v(()=>[B(a(e.label),1)]),_:2},1032,["class","onClick"]))),128))])])),g.value&&g.value.length?(f(),x("div",Gt,[s("div",Yt,a(u.$t("common.tag")),1),s("div",{class:ye(["pt-[10px] pr-[10px] mt-[10px]",[o(me)?"max-h-[150px]":"max-h-[300px]"]])},[b(N,{loading:q.value,"onUpdate:loading":c[9]||(c[9]=e=>q.value=e),finished:n.value,onLoad:Z},{default:v(()=>[b(ve,{modelValue:H.value,"onUpdate:modelValue":c[8]||(c[8]=e=>H.value=e),max:5},{default:v(()=>[(f(!0),x(ne,null,ge(g.value,(e,P)=>(f(),J(he,{name:e.id,key:P,class:"relative flex radioList"},{icon:v($e=>[$e.checked?(f(),J(pe,{key:0,name:"success",color:"white",class:"tag-icon absolute right-[15px] border-0 top-[1px] bg-transparent",size:"30"})):G("",!0)]),default:v(()=>[s("div",{style:Re({backgroundColor:o(vt)(e.colorHex,.12),color:e.colorHex}),class:ye(["rounded-[6px] min-h-[40px] p-[10px] text-white text-[0.875rem]",P===g.value.length-1?"":"mb-[16px]"])},a(e.content),7)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["loading","finished"])],2)])):G("",!0)]),s("div",qt,[b(t,{class:"bg-[#f5f5f5] text-default rounded-md h-[46px] flex-1 border-0",onClick:ee},{default:v(()=>[B(a(u.$t("common.reset")),1)]),_:1}),b(t,{class:"rounded-md text-default h-[46px] flex-1 bg-btnOrBg border-0",onClick:D},{default:v(()=>[B(a(u.$t("common.confirm")),1)]),_:1})])])]),_:1},8,["show"])],64)}}}),zt=Ne(Kt,[["__scopeId","data-v-692c6171"]]),De=i=>(Ye("data-v-290a01fd"),i=i(),qe(),i),Wt={class:"bg-white rounded-lg mt-4 py-4 px-2.5"},Jt={class:"flex"},Qt=De(()=>s("img",{class:"self-center mr-2 rounded-full w-9 h-9",src:Ze},null,-1)),Xt={key:0,class:"mb-1 text-base font-medium"},Zt={class:"text-[#2E2008] text-sm opacity-60"},es={key:0},ts={key:1},ss={class:"ml-auto text-sm opacity-60"},ns={key:0},os=B(" 售后已结束 "),as=["onClick"],is=["src"],rs={class:"flex flex-col flex-1"},ls={class:"flex items-center gap-2 line-clamp-1"},ds={class:"font-semibold line-clamp-1"},cs={key:0,class:"flex-shrink-0 flex items-center text-xs text-[#34C2A9]"},us=De(()=>s("img",{src:et,class:"w-5 h-5"},null,-1)),ms={class:"text-sm font-medium text-[#2E2008] opacity-60"},fs={class:"mt-auto text-[#2E2008] font-semibold flex items-center"},ps={key:0,src:tt,class:"w-4 h-4 mr-1",alt:""},hs={class:"text-base"},vs={class:"ml-auto text-base text-[#2E2008] opacity-60 self-end"},ys={class:"mt-6"},xs={key:0,class:"text-base font-semibold"},gs={class:"flex justify-between mt-2.5 text-sm text-[#2E2008]"},bs={class:"font-medium"},ws={class:"opacity-60"},Ts={class:"flex justify-between items-center mt-2.5 text-sm text-[#2E2008]"},_s={class:"font-medium whitespace-nowrap"},ks={class:"opacity-60 line-clamp-1 break-all max-w-[200px]"},Cs={class:"flex justify-between items-center mt-2.5 text-sm text-[#2E2008]"},Rs={class:"font-medium whitespace-nowrap"},$s=De(()=>s("img",{src:st,class:"w-5 h-5 ml-1",alt:""},null,-1)),As={class:"flex justify-between items-center mt-2.5 text-sm text-[#2E2008]"},Ss={class:"font-medium whitespace-nowrap"},Is={class:"opacity-60"},Es={class:"flex justify-between mt-2.5 text-sm text-[#2E2008]"},Ls={class:"font-medium"},Ns={class:"opacity-60"},Ps={class:"flex justify-between mt-2.5 text-sm text-[#2E2008]"},Fs={class:"font-medium"},Vs={class:"opacity-60"},Ds={class:"flex justify-between mt-2.5 text-sm text-[#2E2008]"},js={class:"font-medium"},Bs={class:"opacity-60"},Ms={key:0,class:"mr-auto flex align-middle leading-[44px] opacity-60 text-sm text-[red]"},Os={class:"gap-2.5 flex justify-end mt-4 items-center"},Hs={key:0,class:"flex justify-between mt-2.5 text-sm text-[#2E2008]"},Us={key:0,class:"text-sm leading-6 text-black"},Gs={class:"text-primary"},Ys={key:1,class:"text-sm leading-6 text-black"},qs={class:"text-primary"},Ks={class:"p-2.5 pb-[150px]"},zs={class:"relative text-center mb-2.5 text-base font-semibold"},Ws={class:"flex justify-between text-sm text-[#2E2008] font-medium mb-3"},Js=Pe({props:{order:null,creditFlag:{default:0}},emits:["resetHandler","handleTo","recompute"],setup(i,{emit:M}){const k=i,{accountStore:I,clerkStore:E}=ot(),{cancel:O}=at(),{t:S,locale:Q}=Fe(),[q,n]=Be(!1),g=Ve({buttonStyle:{"padding-left":"2rem","padding-right":"2rem"},buttonPlainStyle:{"padding-left":"3rem","padding-right":"3rem"},refundReason:"",btnLoading:!1}),H=A(!1),L=()=>{H.value=!0},l=xe(()=>{if(Oe(k.order)&&k.order.platformInterventionCustomerTime){const r=new Date(k.order.systemTime).getTime();return+k.order.platformInterventionCustomerTime+24*60*60*1e3*10-r}return null}),[X,oe]=Be(!1),we=A(1),_e=async()=>{var p;if(I.isOnlyView)return R(S("order.Requires merchant account operation"));if(E.isClerk&&!E.clerkAuth)return R(S("order.Requires merchant account operation"));((p=k.order.refundInfo)==null?void 0:p.refundType)===1?Z(1):z()},ce=()=>{if(I.isOnlyView)return R(S("order.Requires merchant account operation"));if(E.isClerk&&!E.clerkAuth)return R(S("order.Requires merchant account operation"));K(2)},Z=r=>{if(I.isOnlyView)return R(S("order.Requires merchant account operation"));if(E.isClerk&&!E.clerkAuth)return R(S("order.Requires merchant account operation"));we.value=r,oe(!0)},K=async r=>{try{if(g.btnLoading=!0,!(await Le({orderId:k.order.id,type:r})).success)return;M("resetHandler"),M("recompute")}catch{}finally{g.btnLoading=!1}},z=async()=>{var p;if(I.isOnlyView)return R(S("order.Requires merchant account operation"));if(E.isClerk&&!E.clerkAuth)return R(S("order.Requires merchant account operation"));g.btnLoading=!0;const r=(p=k.order.refundInfo)==null?void 0:p.refundType;if(r===2)try{if(g.btnLoading=!0,!(await Le({orderId:k.order.id,type:1})).success)return;M("resetHandler"),M("recompute")}catch{}finally{g.btnLoading=!1}else if(r===1)try{const U=(await mt({orderIds:k.order.id+""})).data.ordIds;if(!(await Le({orderId:k.order.id,type:1})).success||!(await O(U)).success)return;M("resetHandler"),M("recompute")}catch(C){R(C.message||C)}finally{g.btnLoading=!1}},ue=()=>{M("handleTo","/merchantRefundDetail?id="+k.order.id)},ae=xe(()=>pt(k.order,!0)),V=r=>{const p=new be(r.price).minus(new be(r.goodsActivityReduceAmount||0).div(r.number)).plus(new be(r.goodsAdjustChangeAmount||0).div(r.number)).toNumber();return rt(p||0)};return(r,p)=>{var w,D,j,T,_,W;const C=$("van-button"),U=$("van-icon"),d=$("i18n-t"),ee=$("van-count-down"),Te=$("van-field"),m=$("VanButton"),y=$("van-popup");return f(),x("div",Wt,[s("div",Jt,[Qt,s("div",null,[i.order.userAddress&&i.order.userAddress.address?(f(),x("div",Xt,a(o(Ee)(i.order.userAddress.address,"...",5,5)),1)):G("",!0),s("div",Zt,[!i.order.refundInfo||((D=(w=i.order.refundInfo)==null?void 0:w.phase)==null?void 0:D.code)==999?(f(),x("div",es,a(o(se)((j=i.order.refundInfo)==null?void 0:j.cancelTime))+a(r.$t("order.close")),1)):(f(),x("div",ts,a((T=i.order.refundInfo)==null?void 0:T.submitTime)+a(r.$t("refund.Apply")),1))])]),s("div",ss,[o(He)(i.order).available?(f(),x("span",ns,a(o(He)(i.order).label),1)):(f(),x(ne,{key:1},[os],64))])]),(f(!0),x(ne,null,ge(i.order.orderGoods,h=>(f(),x("div",{class:"flex mt-6",key:h.goodsName},[s("div",{onClick:ie=>M("handleTo","/sellerOrderList/detail?id="+h.goodsId)},[s("img",{class:"self-center object-cover w-20 h-20 mr-2 rounded-xl",src:(h.icons||"").split(",")[0]},null,8,is)],8,as),s("div",rs,[s("div",ls,[s("div",ds,a(h.goodsName),1),i.creditFlag?(f(),x("div",cs,[us,B(" "+a(r.$t("order.Credit Collection")),1)])):G("",!0)]),s("div",ms,a(r.$t("refund.TotalNum",{num:h.number})),1),s("div",fs,[i.order.payType!==o(ct).STORE_CARD?(f(),x("img",ps)):G("",!0),s("span",hs,a(i.order.payType===2?h.cardPrice:V(h)),1),s("span",null,a(i.order.payType===2?i.order.fmStoredCard.symbol:""),1)])]),s("div",vs," x"+a(h.number),1)]))),128)),s("div",ys,[((_=i.order.refundInfo)==null?void 0:_.returnType)===1?(f(),x("div",xs,a(r.$t("refund.Refundonly")),1)):G("",!0),s("div",gs,[s("div",bs,a(r.$t("order.orderNumber")),1),s("div",ws,a(i.order.id),1)]),s("div",Ts,[s("div",_s,a(r.$t("refund.BuyerName")),1),s("div",ks,a(i.order.userAddress&&i.order.userAddress.userName||"-"),1)]),s("div",Cs,[s("div",Rs,a(r.$t("order.create address")),1),s("div",{class:"text-b1 text-sm font-normal text-right flex items-center opacity-60",onClick:p[0]||(p[0]=h=>o(it)(i.order.address))},[B(a(o(Ee)(i.order.address,"...",5,5))+" ",1),$s])]),s("div",As,[s("div",Ss,a(r.$t("common.payOrderTime")),1),s("div",Is,a(o(se)(i.order.createTime)),1)]),s("div",Es,[s("div",Ls,a(r.$t("order.txHash")),1),s("div",Ns,a(o(Ee)(i.order.hash,"***",9,5)||"-"),1)]),s("div",Ps,[s("div",Fs,a(r.$t("refund.RefundMoney")),1),s("div",Vs,a(i.order.totalAmount)+a(i.order.payType===2?i.order.fmStoredCard.symbol:"Mcoin"),1)]),s("div",Ds,[s("div",js,a(r.$t("refund.RefundReason")),1),s("div",Bs,a(o(ae)),1)])]),s("div",null,[s("div",null,[((W=i.order.refundInfo)==null?void 0:W.refundStatus)==3&&i.order.status===2?(f(),x("div",Ms,a(r.$t("refund.shopRejectedTip")),1)):G("",!0),s("div",Os,[o(ht)(i.order)?(f(),J(C,{key:0,class:"btn-plain whitespace-nowrap",style:Re(o(g).buttonStyle),color:"#FEA021",plain:"",round:"",loading:o(g).btnLoading,onClick:p[1]||(p[1]=h=>i.order.creditFlag?Z(2):z())},{default:v(()=>[B(a(i.order.creditFlag?r.$t("refund.Unfreeze quota"):r.$t("refund.Agree to refund")),1)]),_:1},8,["style","loading"])):G("",!0),!o(I).isOnlyView&&o(Ue)(i.order,"MERCHANT_REVIEW_ACCEPT","visible")?(f(),J(C,{key:1,onClick:_e,style:Re(o(g).buttonStyle),class:"handle-btn-green whitespace-nowrap text-sm font-normal text-white",disabled:o(g).btnLoading,"loading-text":r.$t("refund.Agreetoapply")},{default:v(()=>[B(a(r.$t("refund.Agreetoapply")),1)]),_:1},8,["style","disabled","loading-text"])):G("",!0),!o(I).isOnlyView&&o(Ue)(i.order,"MERCHANT_REVIEW_REJECT","visible")?(f(),J(C,{key:2,onClick:ce,style:Re(o(g).buttonStyle),class:"handle-btn-red whitespace-nowrap text-sm font-normal text-white",disabled:o(g).btnLoading,"loading-text":r.$t("refund.rejecttheapplication")},{default:v(()=>[B(a(r.$t("refund.rejecttheapplication")),1)]),_:1},8,["style","disabled","loading-text"])):G("",!0),b(C,{class:"handle-btn-orange whitespace-nowrap text-b1 font-normal",style:Re(o(g).buttonPlainStyle),plain:"",round:"",onClick:ue},{default:v(()=>[B(a(r.$t("common.details")),1)]),_:1},8,["style"])])]),o(Oe)(i.order)&&o(l)>0&&!H.value?(f(),x("div",Hs,[b(U,{name:"info-o",color:"red",size:"18px ",class:"mr-1"}),i.order.creditFlag?(f(),x("div",Us,[b(ee,{time:o(l),onFinish:L},{default:v(h=>[b(d,{keypath:"refund.shopLockRefundTip",tag:"span"},{time:v(()=>[s("span",Gs,a(r.$t("refund.time",{days:h.days,hours:h.hours,minutes:h.minutes,seconds:h.seconds})),1)]),_:2},1024)]),_:1},8,["time"])])):(f(),x("div",Ys,[b(ee,{time:o(l),onFinish:L},{default:v(h=>[b(d,{keypath:"refund.autoRefundTip",tag:"span"},{time:v(()=>[s("span",qs,a(r.$t("refund.time",{days:h.days,hours:h.hours,minutes:h.minutes,seconds:h.seconds})),1)]),_:2},1024)]),_:1},8,["time"])]))])):G("",!0)]),b(y,{show:o(q),"onUpdate:show":p[5]||(p[5]=h=>Se(q)?q.value=h:null),position:"bottom",round:"",style:{"text-align":"center"}},{default:v(()=>[s("div",Ks,[s("div",zs,[B(a(r.$t("refund.rejecttheapplication"))+" ",1),s("div",{class:"absolute right-0 bottom-[-2px] text-lg",onClick:p[2]||(p[2]=h=>o(n)(!1))},[b(U,{name:"cross"})])]),s("div",Ws,[s("div",null,a(r.$t("refund.reasonforreturn")),1),s("div",null,a(o(ae)),1)]),b(Te,{modelValue:o(g).refundReason,"onUpdate:modelValue":p[3]||(p[3]=h=>o(g).refundReason=h),rows:"5",autosize:"",type:"textarea",maxlength:"200",placeholder:r.$t("refund.enterrejection"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),b(m,{class:"mb-[50px] inline-block btn-orange btn-shadow w-[150px] h-[40px] text-white",onClick:p[4]||(p[4]=h=>o(n)(!1))},{default:v(()=>[B(a(r.$t("common.confirm")),1)]),_:1})]),_:1},8,["show"]),b(nt,{order:i.order,show:o(X),type:we.value,onClose:p[6]||(p[6]=h=>o(oe)(!1)),loading:o(g).btnLoading,onHandleSubmit:z},null,8,["order","show","type","loading"])])}}}),Qs=Ne(Js,[["__scopeId","data-v-290a01fd"]]),Xs={class:"bg-[#f2f0ef]"},Zs=Pe({emits:["recompute"],setup(i,{emit:M}){const k=A(null),{getCurrentStoreId:I}=Ke(),{getMerchantDhKey:E,decryptAddressKey:O,decryptKey:S,cryptoAESWithSearch:Q}=lt(),q=Qe(),{t:n}=Fe(),[g,H]=Ae(!1),L=A(""),l=Ve({active:1,page:0,size:30,finished:!1,list:[],loading:!1,total:0,refundTabList:[{id:1,name:n("order.applying")},{id:2,name:n("order.refund block confirmation")},{id:3,name:n("order.refund completed")},{id:4,name:n("order.refund rejection")},{id:5,name:n("order.cancellation refund")},{id:10,name:n("order.platform intervention")},{id:11,name:n("order.platforms step in to support buyers")},{id:12,name:n("order.platform intervention to support sellers")},{id:13,name:n("order.freeze thawed")},{id:14,name:n("order.user forced liquidation")},{id:20,name:n("order.Long time no delivery")},{id:30,name:n("refund.refund success tips")}],statusTabList:[{id:0,name:n("order.waitPay")},{id:1,name:n("order.wait")},{id:2,name:n("order.already")},{id:3,name:n("order.fail")},{id:4,name:n("order.trade success")},{id:5,name:n("order.trade close")},{id:6,name:n("order.trade close")},{id:7,name:n("order.platform intervention")},{id:8,name:n("order.canceled")},{id:-1,name:n("order.canceled")}],query:{}}),X=xe(()=>[{id:1,name:n("refund.Pending")},{id:99,name:n("order.all")}]),oe=bt(),we=m=>m.fmRefundReason?m.fmRefundReason[oe]:"",_e=m=>{l.loading||(k.value.handleReset(!1),q.replace({path:"sellerOrderList",query:{type:2,active:m}}),l.active=m,M("recompute"),Z())},ce=async()=>{if(L.value&&L.value.length<2)return R(n("common.Please enter at least two keywords"));Z()},Z=()=>{l.page=0,l.finished=!1,l.list=[],R.loading({message:n("common.loading"),forbidClick:!0}),K()},K=async()=>{l.loading=!0,l.page+=1,await U(l.query),R.clear(),l.loading=!1},z=async m=>{l.list=[],l.page=1,await U(m)},ue=m=>{q.push(m)},ae=async m=>{var c,F;const y=navigator.userAgent.toLowerCase(),w=/mobile|android|iphone|ipad|phone/i.test(y),D=/tablet|ipad/i.test(y),j=/webview|wv/i.test(y),T=/fbav|instagram|line|twitter|whatsapp/i.test(y),_=/metamask/i.test(y),W=/tokenpocket/i.test(y),h=(window==null?void 0:window.$onekey)||!1;if(Xe.isConnected()){H(!0);return}if(h){H(!0);return}if((w||D)&&(j||T||_||W||h)&&!window.chrome&&!window.safari){H(!0);return}let ie=null;L.value&&(ie=await Q(L.value));const re={page:1,size:99999,status:-1,refundStatus:X.value[l.active].id,type:1,tab:2,keyword:ie,keywordPlain:L.value,storeId:(c=await I())==null?void 0:c.id,...m};R.loading({duration:0,message:n("common.loading")});const te=await Me(re);if(!te.success||!te.data||te.data.length===0){R.clear(),R(n("common.No data download"));return}const me=te.data.map(t=>new Promise(async fe=>{var de,pe,he,ve;if(t!=null&&t.userAddress&&(t.userAddress.postscript=t.postscript),t!=null&&t.userAddress&&((de=t==null?void 0:t.userAddress)!=null&&de.encryptFlag)){const N=await E(t.address,t==null?void 0:t.submitUserPubKey);N&&(t.userAddress=O(t.userAddress,N))}if(t!=null&&t.shippingHash){const N=await E(t.address,t==null?void 0:t.shippingUserPubKey);if(N){const Y=S(t.expressNo,N);Y.hash===t.shippingHash&&(t.expressNo=Y.decrypt,t.expressCompany=S(t.expressCompany,N).decrypt)}}fe([{text:t.id},{text:t.address},{text:t.hash||""},{text:t.orderGoods&&t.orderGoods.length?C(t.orderGoods,"goodsName"):""},{text:t.orderGoods&&t.orderGoods.length?C(t.orderGoods,"goodsId"):""},{text:t.orderGoods&&t.orderGoods.length?C(t.orderGoods,"number"):0},{text:t.orderGoods&&t.orderGoods.length?C(t.orderGoods,"price"):0},{text:((pe=l.statusTabList.find(N=>N.id==t.status))==null?void 0:pe.name)||""},{text:t.totalAmountOriginal||0},{text:t.merchantAdjustAmount||0},{text:t.activityReduceAmount||0},{text:t.voucherAmount||0},{text:r(t)},{text:t.orderGoods&&t.orderGoods.length?C(t.orderGoods,"discountRatio","%"):"0%"},{text:t.createTime?se(t.createTime):""},{text:t.chainCreateTime?se(t.chainCreateTime):""},{text:t.expressTime?se(t.expressTime):""},{text:t.finishTime?se(t.finishTime):""},{text:t.userAddress.postscript||""},{text:`${t.userAddress.provinceName??""}${t.userAddress.cityName??""}${t.userAddress.countyName??""}${t.userAddress.detailInfo??""} ${t.userAddress.userName??""} ${t.userAddress.telNumber??""}`},{text:t.creditFlag?n("common.yes"):n("common.no")},{text:t.merchantsConfirm?n("common.yes"):n("common.no")},{text:t.orderLabelList.map(N=>N.content).join(",")},{text:t.expressCompany||""},{text:t.expressNo||""},{text:we(t)},{text:((ve=(he=t.refundInfo)==null?void 0:he.phase)==null?void 0:ve.label)||""},{text:t.refundTime?se(t.refundTime):""},{text:t.refundSuccessTime?se(t.refundSuccessTime):""},{text:t.refundCancelTime?se(t.refundCancelTime):""}])})),le=await Promise.all(me);if(!le||le.length===0){R.clear(),R(n("common.No data download"));return}const u=[{text:n("order.export.orderId")},{text:n("order.export.buyerAddress")},{text:n("order.export.transactionHash")},{text:n("order.export.goodsName")+"("+n("order.export.goodsName-tips")+")"},{text:n("order.export.goodsId")+"("+n("order.export.goodsId-tips")+")"},{text:n("order.export.goodsNumber")+"("+n("order.export.goodsName-tips")+")"},{text:n("order.goodsPrice")+"("+n("order.export.goodsName-tips")+")"},{text:n("order.orderStatus")},{text:n("order.export.goodsPrice total")},{text:n("order.merchant modify price total")},{text:n("order.export.activityReduceAmount total")},{text:n("voucher.voucher_deduction total")},{text:n("order.export.actualAmount total")},{text:n("common.ratio")},{text:n("order.createTime")},{text:n("order.export.paymentTime")},{text:n("order.Shipping time")},{text:n("order.Complete time")},{text:n("order.remark")},{text:n("order.receive address")},{text:n("order.export.isCreditReceive")},{text:n("order.export.merchantsConfirm")},{text:n("order.export.orderLabelList")},{text:n("order.deliveryCompany")},{text:n("order.deliveryId")},{text:n("refund.RefundReason")},{text:n("refund.refundStatus")},{text:n("refund.refundTime")},{text:n("refund.refundSuccessTime")},{text:n("refund.refundCancelTime")}];try{const t=((F=await I())==null?void 0:F.storeName)+"_退款或售后订单_"+Ce().format("YYYY-MM-DD HH:mm:ss");xt([u,...le],{excelName:t,worksheet:"sheet"}),R.clear()}catch{R.clear()}},V=()=>{H(!1)},r=m=>{const y=new be(m.totalAmountOriginal).plus(new be(m.merchantAdjustAmount||0)).minus(new be(m.activityReduceAmount||0)).minus(new be(m.voucherAmount||0)).toNumber();return p(y)},p=m=>Number.isInteger(m)?m.toString():m.toFixed(4).replace(/\.?0+$/,""),C=(m,y,w)=>m.map(j=>{let T=j[y];return w&&(T=T+w),T}).join(","),U=async m=>{var j,T,_,W,h,ie,re,te,me,le,u,c,F,t,fe,de,pe,he,ve;let y=null;L.value&&(y=await Q(L.value)),l.query=Object.keys(m).length>0?m:l.query;const w=await Me({page:l.page,size:l.size,status:-1,refundStatus:X.value[l.active].id,type:1,tab:2,keyword:y,keywordPlain:L.value,storeId:(j=await I())==null?void 0:j.id,...m});if((w==null?void 0:w.total)===0&&(l.list=[]),!w.success){l.finished=!0,l.loading=!1;return}if(!w.data||!w.total){l.finished=!0,l.loading=!1;return}l.total=w.total;const D=[];for(let N=0;N<w.data.length;N++){let Y="";const e=w.data[N];if(e.userAddress&&(e.userAddress.postscript=e.postscript),e.userAddress&&((T=e.userAddress)!=null&&T.encryptFlag)){const P=await E(e.address,e.submitUserPubKey);P&&(e.userAddress=O(e.userAddress,P),(_=e.userAddress)!=null&&_.success&&!e.merchantEns&&(Y+=((W=e.userAddress)==null?void 0:W.userName)+((h=e.userAddress)==null?void 0:h.telNumber)+(((ie=e.userAddress)==null?void 0:ie.postalCode)??"")+((re=e.userAddress)==null?void 0:re.provinceName)+((te=e.userAddress)==null?void 0:te.cityName)+((me=e.userAddress)==null?void 0:me.countyName)+((le=e.userAddress)==null?void 0:le.detailInfo)+((u=e.userAddress)==null?void 0:u.postscript)))}else e.merchantEns||(Y+=((c=e.userAddress)==null?void 0:c.userName)+((F=e.userAddress)==null?void 0:F.telNumber)+(((t=e.userAddress)==null?void 0:t.postalCode)??"")+((fe=e.userAddress)==null?void 0:fe.provinceName)+((de=e.userAddress)==null?void 0:de.cityName)+((pe=e.userAddress)==null?void 0:pe.countyName)+((he=e.userAddress)==null?void 0:he.detailInfo)+((ve=e.userAddress)==null?void 0:ve.postscript));if(e.shippingHash){const P=await E(e.address,e.shippingUserPubKey);if(P){const $e=S(e.expressNo,P);$e.hash===e.shippingHash&&(e.expressNo=$e.decrypt,e.expressCompany=S(e.expressCompany,P).decrypt,e.merchantEns||(Y+=(e==null?void 0:e.expressNo)+(e==null?void 0:e.expressCompany)))}}else e.merchantEns||(Y+=(e==null?void 0:e.expressNo)+(e==null?void 0:e.expressCompany));if(e.merchantEns||(Y+=(e==null?void 0:e.hash)+(e==null?void 0:e.address)),Y)try{D.push({id:e.id,merchantEns:await Q(Y)})}catch(P){console.log(P)}}D.length>0&&ft({enInfoList:D}),l.list=l.page===1?w.data:l.list.concat(w.data),l.list.length>=l.total&&(l.finished=!0),l.loading=!1},d=()=>{l.page=0,l.finished=!1,l.list=[],K()},ee=Je();ee.query.active&&(l.active=Number(ee.query.active));const Te=A(null);return Ge(async()=>{var m;K(),Te.value=(m=await I())==null?void 0:m.merchant}),(m,y)=>{const w=$("VanList"),D=$("VanTab"),j=$("VanTabs");return f(),x("div",null,[b(j,{active:o(l).active,"onUpdate:active":y[3]||(y[3]=T=>o(l).active=T),onChange:_e,background:"#f2f0ef",sticky:"","offset-top":"44"},{"nav-bottom":v(()=>[s("div",Xs,[b(zt,{modelValue:L.value,"onUpdate:modelValue":y[0]||(y[0]=T=>L.value=T),onOnSubmit:ce,onGetList:z,ref:(T,_)=>{_.searchBox=T,k.value=T},onOnExport:ae},null,8,["modelValue"])])]),default:v(()=>[(f(!0),x(ne,null,ge(o(X),T=>(f(),J(D,{title:T.name,key:T.id},{default:v(()=>[b(w,{class:"mt-2.5",loading:o(l).loading,"onUpdate:loading":y[2]||(y[2]=_=>o(l).loading=_),finished:o(l).finished,"finished-text":m.$t("common.noMore"),"loading-text":m.$t("common.loading"),onLoad:K},{default:v(()=>[(f(!0),x(ne,null,ge(o(l).list,_=>(f(),J(Qs,{creditFlag:_.creditFlag,key:_.id,order:_,onResetHandler:d,onHandleTo:ue,onRecompute:y[1]||(y[1]=W=>M("recompute"))},null,8,["creditFlag","order"]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])]),_:2},1032,["title"]))),128))]),_:1},8,["active"]),b(dt,{show:o(g),title:"导出账单",content:"请在PC端操作账单导出",showConfirm:!0,showReject:!1,confirmText:"我知道了",rejectText:"拒绝",onClose:V,onConfirm:V},null,8,["show"])])}}}),en=Ne(Zs,[["__scopeId","data-v-38e178f5"]]),yn=Object.freeze(Object.defineProperty({__proto__:null,default:en},Symbol.toStringTag,{value:"Module"}));export{en as M,zt as S,yn as a};

import{_ as Q,y as O,a2 as X,l as W,x as M,F as y,G as d,H as l,P as v,X as D,Q as P,Z as ae,$ as ne,R as G,r as E,z as ee,D as le,a9 as ce,E as K,O as j,N as J,K as q,I as re,J as ue,a0 as de,a1 as fe,n as he}from"./vendor-BlU_hoYl.js";import{C as me}from"./CommonVanProvider-CDfGVWR4.js";import{_ as ve}from"./SearchBar-DHowt_Ev.js";import{e as Z,at as ie,r as pe,aK as te,au as ge}from"./index-Wb-6_0W_.js";import{M as _e}from"./Map-CC5e3ZlS.js";import{u as Y}from"./useCityMap-DQk2VBUJ.js";import{S as oe,P as se,L as xe}from"./iconAssets-DsommeAx.js";import"./BackIcon-8hcEjDKb.js";import"./search-B34EARrH.js";import"./delete-Dyula9w6.js";import"./localMark-YkRe0gPv.js";const ye=t=>(ae("data-v-129a2a44"),t=t(),ne(),t),be={class:"w-full flex gap-2"},Ie={class:"shrink-0 w-[80px] h-[80px] rounded-lg overflow-hidden"},Le=["src"],ke={class:"w-full flex flex-col justify-between"},we={class:"shrink-0"},Ce={class:"flex items-center justify-between"},Fe={class:"text-base text-b1 font-semibold line-clamp-1"},Se={key:0,class:"shrink-0 h-[18px] px-1 border-[0.5px] border-[#FF8812] rounded-sm flex justify-center items-center"},$e=ye(()=>l("span",{class:"text-xs text-[#FF8812] font-normal"}," 距离最近 ",-1)),Be=[$e],Ee={class:"mt-1 text-b3 text-sm font-normal line-clamp-1"},Me={key:0,class:"w-full text-right text-b3 text-sm font-normal line-clamp-1"},Te=O({props:{storeInfo:null,idx:null},setup(t){const b=t,B=X(),s=W(),{distanceFormat:f}=Y(),{cityMapStore:I}=Z(),k=M(()=>{var n,F;return(n=b.storeInfo)!=null&&n.storeIcons?(F=b.storeInfo)==null?void 0:F.storeIcons.split(","):[]}),h=()=>{const n=B.path.replace("availableStores","storefront");s.push(`${n}?storeId=${b.storeInfo.storeId}&child=1`)};return(n,F)=>{var p,m,w,g,C,_;return d(),y("div",{class:"w-full h-fit bg-white rounded-xl p-3 shadow-[0_0.5px_16px_0_rgba(0,0,0,0.16)]",onClick:h},[l("div",be,[l("div",Ie,[l("img",{src:v(k)[0],alt:"shop",class:"w-full h-full object-cover"},null,8,Le)]),l("div",ke,[l("div",we,[l("div",Ce,[l("div",Fe,P(((p=t.storeInfo)==null?void 0:p.storeName)||""),1),t.idx===0?(d(),y("div",Se,Be)):D("",!0)]),l("div",Ee,P((m=t.storeInfo)==null?void 0:m.storeAddress),1)]),(w=t.storeInfo)!=null&&w.distance&&((g=v(I).locationCoords)!=null&&g.lat)&&((C=v(I).locationCoords)!=null&&C.lng)?(d(),y("div",Me,P(v(f)((_=t.storeInfo)==null?void 0:_.distance)),1)):D("",!0)])])])}}}),Ae=Q(Te,[["__scopeId","data-v-129a2a44"]]),De="/static/images/check-HLHTc74I.svg",Ve={class:"flex items-center gap-0.5"},Pe={key:0,class:"shrink-0 h-[18px] px-1 border-[0.5px] border-newOrigin rounded-sm flex justify-center items-center"},ze=l("span",{class:"text-xs text-newOrigin font-normal"},"距离最近",-1),je=[ze],Re={class:"flex items-center"},Ne={key:0,class:"shrink-0 text-b3 text-sm font-normal"},He={class:"text-b3 text-sm font-normal line-clamp-1"},Ue={key:0,class:"shrink-0 flex items-center justify-center"},qe=l("img",{class:"shrink-0 w-5 h-5",src:De,alt:""},null,-1),Oe=[qe],Ze=O({props:{storeInfo:null,selected:{type:Boolean},recentFlag:{type:Boolean}},emits:["select"],setup(t,{emit:b}){const B=t,{distanceFormat:s}=Y(),{cityMapStore:f}=Z();M(()=>{var k,h;return(k=B.storeInfo)!=null&&k.storeIcons?(h=B.storeInfo)==null?void 0:h.storeIcons.split(","):[]});const I=()=>{b("select")};return(k,h)=>{var n,F,p,m,w,g;return d(),y("div",{class:"w-full flex justify-between gap-2",onClick:I},[l("div",null,[l("div",Ve,[l("div",{class:G(["text-sm line-clamp-1",t.selected?"text-newOrigin font-semibold":"text-b1 font-normal"])},P(((n=t.storeInfo)==null?void 0:n.storeName)||""),3),t.recentFlag?(d(),y("div",Pe,je)):D("",!0)]),l("div",Re,[(F=t.storeInfo)!=null&&F.distance&&((p=v(f).locationCoords)!=null&&p.lat)&&((m=v(f).locationCoords)!=null&&m.lng)?(d(),y("div",Ne,P(v(s)((w=t.storeInfo)==null?void 0:w.distance))+"｜ ",1)):D("",!0),l("div",He,P((g=t.storeInfo)==null?void 0:g.storeAddress),1)])]),t.selected?(d(),y("div",Ue,Oe)):D("",!0)])}}}),Ge=t=>(ae("data-v-5c1e1436"),t=t(),ne(),t),Ke={class:"w-full h-full relative flex flex-col"},Je=Ge(()=>l("div",{id:"map",class:"w-full h-full relative z-0"},null,-1)),Qe={class:"shrink-0 -mt-4 h-fit bg-white rounded-t-2xl relative pb-[78px]"},Xe=["id"],We={key:0,class:"absolute bottom-0 w-full sm:w-[375px] flex items-center py-4 px-3 bg-white"},Ye=fe(P("选择")),et=O({props:{storeList:null,searchList:null,searchFlag:{type:Boolean},loading:{type:Boolean},finished:{type:Boolean}},emits:["changeIndex","handleTo","onLoad"],setup(t,{expose:b,emit:B}){const s=t,{cityMapStore:f}=Z(),I=X(),k=W(),h=M(()=>s.searchList.length?s.searchList:s.storeList),n=E({}),F=e=>{var o;return((o=n.value)==null?void 0:o.storeId)===e.storeId},p=e=>!!e.recentFlag,m=M(()=>s.searchFlag&&!s.searchList.length?!0:!h.value.length),w=(e,o)=>{n.value={...e},g(e),H(o)},g=async e=>{await he();const o=document.getElementById("item"+e.storeId);document.getElementById("list").scrollTo({top:o.offsetTop,behavior:"smooth"})},C=()=>{f.setSelectedAvailableStore(n.value),k.back()};ee(()=>s.storeList,e=>{e.length>0&&setTimeout(()=>{c&&(z(),$(),S(),a(),n.value=s.storeList.find(o=>{var x;return o.storeId==((x=I.query)==null?void 0:x.storeId)}))},300)},{immediate:!0,deep:!0}),ee(()=>s.searchList,e=>{e.length===0&&n.value.storeId&&!m.value&&g(n.value)},{immediate:!0,deep:!0});const _=E(0);let c=null,r=[],T=null;const R=M(()=>{var e,o;return f.locationCoords.lng&&f.locationCoords.lat?{lng:f.locationCoords.lng,lat:f.locationCoords.lat}:{lng:(e=f.currentActiveCity)==null?void 0:e.areaLongitude,lat:(o=f.currentActiveCity)==null?void 0:o.areaLatitude}}),a=()=>{try{const e=R.value;c=L.map("map",{center:[e.lat,e.lng],zoom:12,trackResize:!0,zoomControl:!1}),L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:"",subdomains:"abcd",maxZoom:17,minZoom:7}).addTo(c)}catch{}finally{}},S=()=>{const e=s.storeList[_.value];e&&e.storeLatitude&&e.storeLongitude&&c.flyTo([e.storeLatitude,e.storeLongitude],15,{duration:.8,easeLinearity:1})},z=()=>{i(),s.storeList.forEach((e,o)=>{if(e.storeLatitude&&e.storeLongitude){const x=o===_.value?oe:se,V=L.marker([e.storeLatitude,e.storeLongitude],{icon:x}).addTo(c);V.on("click",()=>{H(o,!0);const u=s.storeList[o];n.value={...u},g(u)}),r.push(V)}})},i=()=>{r.forEach(e=>{c&&c.removeLayer(e)}),r=[]},$=()=>{T&&c&&c.removeLayer(T);const e=R.value;e.lat&&e.lng&&(T=L.marker([e.lat,e.lng],{icon:xe}).addTo(c))},N=()=>{r.forEach((e,o)=>{const x=o===_.value?oe:se;e.setIcon(x)})},H=(e,o=!1)=>{_.value=e,B("changeIndex",e),S(),o?N():setTimeout(()=>{N()},600)},U=()=>{i(),T&&c&&(c.removeLayer(T),T=null),c&&(c.remove(),c=null)};return le(()=>{a()}),ce(()=>{U()}),b({initMap:a}),(e,o)=>{const x=K("VanList"),V=K("VanButton");return d(),y("div",Ke,[Je,l("div",Qe,[j(x,{loading:t.loading,"onUpdate:loading":o[0]||(o[0]=u=>de(loading)?loading.value=u:null),finished:t.finished,"immediate-check":!1,"loading-text":e.$t("common.loading"),onLoad:o[1]||(o[1]=u=>B("onLoad")),class:G(["overflow-y-auto h-fit px-4",v(m)?"min-h-[calc(30vh)] max-h-[calc(50vh)]":"min-h-[calc(30vh-78px)] max-h-[calc(50vh-78px)]"]),id:"list"},{default:J(()=>[v(m)?(d(),q(ie,{key:0,class:"!bg-transparent",name:"暂无门店"})):(d(!0),y(re,{key:1},ue(v(h),(u,A)=>(d(),y("div",{class:G(["w-full h-fit bg-white border-b-[0.5px] border-b-b4 border-solid py-4",{"!border-b-0":A===v(h).length-1}]),key:u.storeId,id:"item"+u.storeId},[j(Ze,{"store-info":u,selected:F(u),recentFlag:p(u),onSelect:rt=>w(u,A)},null,8,["store-info","selected","recentFlag","onSelect"])],10,Xe))),128))]),_:1},8,["loading","finished","loading-text","class"]),v(m)?D("",!0):(d(),y("div",We,[j(V,{class:"submit-btn flex-1 bg-yellow text-b1 text-base font-semibold border-none h-[46px]",round:"",disabled:!n.value.storeId,onClick:C},{default:J(()=>[Ye]),_:1},8,["disabled"])]))])])}}}),tt=Q(et,[["__scopeId","data-v-5c1e1436"]]),ot={class:"h-full w-full overflow-hidden"},st={class:"h-[calc(100vh-50px)] bg-[#F2F0EF] relative"},at={class:"px-3 pb-3 bg-white"},nt={class:"h-[calc(100vh-50px-48px)]"},lt=O({setup(t){const b=X(),B=W(),{cityMapStore:s}=Z(),{getUserLocation:f}=Y(),{loadingToggle:I}=pe(),k=M(()=>{var a;return(a=b.query)==null?void 0:a.brandId}),h=M(()=>{var a;return(a=b.query)==null?void 0:a.storeId}),n=M(()=>{var a;return(a=b.query)==null?void 0:a.goodsId}),F=M(()=>{let a=k.value?"相关分店":"门店列表";return r.value.length&&(a+=`(${r.value.length})`),a}),p=E({keyword:""}),m=E(!1),w=E([]),g=async()=>{var a;if(p.value.keyword){C.value=!0,I(!0);const S=await te({size:1,goodsId:n.value,keywords:p.value.keyword});if(C.value=!1,I(!1),!S.success)return;m.value=!0,w.value=((a=S.data)==null?void 0:a.records)||[]}else m.value=!1,w.value=[]},C=E(!1),_=E(!1),c=E(0),r=E([]),T=async()=>{var $,N,H,U,e,o,x,V;C.value=!0,I(!0);let a=[];(s.locationCoords.lat&&s.locationCoords.lng||($=s.currentActiveCity)!=null&&$.areaLatitude&&((N=s.currentActiveCity)!=null&&N.areaLongitude))&&a.push("asc|distance");let S=a.length?a.join(","):null;const z={size:999,longitude:s.locationCoords.lng||((H=s.currentActiveCity)==null?void 0:H.areaLongitude)||null,latitude:s.locationCoords.lat||((U=s.currentActiveCity)==null?void 0:U.areaLatitude)||null,sortBy:S};let i;if(n.value?i=await te({...z,goodsId:n.value}):i=await ge({...z,storeBrandId:k.value,neStoreId:h.value}),C.value=!1,I(!1),!i.success){_.value=!0;return}if(!i.data||!((e=i.data)!=null&&e.records)||!+((o=i.data)==null?void 0:o.total)){_.value=!0;return}if(r.value=((x=i.data)==null?void 0:x.records)||[],c.value=(V=i.data)==null?void 0:V.total,r.value=r.value.map((u,A)=>A===0?{...u,recentFlag:!0}:{...u,recentFlag:!1}),n.value&&h.value){const u=r.value.find(A=>A.storeId==h.value);r.value=r.value.filter(A=>A.storeId!=h.value),r.value.unshift(u)}r.value.length>=c.value&&(_.value=!0)},R=a=>{B.push(a)};return le(async()=>{s.currentActiveCity||await f(),T()}),(a,S)=>{const z=K("router-view");return d(),q(me,{title:v(F),class:"bg-white font-Puhui font-normal relative","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(i,$)=>{$.searchRef=i}},{default:J(()=>[l("div",ot,[l("section",st,[!r.value.length&&!C.value?(d(),q(ie,{key:0,class:"!bg-transparent",name:"暂无门店"})):D("",!0),v(k)&&r.value.length?(d(),q(_e,{key:1,ref:(i,$)=>{$.mapRef=i},storeList:r.value,storeComponent:Ae,"available-store":"",onHandleTo:R},null,8,["storeList"])):r.value.length?(d(),y(re,{key:2},[l("div",at,[j(ve,{modelValue:p.value.keyword,"onUpdate:modelValue":S[0]||(S[0]=i=>p.value.keyword=i),placeholder:"请输入门店名称/地址","search-button-text":"搜索",onSearch:g,onClear:g},null,8,["modelValue"])]),l("div",nt,[j(tt,{ref:(i,$)=>{$.mapRef=i},storeList:r.value,searchList:w.value,searchFlag:m.value,loading:C.value,finished:_.value,onHandleTo:R},null,8,["storeList","searchList","searchFlag","loading","finished"])])],64)):D("",!0)])]),j(z,{class:"child-view"})]),_:1},8,["title"])}}}),xt=Q(lt,[["__scopeId","data-v-10fb02eb"]]);export{xt as default};

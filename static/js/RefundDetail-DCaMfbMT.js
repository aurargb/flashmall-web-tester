import{_ as ie}from"./copy-BNJzxEuA.js";import{_ as Te,y as Ce,w as Re,r as T,a2 as Ie,x as p,be as $e,D as Se,bj as Ae,F as i,G as r,O as v,N as u,l as Ee,E as $,X as l,K as S,P as n,I as Fe,J as De,H as o,Q as a,a1 as y,R as Ne,T as M,Z as Ve,$ as je}from"./vendor-BlU_hoYl.js";import{o as Be,R as Le,h as ae,b as oe,l as Ke,r as Oe}from"./index-Wb-6_0W_.js";import{R as Pe}from"./RefundGoodItem-CSgkjVg3.js";import{_ as He}from"./RecommendationFeed-59_tDTRQ.js";import{C as Me}from"./CommonVanProvider-CDfGVWR4.js";import{P as K}from"./flashSale-DDyqLyYN.js";import{a as Ge,c as ne,n as re}from"./order-pJoL_MtT.js";import{g as Ue}from"./refund-B5IEjYwn.js";import{c as G,d as Je}from"./useRefund-CagomE1G.js";import{m as We}from"./useOrderActionButtons-CwgowcAa.js";import"./avatarRing-DtI_kRg6.js";import"./GoodsItem-DRa0dkv6.js";import"./credit-0laLclE7.js";import"./mcoin-logo-1-CkjdfX51.js";import"./useShipTemplate-C35bKCd2.js";import"./enums-DlE-aiss.js";import"./useOrderStatus-D1Cw0BRr.js";import"./GoodsList-ClcIQmXw.js";import"./buy-cart-DX6aL7m1.js";import"./goods-BVwS8oFG.js";import"./ShopMaskTips-CxJi-SfW.js";import"./shop-CeqcS6K2.js";import"./GoodsPrice-CFQUMmEr.js";import"./MCOIN-BOqZVkND.js";import"./mall-BWu47CdE.js";import"./WaterFull-Ce1Oez92.js";/* empty css                                                              */import"./useShowActiveInfo-DEBRJRuQ.js";import"./festivalActivities-DDLUvtJV.js";import"./BackIcon-8hcEjDKb.js";import"./orderTime-9DqOwNpF.js";const ze="/static/images/ic_round-auto-mode-l7j5TmeY.png",U=F=>(Ve("data-v-acd969de"),F=F(),je(),F),qe={class:"refund-detail__container bg-transparent bg-gray1"},Qe={key:0,class:"px-2 py-4 mt-3 bg-white rounded-xl"},Xe={key:0},Ye={class:"flex items-start",style:{}},Ze={class:"w-2/6"},et={key:0,class:"flex-1 w-full pl-1 ml-1 opacity-60 line flex-nowrap"},tt={key:1,class:"text-[#2E2008] text-xs"},st={key:0,class:"flex-1 mt-2 text-xs opacity-60"},at={key:1},ot={class:"flex items-center justify-between"},nt={class:"gap-2 flex-start"},rt=U(()=>o("img",{src:ze,class:"w-[16px]"},null,-1)),it={class:"text-[#2E2008] font-semibold"},lt={class:"flex items-center justify-between mt-3"},dt={class:"opacity-60 text-[#2E2008]"},ut={class:"font-semibold"},ct={key:0},ft={key:1},mt={key:0,class:"mt-2 text-xs opacity-60"},pt={key:1,class:"mt-2 text-xs opacity-60"},vt={key:2,class:"opacity-60 text-[#2E2008] mt-3"},ht={class:"mt-4 flex-center-bw"},yt={class:"opacity-60"},_t={class:"mt-4 flex-center-bw"},wt={class:"opacity-60"},xt={key:1},gt={class:"mt-4 flex-center-bw"},kt={class:"opacity-60"},bt=U(()=>o("img",{src:ie,class:"w-4 h-4 ml-2",alt:""},null,-1)),Tt={class:"mt-4 flex-center-bw"},Ct={class:"opacity-60"},Rt=U(()=>o("img",{src:ie,class:"w-4 h-4 ml-2",alt:""},null,-1)),It={class:"mt-4 flex-center-bw"},$t={class:"opacity-60"},St={class:"mt-4 flex-center-bw"},At={class:"opacity-60"},Et={class:"flex justify-between gap-2 mt-4 text-right break-all"},Ft={class:"opacity-60 whitespace-nowrap"},Dt={key:2,class:"flex flex-wrap items-center justify-center gap-[20px] mt-[15px] overflow-hidden"},Nt=y(" 未發貨強制退款 "),Vt={key:3,class:"flex justify-center text-sm text-[#2E2008]"},jt={class:"text-sm leading-6 text-black"},Bt={class:"text-primary"},Lt={key:4,class:"flex justify-center text-[#2E2008] text-xs text-center mt-5 pb-5"},Kt={key:5,class:"flex justify-center text-[#2E2008] text-xs text-center mt-5 pb-5"},Ot={key:6,class:"flex justify-center text-[#2E2008] text-xs text-center mt-5 pb-5"},Pt=Ce({setup(F){const{loadingToggle:J}=Oe(),{senderForceCancel:le,senderCancelUnsend:de}=Be(),{getUserDhKey:W,decryptAddressKey:ue,decryptKey:z}=Le(),{t:f}=Re(),ce=Ie(),q=Ee(),t=T(null),fe=ce.query.id,D=T(0),_=T(null),C=T(!1),N=p(()=>{var e,s,d;if(((s=(e=t.value)==null?void 0:e.refundInfo)==null?void 0:s.interveneStatus)===2&&((d=t.value)!=null&&d.platformInterventionCustomerTime)){const w=new Date(t.value.systemTime).getTime();return+t.value.platformInterventionCustomerTime+24*60*60*1e3*10-w}return null}),V=T(!1),me=()=>{V.value=!0},O=T(!1),pe=()=>{O.value=!0},j=p(()=>{var e,s;return((s=(e=t.value)==null?void 0:e.refundInfo)==null?void 0:s.refundStatus)===1}),P=p(()=>{var e,s;return((s=(e=t.value)==null?void 0:e.refundInfo)==null?void 0:s.refundStatus)===6}),Q=e=>{var s;return e!==1||((s=t.value)==null?void 0:s.payType)===K.STORE_CARD||!j.value?!1:D.value>0&&!O.value},ve=p(()=>j.value),he=p(()=>N.value<=0||V.value),X=p(()=>!t.value||t.value.payType===K.STORE_CARD||!j.value?!1:D.value<=0||O.value),ye=p(()=>G(t.value)&&N.value>0&&!V.value),_e=p(()=>G(t.value)&&(N.value<=0||V.value)),A=async()=>{var d,w,E,I,x,B,g,k;const e=JSON.parse(JSON.stringify(t.value)),s=await Ge({id:fe});if((d=s.data)!=null&&d.userAddress&&(s.data.userAddress.postscript=s.data.postscript),(w=s.data)!=null&&w.userAddress&&((I=(E=s.data)==null?void 0:E.userAddress)!=null&&I.encryptFlag)){const c=await W(s.data.stores.id,(x=s.data)==null?void 0:x.submitMerchantPubKey);c&&(s.data.userAddress=ue(s.data.userAddress,c))}if(s.data.shippingHash){const c=await W(s.data.stores.id,(B=s.data)==null?void 0:B.shippingMerchantPubKey);if(c){const b=z(s.data.expressNo,c);b.hash===s.data.shippingHash&&(s.data.expressNo=b.decrypt,s.data.expressCompany=z(s.data.expressCompany,c).decrypt)}}if(t.value=s.data,t.value.refundStatus===1){const c=new Date(t.value.systemTime).getTime(),b=new Date(t.value.autoRefundTime).getTime();D.value=b-c}C.value&&(e.payType==t.value.payType&&((g=e.refundInfo)==null?void 0:g.refundStatus)==((k=t.value.refundInfo)==null?void 0:k.refundStatus)||(C.value=!1))},we=p(()=>t.value.payType===K.STORE_CARD?[{title:f("refund.apply refund"),value:0},{title:f("order.status4"),value:1},{title:f("refund.refund success tips"),value:3}]:[{title:f("refund.apply refund"),value:0},{title:f("refund.waiting deal with"),value:1},{title:f("order.blok comfirm"),value:2},{title:f("refund.refund success tips"),value:4}]),[H,Y]=$e(!1),xe=p(()=>Je(t.value,!0)),ge=async()=>{J(!0);const{success:e}=await Ue({orderId:t.value.id});J(!1),e&&(M(f("common.revoke success")),q.replace({path:"/refundList"}))},Z=()=>{q.push(`/category?deliveryType=1&shopId=${t.value.stores.id}`)},R=T(!1),ke=async()=>{R.value=!0;try{const s=(await ne({orderIds:t.value.id+""})).data.ordIds,d=await le(s[0]);if(!d.success||!(await re({ordIds:s,hash:d.result.transactionHash})).success)return;C.value=!0,setTimeout(()=>{A(),_.value=setInterval(()=>{C.value?A():(clearInterval(_.value),_.value=null)},3e3)},1500)}catch(e){M(e.message||e)}finally{R.value=!1}},be=async()=>{R.value=!0;try{const s=(await ne({orderIds:t.value.id+""})).data.ordIds,d=await de(s[0]);if(!d.success||!(await re({ordIds:s,hash:d.result.transactionHash})).success)return;C.value=!0,setTimeout(()=>{A(),_.value=setInterval(()=>{C.value?A():(clearInterval(_.value),_.value=null)},3e3)},1500)}catch(e){M(e.message||e)}finally{R.value=!1}};return Se(async()=>{await A()}),Ae(()=>{clearInterval(_.value),_.value=null}),(e,s)=>{const d=$("van-count-down"),w=$("VanStep"),E=$("VanSteps"),I=$("van-icon"),x=$("VanButton"),B=$("i18n-t");return r(),i("div",qe,[v(Me,{title:e.$t("order.refund title"),class:"bg-gray1 font-Puhui font-normal relative shopGoodsPage h-full px-3","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(g,k)=>{k.shopGoodsRef=g}},{default:u(()=>{var g,k,c,b,ee,te;return[t.value?(r(),i("div",Qe,[n(j)?(r(),i("div",Xe,[v(E,{direction:"vertical",active:(g=t.value.refundInfo)==null?void 0:g.refundStatus},{default:u(()=>[(r(!0),i(Fe,null,De(n(we),(h,m)=>(r(),S(w,{class:Ne(["text-xs",{"van-icon-checked::before":m===1}]),key:m},{default:u(()=>{var se;return[o("div",Ye,[o("div",Ze,a(m===1&&((se=t.value.refundInfo)==null?void 0:se.refundStatus)==2?e.$t("refund.shop completed"):h.title),1),Q(m)?(r(),i("div",et,[v(d,{time:D.value,onFinish:pe},{default:u(L=>[y(a(e.$t("common.shop will",{time:L.days+e.$t("common.days")+L.hours+e.$t("common.hours")+L.minutes+e.$t("common.minutes")+L.seconds+e.$t("common.seconds")})),1)]),_:1},8,["time"])])):m===1?(r(),i("div",tt,a(e.$t("refund.not delivered the goods")),1)):l("",!0)]),Q(m)?(r(),i("div",st,a(e.$t("refund.waiting refund tips")),1)):l("",!0)]}),_:2},1032,["class"]))),128))]),_:1},8,["active"])])):(r(),i("div",at,[o("div",ot,[o("div",nt,[rt,o("div",it,a(e.$t("refund.order status")),1)])]),o("div",lt,[o("div",dt,a(e.$t("order.Current status of after-sales order")),1),o("div",ut,[n(P)?(r(),i("span",ct,"撤销售后")):(r(),i("span",ft,a(((c=(k=t.value.refundInfo)==null?void 0:k.phase)==null?void 0:c.label)||"--"),1))])]),n(P)?(r(),i("div",mt,a(n(f)("refund.cancel order tips")),1)):l("",!0),n(P)?(r(),i("div",pt,a(e.$t("common.cancel refund time"))+" ："+a(t.value.refundCancelTime||"-"),1)):l("",!0),(b=t.value.refundInfo)!=null&&b.successTime?(r(),i("div",vt,a(((ee=t.value.refundInfo)==null?void 0:ee.successTime)||"--"),1)):l("",!0)]))])):l("",!0),t.value?(r(),S(Pe,{key:1,order:t.value},{default:u(()=>{var h;return[o("div",ht,[o("div",yt,a(e.$t("refund.No")),1),o("div",null,a(t.value.id),1)]),o("div",_t,[o("div",wt,a(e.$t("refund.reason text")),1),o("div",null,a(n(xe)),1)]),n(H)?l("",!0):(r(),i("div",{key:0,class:"mt-4 text-center text-[#2E2008]",onClick:s[0]||(s[0]=m=>n(Y)(!0))},[o("span",null,a(e.$t("common.check more")),1),v(I,{class:"ml-2",name:"arrow-down"})])),n(H)?(r(),i("div",xt,[o("div",gt,[o("div",kt,a(e.$t("order.hash")),1),o("div",{class:"flex items-center",onClick:s[1]||(s[1]=m=>n(ae)(t.value.hash))},[y(a(n(oe)(t.value.hash,"***",9,5)||"-")+" ",1),bt])]),o("div",Tt,[o("div",Ct,a(e.$t("order.payAddress")),1),o("div",{class:"flex items-center",onClick:s[2]||(s[2]=m=>n(ae)(t.value.stores.merchant))},[y(a(n(oe)(t.value.stores.merchant,"...",5,5))+" ",1),Rt])]),o("div",It,[o("div",$t,a(e.$t("order.payTime")),1),o("div",null,a(n(Ke)(t.value.createTime)),1)]),o("div",St,[o("div",At,a(e.$t("order.orderNumber")),1),o("div",null,a(t.value.id),1)]),o("div",Et,[o("div",Ft,a(e.$t("order.orderRemark")),1),o("div",null,a(((h=t.value.userAddress)==null?void 0:h.postscript)||"-"),1)])])):l("",!0),n(H)?(r(),i("div",{key:2,class:"mt-4 text-center text-[#2E2008]",onClick:s[3]||(s[3]=m=>n(Y)(!1))},[y(a(e.$t("refund.put way")),1),v(I,{class:"ml-2",name:"arrow-up"})])):l("",!0)]}),_:1},8,["order"])):l("",!0),t.value?(r(),i("div",Dt,[n(ve)?(r(),S(x,{key:0,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold",onClick:ge},{default:u(()=>[y(a(e.$t("refund.cancel refund")),1)]),_:1})):(r(),S(x,{key:1,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold",onClick:Z},{default:u(()=>[y(a(e.$t("refund.make order")),1)]),_:1})),n(G)(t.value)?(r(),S(x,{key:2,loading:R.value,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold",onClick:ke,disabled:!n(he)},{default:u(()=>[y(a(e.$t("order.forced refund")),1)]),_:1},8,["loading","disabled"])):l("",!0),n(X)?(r(),S(x,{key:3,onClick:be,loading:R.value,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold"},{default:u(()=>[Nt]),_:1},8,["loading"])):l("",!0),v(x,{class:"text-[#FEA021] h-[40px] min-w-[130px] px-4 font-semibold btn-border",onClick:Z},{default:u(()=>[y(a(e.$t("refund.concat sales")),1)]),_:1})])):l("",!0),n(ye)?(r(),i("div",Vt,[v(I,{name:"info-o",color:"red",size:"18px ",class:"mr-1"}),o("div",jt,[v(d,{time:n(N),onFinish:me},{default:u(h=>[v(B,{keypath:"refund.userShopLockRefundTip",tag:"span"},{time:u(()=>[o("span",Bt,a(e.$t("refund.time",{days:h.days,hours:h.hours,minutes:h.minutes,seconds:h.seconds})),1)]),_:2},1024)]),_:1},8,["time"])])])):l("",!0),n(_e)?(r(),i("div",Lt," *"+a(e.$t("refund.directly force a refund")),1)):l("",!0),n(X)?(r(),i("div",Kt," *"+a(e.$t("refund.not delivered the goods")),1)):l("",!0),((te=t.value)==null?void 0:te.payType)!==n(K).STORE_CARD&&n(We)(t.value)?(r(),i("div",Ot," *"+a(e.$t("refund.refund has been forced")),1)):l("",!0),v(He,{"title-text":n(f)("common.recommend_for_you"),class:"pt-[10px]"},null,8,["title-text"])]}),_:1},8,["title"])])}}}),xs=Te(Pt,[["__scopeId","data-v-acd969de"]]);export{xs as default};

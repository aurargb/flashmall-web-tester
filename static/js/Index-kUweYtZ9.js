import{_ as O,y as V,l as X,a1 as Q,r as _,x as T,E as F,F as h,G as l,H as u,a4 as Z,K as E,P as L,Q as z,Y as ee,Z as te,w as ae,N as P,J as K,I as j,R as B,z as R,a2 as D,n as se,O as A,a0 as oe,X as U,D as H,U as ne,V as re,a9 as le}from"./vendor-Ba70TIw4.js";import{_ as ce}from"./down-arrow-dGZh9nVp.js";import{e as G,ao as ie,ap as ue,W as de,aq as pe}from"./index-DGR86ePT.js";import{_ as fe}from"./avatarRing-DtI_kRg6.js";import{O as me}from"./OfflineMerchantLabel-BUhxSfcn.js";import{u as Y}from"./useCityMap-Cea3-tlD.js";const ve="/static/images/demo-bg-DyaCmFCf.png",ge="/static/images/search-ClCpHcy8.svg",W=t=>(ee("data-v-ee9ddf30"),t=t(),te(),t),he={class:"w-full px-3 py-4 bg-transparent font-Puhui flex flex-row justify-between items-center gap-3"},ye=["onClick"],_e={class:"text-sm text-b2 font-normal min-w-[28px] max-w-[56px]"},xe={key:1,class:"line-clamp-1"},be=W(()=>u("img",{src:ce,class:"w-[9px] h-auto"},null,-1)),we=W(()=>u("div",{class:"divider mx-2 ml-3"},null,-1)),Ce=W(()=>u("div",{class:"search-box flex items-center justify-start gap-1"},[u("img",{src:ge,class:"w-4 h-4"}),u("p",{class:"text-sm text-b3 font-normal w-full"},z("搜索门店/服务"))],-1)),ke=V({setup(t){const{cityMapStore:n}=G(),s=X(),r=Q(),m=_(20);T(()=>{const d=m.value;return d===0?0:d>99?"99+":d});const v=()=>{s.push("/city/search")},x=()=>{s.push({path:"/city/selectArea",query:{mode:"change",from:encodeURIComponent(r.path)}})},e=T(()=>n.currentActiveCity||{});return(d,f)=>{const p=F("van-loading");return l(),h("div",he,[u("div",{class:"w-full h-[36px] bg-white rounded-3xl flex items-center justify-start px-3 border-solid border-[1px] border-[#F1A840]",onClick:v},[u("div",{class:"city-selector flex items-center justify-start gap-1",onClick:Z(x,["stop"])},[u("p",_e,[L(e).areaName?(l(),h("span",xe,z(L(e).areaName),1)):(l(),E(p,{key:0,size:"14"}))]),be],8,ye),we,Ce])])}}}),Ie=O(ke,[["__scopeId","data-v-ee9ddf30"]]),Le=["onClick"],$e=["src","alt"],Se={class:"text-sm text-b1 font-normal text-center no-wrap"},Me=V({props:{categoryList:{type:Array,default:()=>[]}},emits:["handleMenu","changeTab"],setup(t,{emit:n}){const s=t,{t:r}=ae(),m=T(()=>s.categoryList||[]),v=_(0),x=T(()=>{let f=m.value.slice(0,5),p=m.value.slice(5),y=[];y.push(f);for(let b=0;b<Math.ceil(p.length/10);b++)y.push(p.slice(b*10,(b+1)*10));return y}),e=f=>{v.value=f},d=f=>{n("handleMenu",f)};return(f,p)=>{const y=F("van-swipe-item"),b=F("van-swipe");return l(),E(b,{class:"font-Puhui linear__wrap min-h-[138.5px] pt-[55px]",loop:!1,onChange:e},{default:P(()=>[(l(!0),h(j,null,K(L(x),(c,k)=>(l(),E(y,{key:k},{default:P(()=>[u("div",{class:B(["w-full px-[10px] flex flex-wrap content-start transition-all gap-y-[1.5px]",v.value===0?"h-[calc(138.5px-55px)]":"h-[calc(211px-55px)]"])},[(l(!0),h(j,null,K(c,(I,o)=>(l(),h("div",{class:"shrink-0 relative w-[20%] h-fit px-3 py-[5.5px] flex flex-col content-start items-center gap-1",key:k+":"+o,onClick:w=>d(I)},[u("img",{class:"shrink-0 w-[36px] h-[36px]",src:I.goodsCategoryIcon||L(fe),alt:I.goodsCategoryName+"的分类"},null,8,$e),u("div",Se,z(I.goodsCategoryName),1)],8,Le))),128))],2)]),_:2},1024))),128))]),_:1})}}}),Ae=O(Me,[["__scopeId","data-v-e9111fe4"]]),ze="/static/images/wave-BD0prNuS.svg",Te=["onClick","id"],Ne={class:"absolute -bottom-1 left-0 shrink-0 w-full flex justify-center items-center"},Ee={key:0,class:"w-fit h-[8px]",src:ze,alt:""},Fe={props:{options:{type:[Array,Object],required:!0},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"value"},modelValue:[String,Number,Object],scrollToSelected:{type:Boolean,default:!0},scrollOffset:{type:Number,default:16}},emits:["update:modelValue","change"],setup(t,{emit:n}){const s=t,r=_(null),m=_(null),v=_([]),x=T(()=>Array.isArray(s.options)?s.options:Object.values(s.options));function e(o){return o[s.valueKey]===s.modelValue}function d(o){n("update:modelValue",o[s.valueKey]),n("change",o[s.valueKey])}R(()=>s.modelValue,async()=>{s.scrollToSelected&&(await se(),f())},{immediate:!0});function f(){const o=x.value.findIndex(C=>e(C));if(o===-1)return;const w=document.getElementById(`category-tab-item-${o}`),i=r.value;if(w&&i){const C=w.offsetLeft-(s.scrollOffset||0);i.scrollTo({left:C,behavior:"smooth"})}}let p=!1,y=0,b=0;function c(o){p=!0,y=o.touches?o.touches[0].pageX:o.pageX,b=r.value.scrollLeft}function k(o){if(!p)return;const w=o.touches?o.touches[0].pageX:o.pageX,i=y-w;r.value.scrollLeft=b+i}function I(){p=!1}return(o,w)=>(l(),h("div",{class:"category-tab h-[103px] pt-[68px] px-3 linear__wrap",ref:(i,C)=>{C.tabWrapper=i,r.value=i},onMousedown:c,onTouchstart:c,onMousemove:k,onTouchmove:k,onMouseup:I,onMouseleave:I,onTouchend:I},[u("div",{class:"stickyTab flex flex-nowrap justify-start items-start gap-5",ref:(i,C)=>{C.tabList=i,m.value=i}},[(l(!0),h(j,null,K(L(x),(i,C)=>(l(),h("div",{key:i[t.valueKey]??C,class:B(["relative shrink-0 mt-[1px] text-sm text-b2 font-normal last:px-3 last:-ml-3",e(i)?"!mt-0 !text-base !text-b1 !font-semibold":""]),onClick:$=>d(i),ref:($,M)=>{M.tabItems=$,v.value=$},id:`category-tab-item-${C}`},[u("p",null,z(i[t.labelKey]),1),u("div",Ne,[e(i)?(l(),h("img",Ee)):D("",!0)])],10,Te))),128))],512)],544))}},Ve=O(Fe,[["__scopeId","data-v-634f6dea"]]),De={class:"shop-img w-[80px] h-[80px] rounded-lg overflow-hidden flex-shrink-0 relative"},Pe={class:"shop-content h-full ml-2 w-full"},je={class:"w-full text-base text-b1 font-semibold flex items-center justify-between"},Be={class:"line-clamp-1"},Oe={class:"text-sm text-b3 font-normal"},qe={class:"h-[20px] text-sm text-b3 font-normal mt-[18px] flex items-center justify-between"},Ke={class:"engagement"},Ue={key:0,class:"distance"},Xe={props:{backgroundColor:{type:String,default:""},store:{type:Object,default:()=>({})}},setup(t){const{distanceFormat:n}=Y(),{cityMapStore:s}=G();return(r,m)=>{var x,e,d,f,p,y,b,c;const v=F("van-image");return l(),h("div",{class:"w-full p-3 bg-white rounded-xl flex items-center justify-start",style:U({backgroundColor:t.backgroundColor})},[u("div",De,[A(v,{width:"80",height:"80",fit:"cover",src:(((x=t.store)==null?void 0:x.storeIcons)||"").split(",")[0]},null,8,["src"]),+((e=t.store)==null?void 0:e.storeGoodsCount)>0?(l(),E(me,{key:0})):D("",!0)]),u("div",Pe,[u("div",je,[u("span",Be,z(((d=t.store)==null?void 0:d.storeName)||""),1)]),u("div",Oe,z(((f=t.store)==null?void 0:f.goodsCategoryName3)||"")+" "+z(((p=t.store)==null?void 0:p.areaExtName3)||""),1),u("div",qe,[u("span",Ke,[+((y=t.store)==null?void 0:y.wantCount)?(l(),h(j,{key:0},[oe(z(t.store.wantCount)+"人想要 ",1)],64)):D("",!0)]),(b=L(s).locationCoords)!=null&&b.lng&&((c=L(s).locationCoords)!=null&&c.lat)?(l(),h("span",Ue,z(L(n)(t.store.distance)),1)):D("",!0)])])],4)}}},Ge={class:"min-h-[calc(100vh-102px-env(safe-area-inset-bottom)-25px-3.5rem)] p-3 bg-[#f2f0ef] rounded-[20px_20px_0_0]"},Re=V({props:{storeParams:{default:()=>{}}},setup(t){const n=t,{cityMapStore:s}=G(),r=X(),m=_(!1),v=_(0),x=_(20),e=_(!1),d=_([]),f=()=>{v.value=0,e.value=!1,d.value=[],p()},p=async()=>{v.value+=1,e.value=!1,m.value=!0,await y(),m.value=!1},y=async()=>{var C,$;let c=[];(s.locationCoords.lat&&s.locationCoords.lng||(C=s.currentActiveCity)!=null&&C.areaLatitude&&(($=s.currentActiveCity)!=null&&$.areaLongitude))&&c.push("asc|distance_order"),c.push("desc|store_home_order"),c.push("asc|store_id");let k=c.length?c.join(","):null;const I={page:v.value,size:x.value,...n.storeParams,sortBy:k},{success:o,data:w}=await ue(I);if(!o||!w||!w.total){e.value=!0;return}const i=w.records||[];i.forEach(M=>{M.shopName=M.storeName||M.shopName}),d.value=v.value===1?i:[...d.value,...i],d.value.length>=w.total&&(e.value=!0)},b=c=>{console.log(c),r.push({path:"/city/cityMap/storefront",query:{storeId:c.storeId,child:1}})};return R(()=>n.storeParams,c=>{c.areaIdPreviousLastLeaf&&f()},{immediate:!0,deep:!0}),H(()=>{}),(c,k)=>{const I=F("van-list");return l(),h("div",Ge,[d.value.length===0&&!m.value?(l(),E(ie,{key:0,name:c.$t("common.No data yet")},null,8,["name"])):(l(),E(I,{key:1,loading:m.value,"onUpdate:loading":k[0]||(k[0]=o=>m.value=o),finished:e.value,"finished-text":c.$t("common.noMore"),onLoad:p},{default:P(()=>[(l(!0),h(j,null,K(d.value,o=>(l(),E(Xe,{key:o.goodsId,store:o,class:"mb-3 :last:mb-0",onClick:w=>b(o)},null,8,["store","onClick"]))),128))]),_:1},8,["loading","finished","finished-text"]))])}}}),He=V({props:{topId:{default:"fm-page"},svg:{default:"cityMap/backTop.svg"},size:{default:50},msize:{default:24},right:{default:16},bottom:{default:16},bg:{default:"#FFF"}},setup(t){const n=t;X();const s=_(null),{width:r,height:m}=ne(),{style:v}=re(s,{initialValue:{x:r.value-(n.right+n.size),y:m.value-(n.bottom+n.size)},onMove:e=>{e.x>n.right&&(e.x=r.value-(n.right+n.size)),e.x<n.right&&(e.x=n.right),e.y>m.value-n.size&&(e.y=m.value-n.size),e.y<0&&(e.y=0)}}),x=()=>{const e=document.querySelector("#"+n.topId);e&&setTimeout(()=>{e.scrollTo({top:0})},50)};return H(()=>{}),(e,d)=>{const f=F("VanImage");return l(),h("div",{ref:(p,y)=>{y.el=p,s.value=p},style:U([L(v),{"touch-action":"none"}]),onClick:x,class:B(["fixed z-[49] flex items-center justify-center rounded-full shadow-[0_1px_16px_0_rgba(0,0,0,0.16)] cursor-pointer",`w-[${t.size}px] h-[${t.size}px] bg-[${t.bg}]`])},[A(f,{src:L(de)(t.svg),class:B(["overflow-hidden",`w-[${t.msize}px] h-[${t.msize}px]`]),alt:""},null,8,["src","class"])],6)}}}),We=O(He,[["__scopeId","data-v-97ea034e"]]),Je={class:"header__wrap relative"},Qe={key:1,class:"mt-3"},Ye=V({name:"CityMap"});function Ze(t){var J;const n=Q(),s=X(),{cityMapStore:r}=G(),{getUserLocation:m}=Y(),v=T(()=>{var S;const a=((S=r.currentActiveCity)==null?void 0:S.areaIcon)||null;return{backgroundImage:`url(${a||ve})`}||{}}),x=_(!1),e=_(""),d=async()=>{try{x.value=!0,e.value="",await m()}catch{}finally{x.value=!1}},f=_([]),p=async()=>{var S,q;const a={areaIdPreviousLastLeaf:((S=r.currentActiveCity)==null?void 0:S.areaId)||"",overseasFlag:((q=r.currentActiveCity)==null?void 0:q.overseasFlag)||!1},{success:g,data:N}=await pe(a);g&&(f.value=N||[])};R(r.currentActiveCity,(a,g)=>{console.log("已选城市发生改变",{newCity:a==null?void 0:a.areaName,oldCity:g==null?void 0:g.areaName,hasAreaId:!!(a!=null&&a.areaId)}),a!=null&&a.areaId&&p()},{immediate:!0,deep:!0});const y=()=>{const a=setInterval(()=>{var g;(g=r.currentActiveCity)!=null&&g.areaId&&(p(),clearInterval(a))},500)},b=a=>{console.log(a),s.push({path:"/city/poi",query:{categoryId:a.goodsCategoryId}})},c=T(()=>{let a=f.value.map(g=>({label:g.goodsCategoryName,value:g.goodsCategoryId}));return a.unshift({label:"附近店铺",value:""}),a}),k=_(((J=c.value[0])==null?void 0:J.value)||""),I=a=>{k.value=a},o=T(()=>{var a,g,N,S;return{goodsCategoryId1:k.value,longitude:r.locationCoords.lng||((a=r.currentActiveCity)==null?void 0:a.areaLongitude)||null,latitude:r.locationCoords.lat||((g=r.currentActiveCity)==null?void 0:g.areaLatitude)||null,areaIdPreviousLastLeaf:((N=r.currentActiveCity)==null?void 0:N.areaId)||"",overseasFlag:((S=r.currentActiveCity)==null?void 0:S.overseasFlag)||!1}}),w=async()=>{if(n.path!=="/city/cityMap"){window.removeEventListener("visibilitychange",w);return}document.hidden?console.log("cityMap hidden"):(console.log("cityMap show"),await d())},i=T(()=>document.querySelector("#fm-page")),C=_(0),$=_(!1),M=a=>{if(n.path!=="/city/cityMap"){i.value.removeEventListener("scroll",M);return}C.value=a.target.scrollTop,C.value>=81?$.value=!0:$.value=!1};return H(async()=>{await r.init(),await d(),y(),window.addEventListener("visibilitychange",w),i.value.addEventListener("scroll",M)}),le(()=>{window.removeEventListener("visibilitychange",w),i.value.removeEventListener("scroll",M)}),(a,g)=>{const N=F("van-sticky"),S=F("router-view");return l(),h("div",{class:"app-container img__wrap",style:U(L(v))},[A(N,{"z-index":"10"},{default:P(()=>[u("div",Je,[A(Ie)])]),_:1}),$.value?(l(),E(N,{key:0,"z-index":"9"},{default:P(()=>[A(Ve,{options:L(c),modelValue:k.value,"onUpdate:modelValue":g[0]||(g[0]=q=>k.value=q),onChange:I,"label-key":"label","value-key":"value"},null,8,["options","modelValue"])]),_:1})):(l(),h("div",Qe,[A(Ae,{categoryList:f.value,tabFixed:$.value,onHandleMenu:b},null,8,["categoryList","tabFixed"])])),$.value?(l(),h("div",{key:2,class:"imgSticky img__wrap sm:w-[375px] w-full h-[68px] fixed top-0 left-1/2 -translate-x-1/2 z-[8]",style:U(L(v))},null,4)):D("",!0),u("div",{class:B(["bg-white pt-[5.5px] mt-[-0.5px]",$.value?"pt-[53px]":""])},[A(Re,{storeParams:L(o)},null,8,["storeParams"])],2),A(We,{size:40,msize:20,bottom:92}),A(S,{class:"child-view !rounded-none"})],4)}}const et=V({...Ye,setup:Ze}),lt=O(et,[["__scopeId","data-v-64246502"]]);export{lt as default};

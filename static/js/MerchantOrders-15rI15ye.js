import{y as Oe,w as Ue,x as Te,F as E,X as Y,P as u,G as b,I as ce,J as ve,R as te,Y as Ae,Q as p,a4 as ie,T,_ as qe,be as Le,o as ke,r as v,bf as Fe,D as Ge,E as w,H as l,O as d,a3 as it,N as m,bD as ct,a0 as Be,K as J,Z as We,$ as Je,l as ut,a2 as rt,z as dt,a1 as fe,bc as G,bd as W,bP as mt,t as pt}from"./vendor-BlU_hoYl.js";import{h as Ve,_ as ft,e as vt}from"./excel-B8sCVOEn.js";import{C as ht}from"./CommonVanProvider-CDfGVWR4.js";import{e as Ye,u as Qe,ad as _e,R as xt,C as gt,bR as je,l as Ee,b as bt,bU as yt,bV as wt,bS as _t}from"./index-UgIL2Smv.js";import{_ as kt}from"./OfflineGoods-NsfElKHP.js";import{_ as Tt}from"./OfflineConsumer-IseIUH_a.js";import{_ as Ct}from"./search-B34EARrH.js";import{_ as St}from"./filter-IfI7iQIk.js";import{D as It}from"./goods-BVwS8oFG.js";import{w as Xe,x as $t,y as Dt}from"./order-ClP3Ze4h.js";import{B as Et}from"./BetweenTab-BE6o466J.js";import{a as le,O as Ke,d as Lt}from"./offlineGoods-DvT2Go6q.js";import{_ as At}from"./RegionBox-ExMr1J4R.js";import"./BackIcon-8hcEjDKb.js";import"./MCOIN-BOqZVkND.js";import"./ImgBoutiqueLable-BIio6fYG.js";import"./shop-CeqcS6K2.js";import"./avatarRing-DtI_kRg6.js";/* empty css                                                               */const Vt=Oe({props:{order:null},emits:["open"],setup(L,{emit:Q}){const O=L,{t:B}=Ue(),{accountStore:U}=Ye(),H=Te(()=>{var M,n;return(M=O.order)!=null&&M.orderLabels?(n=O.order)==null?void 0:n.orderLabels.filter(h=>!!h).map((h,X)=>{var oe;return{...h,id:(oe=O.order)==null?void 0:oe.orderLabelIds[X]}}):[]}),he=M=>{if(U.isOnlyView)return T(B("order.Requires merchant account operation"));Q("open",M)};return(M,n)=>u(H).length?(b(),E("ul",{key:0,class:"w-fit max-w-full tag-style flex justify-start items-center mt-[16px] text-white overflow-x-scroll",onClick:n[0]||(n[0]=ie(h=>he(L.order),["stop"]))},[u(H).length>0?(b(!0),E(ce,{key:0},ve(u(H).slice(0,5),h=>(b(),E("li",{style:Ae({backgroundColor:u(Ve)(h==null?void 0:h.colorHex,.12),color:h==null?void 0:h.colorHex}),class:te(["shrink-0 text-xxs h-[22px] rounded-[4px] px-[8px] py-1 mr-1 flex justify-center items-center font-normal whitespace-nowrap",{"w-[22px]":!(h!=null&&h.content)}]),key:h==null?void 0:h.id},p(h==null?void 0:h.content),7))),128)):Y("",!0)])):Y("",!0)}}),Ze=L=>(We("data-v-510c91c8"),L=L(),Je(),L),Ot={class:"flex items-center p-3"},Rt={class:"flex-1 bg-white rounded-3xl search-input-box"},Pt=Ze(()=>l("div",null,[l("img",{src:Ct,class:"w-4 h-4"})],-1)),Ht=Ze(()=>l("img",{src:St,class:"w-full h-full"},null,-1)),Mt=[Ht],Nt={class:"flex flex-col h-[75vh] justify-between px-5 pb-[80px]"},Bt={class:"pt-[18px] pb-4 font-semibold text-base text-center"},Ft={class:"overflow-y-auto flex-1"},Yt={class:"text-sm font-semibold"},Ut={class:"flex items-center gap-2 mt-3 overflow-x-auto"},zt=["onClick"],jt={class:"mt-3 flex-start"},Kt={class:"mx-2"},qt={key:0,class:"pt-4"},Gt={class:"text-sm font-semibold"},Wt={class:"pt-[10px] pr-[10px] mt-[10px] max-h-[300px]"},Jt={class:"pb-4 flex-center-bw p-4 flex justify-between gap-3 fixed bottom-0 left-0 right-0 bg-white"},Qt={class:"text-base font-normal"},Xt={class:"text-base font-semibold"},Zt=Oe({props:{modelValue:null,deliveryType:{default:It.online},shopType:null},emits:["update:modelValue","onSearch"],setup(L,{expose:Q,emit:O}){const{t:B}=Ue(),[U,H]=Le(!1),{getCurrentStoreId:he}=Qe(),M=ke().format("YYYY-MM-DD"),n=ke().subtract("days",7).format("YYYY-MM-DD"),h=ke().subtract("month",1).format("YYYY-MM-DD"),X=ke().subtract("month",3).format("YYYY-MM-DD"),oe=Te(()=>[{id:1,label:B("shop.Last 7 days")},{id:2,label:B("shop.last month")},{id:3,label:B("shop.last 3 months")}]),[ue,re]=Le(!1),[xe,z]=Le(!1),a=v(new Date),x=v(new Date),Re=v(new Date(new Date("2020/1/1").getTime())),ne=v(new Date(new Date("2020/1/1").getTime())),f=Fe({startTime:null,endTime:null}),A=v(!1),_=v(!1),C=v([]),k=v([]),N=v(null),ge=()=>{O("onSearch"),N.value.blur()},R=()=>{f.startTime=null,f.endTime=null,j.value=null,a.value=null,x.value=null,k.value=[],K()},V=()=>{re(!1),z(!1),(!f.startTime||!f.endTime)&&(f.endTime=null,f.startTime=null)},Ce=r=>{a.value=new Date(_e(r)),ne.value=new Date(new Date(r).getTime()),f.startTime=_e(a.value.toString()),j.value=null,re(!1),z(!0)},I=r=>{x.value=new Date(_e(r)),f.startTime=_e(a.value.toString()),f.endTime=_e(r),j.value=null,z(!1)},j=v(null),Se=r=>{if(j.value!==r){switch(x.value=new Date(M),f.endTime=M,r){case 1:f.startTime=n,a.value=new Date(n),ne.value=new Date(new Date(n).getTime()+60*1e3);break;case 2:f.startTime=h,a.value=new Date(h),ne.value=new Date(new Date(h).getTime()+60*1e3);break;case 3:f.startTime=X,a.value=new Date(X),ne.value=new Date(new Date(X).getTime()+60*1e3);break}j.value=r}},K=()=>{const r={startTime:f.startTime?f.startTime+" 00:00:00":null,endTime:f.endTime?f.endTime+" 23:59:59":null,orderLabelIdList:k.value};O("onSearch",r),H(!1)},de=async()=>{var r;Xe({page:1,size:300,shopId:(r=await he())==null?void 0:r.id}).then(c=>{C.value=c.data.map(Z=>({id:Z.id,content:Z.content,colorHex:Z.colorHex})),A.value=!1,C.value.length>=c.total&&(_.value=!0)})};return Ge(()=>{de()}),Q({onLoadTagList:de}),(r,c)=>{const Z=w("VanField"),me=w("van-datetime-picker"),Ie=w("van-popup"),se=w("van-icon"),Pe=w("van-checkbox"),$e=w("van-checkbox-group"),He=w("van-list"),De=w("VanButton"),Me=w("VanPopup");return b(),E(ce,null,[l("div",Ot,[l("div",Rt,[d(Z,{ref:(i,ee)=>{ee.searchRef=i,N.value=i},onKeyup:ct(ge,["enter"]),"model-value":L.modelValue,"onUpdate:modelValue":c[1]||(c[1]=i=>O("update:modelValue",i)),placeholder:r.$t("offline.searchTips"),class:"w-[100% - 20px] text-center bg-transparent items-center",clearable:"",enterkeyhint:"search"},{"left-icon":m(()=>[Pt]),"right-icon":m(()=>[l("div",{onClick:c[0]||(c[0]=i=>O("onSearch")),class:"text-newOrigin font-semibold leading-5"},p(r.$t("common.search")),1)]),_:1},8,["onKeyup","model-value","placeholder"])]),l("div",{class:"flex-shrink-0 w-5 h-5 ml-2",onClick:c[2]||(c[2]=i=>u(H)(!0))},Mt),it(r.$slots,"default",{},void 0,!0)]),d(Me,{teleport:"body",show:u(U),"onUpdate:show":c[11]||(c[11]=i=>Be(U)?U.value=i:null),round:"",position:"bottom",closeable:"",class:"sm:w-[375px]",style:{height:"75vh","max-height":"75vh","min-width":"280px",left:"50%",transform:"translate3d(-50%, 0, 0)"},"close-on-click-overlay":"",onClickOverlay:c[12]||(c[12]=i=>u(H)(!1)),onClickCloseIcon:c[13]||(c[13]=i=>u(H)(!1))},{default:m(()=>[l("div",Nt,[l("div",Bt,p(r.$t("common.OrderScreening")),1),l("div",Ft,[l("div",Yt,p(r.$t("common.time")),1),l("div",Ut,[(b(!0),E(ce,null,ve(u(oe),i=>(b(),E("div",{class:te(["type-cell flex-1",{"cell-active":j.value==i.id}]),key:i.id,onClick:ee=>Se(i.id)},p(i.label),11,zt))),128))]),l("div",jt,[l("div",{class:"van-cell p-0 flex justify-center type-cell",onClick:c[3]||(c[3]=ie(i=>u(re)(!0),["stop"]))},[l("div",{class:te({"opacity-30":!u(f).startTime})},p(u(f).startTime||r.$t("goods.selectStartTime")),3)]),d(Ie,{show:u(ue),"onUpdate:show":c[5]||(c[5]=i=>Be(ue)?ue.value=i:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:m(()=>[d(me,{modelValue:a.value,"onUpdate:modelValue":c[4]||(c[4]=i=>a.value=i),"min-date":Re.value,type:"date",title:r.$t("goods.selectStartTime"),onCancel:V,onConfirm:Ce},null,8,["modelValue","min-date","title"])]),_:1},8,["show"]),l("div",Kt,[d(se,{name:"minus"})]),l("div",{class:"van-cell p-0 flex justify-center type-cell",onClick:c[6]||(c[6]=ie(i=>u(z)(!0),["stop"]))},[l("div",{class:te({"opacity-30":!u(f).endTime})},p(u(f).endTime||r.$t("goods.selectEndTime")),3)]),d(Ie,{show:u(xe),"onUpdate:show":c[8]||(c[8]=i=>Be(xe)?xe.value=i:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:m(()=>[d(me,{modelValue:x.value,"onUpdate:modelValue":c[7]||(c[7]=i=>x.value=i),onConfirm:I,"min-date":ne.value,onCancel:V,type:"date",title:r.$t("goods.selectEndTime")},null,8,["modelValue","min-date","title"])]),_:1},8,["show"])]),C.value&&C.value.length?(b(),E("div",qt,[l("div",Gt,p(r.$t("common.tag")),1),l("div",Wt,[d(He,{loading:A.value,"onUpdate:loading":c[10]||(c[10]=i=>A.value=i),finished:_.value,onLoad:de},{default:m(()=>[d($e,{modelValue:k.value,"onUpdate:modelValue":c[9]||(c[9]=i=>k.value=i),max:5},{default:m(()=>[(b(!0),E(ce,null,ve(C.value,(i,ee)=>(b(),J(Pe,{name:i.id,key:ee,class:"relative flex radioList"},{icon:m(be=>[be.checked?(b(),J(se,{key:0,name:"success",color:"white",class:"tag-icon absolute right-[15px] border-0 top-[1px] bg-transparent",size:"30"})):Y("",!0)]),default:m(()=>[l("div",{style:Ae({backgroundColor:u(Ve)(i.colorHex,.12),color:i.colorHex}),class:te(["rounded-[6px] min-h-[40px] p-[10px] text-white text-[0.875rem]",ee===C.value.length-1?"":"mb-[16px]"])},p(i.content),7)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["loading","finished"])])])):Y("",!0)]),l("div",Jt,[d(De,{round:"",class:"!border-b4 text-b1 flex-1 h-[46px]",onClick:R},{default:m(()=>[l("span",Qt,p(r.$t("common.reset")),1)]),_:1}),d(De,{round:"",class:"btn-yellow flex-1 h-[46px] border-0",onClick:K},{default:m(()=>[l("span",Xt,p(r.$t("common.confirm")),1)]),_:1})])])]),_:1},8,["show"])],64)}}}),eo=qe(Zt,[["__scopeId","data-v-510c91c8"]]),to=L=>(We("data-v-593c4490"),L=L(),Je(),L),oo=to(()=>l("img",{src:ft,class:"w-5 h-5"},null,-1)),no=[oo],so={class:"mx-3 safe-body overflow-y-auto"},ao=["onClick"],lo={class:"text-b3"},io={key:0,class:"relative flex justify-end text-xs mt-3 gap-2"},co={class:"px-[20px] pt-[18px] pb-[15px] flex justify-between bg-white z-40 text-[14px] items-center absolute top-0 left-0 right-0"},uo={class:"text-[#222221] text-[16px]"},ro={class:"tagForm"},mo={class:"text-[#222221] mb-[10px]"},po={class:"mt-[30px]"},fo={key:0,class:"text-center mt-[150px]"},vo={class:"h-[96px] p-[16px] flex flex-col justify-center items-center fixed bottom-0 left-0 right-0 bg-white"},ho={class:"mt-[8px] text-[#5D5A56] text-[12px] leading-none"},xo={class:"p-[16px] flex justify-center fixed bottom-0 left-0 right-0 bg-white"},go=Oe({name:"MerchantOrders"});function bo(L){const{accountStore:Q}=Ye(),{clerkStore:O}=Ye(),B=ut(),U=rt(),{getCurrentStoreId:H}=Qe(),he=v(null),M=v(null),{t:n}=Ue(),{generateKey:h,getMerchantDhKey:X,decryptKey:oe,cryptoAESWithSearch:ue}=xt(),re=Te(()=>[{label:n("order.wait"),value:le.PAYMENT_SUCCESS},{label:n("order.canceled"),value:le.CANCELLED},{label:n("order.completed"),value:le.COMPLETED},{label:n("common.all"),value:-1}]),[xe,z]=Le(!1),a=Fe({status:-1,shopInfo:null,list:[],total:0,loading:!1,finished:!1}),x=Fe({shopId:null,orderCustomerAddress:void 0,page:0,size:20,keywords:"",merchantEnsLike:void 0,orderStatus:-1,startTime:void 0,endTime:void 0,orderLabelIdList:void 0,sortBy:"desc|create_time"}),Re=t=>{a.status=t,B.replace({path:"offlineMerchantOrders",query:{status:t}}),Z()},ne=Te(()=>!0),f=v(!1),A=v(!1),_=v(!1),C=v(null),k=v([]),N=v(""),ge=v([]),R=v([]),V=v(null),Ce=Te(()=>{var t;return(t=a.shopInfo)==null?void 0:t.id}),I=v({content:"",colorHex:"",id:null,shopId:null}),j=v(null),Se=v([{id:null,content:"",colorHex:"#D4380D"},{id:null,content:"",colorHex:"#E58312"},{id:null,content:"",colorHex:"#DEAD0E"},{id:null,content:"",colorHex:"#389E0D"},{id:null,content:"",colorHex:"#0958D9"},{id:null,content:"",colorHex:"#531DAB"}]),K=v(!1),de=v(0),r=t=>{var s;return((s=re.value.find(y=>+y.value==+t))==null?void 0:s.label)||""},c=t=>{B.push(t)},Z=async t=>{t&&(x.startTime=(t==null?void 0:t.startTime)||void 0,x.endTime=(t==null?void 0:t.endTime)||void 0,x.orderLabelIdList=(t==null?void 0:t.orderLabelIdList)||void 0),a.finished=!1,a.total=0,a.list=[],x.page=0,me()},me=async()=>{var t,s;if(!((t=a.shopInfo)!=null&&t.id))return a.finished=!0;a.loading=!0,x.shopId=(s=a.shopInfo)==null?void 0:s.id,x.page+=1,await se(),a.loading=!1},Ie=async t=>{const s=[];for(let y=0;y<t.length;y++){const g=t[y];if(g!=null&&g.orderRemark&&!g.merchantEns)try{let $=g.orderRemark;if(g!=null&&g.orderSubmitCustomerPubKey){const D=await X(g.merchantAddress,g.orderSubmitCustomerPubKey);if(D){const{decrypt:ae}=oe(g.orderRemark,D);$=ae}}if($){const D=await ue($);D&&s.push({orderId:g.orderId,merchantEns:D})}}catch($){console.error("Decryption failed:",$)}}(s||[]).length&&wt(s)},se=async()=>{const t=a.status;let s=null;K.value&&(s=Math.ceil((de.value+1)/x.size)),a.status<0?delete x.orderStatus:x.orderStatus=a.status,x.keywords?x.merchantEnsLike=await ue(x.keywords):x.merchantEnsLike=void 0;const{success:y,data:g}=await je(x);if(a.loading=!1,!y){a.finished=!0;return}const{records:$,total:D,current:ae,pages:pe}=g;if(!D||!$||!($!=null&&$.length)){a.finished=!0;return}a.total=D;const q=v([]);q.value=$.map(ye=>({btnLoading:!1,...ye})),Ie(q.value),t===a.status&&(K.value?(a.list.splice((s-1)*x.size,x.size,...q.value),K.value=!1):a.list=x.page===1?q.value:a.list.concat(q.value)),+ae>=+pe&&(a.finished=!0)},Pe=t=>{if(Q.isOnlyView)return T(n("order.Requires merchant account operation"));if(O.isClerk&&!O.clerkAuth)return T(n("order.Requires merchant account operation"));B.push({name:"offlineMerchantDetail",query:{id:t.orderId,quick:"deliver"}})},$e=(t,s)=>{if(Q.isOnlyView)return T(n("order.Requires merchant account operation"));de.value=s,f.value=!0,j.value=t.orderId,t.orderLabelIds&&(k.value=[],t.orderLabelIds.forEach(y=>k.value.push(+y))),be()},He=t=>{_.value=!0,t.id&&(V.value=t.id,C.value=t.content,I.value.id=t.id,I.value.colorHex=t.colorHex,N.value=t.colorHex,ge.value=k.value)},De=()=>{_.value=!0,V.value=null,C.value=null,I.value.id=null,I.value.colorHex=null,N.value="",ge.value=k.value},Me=t=>{k.value&&k.value.length>=5&&k.value.findIndex(s=>s===R.value[t].id)===-1&&T(n("common.tag select num valid",{num:5}))},i=()=>{_.value=!1,k.value=ge.value,V.value=null,R.value.length=0,C.value=null,N.value="",be()},ee=()=>{f.value=!1,V.value=null,k.value=[],M.value.onLoadTagList()},be=()=>{R.value=[],Xe({page:1,size:300,shopId:Ce.value}).then(t=>{t==null||t.data.forEach(s=>{R.value.push({id:s.id,content:s.content,colorHex:s.colorHex})})})},et=()=>{var t;if(!A.value){if(((t=N.value)==null?void 0:t.length)===0){T.fail(n("order.Please select a color"));return}else I.value.colorHex=N.value,I.value.id=V.value,I.value.content=C.value,I.value.shopId=Ce.value;I.value.content&&(I.value.content=I.value.content.trim()),V.value||delete I.value.id,A.value=!0,$t(I.value).then(s=>{s.msg==="SUCCESS"&&(_.value=!1,R.value=[],N.value="",C.value=null,be(),K.value=!0,se(),T(n("order.Save success")))}).finally(()=>{A.value=!1})}},tt=()=>{A.value||(A.value=!0,Dt({id:V.value}).then(t=>{t.msg==="SUCCESS"?(T(n("order.Delete success")),K.value=!0,se(),i()):T(n("order.Delete failed"))}).finally(()=>{A.value=!1}))},ot=async()=>{A.value||(k.value=k.value.filter(t=>!!R.value.find(s=>t==s.id)),A.value=!0,await yt({orderId:j.value,orderLabelIds:k.value}).then(t=>{if(t!=null&&t.success)f.value=!1,_.value=!1,C.value="",T(n("order.Save success")),K.value=!0,se();else{T(n("order.Save failed"));return}}).finally(()=>{A.value=!1}))},nt=t=>{if(Q.isOnlyView)return T(n("order.Requires merchant account operation"));const s=t.orderCustomerAddress;bt(t.orderCustomerAddress,"...",5,5),B.push(`/merchantOrders-offlineOrderHistory?address=${s}&source=merchants`)},st=async()=>{var S;const t=navigator.userAgent.toLowerCase(),s=/mobile|android|iphone|ipad|phone/i.test(t),y=/tablet|ipad/i.test(t),g=/webview|wv/i.test(t),$=/fbav|instagram|line|twitter|whatsapp/i.test(t),D=/metamask/i.test(t),ae=/tokenpocket/i.test(t),pe=(window==null?void 0:window.$onekey)||!1;if(pt.isConnected()){z(!0);return}if(pe){z(!0);return}if((s||y)&&(g||$||D||ae||pe)&&!window.chrome&&!window.safari){z(!0);return}const q={...x,page:1,size:99999};T.loading({duration:0,message:n("common.loading")});const{success:ye,data:P}=await je(q);if(!ye||!(P!=null&&P.records)||(P==null?void 0:P.records.length)===0){T.clear(),T(n("common.No data download"));return}await h("merchant");const Ne=P==null?void 0:P.records.map(e=>new Promise(async at=>{if(e!=null&&e.orderRemark&&(e!=null&&e.orderSubmitCustomerPubKey))try{const F=await X(e.merchantAddress,e.orderSubmitCustomerPubKey);if(F){const lt=oe(e.orderRemark,F);e.orderRemark=lt.decrypt}}catch(F){console.error("解密失败:",F)}at([{text:e==null?void 0:e.orderId},{text:(e==null?void 0:e.orderCustomerAddress)||""},{text:(e==null?void 0:e.orderPayAddress)||""},{text:(e==null?void 0:e.orderTransactionHash)||""},{text:(e==null?void 0:e.storeName)||(e==null?void 0:e.storeId)||""},{text:(e==null?void 0:e.shopName)||""},{text:typeof(e==null?void 0:e.orderType)=="number"?n(`offline.order_${Ke[e==null?void 0:e.orderType]}`):""},{text:(e==null?void 0:e.relName)||""},{text:(e==null?void 0:e.relId)||""},{text:(e==null?void 0:e.relNumber)||0},{text:(e==null?void 0:e.relPrice)||0},{text:r(e==null?void 0:e.orderStatus)},{text:(e==null?void 0:e.orderTotalAmount)||0},{text:(e==null?void 0:e.orderRealAmount)||0},{text:e!=null&&e.orderDiscountRatio?(e==null?void 0:e.orderDiscountRatio)+"%":"0%"},{text:e!=null&&e.createTime?Ee(e==null?void 0:e.createTime):""},{text:e!=null&&e.payTime?Ee(e==null?void 0:e.payTime):""},{text:(e==null?void 0:e.orderStatus)!==le.CANCELLED&&(e!=null&&e.finishTime)?Ee(e==null?void 0:e.finishTime):""},{text:(e==null?void 0:e.orderRemark)||""},{text:e!=null&&e.orderLabels&&(e!=null&&e.orderLabels.length)?e==null?void 0:e.orderLabels.map(F=>F==null?void 0:F.content).filter(F=>!!F).join(","):""},{text:typeof(e==null?void 0:e.cancelSource)=="number"?n(`offline.order_cancel_type_${Lt[e==null?void 0:e.cancelSource]}`):""},{text:(e==null?void 0:e.cancelReason)||""},{text:(e==null?void 0:e.orderStatus)===le.CANCELLED&&(e!=null&&e.finishTime)?Ee(e==null?void 0:e.finishTime):""}])})),we=await Promise.all(Ne);if(!we||we.length===0){T.clear(),T(n("common.No data download"));return}const o=[{text:n("order.export.orderId")},{text:n("order.export.buyerAddress")},{text:n("order.export.payAddress")},{text:n("order.export.transactionHash")},{text:n("order.export.belongShop")},{text:n("order.export.services")},{text:n("order.export.goodsType")},{text:n("order.export.goodsName")},{text:n("order.export.goodsId")},{text:n("order.export.goodsNumber")},{text:n("order.export.goodsPrice")},{text:n("order.orderStatus")},{text:n("order.export.goodsPriceTotal")},{text:n("order.export.actualAmount total")},{text:n("common.ratio")},{text:n("order.createTime")},{text:n("order.export.paymentTime")},{text:n("order.Complete time")},{text:n("order.remark")},{text:n("offline.export.order tag")},{text:n("offline.export.order cancel type")},{text:n("offline.export.order cancel reason")},{text:n("offline.cancel_time")}];try{const e=((S=await H())==null?void 0:S.storeName)+n("offline.main title")+"_"+ke().format("YYYY-MM-DD HH:mm:ss");vt([o,...we],{excelName:e,worksheet:"sheet"}),T.clear()}catch{T.clear()}},ze=()=>{z(!1)};return dt(()=>U.path,async t=>{if(t==="/offlineMerchantOrders"){const s=sessionStorage.getItem("merchant_offline_refresh_chainOrderId");if(s){const y=a.list.findIndex(g=>g.orderId==s);if(y>-1&&a.status===le.PAYMENT_SUCCESS)a.list.splice(y,1);else if(y>-1&&a.status===-1){const g=await _t({id:s});g.success&&(a.list[y]=g.data||{})}sessionStorage.removeItem("merchant_offline_refresh_chainOrderId")}}},{deep:!0}),Ge(async()=>{var t,s;(t=U.query)!=null&&t.status&&(a.status=Number((s=U.query)==null?void 0:s.status)),a.shopInfo=await H(),me(),O.checkClerkAuth()}),(t,s)=>{const y=w("VanButton"),g=w("VanList"),$=w("van-field"),D=w("van-icon"),ae=w("van-radio"),pe=w("van-radio-group"),q=w("van-checkbox"),ye=w("van-checkbox-group"),P=w("van-button"),Ne=w("van-action-sheet"),we=w("router-view");return b(),J(ht,{title:t.$t("offline.main title"),class:"bg-gray1 font-Puhui font-normal relative shopGoodsPage","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(o,S)=>{S.shopGoodsRef=o,he.value=o}},{right:m(()=>[d(At)]),default:m(()=>[d(Et,{options:u(re),"label-key":"label","value-key":"value",modelValue:u(a).status,"onUpdate:modelValue":s[0]||(s[0]=o=>u(a).status=o),onChange:Re},null,8,["options","modelValue"]),d(eo,{ref:(o,S)=>{S.searchBox=o,M.value=o},modelValue:u(x).keywords,"onUpdate:modelValue":s[1]||(s[1]=o=>u(x).keywords=o),onOnSearch:Z},{default:m(()=>[l("div",{class:"flex-shrink-0 w-5 ml-3",onClick:st},no)]),_:1},8,["modelValue"]),l("div",so,[d(g,{loading:u(a).loading,"onUpdate:loading":s[2]||(s[2]=o=>u(a).loading=o),finished:u(a).finished,"immediate-check":!1,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:me},{default:m(()=>[(b(!0),E(ce,null,ve(u(a).list,(o,S)=>(b(),E("div",{class:"offline-crad-box mb-3",key:o.orderId,onClick:e=>c(`/offlineMerchantDetail?id=${o.orderId}`)},[d(Tt,{order:o,"show-status":"",status:r(o.orderStatus)},null,8,["order","status"]),d(Vt,{order:o,onOpen:e=>$e(e,S)},null,8,["order","onOpen"]),d(kt,{"show-order-type":"",class:"mt-3",goods:{goodsName:o.relName,goodsIcons:o.relIcons,orderType:o.orderType,goodsPrice:o.orderRealAmount,areaExtName2:o.areaExtName2,storeName:o.storeName},onImageClick:e=>o.orderType===u(Ke).GOODS?c("/offlineMerchantOrders/offlineGoodsDetail?goodsId="+o.relId+(o.storeId?`&storeId=${o.storeId}`:"")+"&child=1"):c("/shop?shopId="+o.relId)},{"bottom-left":m(()=>[l("div",lo,p(t.$t("common.total"))+"：",1)]),_:2},1032,["goods","onImageClick"]),u(Q).isOnlyView?Y("",!0):(b(),E("section",io,[u(ne)?(b(),J(y,{key:0,class:"bg-[#f5f5f5] rounded-md h-[32px] px-3 text-[#585654] text-sm font-normal",onClick:ie(e=>nt(o),["stop"])},{default:m(()=>[fe(p(t.$t("order.orderHistoryBuy")),1)]),_:2},1032,["onClick"])):Y("",!0),d(y,{class:"bg-[#f5f5f5] rounded-md h-[32px] px-3 text-[#585654] text-sm font-normal",onClick:ie(e=>$e(o,S),["stop"])},{default:m(()=>[fe(p(t.$t("order.orderAddTag")),1)]),_:2},1032,["onClick"]),o.orderStatus===u(le).PAYMENT_SUCCESS?(b(),J(y,{key:1,color:"#FED73A",round:"",class:"!text-b1 font-semibold h-[32px] rounded-md px-3",onClick:ie(e=>Pe(o),["stop"])},{default:m(()=>[fe(p(t.$t("order.Ship")),1)]),_:2},1032,["onClick"])):Y("",!0)]))],8,ao))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])]),d(Ne,{show:f.value,"onUpdate:show":s[8]||(s[8]=o=>f.value=o),closeable:!1,class:"h-[70vh]",onCancel:i,onClose:ee},{default:m(()=>[l("div",co,[G(l("div",{class:"text-[#5D5A56] w-[60px]",onClick:i},p(t.$t("common.closed")),513),[[W,_.value]]),G(l("div",{class:"text-[#5D5A56] w-[30px]",onClick:ee},p(t.$t("common.closed")),513),[[W,!_.value]]),l("div",uo,p(V.value?t.$t("common.editTag"):t.$t("common.addTag")),1),G(l("div",{class:"text-[#A45E00] w-[30px]",onClick:De},p(t.$t("piggy.add")),513),[[W,!_.value]]),G(l("div",{class:"text-[#A45E00] w-[30px]",onClick:et},p(t.$t("common.save")),513),[[W,_.value]])]),l("div",{class:te(["mt-[53px] px-[20px]",_.value&&V.value?"pb-[96px]":"pb-[72px]"])},[d(mt,{name:"van-slide-up"},{default:m(()=>[G(l("div",ro,[l("div",mo,p(t.$t("common.NameOptional")),1),d($,{modelValue:C.value,"onUpdate:modelValue":s[3]||(s[3]=o=>C.value=o),maxlength:"5",placeholder:t.$t("common.pleaseEnter")},null,8,["modelValue","placeholder"]),l("div",po,p(t.$t("common.color")),1)],512),[[W,_.value]])]),_:1}),G(d(pe,{modelValue:N.value,"onUpdate:modelValue":s[4]||(s[4]=o=>N.value=o),max:1},{default:m(()=>[(b(!0),E(ce,null,ve(Se.value,(o,S)=>(b(),J(ae,{name:o.colorHex,key:S,class:"relative flex checkedList"},{icon:m(e=>[e.checked?(b(),J(D,{key:0,name:"success",color:"white",class:"tag-icon absolute right-[23px] border-0 top-[1px] bg-transparent",size:"30"})):Y("",!0)]),default:m(()=>[l("div",{style:Ae({backgroundColor:u(Ve)(o.colorHex,.12),color:o.colorHex}),class:te(["mr-[10px] rounded-[6px] min-h-[40px] p-[10px] text-white",S<Se.value.length-1?"mb-[16px]":""])},p(o.content||C.value),7)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),[[W,_.value]]),!_.value&&R.value.length==0?(b(),E("div",fo,p(t.$t("common.NoLabels")),1)):Y("",!0),G(d(ye,{modelValue:k.value,"onUpdate:modelValue":s[5]||(s[5]=o=>k.value=o),max:5},{default:m(()=>[(b(!0),E(ce,null,ve(R.value,(o,S)=>(b(),J(q,{name:o.id,key:S,class:"relative flex radioList",onClick:e=>Me(S)},{icon:m(e=>[e.checked?(b(),J(D,{key:0,name:"success",color:"white",class:"tag-icon absolute right-[40px] border-0 top-[1px] bg-transparent",size:"30"})):Y("",!0)]),default:m(()=>[l("div",{style:Ae({backgroundColor:u(Ve)(o.colorHex,.12),color:o.colorHex}),class:te(["mr-[10px] rounded-[6px] min-h-[40px] p-[10px] text-white",S<R.value.length-1?"mb-[16px]":""])},p(o.content||C.value),7),l("div",null,[d(D,{name:"edit",class:"absolute right-[1px] top-[1px]",color:"#543E3E",size:"30",onClick:ie(e=>He(o),["stop"])},null,8,["onClick"])])]),_:2},1032,["name","onClick"]))),128))]),_:1},8,["modelValue"]),[[W,!_.value]]),G(l("div",vo,[d(P,{color:"linear-gradient(to right, #FED53A, #FFA122)",class:"shrink-0 w-[180px] my-0 h-[40px] rounded-[20px]",onClick:s[6]||(s[6]=o=>tt()),block:""},{default:m(()=>[fe(p(t.$t("common.RemoveTag")),1)]),_:1}),l("div",ho,[d(D,{name:"question-o",size:"12",class:"mr-[8px]"}),fe(p(t.$t("common.AllOrderLabelsCannotBeViewedAfterRemoval")),1)])],512),[[W,_.value&&V.value]])],2),G(l("div",xo,[d(P,{color:"linear-gradient(to right, #FED53A, #FFA122)",class:"w-[180px] my-0 h-[40px] rounded-[20px]",onClick:s[7]||(s[7]=o=>ot()),block:""},{default:m(()=>[fe(p(t.$t("common.ConfirmSelection")),1)]),_:1})],512),[[W,!_.value&&R.value.length>0]])]),_:1},8,["show"]),d(gt,{show:u(xe),title:"导出账单",content:"请在PC端操作账单导出",showConfirm:!0,showReject:!1,confirmText:"我知道了",rejectText:"拒绝",onClose:ze,onConfirm:ze},null,8,["show"]),d(we,{class:"child-view bg-gray1"})]),_:1},8,["title"])}}const yo=Oe({...go,setup:bo}),Bo=qe(yo,[["__scopeId","data-v-593c4490"]]);export{Bo as default};

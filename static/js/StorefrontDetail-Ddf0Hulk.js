import{_ as he,r,x as B,z as xe,F as l,G as a,H as t,I as F,J as U,R as P,X as x,a3 as we,Q as g,P as i,n as Ce,y as Ie,a2 as ge,bf as ke,E as N,K as H,N as W,O as y,D as Se,bj as $e,a4 as Y,Z as Be,$ as Te,l as Ve,a1 as Ae,T as _e}from"./vendor-BlU_hoYl.js";import{_ as Ee,a as je}from"./collect-BClEEey2.js";import{at as Le,aH as Ne,e as De,S as Fe,h as Oe,W as ee,r as Pe,aA as We,aB as qe,aI as Ge}from"./index-UgIL2Smv.js";import{u as Ke}from"./useCityMap-CU72MCNW.js";import{_ as be}from"./right-arrow-Dxo7EFlu.js";import{B as ze}from"./BackIcon-8hcEjDKb.js";import{_ as Me}from"./MCOIN-BOqZVkND.js";import{_ as Ue}from"./ImgBoutiqueLable-BIio6fYG.js";/* empty css                                                              *//* empty css                                                                 */import"./shop-CeqcS6K2.js";const He=["onClick","id"],Re={class:"relative"},Je={class:"text-sm text-b3 font-normal flex items-center justify-center"},Qe={class:"label__wrap text-center"},Xe={key:0,class:"fm-tab-underline"},Ze={props:{options:{type:[Array,Object],required:!0},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"value"},modelValue:[String,Number,Object],scrollToSelected:{type:Boolean,default:!0},scrollOffset:{type:Number,default:16},equalWidth:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(S,{emit:A}){const f=S,$=r(null),w=r(null),E=r([]),C=B(()=>Array.isArray(f.options)?f.options:Object.values(f.options));function p(v){return v[f.valueKey]===f.modelValue}function T(v){A("update:modelValue",v[f.valueKey]),A("change",v[f.valueKey])}xe(()=>f.modelValue,async()=>{f.scrollToSelected&&(await Ce(),I())},{immediate:!0});function I(){const v=C.value.findIndex(u=>p(u));if(v===-1)return;const k=document.getElementById(`fm-tab-item-${v}`),c=$.value;if(k&&c){const u=k.offsetLeft-(f.scrollOffset||0);c.scrollTo({left:u,behavior:"smooth"})}}return(v,k)=>(a(),l("div",{class:"fm-tab",ref:(c,u)=>{u.tabWrapper=c,$.value=c}},[t("div",{class:"flex flex-nowrap items-center w-full",ref:(c,u)=>{u.tabList=c,w.value=c}},[(a(!0),l(F,null,U(i(C),(c,u)=>(a(),l("div",{key:c[S.valueKey]??u,class:P([["fm-tab-item",{active:p(c)}],"relative w-1/2 flex justify-center items-center"]),onClick:m=>T(c),ref:(m,e)=>{e.tabItems=m,E.value=m},id:`fm-tab-item-${u}`},[t("div",Re,[t("p",Je,[t("span",Qe,g(c[S.labelKey]),1),we(v.$slots,"badge"+u,{},void 0,!0)]),p(c)?(a(),l("div",Xe)):x("",!0)])],10,He))),128))],512)],512))}},Ye=he(Ze,[["__scopeId","data-v-591f336a"]]),et={key:0},tt={key:0},st=["onClick"],ot={class:"text-base font-semibold text-b1 line-clamp-1"},at=["onClick"],lt={class:"shrink-0 w-[80px] h-[80px] rounded-lg overflow-hidden relative"},nt={class:"ml-2 w-full h-[80px] flex flex-col justify-between"},rt={class:"shrink-0"},ct={class:"text-sm text-b1 font-semibold line-clamp-1"},it={class:"mt-1 text-sm text-b3 font-normal line-clamp-1"},ut={class:"shrink-0 flex items-center"},dt={class:"text-sm text-b1 font-semibold"},ft=Ie({props:{params:{default:{}}},emits:["handleTo"],setup(S,{expose:A,emit:f}){const $=S,w=ge(),E=ke({page:0,size:99}),C=r(0),p=r(!1),T=r(!1),I=r([]),v=3,k=3,c=async()=>{p.value=!0,E.page+=1,await u(),p.value=!1},u=async()=>{const n=await Ne({...E,...$.params});if(!n.success){T.value=!0;return}if(!n.data||!n.data.records||!+n.data.total){T.value=!0;return}C.value=n.data.total,I.value=E.page===1?n.data.records:I.value.concat(n.data.records),I.value.length>=C.value&&(T.value=!0)},m=r(!1),e=B(()=>I.value.filter(n=>+n.storeShopGoodsCount>0)),G=B(()=>m.value||e.value.length<=k?e.value:e.value.slice(0,k)),R=n=>n.goodsList.slice(0,v),j=()=>{m.value=!m.value},J=n=>{f("handleTo","/shop?shopId="+n.shopId)},Q=n=>{var _;const D=w.path.replace("storefront","offlineGoodsDetail");f("handleTo",D+("?goodsId="+n.goodsId)+("&storeId="+$.params.storeId)+((_=w.query)!=null&&_.child?"&child=1":""))};return A({total:C,finished:T,loading:p}),(n,D)=>{const _=N("VanImage"),X=N("VanList");return a(),H(X,{loading:p.value,"onUpdate:loading":D[0]||(D[0]=h=>p.value=h),finished:T.value,"loading-text":n.$t("common.loading"),onLoad:c},{finished:W(()=>[C.value?x("",!0):(a(),H(Le,{key:0,style:{padding:"52px 0 47px"},name:"该店暂未开通代买单服务"}))]),default:W(()=>[C.value?(a(),l("div",et,[(a(!0),l(F,null,U(i(G),(h,K)=>{var O;return a(),l("div",{class:"mb-3 last:mb-0",key:K},[t("div",{class:P(K>0?"w-full border-b-[0.5px] border-b-b4 mb-3":"")},null,2),(O=h==null?void 0:h.goodsList)!=null&&O.length?(a(),l("div",tt,[t("div",{class:"flex items-center mb-3 cursor-pointer",onClick:b=>J(h)},[y(_,{src:h.shopPics?h.shopPics.split(",")[0]:"",class:"w-6 h-6 mr-1 rounded-[4px] overflow-hidden",alt:h.shopName,fit:"cover"},null,8,["src","alt"]),t("span",ot,g(h.shopName),1),y(_,{src:i(be),class:"w-4 h-4",alt:"arrow"},null,8,["src"])],8,st),(a(!0),l(F,null,U(R(h),(b,s)=>(a(),l("div",{key:b.goodsId,class:"flex items-center mb-3 last:mb-0",onClick:o=>Q(b)},[t("div",lt,[y(_,{src:b.goodsIcons?b.goodsIcons.split(",")[0]:"",class:"w-full h-full object-cover",alt:b.goodsName,fit:"cover"},null,8,["src","alt"]),y(Ue,{type:b.goodsType||null},null,8,["type"])]),t("div",nt,[t("div",rt,[t("div",ct,g(b.goodsName),1),t("div",it,g(b.goodsDesc),1)]),t("div",ut,[y(_,{src:i(Me),class:"w-4 h-4 mr-1",alt:"Mcoin"},null,8,["src"]),t("span",dt,g(b.goodsPrice),1)])])],8,at))),128))])):x("",!0)])}),128)),i(e).length>k?(a(),l("div",{key:0,class:"text-center text-b3 text-sm font-normal",onClick:j},g(m.value?"收起":`查看其他${i(e).length-k}家门店`),1)):x("",!0)])):x("",!0)]),_:1},8,["loading","finished","loading-text"])}}}),q=S=>(Be("data-v-542a418f"),S=S(),Te(),S),vt={class:"flex flex-wrap items-center w-10"},pt=q(()=>t("p",{class:"text-lg font-bold text-b1 text-center"},"门店详情",-1)),mt={key:0,src:Ee,alt:"收藏",class:"w-5 h-5"},_t={key:1,src:je,alt:"取消",class:"w-5 h-5"},ht={class:"w-full h-[330px]"},xt={class:"relative z-10"},gt={class:"shop-info rounded-t-xl bg-white w-ful p-3 mt-[-12px]"},bt={class:"flex justify-between items-start gap-1"},yt={class:"text-lg font-bold text-b1"},wt={key:0,class:"shrink-0 w-fit h-[28px] flex justify-center items-center"},Ct=q(()=>t("div",{class:"text-xs text-newOrigin bg-[#FFF8EC] border-[0.5px] border-[#FF8812] px-1 rounded-sm font-normal"}," 代买单 ",-1)),It=[Ct],kt={class:"flex items-center justify-start mt-[2px] text-xs text-b3 font-normal"},St=q(()=>t("div",{class:"divider bg-[#D9D9D9] h-[12px] w-[1px] mx-1"},null,-1)),$t={class:"map-texture w-full h-fit rounded-lg overflow-hidden mt-2"},Bt={key:0,class:"w-full h-full map-texture-bg flex items-center justify-between p-2"},Tt={class:"text-xs text-[#2E2008] leading-[18px] font-semibold"},Vt={key:0,class:"mt-1 text-xs text-[#585654] leading-[18px]"},At=["src"],Et=q(()=>t("div",{class:"mt-[1px] text-xs text-[#585654] leading-[18px]"}," 复制 ",-1)),jt={class:"mt-2 relative z-10 h-fit pb-2"},Lt={class:"w-full bg-white"},Nt={class:"p-3 bg-white",id:"combo"},Dt=["onClick"],Ft={class:"p-3 flex justify-between items-center"},Ot=q(()=>t("div",{class:"text-base font-medium text-b1"},"相关分店",-1)),Pt={class:"flex justify-center items-center"},Wt={class:"text-xs text-b3 font-normal"},qt={key:0,class:"button-group-bg fixed bottom-0 left-0 z-[11] w-full h-[82px] flex items-center px-3 pt-4 safe-bottom justify-evenly gap-x-3 btn-wrapper"},Gt={key:0,round:"",class:"min-w-[58.5%] w-full h-[46px] text-base font-semibold bg-yellow text-b1 rounded-full opacity-[0.7] flex justify-center items-center"},Kt=Ae(" 我想要 "),zt={setup(S){const A=ge(),f=Ve(),{loadingToggle:$}=Pe(),{cityMapStore:w}=De(),{distanceFormat:E}=Ke(),C=B(()=>{var s;return(s=A.query)!=null&&s.child?document.getElementById("storefront"):document.getElementById("fm-page")}),p=r(!1);r(0);let T=r(!0);const I=r([{label:"门店服务",value:"bundle"},{label:"消费笔记",value:"note"}]),v=r(I.value[0].value),k=r([I.value[0]]),c=s=>{let o=null;s==="bundle"?o=document.querySelector("#combo"):s==="note"&&(o=document.querySelector("#note")),C.value&&o&&setTimeout(()=>{var d;C.value.scrollTo({top:((d=o==null?void 0:o.getBoundingClientRect())==null?void 0:d.top)||0,behavior:"smooth"})},100)},u=B(()=>{var s,o,d;return e.value.storeId&&(e.value.addWantCountFlag||+((s=e.value)==null?void 0:s.wantCount))&&((o=j.value)==null?void 0:o.total)===0&&!((d=j.value)!=null&&d.loading)}),m=B(()=>{var s;return((s=A.query)==null?void 0:s.storeId)||""}),e=r({}),G=r([]),R=async()=>{var s,o,d,z;try{const Z={id:m.value,longitude:w.locationCoords.lng||((s=w.currentActiveCity)==null?void 0:s.areaLongitude)||null,latitude:w.locationCoords.lat||((o=w.currentActiveCity)==null?void 0:o.areaLatitude)||null},L=await Fe(Z);if(!L.success||!L.data)return;e.value=L.data,G.value=(d=L.data)!=null&&d.storeIcons?(z=L.data)==null?void 0:z.storeIcons.split(","):[]}catch{}},j=r(null),J=r(null),Q=B(()=>{var s;return(s=J.value)==null?void 0:s.total}),n=B(()=>({storeId:m.value}));xe(()=>Q.value,(s,o)=>{k.value=[I.value[0]],v.value=I.value[0].value},{immediate:!0,deep:!0});const D=async()=>{var o;if(p.value||!m.value)return;p.value=!0;const s=await Ge({id:m.value});p.value=!1,s.success&&(e.value.addWantCountFlag=!e.value.addWantCountFlag,e.value.wantCount=+(((o=e.value)==null?void 0:o.wantCount)||0)+1)},_=r(!1),X=async()=>{var o,d;if(_.value||!((o=e.value)!=null&&o.storeId))return;_.value=!0,$(!0);const s=await qe({storeId:(d=e.value)==null?void 0:d.storeId});_.value=!1,$(!1),s.success&&(e.value.collectId=s.data,_e({message:"收藏成功",icon:ee("toast-success.svg"),duration:3e3}))},h=async()=>{var o,d;if(_.value||!((o=e.value)!=null&&o.storeId))return;_.value=!0,$(!0);const s=await We({ids:[(d=e.value)==null?void 0:d.collectId]});_.value=!1,$(!1),s.success&&(e.value.collectId=null,_e({message:"取消收藏",icon:ee("toast-success.svg"),duration:3e3}))},K=B(()=>{var s;return((s=e.value)==null?void 0:s.goodsCategoryName3)||""});B(()=>{var s,o;return(s=e.value)!=null&&s.areaName2?((o=e.value)==null?void 0:o.areaName2)+"市":""});const O=s=>{f.push(s)},b=()=>{var o;const s=A.path.replace("storefront","availableStores");O(`${s}?brandId=${(o=e.value)==null?void 0:o.storeBrandId}&storeId=${m.value}`)};return Se(async()=>{await R()}),$e(()=>{}),(s,o)=>{var te,se,oe,ae,le,ne,re,ce,ie,ue,de,fe,ve,pe,me;const d=N("VanImage"),z=N("van-swipe-item"),Z=N("van-swipe"),L=N("VanButton"),ye=N("router-view");return a(),l("div",{class:P(["relative w-full h-full pt-[50px] font-Puhui",{"pb-[82px]":i(u)}]),id:"storefront",style:{background:"#f2f0ef"}},[t("div",{class:P(["flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[50px] px-4 fixed bg-white rounded-none",{"!bg-white":i(T)}])},[t("div",vt,[y(ze)]),pt,t("div",{onClick:o[0]||(o[0]=Y(V=>e.value.collectId?h():X(),["stop"]))},[e.value.collectId?(a(),l("img",mt)):(a(),l("img",_t))])],2),t("div",{class:P(["detail__wrap overflow-y-scroll flex flex-col",i(u)?"h-[calc(100vh-50px-82px)]":"h-[calc(100vh-50px)]"])},[t("section",ht,[y(Z,{class:"note-imgs-swiper",autoplay:3e3,"indicator-color":"oriange1"},{default:W(()=>[(a(!0),l(F,null,U(G.value,V=>(a(),H(z,{key:V},{default:W(()=>[y(d,{src:V,class:"w-full h-full overflow-hidden",alt:"",fit:"cover"},null,8,["src"])]),_:2},1024))),128))]),_:1})]),t("div",xt,[t("section",gt,[t("div",bt,[t("p",yt,g(((te=e.value)==null?void 0:te.storeName)||""),1),+e.value.storeGoodsCount>0?(a(),l("div",wt,It)):x("",!0)]),t("div",kt,[t("p",null,g(i(K)),1),+((se=e.value)==null?void 0:se.orderPersonCount15)>0?(a(),l(F,{key:0},[St,t("p",null,"近15天"+g(((oe=e.value)==null?void 0:oe.orderPersonCount15)||0)+"人下单",1)],64)):x("",!0)]),t("div",$t,[(ae=e.value)!=null&&ae.storeAddress?(a(),l("div",Bt,[t("div",null,[t("p",Tt,g((le=e.value)==null?void 0:le.storeAddress),1),(ne=e.value)!=null&&ne.distance&&((re=i(w).locationCoords)!=null&&re.lat)&&((ce=i(w).locationCoords)!=null&&ce.lng)?(a(),l("div",Vt,g(i(E)(((ie=e.value)==null?void 0:ie.distance)||0,2,999,"距您直线")),1)):x("",!0)]),(ue=e.value)!=null&&ue.storeAddress?(a(),l("div",{key:0,class:"shrink-0 flex flex-col items-center",onClick:o[1]||(o[1]=Y(V=>{var M;return i(Oe)((M=e.value)==null?void 0:M.storeAddress)},["stop"]))},[t("img",{class:"w-4 h-4",src:i(ee)("cityMap/copy.svg"),alt:""},null,8,At),Et])):x("",!0)])):x("",!0)])])]),t("div",jt,[t("section",Lt,[y(Ye,{modelValue:v.value,"onUpdate:modelValue":o[2]||(o[2]=V=>v.value=V),options:k.value,onChange:c,"label-key":"label","value-key":"value"},null,8,["modelValue","options"]),t("div",Nt,[y(ft,{ref:(V,M)=>{M.shopBundle=V,j.value=V},params:i(n),onHandleTo:O},null,8,["params"])])]),((de=e.value)==null?void 0:de.storeCount)>1?(a(),l("section",{key:0,class:"mt-2 w-full bg-white",onClick:Y(b,["stop"])},[t("div",Ft,[Ot,t("div",Pt,[t("span",Wt,g(((fe=e.value)==null?void 0:fe.storeCount)-1)+"店可用 ",1),y(d,{src:i(be),class:"shrink-0 w-3 h-3",alt:"arrow"},null,8,["src"])])])],8,Dt)):x("",!0)])],2),i(u)?(a(),l("div",qt,[(ve=j.value)!=null&&ve.finished&&((pe=j.value)==null?void 0:pe.total)===0?(a(),l(F,{key:0},[e.value.storeId&&!e.value.addWantCountFlag?(a(),l("div",Gt," 已有"+g(((me=e.value)==null?void 0:me.wantCount)||0)+"人想要 ",1)):(a(),H(L,{key:1,round:"",class:"min-w-[58.5%] w-full h-[46px] text-base font-semibold bg-yellow text-b1",loading:p.value,onClick:D},{default:W(()=>[Kt]),_:1},8,["loading"]))],64)):x("",!0)])):x("",!0),y(ye,{class:"child-view !rounded-none sm:fixed"})],2)}}},ss=he(zt,[["__scopeId","data-v-542a418f"]]);export{ss as default};

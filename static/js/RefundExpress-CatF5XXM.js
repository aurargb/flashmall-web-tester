import{_ as Pe}from"./arrow-down-585654-BvWo_huQ.js";import{_ as He,y as Re,w as Te,l as Ue,r as y,a1 as Oe,be as je,bf as qe,D as Fe,E as x,F as Ne,a2 as ze,G as Ae,H as o,O as i,Q as v,N as C,P as m,I as Ge,J as Je,a0 as Qe,Y as We,Z as Ye,T as N}from"./vendor-Ba70TIw4.js";import{a as Ze,v as Xe}from"./order-Bt6BXfCD.js";import{e as es}from"./refund-BilSleEw.js";import{B as ss}from"./BackIcon-DkqwcD_b.js";import{R as as}from"./index-Bsb9uxb4.js";const we=f=>(We("data-v-7466cbde"),f=f(),Ye(),f),ts={key:0,class:"font-Puhui main-bg safe-bottom-page"},os={class:"header-bar fixed top-0 left-0 right-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 backdrop-blur-md bg-white"},rs={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},ds={class:"font-bold text-base text-b1"},ns={class:"safe-bottom pt-[62px] rounded-xl px-3"},ls={class:"rounded-xl bg-white overflow-hidden px-3"},is=we(()=>o("img",{src:Pe,class:"w-4 h-4 m-[2px]",alt:""},null,-1)),ps=we(()=>o("div",{class:"h-px bg-[#e5e5e5]"},null,-1)),cs={class:"flex justify-center items-center relative h-14 font-bold text-[22px] text-[#3a2e13]"},us={class:"flex-1 text-center text-base font-semibold text-b1"},ms={class:"pl-4 pr-4 pb-4 h-[calc(100%-56px)] overflow-y-scroll"},fs=["onClick"],hs={class:"text-b1"},ys={class:"popup-footer w-full fixed bottom-0 left-0 right-0 safe-bottom px-3"},xs=Re({name:"SellerDelivery"});function vs(f){const{t:A}=Te(),Ie=Ue(),{getMerchantDhKey:b,decryptAddressKey:ke,decryptKey:w,cryptoAESWithSearch:De,encryptKey:I}=as();y(!1);const k=Oe(),Ee=k.query.id;k.query.detail;const h=y(null),D=y(!1),Ve=async()=>{var n,l,t,_,g,E,V,L,K,S,$,B,M,P,H,R,T,U,O,j,q,F,z,G,J,Q,W,Y,Z,X,ee,se,ae,te,oe,re,de,ne,le,ie,pe,ce,ue,me,fe,he,ye,xe,ve,be,_e,ge;const e=await Ze({id:Ee});let s="";if((n=e.data)!=null&&n.userAddress&&(e.data.userAddress.postscript=e.data.postscript),(l=e.data)!=null&&l.userAddress&&((_=(t=e.data)==null?void 0:t.userAddress)!=null&&_.encryptFlag)){const d=await b(e.data.address,(g=e.data)==null?void 0:g.submitUserPubKey);d&&(e.data.userAddress=ke(e.data.userAddress,d),(V=(E=e.data)==null?void 0:E.userAddress)!=null&&V.success&&!((L=e.data)!=null&&L.merchantEns)&&(s+=((S=(K=e.data)==null?void 0:K.userAddress)==null?void 0:S.userName)+((B=($=e.data)==null?void 0:$.userAddress)==null?void 0:B.telNumber)+(((P=(M=e.data)==null?void 0:M.userAddress)==null?void 0:P.postalCode)??"")+((R=(H=e.data)==null?void 0:H.userAddress)==null?void 0:R.provinceName)+((U=(T=e.data)==null?void 0:T.userAddress)==null?void 0:U.cityName)+((j=(O=e.data)==null?void 0:O.userAddress)==null?void 0:j.countyName)+((F=(q=e.data)==null?void 0:q.userAddress)==null?void 0:F.detailInfo)+((G=(z=e.data)==null?void 0:z.userAddress)==null?void 0:G.postscript)))}else(J=e.data)!=null&&J.merchantEns||(s+=((W=(Q=e.data)==null?void 0:Q.userAddress)==null?void 0:W.userName)+((Z=(Y=e.data)==null?void 0:Y.userAddress)==null?void 0:Z.telNumber)+(((ee=(X=e.data)==null?void 0:X.userAddress)==null?void 0:ee.postalCode)??"")+((ae=(se=e.data)==null?void 0:se.userAddress)==null?void 0:ae.provinceName)+((oe=(te=e.data)==null?void 0:te.userAddress)==null?void 0:oe.cityName)+((de=(re=e.data)==null?void 0:re.userAddress)==null?void 0:de.countyName)+((le=(ne=e.data)==null?void 0:ne.userAddress)==null?void 0:le.detailInfo)+((pe=(ie=e.data)==null?void 0:ie.userAddress)==null?void 0:pe.postscript));if(e.data.shippingHash){const d=await b(e.data.address,(ce=e.data)==null?void 0:ce.shippingUserPubKey);if(d){const Ce=w(e.data.expressNo,d);Ce.hash===e.data.shippingHash&&(e.data.expressNo=Ce.decrypt,e.data.expressCompany=w(e.data.expressCompany,d).decrypt,(ue=e.data)!=null&&ue.merchantEns||(s+=((me=e.data)==null?void 0:me.expressNo)+((fe=e.data)==null?void 0:fe.expressCompany)))}else(he=e.data)!=null&&he.merchantEns||(s+=((ye=e.data)==null?void 0:ye.expressNo)+((xe=e.data)==null?void 0:xe.expressCompany));(ve=e.data)!=null&&ve.merchantEns||(s+=((be=e.data)==null?void 0:be.hash)+((_e=e.data)==null?void 0:_e.address))}const u=[{id:(ge=e.data)==null?void 0:ge.id,merchantEns:await De(s)}].filter(d=>d.merchantEns);u.length>0&&Xe({enInfoList:u}),h.value=e.data},[Le,Ke]=je(!1),p=y(!1),Se=["无需发货","到付运费","顺丰速运","中国邮政EMS","京东物流","中通快递","圆通速递","韵达快递","申通快递","极兔速递","德邦物流","其他"],a=qe({expressCompany:"",expressNo:"",orderId:""}),$e=e=>{a.expressCompany=e,p.value=!1},Be=()=>{p.value=!1},Me=async()=>{var s;if(D.value)return;c(!0),a.orderId=h.value.id;const e=await b((s=h.value)==null?void 0:s.address);try{if(!a.expressCompany){N.fail(A("order.deliveryCompanyPlaceholder")),c(!1);return}if(a.expressCompany!=="无需发货"&&!a.expressNo){N.fail(A("order.express empty")),c(!1);return}let r={expressCompany:a.expressCompany,expressNo:a.expressNo,orderId:a.orderId,shippingHash:null};if(e){const n=I(a.expressNo,e);r.expressNo=n.encrypt,r.shippingHash=n.hash;const l=I(a.expressCompany,e);r.expressCompany=l.encrypt}(await es(r)).success&&setTimeout(()=>{Ie.replace({path:"/buyerOrderList",query:{active:2,type:1}})},50),c(!1)}catch(r){c(!1),N.fail(r.message)}},c=(e=!0)=>{Ke(e),D.value=e};return Fe(async()=>{await Ve()}),(e,s)=>{const r=x("van-field"),u=x("van-icon"),n=x("van-popup"),l=x("VanButton");return h.value?(Ae(),Ne("div",ts,[o("section",os,[o("div",rs,[i(ss)]),o("div",ds,v(e.$t("order.deliveryInfo")),1)]),o("div",ns,[o("div",ls,[i(r,{modelValue:m(a).expressCompany,"onUpdate:modelValue":s[0]||(s[0]=t=>m(a).expressCompany=t),label:e.$t("order.deliveryCompany"),placeholder:e.$t("order.deliveryCompanyPlaceholder"),border:!1,"input-align":"right",readonly:"",onClick:s[1]||(s[1]=t=>p.value=!0)},{"right-icon":C(()=>[is]),_:1},8,["modelValue","label","placeholder"]),ps,i(r,{modelValue:m(a).expressNo,"onUpdate:modelValue":s[2]||(s[2]=t=>m(a).expressNo=t),label:e.$t("order.deliveryId"),placeholder:e.$t("order.deliveryPlaceholder"),border:!1,"input-align":"right",maxlength:150},null,8,["modelValue","label","placeholder"]),i(n,{show:p.value,"onUpdate:show":s[3]||(s[3]=t=>p.value=t),position:"bottom",round:"",style:{width:"100%",borderRadius:"20px 20px 0 0",maxHeight:"90vh",height:"660px"}},{default:C(()=>[o("div",cs,[o("span",us,v(e.$t("order.deliveryCompany")),1),i(u,{name:"cross",class:"absolute right-4 top-1/2 -translate-y-1/2 text-2xl",onClick:Be})]),o("div",ms,[(Ae(),Ne(Ge,null,Je(Se,(t,_)=>o("div",{key:t,class:"text-b1 py-4 border-b border-[#D9D9D9]",onClick:g=>$e(t)},[o("span",hs,v(t),1)],8,fs)),64))])]),_:1},8,["show"])]),o("div",ys,[i(l,{round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full w-full",loading:m(Le),onClick:Me},{default:C(()=>[Qe(v(e.$t("common.confirm")),1)]),_:1},8,["loading"])])])])):ze("",!0)}}const bs=Object.assign(xs,{setup:vs}),Is=He(bs,[["__scopeId","data-v-7466cbde"]]);export{Is as default};

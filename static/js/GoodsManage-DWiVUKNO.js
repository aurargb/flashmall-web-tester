import{_ as J}from"./MCOIN-Bodfn-v1.js";import{_ as K,y as E,w as Q,l as X,a2 as Y,r as w,bf as F,x as Z,D as W,bh as ee,bj as oe,E as k,K as v,G as m,N as r,O as c,H as u,P as n,F as B,J as te,Q as g,X as C,a1 as S,I as se,R as ne,Z as le,$ as ie}from"./vendor-BlU_hoYl.js";import{C as ae}from"./CommonVanProvider-CDfGVWR4.js";import{_ as de}from"./OfflineGoods-BGXEfi-E.js";import{S as re}from"./SearchBox-Cmpb168z.js";import{B as fe}from"./BetweenTab-BE6o466J.js";import{_ as ce}from"./RegionBox-Cy-ipAel.js";import{u as ue,e as pe,bP as me,aL as he,Y as ge}from"./index-Clz0Qna-.js";import{D as ye}from"./goods-BVwS8oFG.js";import{c as f}from"./offlineGoods-DvT2Go6q.js";import{S as _e}from"./shop-CeqcS6K2.js";import"./BackIcon-8hcEjDKb.js";import"./ImgBoutiqueLable-BIio6fYG.js";import"./search-C4fLtTfY.js";import"./filter-DRLh1k_O.js";import"./category-5QTDC8Db.js";/* empty css                                                               */const ve=y=>(le("data-v-0cf54d00"),y=y(),ie(),y),Se={class:"px-3 mt-3"},be={class:"flex items-center"},Ie=ve(()=>u("img",{src:J,class:"w-4 h-4 mr-1.5"},null,-1)),xe={class:"text-newOrigin"},Te={class:"relative flex justify-end text-xs mt-3"},we={class:"w-[calc(100%-32px)] max-w-[343px] mx-auto safe-bottom"},ke=E({name:"GoodsManage"});function Ce(y){var P;const{t:b}=Q(),O=X(),V=Y(),{getCurrentStoreId:N}=ue(),R=w(null),{accountStore:_,clerkStore:A}=pe(),D=[{label:b("offline.onSale"),value:f.Published},{label:b("shop.watiShelf"),value:f.OffShelf},{label:b("offline.drafts"),value:f.DRAFT}],o=F({shopInfo:null,list:[],total:0,loading:!1,finished:!1}),l=F({shopId:(P=o.shopInfo)==null?void 0:P.id,page:0,size:10,goodsNameLike:"",goodsCategoryId1:"",goodsStatus:f.Published,goodsType:null,sortBy:"desc|create_time",distinctFlag:!0}),q=Z(()=>{var e;return(e=o==null?void 0:o.shopInfo)==null?void 0:e.type}),G=e=>{O.push(e)},M=async e=>{l.goodsType=(e==null?void 0:e.type)>=_e.SD?e.type:void 0,l.startTime=(e==null?void 0:e.upStartTime)||void 0,l.endTime=(e==null?void 0:e.upEndTime)||void 0,l.goodsCategoryId1=(e==null?void 0:e.subclassId)||void 0,p()},U=e=>{l.goodsStatus=e,O.replace({path:"offlineGoods",query:{status:e}}),p()},L=async(e,t)=>{e.loading=!0;const{success:i}=await me({goodsId:e.goodsId,shopId:e.shopId,goodsStatus:t});e.loading=!1,i&&(o.list=o.list.filter(a=>a.goodsId!==e.goodsId))},p=async()=>{o.finished=!1,o.total=0,o.list=[],l.page=0,I()},I=async()=>{var e,t;if(!((e=o.shopInfo)!=null&&e.id))return o.finished=!0;o.loading=!0,l.shopId=(t=o.shopInfo)==null?void 0:t.id,l.page+=1,await z(),o.loading=!1},z=async()=>{const{success:e,data:t}=await he(l);if(o.loading=!1,!e){o.finished=!0;return}const{records:i,total:a,current:T,pages:s}=t;if(!a||!i||!(i!=null&&i.length)){o.finished=!0;return}o.total=a;const d=w([]);d.value=i.map(H=>({btnLoading:!1,...H})),o.list=l.page===1?d.value:o.list.concat(d.value),+T>=+s&&(o.finished=!0)};let h=null;const j=async()=>{const e=localStorage.getItem("shopOffline_scrollTop");+e?h.scrollTo({top:+e,left:0,behavior:"instant"}):localStorage.removeItem("shopOffline_scrollTop")},x=w(!1),$=()=>{x.value||(x.value=!0,setTimeout(()=>{localStorage.setItem("shopOffline_scrollTop",h.scrollTop+""),x.value=!1},500))};return W(async()=>{var e,t;h=document.querySelector(".shopGoodsPage"),h.addEventListener("scroll",$),(e=V.query)!=null&&e.status&&(l.goodsStatus=Number((t=V.query)==null?void 0:t.status)),o.shopInfo=await N(),I()}),ee(async()=>{A.isClerk&&p();try{j();const e=sessionStorage.getItem("shop_offline_refresh_id");if(e==="add")p();else if(e){const t=await ge({id:e}),i=o.list.findIndex(a=>a.goodsId===e);i>-1?t.data.goodsStatus!==o.list[i].goodsStatus?o.list.splice(i,1):o.list[i]=t.data:p()}}finally{sessionStorage.removeItem("shop_offline_refresh_id")}}),oe(()=>{h.removeEventListener("scroll",$)}),(e,t)=>{const i=k("VanButton"),a=k("VanList"),T=k("router-view");return m(),v(ae,{title:e.$t("offline.sale_services"),class:"bg-gray1 font-Puhui font-normal relative","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(s,d)=>{d.shopGoodsRef=s,R.value=s}},{right:r(()=>[c(ce)]),default:r(()=>[c(fe,{options:D,"label-key":"label","value-key":"value",modelValue:n(l).goodsStatus,"onUpdate:modelValue":t[0]||(t[0]=s=>n(l).goodsStatus=s),onChange:U},null,8,["modelValue"]),u("div",Se,[c(re,{modelValue:n(l).goodsNameLike,"onUpdate:modelValue":t[1]||(t[1]=s=>n(l).goodsNameLike=s),deliveryType:n(ye).offeline,shopType:n(q),onOnSubmit:p,onOnFilter:M},null,8,["modelValue","deliveryType","shopType"])]),u("div",{class:ne(["m-3 overflow-y-auto shopGoodsPage",{"safe-body":!n(_).isOnlyView}])},[c(a,{loading:n(o).loading,"onUpdate:loading":t[2]||(t[2]=s=>n(o).loading=s),finished:n(o).finished,"immediate-check":!1,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:I},{default:r(()=>[(m(!0),B(se,null,te(n(o).list,s=>(m(),B("div",{class:"offline-crad-box mb-3",key:s.goodsId},[c(de,{showSale:"",showGoodsType:"",goods:s},{"bottom-price":r(()=>[u("div",be,[Ie,u("div",xe,g(s.goodsPrice),1)])]),_:2},1032,["goods"]),u("section",Te,[n(l).goodsStatus===n(f).Published&&!n(_).isOnlyView?(m(),v(i,{key:0,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:s.loading,onClick:d=>L(s,n(f).OffShelf)},{default:r(()=>[S(g(e.$t("shop.down")),1)]),_:2},1032,["loading","onClick"])):C("",!0),n(l).goodsStatus===n(f).OffShelf&&!n(_).isOnlyView?(m(),v(i,{key:1,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:s.loading,onClick:d=>L(s,n(f).Published)},{default:r(()=>[S(g(e.$t("shop.up")),1)]),_:2},1032,["loading","onClick"])):C("",!0),c(i,{color:"#FED73A",round:"",class:"!text-b1 font-semibold h-[32px] rounded-md px-3",onClick:d=>G(`/offlineGoodsEditGoods?goodsId=${s.goodsId.toString()}`)},{default:r(()=>[S(g(e.$t("shop.modify")),1)]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])],2),u("div",we,[n(_).isOnlyView?C("",!0):(m(),v(i,{key:0,onClick:t[3]||(t[3]=s=>G("/offlineGoodsEditGoods")),class:"bg-btnOrBg w-full h-[46px] flex-center text-b1 text-base font-semibold z-50 rounded-3xl"},{default:r(()=>[S(g(e.$t("offline.published_goods")),1)]),_:1}))]),c(T,{class:"child-view bg-gray1"})]),_:1},8,["title"])}}const Oe=E({...ke,setup:Ce}),He=K(Oe,[["__scopeId","data-v-0cf54d00"]]);export{He as default};

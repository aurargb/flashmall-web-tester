import{_ as he,r as c,x as k,z as xe,F as l,G as a,H as t,I as F,J as U,R as O,a2 as g,a3 as ye,Q as b,P as d,n as we,y as Ce,a1 as ge,bf as Ie,E as L,K as R,N as P,O as w,D as ke,bj as Se,a4 as me,Y as $e,Z as Te,l as Be,a0 as Ve,T as _e}from"./vendor-Ba70TIw4.js";import{_ as Ee,a as Ne}from"./collect-EjkhARjb.js";import{ao as Ae,aC as De,e as Le,S as je,h as Fe,W as Z,r as Oe,ay as Pe,az as We,aD as ze}from"./index-Bsb9uxb4.js";import{u as Ge}from"./useCityMap-VHv5LiO4.js";import{B as Ke}from"./BackIcon-DkqwcD_b.js";import{_ as qe}from"./MCOIN-Bodfn-v1.js";import{_ as Me}from"./right-arrow-CaxjJ3WI.js";import{_ as Ue}from"./ImgBoutiqueLable-BMjuak4g.js";/* empty css                                                              *//* empty css                                                                 */import"./shop-CeqcS6K2.js";const Re=["onClick","id"],He={class:"relative"},Je={class:"text-sm text-b3 font-normal flex items-center justify-center"},Qe={class:"label__wrap text-center"},Ye={key:0,class:"fm-tab-underline"},Ze={props:{options:{type:[Array,Object],required:!0},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"value"},modelValue:[String,Number,Object],scrollToSelected:{type:Boolean,default:!0},scrollOffset:{type:Number,default:16},equalWidth:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(C,{emit:N}){const v=C,I=c(null),h=c(null),S=c([]),y=k(()=>Array.isArray(v.options)?v.options:Object.values(v.options));function p(i){return i[v.valueKey]===v.modelValue}function T(i){N("update:modelValue",i[v.valueKey]),N("change",i[v.valueKey])}xe(()=>v.modelValue,async()=>{v.scrollToSelected&&(await we(),B())},{immediate:!0});function B(){const i=y.value.findIndex(n=>p(n));if(i===-1)return;const V=document.getElementById(`fm-tab-item-${i}`),u=I.value;if(V&&u){const n=V.offsetLeft-(v.scrollOffset||0);u.scrollTo({left:n,behavior:"smooth"})}}return(i,V)=>(a(),l("div",{class:"fm-tab",ref:(u,n)=>{n.tabWrapper=u,I.value=u}},[t("div",{class:"flex flex-nowrap items-center w-full",ref:(u,n)=>{n.tabList=u,h.value=u}},[(a(!0),l(F,null,U(d(y),(u,n)=>(a(),l("div",{key:u[C.valueKey]??n,class:O([["fm-tab-item",{active:p(u)}],"relative w-1/2 flex justify-center items-center"]),onClick:m=>T(u),ref:(m,e)=>{e.tabItems=m,S.value=m},id:`fm-tab-item-${n}`},[t("div",He,[t("p",Je,[t("span",Qe,b(u[C.labelKey]),1),ye(i.$slots,"badge"+n,{},void 0,!0)]),p(u)?(a(),l("div",Ye)):g("",!0)])],10,Re))),128))],512)],512))}},Xe=he(Ze,[["__scopeId","data-v-14915886"]]),et={key:0},tt={key:0},st=["onClick"],ot={class:"text-base font-semibold text-b1 line-clamp-1"},at=["onClick"],lt={class:"shrink-0 w-[80px] h-[80px] rounded-lg overflow-hidden relative"},nt={class:"ml-2 w-full h-[80px] flex flex-col justify-between"},rt={class:"shrink-0"},ct={class:"text-sm text-b1 font-semibold line-clamp-1"},it={class:"mt-1 text-sm text-b3 font-normal line-clamp-1"},ut={class:"shrink-0 flex items-center"},dt={class:"text-sm text-b1 font-semibold"},ft=Ce({props:{params:{default:{}}},emits:["handleTo"],setup(C,{expose:N,emit:v}){const I=C;ge();const h=Ie({page:0,size:99}),S=c(0),y=c(!1),p=c(!1),T=c([]),B=3,i=3,V=async()=>{y.value=!0,h.page+=1,await u(),y.value=!1},u=async()=>{const r=await De({...h,...I.params});if(!r.success){p.value=!0;return}if(!r.data||!r.data.records||!+r.data.total){p.value=!0;return}S.value=r.data.total,T.value=h.page===1?r.data.records:T.value.concat(r.data.records),T.value.length>=S.value&&(p.value=!0)},n=c(!1),m=k(()=>T.value.filter(r=>+r.storeShopGoodsCount>0)),e=k(()=>n.value||m.value.length<=i?m.value:m.value.slice(0,i)),W=r=>r.goodsList.slice(0,B),J=()=>{n.value=!n.value},A=r=>{v("handleTo","/shop?shopId="+r.shopId)},Q=r=>{v("handleTo","/offlineGoodsDetail"+("?goodsId="+r.goodsId)+("&storeId="+I.params.storeId))};return N({total:S,finished:p,loading:y}),(r,z)=>{const j=L("VanImage"),E=L("VanList");return a(),R(E,{loading:y.value,"onUpdate:loading":z[0]||(z[0]=_=>y.value=_),finished:p.value,"loading-text":r.$t("common.loading"),onLoad:V},{finished:P(()=>[S.value?g("",!0):(a(),R(Ae,{key:0,style:{padding:"52px 0 47px"},name:"该店暂未开通代买单服务"}))]),default:P(()=>[S.value?(a(),l("div",et,[(a(!0),l(F,null,U(d(e),(_,G)=>{var K;return a(),l("div",{class:"mb-3 last:mb-0",key:G},[t("div",{class:O(G>0?"w-full border-b-[0.5px] border-b-b4 mb-3":"")},null,2),(K=_==null?void 0:_.goodsList)!=null&&K.length?(a(),l("div",tt,[t("div",{class:"flex items-center mb-3 cursor-pointer",onClick:x=>A(_)},[w(j,{src:_.shopPics?_.shopPics.split(",")[0]:"",class:"w-6 h-6 mr-1 rounded-[4px] overflow-hidden",alt:_.shopName,fit:"cover"},null,8,["src","alt"]),t("span",ot,b(_.shopName),1),w(j,{src:d(Me),class:"w-4 h-4",alt:"arrow"},null,8,["src"])],8,st),(a(!0),l(F,null,U(W(_),(x,s)=>(a(),l("div",{key:x.goodsId,class:"flex items-center mb-3 last:mb-0",onClick:o=>Q(x)},[t("div",lt,[w(j,{src:x.goodsIcons?x.goodsIcons.split(",")[0]:"",class:"w-full h-full object-cover",alt:x.goodsName,fit:"cover"},null,8,["src","alt"]),w(Ue,{type:x.goodsType||null},null,8,["type"])]),t("div",nt,[t("div",rt,[t("div",ct,b(x.goodsName),1),t("div",it,b(x.goodsDesc),1)]),t("div",ut,[w(j,{src:d(qe),class:"w-4 h-4 mr-1",alt:"Mcoin"},null,8,["src"]),t("span",dt,b(x.goodsPrice),1)])])],8,at))),128))])):g("",!0)])}),128)),d(m).length>i?(a(),l("div",{key:0,class:"text-center text-b3 text-sm font-normal",onClick:J},b(n.value?"收起":`查看其他${d(m).length-i}家门店`),1)):g("",!0)])):g("",!0)]),_:1},8,["loading","finished","loading-text"])}}}),H=C=>($e("data-v-5fcb9dfa"),C=C(),Te(),C),vt={class:"flex flex-wrap items-center w-10"},pt=H(()=>t("p",{class:"text-lg font-bold text-b1 text-center"},"门店详情",-1)),mt={key:0,src:Ee,alt:"收藏",class:"w-5 h-5"},_t={key:1,src:Ne,alt:"取消",class:"w-5 h-5"},ht={class:"w-full h-[330px]"},xt={class:"relative z-10"},gt={class:"shop-info rounded-t-xl bg-white w-ful p-3 mt-[-12px]"},bt={class:"flex justify-between items-start gap-1"},yt={class:"text-lg font-bold text-b1"},wt={key:0,class:"shrink-0 w-fit h-[28px] flex justify-center items-center"},Ct=H(()=>t("div",{class:"text-xs text-newOrigin bg-[#FFF8EC] border-[0.5px] border-[#FF8812] px-1 rounded-sm font-normal"}," 代买单 ",-1)),It=[Ct],kt={class:"flex items-center justify-start mt-[2px] text-xs text-b3 font-normal"},St=H(()=>t("div",{class:"divider bg-[#D9D9D9] h-[12px] w-[1px] mx-1"},null,-1)),$t={class:"map-texture w-full h-fit rounded-lg overflow-hidden mt-3"},Tt={key:0,class:"w-full h-full map-texture-bg flex items-center justify-between p-2"},Bt={class:"text-xs text-[#2E2008] leading-[18px] font-semibold"},Vt={key:0,class:"mt-1 text-xs text-[#585654] leading-[18px]"},Et=["src"],Nt=H(()=>t("div",{class:"mt-[1px] text-xs text-[#585654] leading-[18px]"}," 复制 ",-1)),At={class:"mt-2 relative z-10 h-full"},Dt={class:"w-full h-full bg-white"},Lt={class:"p-3 bg-white",id:"combo"},jt={key:0,class:"button-group-bg fixed bottom-0 left-0 z-[11] w-full h-[82px] flex items-center px-3 pt-4 safe-bottom justify-evenly gap-x-3 btn-wrapper"},Ft={key:0,round:"",class:"min-w-[58.5%] w-full h-[46px] text-base font-semibold bg-yellow text-b1 rounded-full opacity-[0.7] flex justify-center items-center"},Ot=Ve(" 我想要 "),Pt={setup(C){const N=ge(),v=Be(),{loadingToggle:I}=Oe(),{cityMapStore:h}=Le(),{distanceFormat:S}=Ge(),y=k(()=>{var s;return(s=N.query)!=null&&s.child?document.getElementById("storefront"):document.getElementById("fm-page")}),p=c(!1);c(0);let T=c(!0);const B=c([{label:"门店服务",value:"bundle"},{label:"消费笔记",value:"note"}]),i=c(B.value[0].value),V=c([B.value[0]]),u=s=>{let o=null;s==="bundle"?o=document.querySelector("#combo"):s==="note"&&(o=document.querySelector("#note")),y.value&&o&&setTimeout(()=>{var f;y.value.scrollTo({top:((f=o==null?void 0:o.getBoundingClientRect())==null?void 0:f.top)||0,behavior:"smooth"})},100)},n=k(()=>{var s,o,f;return e.value.storeId&&(e.value.addWantCountFlag||+((s=e.value)==null?void 0:s.wantCount))&&((o=A.value)==null?void 0:o.total)===0&&!((f=A.value)!=null&&f.loading)}),m=k(()=>{var s;return((s=N.query)==null?void 0:s.storeId)||""}),e=c({}),W=c([]),J=async()=>{var s,o,f,q;try{const Y={id:m.value,longitude:h.locationCoords.lng||((s=h.currentActiveCity)==null?void 0:s.areaLongitude)||null,latitude:h.locationCoords.lat||((o=h.currentActiveCity)==null?void 0:o.areaLatitude)||null},D=await je(Y);if(!D.success||!D.data)return;e.value=D.data,W.value=(f=D.data)!=null&&f.storeIcons?(q=D.data)==null?void 0:q.storeIcons.split(","):[]}catch{}},A=c(null),Q=c(null),r=k(()=>{var s;return(s=Q.value)==null?void 0:s.total}),z=k(()=>({storeId:m.value}));xe(()=>r.value,(s,o)=>{V.value=[B.value[0]],i.value=B.value[0].value},{immediate:!0,deep:!0});const j=async()=>{var o;if(p.value||!m.value)return;p.value=!0;const s=await ze({id:m.value});p.value=!1,s.success&&(e.value.addWantCountFlag=!e.value.addWantCountFlag,e.value.wantCount=+(((o=e.value)==null?void 0:o.wantCount)||0)+1)},E=c(!1),_=async()=>{var o,f;if(E.value||!((o=e.value)!=null&&o.storeId))return;E.value=!0,I(!0);const s=await We({storeId:(f=e.value)==null?void 0:f.storeId});E.value=!1,I(!1),s.success&&(e.value.collectId=s.data,_e({message:"收藏成功",icon:Z("toast-success.svg"),duration:3e3}))},G=async()=>{var o,f;if(E.value||!((o=e.value)!=null&&o.storeId))return;E.value=!0,I(!0);const s=await Pe({ids:[(f=e.value)==null?void 0:f.collectId]});E.value=!1,I(!1),s.success&&(e.value.collectId=null,_e({message:"取消收藏",icon:Z("toast-success.svg"),duration:3e3}))},K=k(()=>{var s;return((s=e.value)==null?void 0:s.goodsCategoryName3)||""});k(()=>{var s,o;return(s=e.value)!=null&&s.areaName2?((o=e.value)==null?void 0:o.areaName2)+"市":""});const x=s=>{v.push(s)};return ke(async()=>{await J()}),Se(()=>{}),(s,o)=>{var X,ee,te,se,oe,ae,le,ne,re,ce,ie,ue,de,fe,ve;const f=L("VanImage"),q=L("van-swipe-item"),Y=L("van-swipe"),D=L("VanButton"),be=L("router-view");return a(),l("div",{class:O(["relative w-full h-full pt-[50px]",{"pb-[82px]":d(n)}]),id:"storefront",style:{background:"#f2f0ef"}},[t("div",{class:O(["flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[50px] px-4 fixed bg-white rounded-none",{"!bg-white":d(T)}])},[t("div",vt,[w(Ke)]),pt,t("div",{onClick:o[0]||(o[0]=me($=>e.value.collectId?G():_(),["stop"]))},[e.value.collectId?(a(),l("img",mt)):(a(),l("img",_t))])],2),t("div",{class:O(["overflow-y-scroll flex flex-col",d(n)?"h-[calc(100vh-50px-82px)]":"h-[calc(100vh-50px)]"])},[t("section",ht,[w(Y,{class:"note-imgs-swiper",autoplay:3e3,"indicator-color":"oriange1"},{default:P(()=>[(a(!0),l(F,null,U(W.value,$=>(a(),R(q,{key:$},{default:P(()=>[w(f,{src:$,class:"w-full h-full overflow-hidden",alt:"",fit:"cover"},null,8,["src"])]),_:2},1024))),128))]),_:1})]),t("div",xt,[t("section",gt,[t("div",bt,[t("p",yt,b(((X=e.value)==null?void 0:X.storeName)||""),1),+e.value.storeGoodsCount>0?(a(),l("div",wt,It)):g("",!0)]),t("div",kt,[t("p",null,b(d(K)),1),+((ee=e.value)==null?void 0:ee.orderPersonCount15)>0?(a(),l(F,{key:0},[St,t("p",null,"近15天"+b(((te=e.value)==null?void 0:te.orderPersonCount15)||0)+"人下单",1)],64)):g("",!0)]),t("div",$t,[(se=e.value)!=null&&se.storeAddress?(a(),l("div",Tt,[t("div",null,[t("p",Bt,b(((oe=e.value)==null?void 0:oe.areaExtName3)+((ae=e.value)==null?void 0:ae.storeAddress)),1),(le=e.value)!=null&&le.distance&&((ne=d(h).locationCoords)!=null&&ne.lat)&&((re=d(h).locationCoords)!=null&&re.lng)?(a(),l("div",Vt,b(d(S)(((ce=e.value)==null?void 0:ce.distance)||0,2,999,"距您直线")),1)):g("",!0)]),(ie=e.value)!=null&&ie.areaExtName3||(ue=e.value)!=null&&ue.storeAddress?(a(),l("div",{key:0,class:"shrink-0 flex flex-col items-center",onClick:o[1]||(o[1]=me($=>{var M,pe;return d(Fe)(((M=e.value)==null?void 0:M.areaExtName3)+((pe=e.value)==null?void 0:pe.storeAddress))},["stop"]))},[t("img",{class:"w-4 h-4",src:d(Z)("cityMap/copy.svg"),alt:""},null,8,Et),Nt])):g("",!0)])):g("",!0)])])]),t("div",At,[t("section",Dt,[w(Xe,{modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=$=>i.value=$),options:V.value,onChange:u,"label-key":"label","value-key":"value"},null,8,["modelValue","options"]),t("div",Lt,[w(ft,{ref:($,M)=>{M.shopBundle=$,A.value=$},params:d(z),onHandleTo:x},null,8,["params"])])])])],2),d(n)?(a(),l("div",jt,[(de=A.value)!=null&&de.finished&&((fe=A.value)==null?void 0:fe.total)===0?(a(),l(F,{key:0},[e.value.storeId&&!e.value.addWantCountFlag?(a(),l("div",Ft," 已有"+b(((ve=e.value)==null?void 0:ve.wantCount)||0)+"人想要 ",1)):(a(),R(D,{key:1,round:"",class:"min-w-[58.5%] w-full h-[46px] text-base font-semibold bg-yellow text-b1",loading:p.value,onClick:j},{default:P(()=>[Ot]),_:1},8,["loading"]))],64)):g("",!0)])):g("",!0),w(be,{class:"child-view !rounded-none sm:fixed"})],2)}}},Yt=he(Pt,[["__scopeId","data-v-5fcb9dfa"]]);export{Yt as default};

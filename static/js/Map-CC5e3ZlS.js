import{y as w,F as C,G as u,a4 as R,H as v,_ as $,r as x,E as M,O as A,N as S,I as D,J as N,K as I,ab as U,R as V,x as Z,z as F,D as G,a9 as H,X as K,Z as j,$ as J}from"./vendor-BlU_hoYl.js";import{e as O}from"./index-Wb-6_0W_.js";import{S as T,P as z,L as Q}from"./iconAssets-DsommeAx.js";const X="/static/images/add-BGs4QptK.svg",q=v("img",{src:X,class:"w-4 h-4"},null,-1),W=v("p",{class:"text-xs font-normal text-b2"},"加店",-1),Y=[q,W],ee=w({emits:["handleTo"],setup(s,{emit:m}){return(f,n)=>(u(),C("div",{class:"w-[44px] h-[44px] bg-white rounded-lg flex flex-col items-center justify-center",onClick:n[0]||(n[0]=R(o=>m("handleTo","/city/merchantCreate"),["stop"]))},Y))}}),te={class:"swiper-card-container"},oe={class:"card-wrapper"},ae=w({props:{cardData:null,storeComponent:null},emits:["changeIndex"],setup(s,{expose:m,emit:f}){const n=x(null),o=x(0),p=t=>{o.value=t,f("changeIndex",t)};return m({activeIndex:o,updateActiveIndex:t=>{o.value=t,n.value&&n.value.swipeTo(t)}}),(t,d)=>{const l=M("van-swipe-item"),g=M("van-swipe");return u(),C("div",te,[A(g,{ref:(r,i)=>{i.swiperRef=r,n.value=r},active:o.value,"onUpdate:active":d[0]||(d[0]=r=>o.value=r),loop:!1,"show-indicators":!1,touchable:!0,class:"custom-swiper",onChange:p},{default:S(()=>[(u(!0),C(D,null,N(s.cardData,(r,i)=>(u(),I(l,{key:r.id,class:V(["swipe-item",{right:o.value+1===i,left:o.value-1===i}])},{default:S(()=>[v("div",oe,[(u(),I(U(s.storeComponent),{"store-info":r,idx:i},null,8,["store-info","idx"]))])]),_:2},1032,["class"]))),128))]),_:1},8,["active"])])}}}),se=$(ae,[["__scopeId","data-v-407ff22f"]]),ne=s=>(j("data-v-15ea1cfe"),s=s(),J(),s),re={class:"w-full h-full relative"},le=ne(()=>v("div",{id:"map",class:"w-full h-full relative z-0"},null,-1)),ie={class:"absolute bottom-[12px] left-0 right-0 z-10"},ce=w({props:{storeList:null,storeComponent:null,availableStore:{type:Boolean}},emits:["changeIndex","handleTo"],setup(s,{expose:m,emit:f}){const n=s,{cityMapStore:o}=O(),p=x(0),h=x(null);let t=null,d=[],l=null;const g=Z(()=>{var e,a;return o.locationCoords.lng&&o.locationCoords.lat?{lng:o.locationCoords.lng,lat:o.locationCoords.lat}:{lng:(e=o.currentActiveCity)==null?void 0:e.areaLongitude,lat:(a=o.currentActiveCity)==null?void 0:a.areaLatitude}});F(()=>n.storeList,()=>{n.storeList.length>0&&setTimeout(()=>{t&&(B(),E(),i(),r())},300)},{immediate:!0,deep:!0});const r=()=>{try{const e=g.value;t=L.map("map",{center:[e.lat,e.lng],zoom:12,trackResize:!0,zoomControl:!1}),L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:"",subdomains:"abcd",maxZoom:17,minZoom:7}).addTo(t)}catch{}finally{}},i=()=>{const e=n.storeList[p.value];e&&e.storeLatitude&&e.storeLongitude&&t.flyTo([e.storeLatitude,e.storeLongitude],15,{duration:.8,easeLinearity:1})},B=()=>{y(),n.storeList.forEach((e,a)=>{if(e.storeLatitude&&e.storeLongitude){const c=a===p.value?T:z,_=L.marker([e.storeLatitude,e.storeLongitude],{icon:c}).addTo(t);_.on("click",()=>{k(a,!0)}),d.push(_)}})},y=()=>{d.forEach(e=>{t&&t.removeLayer(e)}),d=[]},E=()=>{l&&t&&t.removeLayer(l);const e=g.value;e.lat&&e.lng&&(l=L.marker([e.lat,e.lng],{icon:Q}).addTo(t))},b=()=>{d.forEach((e,a)=>{const c=a===p.value?T:z;e.setIcon(c)})},k=(e,a=!1)=>{p.value=e,a&&h.value&&h.value.updateActiveIndex(e),f("changeIndex",e),i(),a?b():setTimeout(()=>{b()},600)},P=()=>{y(),l&&t&&(t.removeLayer(l),l=null),t&&(t.remove(),t=null)};return G(()=>{r()}),H(()=>{P()}),m({initMap:r}),(e,a)=>(u(),C("div",re,[le,s.availableStore?K("",!0):(u(),I(ee,{key:0,class:"absolute bottom-[128px] right-[20px] z-10 shadow-[0_0.5px_16px_0_rgba(0,0,0,0.16)]",onHandleTo:a[0]||(a[0]=c=>f("handleTo",c))})),v("div",ie,[A(se,{ref:(c,_)=>{_.draggableCardListRef=c,h.value=c},"card-data":s.storeList,storeComponent:s.storeComponent,onChangeIndex:k},null,8,["card-data","storeComponent"])])]))}}),me=$(ce,[["__scopeId","data-v-15ea1cfe"]]);export{me as M};

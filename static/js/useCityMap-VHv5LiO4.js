import{ar as C,as as h,at as m}from"./index-Bsb9uxb4.js";const I=()=>{const e=C(),f=()=>{sessionStorage.removeItem("location_permission_denied_shown"),e.clearLocationErrorFlag()},y=t=>{navigator.geolocation?(console.log("原生能力开始获取位置"),navigator.geolocation.getCurrentPosition(n=>g(n,t),n=>{L(n),t==="reset"&&e.setMsgError("需开启应用的位置权限允许获取您的当前地理位置","位置获取失败")},{timeout:1e4,maximumAge:3e5})):(console.log("原生能力不支持定位"),e.setLocationCity(null),e.setDefaultLocation(),e.setPositionFinished(!0))},g=async(t,n)=>{var o;console.log("原生能力获取位置成功",t);const{latitude:r,longitude:c}=t.coords;f(),e.setLngLat(c,r),e.setPositionFinished(!0);try{const a={areaLongitude:c,areaLatitude:r},u=await Promise.all([h(),m({...a,areaLevel:2})]),l=u[0].data;let i=u[1].data;console.log("saveCity",l),console.log("通过经纬度获取的位置",i),i&&i.overseasFlag&&(i=await m({...a,areaLevel:1}),console.log("通过经纬度获取的位置-海外城市 areaLevel=1",i)),i?(e.locationCity&&((o=e.locationCity)==null?void 0:o.areaId)!==i.areaId&&e.clearLocationErrorFlag(),e.setLocationCity(i),l&&(l==null?void 0:l.areaId)!==i.areaId?(e.setCurrentCity(l,"manual"),n!=="cityErr"&&e.setCityChangeTips(l,i)):e.locationMatchMode!=="manual"&&e.setCurrentCity(i,"auto")):(e.setLocationCity(null),e.setNavigatorState(!0),e.setDefaultLocation())}catch{e.setLocationCity(null),e.setNavigatorState(!0),e.setDefaultLocation()}},L=t=>{console.log("原生能力获取位置失败",t),e.setPositionFinished(!0),e.setLocationCity(null),e.setLngLat(null,null),e.setNavigatorState(!0),e.setDefaultLocation()};return{getUserLocation:y,showPosition:g,distanceFormat:(t,n=2,r=999,c="距您")=>{const o=Number((t?t/1e3:0).toFixed(n));if(o>r)return">999km";if(o>=1){const a=o>0?Number(o).toFixed(n):0;return`${c}${a}km`}else{const a=t?Number(t):0;return`${c}${a}m`}},clearPermissionDeniedFlag:f,getLeafletjsAddressTitle:t=>{var n,r,c;if(t!=null&&t.name&&(t==null?void 0:t.name)!=="")return t==null?void 0:t.name;if(t!=null&&t.display_name){let o=((n=t==null?void 0:t.display_name)==null?void 0:n.split(","))||[],a=0;t!=null&&t.address?((r=t.address)!=null&&r.country&&a++,(c=t.address)!=null&&c.postcode&&a++):a=2,o=o.splice(0,o.length-a);const u=o.findIndex(i=>Number(i)>=0);let l="";if(u>-1){let i=o[0].trim()+"号";l=o[1].trim()+i}else l=o.length?o[0].trim():"";return l||"未知地址"}},getLeafletjsAddressDescription:t=>{var a,u,l,i;let n=((u=(a=t==null?void 0:t.display_name)==null?void 0:a.split(","))==null?void 0:u.reverse())||[],r=0;t!=null&&t.address?((l=t.address)!=null&&l.country&&r++,(i=t.address)!=null&&i.postcode&&r++):r=2,n=n.splice(r,n.length);const c=n.findIndex(s=>Number(s)>=0);let o="";return n.forEach((s,p)=>{c===p?o+=(s==null?void 0:s.trim())+"号":o+=s==null?void 0:s.trim()}),o||"未知地址"}}};export{I as u};

import{_ as W,x as q,F as l,G as t,H as r,I as C,J as I,a2 as m,Q as x,P as i,Y as X,Z as ee,y as ce,r as y,a1 as ve,z as de,a7 as me,D as pe,a9 as ye,K as S,N as E,l as Ce,E as O,O as F,a0 as R,T as Q}from"./vendor-Ba70TIw4.js";import{C as fe}from"./CommonVanProvider-CqQk6UpZ.js";import{e as _e,aP as g,aQ as Y,ao as Z,aL as xe}from"./index-DGR86ePT.js";import{u as he}from"./useCityMap-Cea3-tlD.js";import{B as ge}from"./BetweenTab-DPw9h7Hc.js";import{_ as ke}from"./SearchBar-B80-kk6U.js";import"./BackIcon-DkqwcD_b.js";/* empty css                                                               */import"./search-B34EARrH.js";import"./delete-Dyula9w6.js";const be="/static/images/gps-C70Ke3rM.svg",te="/static/images/flag-DsGJY6jz.svg",Ne=v=>(X("data-v-0b12affc"),v=v(),ee(),v),Se={class:"active-cities_container px-4"},Ee=Ne(()=>r("p",{class:"test-sm text-b3 font-normal"},"当前开通的城市",-1)),Fe=["onClick"],De={key:0},Ae={key:1,src:te,class:"w-[18px] h-[18px] ml-1"},Le={props:{cityList:{type:Array,default:()=>[]},limit:{type:[Number,String],default:5}},emits:["click"],setup(v,{emit:e}){const k=v,b=q(()=>k.cityList.slice(0,k.limit)),N=n=>{e("set",n)};return(n,f)=>(t(),l("div",Se,[Ee,r("div",null,[(t(!0),l(C,null,I(i(b),d=>(t(),l("div",{key:d.name,class:"active-cities-item h-[52px] border-b border-solid border-[#E5E5E5] flex items-center justify-start text-sm font-normal text-b1",onClick:D=>N(d)},[r("span",null,x(d.areaName),1),Number(d.storeCount)>0?(t(),l("span",De,"(代买单门店"+x(d.storeCount)+"家)",1)):m("",!0),d.visitedFlag?(t(),l("img",Ae)):m("",!0)],8,Fe))),128))])]))}},we=W(Le,[["__scopeId","data-v-0b12affc"]]),se=v=>(X("data-v-4d2a4c0c"),v=v(),ee(),v),Pe={class:"px-3 pb-2"},Be={class:"h-[calc(100vh-127px)] overflow-y-auto relative"},Ie={key:0,class:"search-result"},Re={class:"px-4 pt-3"},$e=se(()=>r("p",{class:"text-sm font-normal text-b3"},"当前定位城市/上次选择",-1)),Ve={class:"py-4 flex items-center justify-start gap-3"},Oe=se(()=>r("img",{src:be,class:"w-4 h-4 mr-1"},null,-1)),qe={class:"text-sm font-normal text-[#FF8812]"},Te=R(" 定位失败 "),je=R(" 定位中... "),Ke={class:"text-sm font-normal text-b1"},Ue={class:"text-sm font-normal text-b1"},Me={key:0},ze={class:"relative"},He={class:"flex items-center justify-start"},Ge={class:"custom-title"},Je={key:0,src:te,class:"w-[18px] h-[18px] ml-1"},Qe=ce({setup(v){var U;const{cityMapStore:e}=_e(),{getUserLocation:k}=he(),b=ve(),N=Ce(),n=y(null),f=y([]),d=y(!1),D=y(!1),p=y([]),u={CN:!1,OVERSEAS:!0},ae=[{label:"国内(含港澳台)",value:u.CN},{label:"海外",value:u.OVERSEAS}],a=y({status:((U=e.currentActiveCity)==null?void 0:U.overseasFlag)||!1,keyword:"",isSelector:b.query.mode==="select",fromRoute:b.query.from?decodeURIComponent(String(b.query.from)):""}),$=y([]);de(()=>n.value,s=>{s?$.value=Object.keys(n.value):$.value=[]},{immediate:!0,deep:!0});const oe=q(()=>me.isEmpty(n.value)),T=q(()=>a.value.keyword.trim()!==""&&d.value),ie=s=>{a.value.status=s,n.value=[],T.value?(s===u.CN?n.value=g(e.regions,"areaNamePinyinFirstPrefix",2):n.value=g(e.overseasRegions,"areaNamePinyinFirstPrefix",1),j(a.value.keyword)):s===u.CN?n.value=g(e.regions,"areaNamePinyinFirstPrefix",2):n.value=g(e.overseasRegions,"areaNamePinyinFirstPrefix",1),p.value=e.getActiveCitiesList(s!==u.CN)||[],V(p.value)},j=async s=>{if(console.log("搜索关键词:",s),!s.trim()){f.value=[];return}d.value=!0;try{const o={areaLevel:a.value.status==u.CN?"2":"1",keywords:s.trim()};D.value=!0,Q.loading({message:"搜索中...",duration:0,forbidClick:!1});const _=await xe(a.value.status,o);f.value=_.data||[]}catch(o){console.error("搜索失败:",o),f.value=[]}finally{Q.clear(),D.value=!1}},le=()=>{f.value=[],d.value=!1},h=s=>{!s||!s.areaName||(a.value.isSelector?e.setSelectedArea(s):e.setCurrentCity(s,"manual"),a.value.fromRoute==="back"?N.back():N.replace({path:a.value.fromRoute}))},K=y({}),re=async()=>{p.value=e.getActiveCitiesList(a.value.status!==u.CN)||[];try{const[s,o]=await Promise.all([Y({overseasFlag:!1}),Y({overseasFlag:!0})]),_=s.data||[],A=o.data||[];e.setActiveCitiesList(_,!1),e.setActiveCitiesList(A,!0),p.value=a.value.status===u.CN?_:A,V(p.value)}catch(s){console.error("获取开通城市失败:",s),p.value=e.getActiveCitiesList(a.value.status!==u.CN)||[],V(p.value)}},V=s=>{s.forEach(o=>{o.visitedFlag&&(K.value[o.areaName]=!0)})},ne=()=>{N.push("/city/footprints")};return pe(async()=>{e.regions||e.init(),a.value.status===u.CN?n.value=g(e.regions,"areaNamePinyinFirstPrefix",2):n.value=g(e.overseasRegions,"areaNamePinyinFirstPrefix",1),re(),document.querySelector("#app").style.minHeight="580px",e.currentActiveCity||await k("cityErr")}),ye(()=>{document.querySelector("#app").style.minHeight=null}),(s,o)=>{const _=O("van-cell"),A=O("van-index-anchor"),ue=O("van-index-bar");return t(),S(fe,{title:"当前位置",class:"bg-white font-Puhui font-normal relative min-h-[560px]","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(L,w)=>{w.searchRef=L}},{right:E(()=>[a.value.isSelector?m("",!0):(t(),l("div",{key:0,class:"text-sm font-normal text-b2",onClick:ne}," 足迹 "))]),default:E(()=>{var L,w,M,z,H,G,J;return[r("section",null,[r("div",Pe,[F(ke,{modelValue:a.value.keyword,"onUpdate:modelValue":o[0]||(o[0]=c=>a.value.keyword=c),placeholder:"搜索城市名称/拼音","search-button-text":"搜索",onSearch:j,onClear:le},null,8,["modelValue"])]),F(ge,{options:ae,"label-key":"label","value-key":"value",modelValue:a.value.status,"onUpdate:modelValue":o[1]||(o[1]=c=>a.value.status=c),onChange:ie,class:"relative z-10"},null,8,["modelValue"]),r("section",Be,[i(T)?(t(),l("div",Ie,[f.value.length===0&&!D.value?(t(),S(Z,{key:0,name:"暂无搜索结果"})):m("",!0),(t(!0),l(C,null,I(f.value,c=>(t(),S(_,{class:"w-full",title:c.areaName,key:c.areaId,onClick:P=>h(c)},null,8,["title","onClick"]))),128))])):(t(),l(C,{key:1},[r("div",Re,[$e,r("div",Ve,[r("div",{class:"area-box position-box",onClick:o[2]||(o[2]=c=>i(e).locationCity?h(i(e).locationCity):i(k)("reset"))},[Oe,r("span",qe,[i(e).locationCity?(t(),l(C,{key:0},[R(x(((L=i(e).locationCity)==null?void 0:L.areaName)||"--"),1)],64)):i(e).locationCity?(t(),l(C,{key:2},[je],64)):(t(),l(C,{key:1},[Te],64))])]),a.value.status===u.CN&&i(e).lastSelectCity&&((w=i(e).lastSelectCity)==null?void 0:w.areaId)!=((M=i(e).locationCity)==null?void 0:M.areaId)?(t(),l("div",{key:0,class:"area-old-box position-box",onClick:o[3]||(o[3]=c=>h(i(e).lastSelectCity))},[r("span",Ke,x((z=i(e).lastSelectCity)==null?void 0:z.areaName),1)])):m("",!0),a.value.status===u.OVERSEAS&&i(e).lastSelectOverseasCity&&((H=i(e).lastSelectOverseasCity)==null?void 0:H.areaId)!=((G=i(e).locationCity)==null?void 0:G.areaId)?(t(),l("div",{key:1,class:"area-old-box position-box",onClick:o[4]||(o[4]=c=>h(i(e).lastSelectOverseasCity))},[r("span",Ue,x((J=i(e).lastSelectOverseasCity)==null?void 0:J.areaName),1)])):m("",!0)])]),a.value.status===u.CN?(t(),l("div",Me,[F(we,{cityList:p.value,onSet:h,limit:5},null,8,["cityList"])])):m("",!0),r("div",ze,[i(oe)?(t(),S(Z,{key:0,name:"暂无地区数据"})):m("",!0),F(ue,{sticky:!0,"index-list":$.value,teleport:"#app",class:"select-area-index-bar"},{default:E(()=>[(t(!0),l(C,null,I(n.value,(c,P)=>(t(),l("div",{key:P},[F(A,{index:P},{default:E(()=>[R(x(P),1)]),_:2},1032,["index"]),(t(!0),l(C,null,I(c,B=>(t(),S(_,{key:B.areaId,onClick:Ye=>h(B)},{title:E(()=>[r("p",He,[r("span",Ge,x(B.areaName),1),K.value[B.areaName]?(t(),l("img",Je)):m("",!0)])]),_:2},1032,["onClick"]))),128))]))),128))]),_:1},8,["index-list"])])],64))])])]}),_:1},512)}}}),rt=W(Qe,[["__scopeId","data-v-4d2a4c0c"]]);export{rt as default};

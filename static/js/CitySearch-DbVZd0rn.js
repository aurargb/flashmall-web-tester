import{y as G,F as h,G as n,I as j,J as U,a4 as ce,R as ue,Q as x,E as z,H as a,O as N,K as L,a2 as V,a0 as de,P as k,X as ve,_ as te,r as v,bl as fe,N as se,l as he,a1 as pe,w as me,x as ee,z as _e,D as ge,bc as ye,bp as be,bz as xe,Y as we,Z as Ce}from"./vendor-Ba70TIw4.js";import{_ as ke}from"./search-B34EARrH.js";import{_ as Se}from"./delete-Dyula9w6.js";import{B as $e}from"./BackIcon-DkqwcD_b.js";import{B as Le}from"./BetweenTab-DPw9h7Hc.js";import{H as ae}from"./HomeGoodsItem-Cmys9_2q.js";import{O as Ie}from"./OfflineMerchantLabel-BUhxSfcn.js";import{u as oe}from"./useCityMap-Cea3-tlD.js";import{e as H,aF as le,ao as Ae,ap as Fe}from"./index-DGR86ePT.js";/* empty css                                                               */import"./MCOIN-BOqZVkND.js";import"./store-CbLb3G6E.js";import"./RatioBox-DxAmCY_c.js";import"./ImgBoutiqueLable-BMjuak4g.js";import"./shop-CeqcS6K2.js";const Ee={class:"flex flex-wrap items-center gap-3"},Ne=["onClick"],Ve=G({props:{modelValue:null,options:null},emits:["update:modelValue","change"],setup(r,{emit:g}){function f(t){g("update:modelValue",t.value),g("change",t.value)}return(t,w)=>(n(),h("div",Ee,[(n(!0),h(j,null,U(r.options,(p,d)=>(n(),h("div",{class:ue(["w-fit h-[32px] px-3 py-1.5 rounded-md text-sm flex justify-center items-center",r.modelValue===p.value?"bg-[#FFF8EC] text-[#FF8812] border-solid border border-[#FF8812]":"bg-[#F5F5F5]  text-[#585654]"]),key:p.value??d,onClick:ce(l=>f(p),["stop"])},x(p.label),11,Ne))),128))]))}}),Re={class:"shop-img w-[80px] h-[80px] rounded-lg overflow-hidden flex-shrink-0 relative"},Oe={class:"shop-content h-full ml-2 w-full"},Be={class:"w-full text-base text-b1 font-semibold flex items-center justify-between"},Te={class:"line-clamp-1"},je={class:"text-sm text-b3 font-normal"},De={class:"h-[20px] text-sm text-b3 font-normal mt-[18px] flex items-center justify-between"},qe={class:"engagement"},Me={key:0,class:"distance"},ze={props:{backgroundColor:{type:String,default:""},store:{type:Object,default:()=>({})}},setup(r){const{distanceFormat:g}=oe(),{cityMapStore:f}=H();return(t,w)=>{var d,l,c,y,I,u,i;const p=z("van-image");return n(),h("div",{class:"w-full rounded-xl flex items-center justify-start",style:ve({backgroundColor:r.backgroundColor})},[a("div",Re,[N(p,{width:"80",height:"80",fit:"cover",src:(((d=r.store)==null?void 0:d.storeIcons)||"").split(",")[0]},null,8,["src"]),+((l=r.store)==null?void 0:l.storeGoodsCount)>0?(n(),L(Ie,{key:0})):V("",!0)]),a("div",Oe,[a("div",Be,[a("span",Te,x(((c=r.store)==null?void 0:c.storeName)||""),1)]),a("div",je,x(((y=r.store)==null?void 0:y.goodsCategoryName3)||"")+" "+x(r.store.areaExtName3||""),1),a("div",De,[a("span",qe,[+((I=r.store)==null?void 0:I.wantCount)?(n(),h(j,{key:0},[de(x(r.store.wantCount)+"人想要 ",1)],64)):V("",!0)]),(u=k(f).locationCoords)!=null&&u.lng&&((i=k(f).locationCoords)!=null&&i.lat)?(n(),h("span",Me,x(k(g)(r.store.distance)),1)):V("",!0)])])],4)}}},Pe="/static/images/search-recommend-DZW-4urq.svg",Ge={class:"font-Puhui"},Ue={key:0,class:"mb-4 flex justify-center items-center gap-3"},He=fe('<div class="line-left" data-v-e5a7ad04></div><div class="flex items-center gap-0.5" data-v-e5a7ad04><img src="'+Pe+'" class="w-4 h-4" data-v-e5a7ad04><div class="text-sm text-b3 font-normal" data-v-e5a7ad04>大家都在搜</div></div><div class="line-right" data-v-e5a7ad04></div>',3),Ke=[He],Ze=G({props:{keyword:null,sortAct:null},emits:["onDetail"],setup(r,{emit:g}){const f=r,{cityMapStore:t}=H(),w=v(!1),p=v(0),d=v(20),l=v(!1),c=v([]),y=async()=>{w.value=!0,p.value+=1,l.value=!1,await I(),w.value=!1},I=async()=>{var D,B,F,E;let u={goodsStatus:1,goodsNameLike:null,notBelongAreaIdPreviousLastLeaf:((D=t.currentActiveCity)==null?void 0:D.areaId)||"",overseasFlag:((B=t.currentActiveCity)==null?void 0:B.overseasFlag)||!1};f.keyword&&(u.goodsNameLike=f.keyword);let i=[f.sortAct];f.sortAct!=="asc|distance"&&i.push("asc|distance"),i.push("asc|goods_id");let R=i.length?i.join(","):null;const m={page:p.value,size:d.value,...u,longitude:t.locationCoords.lng||((F=t.currentActiveCity)==null?void 0:F.areaLongitude)||null,latitude:t.locationCoords.lat||((E=t.currentActiveCity)==null?void 0:E.areaLatitude)||null,sortBy:R},{success:_,data:A}=await le(m);if(!_||!A||!A.total){l.value=!0;return}const O=A.records||[];O.forEach(S=>{S.shopName=S.storeName||S.shopName}),c.value=p.value===1?O:[...c.value,...O],c.value.length>=A.total&&(l.value=!0)};return(u,i)=>{const R=z("van-list");return n(),h("div",Ge,[c.value.length?(n(),h("div",Ue,Ke)):V("",!0),N(R,{loading:w.value,"onUpdate:loading":i[0]||(i[0]=m=>w.value=m),finished:l.value,"finished-text":"","loading-text":c.value.length?u.$t("common.loading"):"",onLoad:y},{default:se(()=>[(n(!0),h(j,null,U(c.value,m=>(n(),L(ae,{key:m.goodsId,goods:m,class:"mb-4 :last:mb-0",onClick:_=>g("onDetail",m),"show-store-name":"","show-distance":""},null,8,["goods","onClick"]))),128))]),_:1},8,["loading","finished","loading-text"])])}}}),Je=te(Ze,[["__scopeId","data-v-e5a7ad04"]]),ne=r=>(we("data-v-795d8054"),r=r(),Ce(),r),Qe={class:"font-Puhui font-normal relative pb-20 app-container"},We={class:"header__wrap w-full h-[50px]"},Xe={class:"header__title h-full van-nav-bar__content"},Ye={class:"van-nav-bar__left van-haptics-feedback"},et={class:"van-nav-bar__title van-ellipsis text-b1 text-lg font-bold"},tt={class:"van-nav-bar__right van-haptics-feedback text-b3"},st={class:"search__wrap w-full h-[48px] px-3 pb-3"},at={class:"search__input w-full h-full bg-white rounded-3xl flex items-center justify-center px-3 py-2.5"},ot=ne(()=>a("div",{class:"search__icon flex-shrink-0"},[a("img",{src:ke,class:"w-4 h-4"})],-1)),lt=["placeholder","onKeyup"],nt=ne(()=>a("img",{src:Se,class:"w-4 h-4",alt:""},null,-1)),rt=[nt],it={class:"text-[#FF8812] text-sm font-semibold whitespace-nowrap"},ct={class:"list__wrap"},ut={class:"p-3"},dt={class:"goods__wrap overflow-y-scroll"},vt=G({name:"OfflineHome"});function ft(r){var Z,J;const g=he(),f=pe(),{cityMapStore:t}=H(),{getUserLocation:w}=oe(),{t:p}=me(),d=v(""),l=v(((Z=f.query)==null?void 0:Z.tab)||"STORE"),c=v(!1),y=v(0),I=v(20),u=v(!1),i=v([]),R=ee(()=>[{label:"线下门店",value:"STORE"},{label:p("shop.offline server"),value:"SERVE"}]),m=ee(()=>{var s,b;let e=[];return(s=t.locationCoords)!=null&&s.lat&&((b=t.locationCoords)!=null&&b.lng)&&e.push({label:"距离优先",value:"asc|distance"}),e.push({label:"销量优先",value:"desc|store_sales_volume_order"}),l.value==="SERVE"&&e.push({label:"精选/优选优先",value:"asc|goods_sort"}),e}),_=v((J=m.value[0])==null?void 0:J.value),A=()=>{d.value="",F()},O=e=>{var s;l.value=e,e==="STORE"&&_.value==="asc|goods_sort"&&(_.value=(s=m.value[0])==null?void 0:s.value),g.replace({path:"/city/search",query:{tab:e}}),E()},D=e=>{_.value=e,E()},B=v(null),F=()=>{c.value||(y.value=0,u.value=!1,i.value=[],S(),B.value.blur())},E=()=>{y.value=0,u.value=!1,i.value=[],S()},S=async()=>{c.value=!0,y.value+=1,u.value=!1,await re(),c.value=!1},re=async()=>{var T,M,Q,W,X,Y;let e={};l.value==="STORE"?e={storeNameLike:d.value,areaIdPreviousLastLeaf:((T=t.currentActiveCity)==null?void 0:T.areaId)||"3501",overseasFlag:((M=t.currentActiveCity)==null?void 0:M.overseasFlag)||!1}:e={goodsStatus:1,goodsNameLike:d.value,belongAreaIdPreviousLastLeaf:((Q=t.currentActiveCity)==null?void 0:Q.areaId)||"",overseasFlag:((W=t.currentActiveCity)==null?void 0:W.overseasFlag)||!1};let s=[_.value];_.value!=="asc|distance"&&s.push("asc|distance"),l.value==="STORE"?s.push("asc|store_id"):s.push("asc|goods_id");let b=s.length?s.join(","):null;const $={page:y.value,size:I.value,...e,longitude:t.locationCoords.lng||((X=t.currentActiveCity)==null?void 0:X.areaLongitude)||null,latitude:t.locationCoords.lat||((Y=t.currentActiveCity)==null?void 0:Y.areaLatitude)||null,sortBy:b},{success:q,data:o}=l.value==="STORE"?await Fe($):await le($);if(!q||!o||!o.total){u.value=!0;return}const C=o.records||[];C.forEach(P=>{P.shopName=P.storeName||P.shopName}),i.value=y.value===1?C:[...i.value,...C],i.value.length>=o.total&&(u.value=!0)},K=e=>{g.push({path:"/city/search/offlineGoodsDetail",query:{goodsId:e.goodsId,storeId:e.storeId}})},ie=e=>{console.log(e),g.push({path:"/city/search/storefront",query:{storeId:e.storeId,child:1}})};return _e(()=>t.currentActiveCity,(e,s)=>{e!=null&&e.areaId&&E()},{immediate:!0,deep:!0}),ge(async()=>{var e,s,b,$;t.currentActiveCity?(e=t.locationCoords)!=null&&e.lat&&((s=t.locationCoords)!=null&&s.lng)||t.setNoAuthError():await w(),(b=f.query)!=null&&b.tab&&(l.value=($=f.query)==null?void 0:$.tab)}),(e,s)=>{var q;const b=z("van-list"),$=z("router-view");return n(),h("div",Qe,[a("div",We,[a("div",Xe,[a("div",Ye,[N($e)]),a("div",et,x(e.$t("common.search")),1),a("div",tt,x((q=k(t).currentActiveCity)==null?void 0:q.areaName),1)])]),a("div",st,[a("div",at,[ot,ye(a("input",{ref:(o,C)=>{C.searchRef=o,B.value=o},type:"text","onUpdate:modelValue":s[0]||(s[0]=o=>d.value=o),class:"w-full h-full bg-transparent ml-1 font-normal",placeholder:e.$t("mall.Enter search keywords"),onKeyup:xe(F,["enter"]),enterkeyhint:"search"},null,40,lt),[[be,d.value]]),d.value?(n(),h("div",{key:0,class:"flex-shrink-0 flex items-center justify-center",onClick:A},rt)):V("",!0),a("div",{class:"search__btn ml-2 flex-shrink-0",onClick:F},[a("span",it,x(e.$t("common.search")),1)])])]),a("div",ct,[N(Le,{options:k(R),"label-key":"label","value-key":"value",class:"!pt-3",modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=o=>l.value=o),onChange:O},null,8,["options","modelValue"]),a("div",ut,[N(Ve,{options:k(m),modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=o=>_.value=o),onChange:D},null,8,["options","modelValue"])]),a("div",dt,[i.value.length===0&&!c.value?(n(),L(Ae,{key:0,name:e.$t("common.No data yet")},null,8,["name"])):(n(),L(b,{key:1,loading:c.value,"onUpdate:loading":s[3]||(s[3]=o=>c.value=o),finished:u.value,"finished-text":l.value==="STORE"?e.$t("common.noMore"):"",onLoad:S},{default:se(()=>[(n(!0),h(j,null,U(i.value,o=>{var C,T;return n(),h(j,{key:o.goodsId+o.storeId},[l.value==="STORE"?(n(),L(ze,{key:0,store:o,class:"mb-4 :last:mb-0",onClick:M=>ie(o)},null,8,["store","onClick"])):(n(),L(ae,{key:1,goods:o,class:"mb-4 :last:mb-0",onClick:M=>K(o),"show-store-name":"","show-distance":!!((C=k(t).locationCoords)!=null&&C.lat&&((T=k(t).locationCoords)!=null&&T.lng))},null,8,["goods","onClick","show-distance"]))],64)}),128))]),_:1},8,["loading","finished","finished-text"])),l.value==="SERVE"&&u.value?(n(),L(Je,{key:2,keyword:d.value,sortAct:_.value,onOnDetail:K},null,8,["keyword","sortAct"])):V("",!0)])]),N($,{class:"child-view bg-gray1"})])}}const ht=Object.assign(vt,{setup:ft}),Ft=te(ht,[["__scopeId","data-v-795d8054"]]);export{Ft as default};

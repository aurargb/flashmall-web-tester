import{_ as Z,y as V,r as m,D as U,E as P,F as a,G as s,H as e,X as p,P as c,Q as o,O as S,N as F,R as E,Z as we,$ as ke,be as ie,a9 as je,a1 as R,a4 as ue,bf as Oe,x as q,K as b,J as de,I as ce,w as Se,T as Y,B as re,a2 as ze,l as Ve,A as Ue}from"./vendor-BlU_hoYl.js";import{P as z}from"./flashSale-DDyqLyYN.js";import{S as He}from"./SubmitOrderPop-CYOetB2w.js";import{h as W,p as _e,al as ee,b as Te,f as Me,d as $e,a7 as Ge,r as qe,bh as Ze,bb as k,a8 as Je,bc as Ke,l as Qe}from"./index-UgIL2Smv.js";import{_ as We}from"./OrderPopBorder-DiHG6LWm.js";import{l as Ae}from"./luckyShopContract-DfQD8nlF.js";import{a as Xe,S as Ye,b as et,G as tt,_ as st}from"./GivePointsLable-BPAk_1Dc.js";import{_ as ot}from"./kefu-B-s0jZtS.js";import{c as lt}from"./goods-CBBDw-0p.js";import{_ as at}from"./BoutiqueLable-negN2DKs.js";import{_ as nt}from"./GoodsPrice-CFQUMmEr.js";import{R as it}from"./RatioBox-CBosZpIg.js";import{D as ne}from"./goods-BVwS8oFG.js";import{F as X}from"./enums-DlE-aiss.js";import{B as ut}from"./BackIcon-8hcEjDKb.js";import{R as dt}from"./RemovedShelves-j33id_1b.js";import"./OrderGoodsBox-BNx2eQs9.js";import"./mall-C69gPh5W.js";import"./MCOIN-BOqZVkND.js";import"./OrderGoods-BAWlMMuQ.js";import"./ShopMaskTips-CxJi-SfW.js";import"./shop-CeqcS6K2.js";import"./ApproveButton-FviueR9l.js";const ct="/static/images/prize-redeem-BgHjSMZp.png",rt="/static/images/gongxi-Cs9STMoQ.png",J=t=>(we("data-v-1a85a397"),t=t(),ke(),t),mt={class:"bg-sale flex-center-bw p-2.5 mb-4"},vt={key:0,class:"text-[#FB1A18] text-3xl font-semibold mb-1"},ft=J(()=>e("span",{class:"text-sm font-normal"},"Mcoin",-1)),pt={key:1,class:"text-[#FB1A18] text-3xl mb-1"},ht={class:"text-xs"},gt=J(()=>e("span",{class:"text-sm font-normal"},"Symbol",-1)),yt={class:"flex items-center"},xt={class:"text-[#D7894E] text-xs line-through mr-2.5"},bt={key:0,class:"bg-[#FB1A18] text-white h-4 text-xs flex items-center px-1 rounded"},$t={key:2,class:"text-[#FB1A18] text-base mb-1"},wt={class:"text-xs font-normal"},kt=J(()=>e("span",{class:"text-sm font-normal"},"Symbol",-1)),St={class:"mb-1 text-lg text-white"},_t=J(()=>e("span",{class:"text-[#C96C26] mr-1"},":",-1)),Tt=J(()=>e("span",{class:"text-[#C96C26] mr-1"},":",-1)),At=V({props:{goods:null,systemTime:null,cutdownTimestamp:null,startTime:null,totalAmount:null},emits:["changeTime"],setup(t,{expose:_,emit:v}){const i=t,h=m(null),g=()=>{h.value.pause()},$=()=>{h.value.reset()},f=async()=>{v("changeTime")};return U(async()=>{}),_({pause:g,reset:$}),(r,l)=>{const u=P("van-count-down");return s(),a("div",mt,[e("div",null,[t.goods.payType!==c(z).STORE_CARD?(s(),a("div",vt,[e("span",null,o(i.goods.price),1),ft])):p("",!0),t.goods.payType===c(z).STORE_CARD?(s(),a("div",pt,[e("span",ht,o(r.$t("flashSale.storePrice"))+"：",1),e("span",null,o(i.goods.cardPrice),1),gt])):p("",!0),e("div",yt,[e("div",xt,o(i.goods.totalPrice)+" Mcoin ",1),t.goods.purchaseLimit!==t.totalAmount&&t.totalAmount?(s(),a("div",bt,o(r.$t("flashSale.purchaseLimit",{number:t.goods.purchaseLimit})),1)):p("",!0)]),t.goods.payType===c(z).MIX?(s(),a("div",$t,[e("span",wt,o(r.$t("flashSale.storePrice"))+"：",1),e("span",null,o(i.goods.cardPrice),1),kt])):p("",!0)]),e("div",null,[e("div",St,o(r.$t("common.one sale actives")),1),S(u,{class:"text-[#000] flex items-center",ref:(n,x)=>{x.countDown=n,h.value=n},time:i.cutdownTimestamp,format:"DD 天 HH 时 mm 分 ss 秒",onFinish:f},{default:F(n=>[e("div",{class:E(["min-w-[32px] text-center text-lg rounded-lg p-1 mr-1",i.startTime>0?"bg-[#d9d9d9] text-white":"bg-gradient-to-r from-[#FFF8F3] from-1% to-[#EFB683] to-101% text-[#C96C26]"])},o(n.hours+n.days*24<10?`0${n.hours+n.days*24}`:n.hours+n.days*24),3),_t,e("div",{class:E(["w-[32px] text-center text-lg rounded-lg p-1 mr-1",i.startTime>0?"bg-[#d9d9d9] text-white":"bg-gradient-to-r from-[#FFF8F3] from-1% to-[#EFB683] to-101% text-[#C96C26]"])},o(n.minutes<10?`0${n.minutes}`:n.minutes),3),Tt,e("div",{class:E(["w-[32px] text-center text-lg rounded-lg p-1",i.startTime>0?"bg-[#d9d9d9] text-white":"bg-gradient-to-r from-[#FFF8F3] from-1% to-[#EFB683] to-101% text-[#C96C26]"])},o(n.seconds<10?`0${n.seconds}`:n.seconds),3)]),_:1},8,["time"])])])}}}),Ct=Z(At,[["__scopeId","data-v-1a85a397"]]),It={class:"font-semibold text-[#000] bg-white rounded-lg text-sm mt-1 text-left flex items-center justify-between overflow-hidden"},Ft={class:"w-full bg-[#F9F5F7] rounded-lg text-[#333] px-2 text-xs font-normal"},Et={class:"text-[#FA1A17]"},Bt=V({props:{lucklyInfo:{type:Object,default:()=>({amount:null,sn:null,time:null})},totalAmount:{type:Number,default:0}},setup(t){const _=t,v=m([]),i=r=>{v.value=r},[h,g]=ie(!1),$=m(null),f=r=>{$.value.contains(r.target)||g(!1)};return U(()=>{document.addEventListener("click",f)}),je(()=>{document.removeEventListener("click",f)}),(r,l)=>{const u=P("van-collapse-item"),n=P("van-collapse");return _.lucklyInfo.amount>0?(s(),a("div",{key:0,class:"pt-1 relative",onClick:l[7]||(l[7]=x=>c(g)(!1))},[e("div",It,[S(n,{modelValue:v.value,"onUpdate:modelValue":l[5]||(l[5]=x=>v.value=x),onChange:i,class:"w-full rounded-xl",border:!1},{default:F(()=>[S(u,{title:r.$t("flashSale.openInfo"),name:"1","right-icon":"play",border:!1},{"right-icon":F(()=>[e("div",{class:E(v.value.length===0?"triangle-down":"triangle-up")},null,2)]),default:F(()=>[e("div",Ft,[e("div",{class:"flex justify-between py-1.5 pt-2.5 border-solid border-[#DEDEDE]/20 border-b",onClick:l[0]||(l[0]=x=>c(W)(t.lucklyInfo.amount))},[R(o(r.$t("flashSale.circulation"))+": ",1),e("div",null,o(t.lucklyInfo.amount),1)]),e("div",{class:"flex justify-between py-1.5 border-solid border-[#DEDEDE]/20 border-b",onClick:l[1]||(l[1]=x=>c(W)(t.lucklyInfo.time))},[R(o(r.$t("flashSale.timestamp"))+": ",1),e("div",null,o(t.lucklyInfo.time),1)]),e("div",{class:"flex justify-between py-1.5 border-solid border-[#DEDEDE]/20 border-b",onClick:l[2]||(l[2]=x=>c(W)(t.lucklyInfo.totalAmount))},[R(o(r.$t("flashSale.totalAmount"))+" ",1),e("div",null,o(t.totalAmount),1)]),e("div",{class:"flex justify-between py-1 font-semibold pb-2",onClick:l[3]||(l[3]=x=>c(W)(t.lucklyInfo.totalAmount))},[R(o(r.$t("flashSale.lucklySn"))+" ",1),e("div",Et,o(t.lucklyInfo.sn),1)])]),e("div",{class:"w-full bg-white text-[#777] text-xs font-normal mt-4",onClick:l[4]||(l[4]=ue(()=>{},["stop"]))},o(r.$t("flashSale.openExplanation")),1)]),_:1},8,["title"])]),_:1},8,["modelValue"])]),c(h)?(s(),a("div",{key:0,class:"w-[80%] absolute bg-default/80 text-white right-2 top-8 p-2 rounded text-xs text-justify",onClick:l[6]||(l[6]=ue(()=>{},["stop"]))},o(r.$t("flashSale.openExplanation")),1)):p("",!0)])):p("",!0)}}}),Rt=Z(Bt,[["__scopeId","data-v-5d91f7ee"]]),Dt={class:"h-full pb-4 mt-4"},Pt={class:"flex justify-between text-sm text-[#2E2008] opacity-60 px-4"},Lt={class:"bg-white rounded-lg mt-2.5 text-sm text-[#2E2008] px-4 max-h-[70vh] overflow-y-auto"},Nt={class:"flex-1 text-left"},jt={class:"flex-1"},Ot={class:"flex justify-end flex-1"},zt=V({props:{show:{type:Boolean,default:!1},list:{default:[]},countList:{default:[]},luckUser:null,goodsId:null,totalAmount:null},emits:["close"],setup(t,{emit:_}){const v=t,{orderRandomRecords:i}=Ae(),h=Oe({lucklyInfo:{amount:null,sn:null,time:null}}),g=()=>{_("close")},$=q(()=>{const r=v.list.map((u,n)=>({address:u,count:+v.countList[n],number:_e(+n)||[]})),l=v.list.findIndex(u=>ee(u)===ee(v.luckUser));if(l!==-1){let u=r.splice(l,1)[0];r.unshift(u)}return r}),f=async()=>{const r=await i(v.goodsId);r.success&&(h.lucklyInfo=r.result)};return U(()=>{f()}),(r,l)=>(s(),b(We,{show:v.show,onClose:g,title:r.$t("flashSale.ParticipationRecord")},{default:F(()=>[S(Rt,{"luckly-info":c(h).lucklyInfo,totalAmount:t.totalAmount},null,8,["luckly-info","totalAmount"]),e("div",Dt,[e("div",Pt,[e("div",null,o(r.$t("flashSale.wallet-address")),1),e("div",null,o(r.$t("flashSale.Buy copies")),1),e("div",null,o(r.$t("flashSale.Lottery number")),1)]),e("div",Lt,[(s(!0),a(ce,null,de(c($),(u,n)=>(s(),a("div",{class:E(["flex justify-between py-4 border-solid",{"border-[#7F169A]/20 border-b":n<c($).length-1}]),key:n},[e("div",Nt,o(c(Te)(u.address,"...",3,4)),1),e("div",jt,o(u.count),1),e("div",Ot,[(s(!0),a(ce,null,de(u.number,(x,A)=>(s(),a("div",{class:E(["bg-[#D8D8D8] font-semibold text-lg text-white leading-5 rounded-sm w-4 text-center",{"mr-0.5":A!==u.number.lenght-1,"bg-[#FA1A17]":n==0}]),key:A},o(x),3))),128))])],2))),128))])])]),_:1},8,["show","title"]))}}),Vt=Z(zt,[["__scopeId","data-v-2250f780"]]),Ut="/static/images/shop-ChcGIVIz.svg",Ht="/static/images/shop-KzfS1F29.svg",Ce=t=>(we("data-v-7ff404de"),t=t(),ke(),t),Mt={class:"fixed bottom-0 left-0 w-full px-2.5 safe-bottom sm:bottom-[0%] lg:bottom-[0%] z-20 flex-center"},Gt={class:"w-full h-14 flex items-center justify-between pb-0.5 pr-2 bg-white rounded-full sm:w-[355px] shadow-2"},qt={class:"flex flex-1 justify-evenly"},Zt={key:0,src:Ut,class:"w-5 h-5 m-auto mb-0.5"},Jt={key:1,src:Ht,class:"w-5 h-5 m-auto mb-0.5"},Kt=Ce(()=>e("img",{src:ot,class:"w-5 h-5 m-auto mb-0.5"},null,-1)),Qt={key:1,class:"text-xs text-center"},Wt={class:"text-[#e2e2e2]"},Xt={key:0,class:"flex"},Yt={class:"flex items-center"},es=Ce(()=>e("img",{src:Xe,class:"h-6 m-auto mr-1 w-11"},null,-1)),ts={key:0,class:"text-center text-white"},ss={class:"text-sm leading-3"},os={class:"text-lg font-medium leading-5"},ls=R(" Mcoin "),as={class:"text-[0.675rem]"},ns={class:"mr-0.5"},is={key:1,class:"py-2.5 ml-2 text-[#999] text-base"},us={key:2,class:"py-2.5 ml-2 text-[#999] text-base"},ds=V({props:{isFollow:{type:Boolean},goodsId:null,isSale:{type:Boolean},isSaleEnd:{type:Boolean},isSaleStart:{type:Boolean},isSaleOver:{type:Boolean},goods:null,systemTime:null,currentAmount:null,totalAmount:null,payType:null,boutiqueFlag:{type:Boolean}},emits:["handeToShop","handleConnect","handleBuy","handleAddCart","toPurchase"],setup(t,{expose:_,emit:v}){const i=t,{t:h}=Se(),g=m(!1);U(()=>{g.value=i.isFollow,i.isSale});const $=m(!1),f=q(()=>[{text:h("piggy.normalBuy"),id:1}]),r=u=>{v("handleBuy",`payType=${u.id}`)},l=()=>{lt({goodsIds:[i.goodsId],type:g.value?2:1,collectType:i.isSale?2:1}).then(u=>{u.success&&(g.value?Y(h("common.cancel collect")):Y(h("common.collect success")),g.value=!g.value)})};return _({}),(u,n)=>{const x=P("van-icon"),A=P("VanButton"),te=P("van-popover");return s(),a("div",Mt,[e("div",Gt,[e("div",qt,[e("div",{class:"text-xs text-center",onClick:n[0]||(n[0]=()=>v("handeToShop"))},[t.isSale?(s(),a("img",Jt)):(s(),a("img",Zt)),e("div",null,o(u.$t("mall.shop")),1)]),e("div",{class:"text-xs text-center",onClick:n[1]||(n[1]=()=>v("handleConnect"))},[Kt,e("div",null,o(u.$t("common.service")),1)]),t.isSale?(s(),a("div",Qt,[S(x,{name:"star",color:"#e2e2e2",size:20}),e("div",Wt,o(u.$t("common.collect")),1)])):(s(),a("div",{key:0,class:"text-xs text-center",onClick:l},[g.value?(s(),b(x,{key:0,name:"star",color:"#ffd21e",size:20})):(s(),b(x,{key:1,name:"star-o",color:"#2E2008",size:20})),e("div",null,o(u.$t("common.collect")),1)]))]),t.isSale?(s(),b(A,{key:1,class:E(["min-w-[60px] rounded-3xl px-2.5",i.isSaleEnd||i.isSaleStart||i.currentAmount>=i.totalAmount?"bg-[#D9D9D9]":"bg-[#FB1A18]"]),disabled:i.isSaleStart||i.isSaleEnd||i.currentAmount>=i.totalAmount,onClick:n[5]||(n[5]=()=>{v("toPurchase")})},{default:F(()=>[e("div",Yt,[es,!i.isSaleEnd&&!i.isSaleStart&&i.currentAmount<i.totalAmount?(s(),a("div",ts,[e("div",ss,[e("span",os,o(t.goods.price),1),ls]),e("div",as,[e("span",ns,o(u.$t("refund.TotalNum",{num:t.totalAmount})),1),e("span",null,o(u.$t("flashSale.Already snatched"))+o(i.currentAmount)+o(u.$t("common.pieces")),1)])])):i.isSaleStart?(s(),a("div",is,o(u.$t("common.no start")),1)):(s(),a("div",us,o(i.currentAmount>=i.totalAmount?u.$t("flashSale.Alreadygrabbed"):u.$t("flashSale.gooderror")),1))])]),_:1},8,["disabled","class"])):(s(),a("div",Xt,[S(A,{class:"px-3 text-sm text-white linear-btn rounded-l-3xl",onClick:n[2]||(n[2]=ue(K=>v("handleAddCart"),["stop"]))},{default:F(()=>[R(o(u.$t("common.addCart")),1)]),_:1}),t.payType!==3||t.boutiqueFlag?(s(),b(A,{key:0,class:"px-5 text-sm text-white bg-primary rounded-r-3xl",onClick:n[3]||(n[3]=()=>v("handleBuy",t.payType===2?"":"payType=1"))},{default:F(()=>[R(o(t.payType===2?u.$t("piggy.cardBuy"):u.$t("common.buy")),1)]),_:1})):(s(),b(te,{key:1,placement:"top",show:$.value,"onUpdate:show":n[4]||(n[4]=K=>$.value=K),actions:c(f),onSelect:r},{reference:F(()=>[S(A,{class:"px-5 text-sm text-white bg-primary rounded-r-3xl"},{default:F(()=>[R(o(u.$t("common.buy")),1)]),_:1})]),_:1},8,["show","actions"]))]))])])}}}),cs=Z(ds,[["__scopeId","data-v-7ff404de"]]),rs="/static/images/online-V-h6qWLs.svg",ms="/static/images/online-BHRPZ7Z2.svg",vs="/static/images/outline-C86leE1s.svg",fs="/static/images/inline-NC3d5N9J.svg",ps={class:"rounded-b-lg px-2.5 pt-2.5 pb-3 bg-white box-shadow"},hs={key:0},gs={class:"text-sm font-semibold break-all"},ys={class:"mr-1.5"},xs={key:0,class:"mt-1.5 text-xs leading-normal text-black-400 line-clamp-2"},bs={class:"flex items-center mt-2"},$s={key:1,class:"flex items-center"},ws={key:2,class:"gap-2 ml-auto mr-4 text-right"},ks={key:1},Ss={class:"mb-2 font-semibold break-all"},_s={class:"flex items-center justify-between mt-3"},Ts={key:0,class:"flex-start"},As={key:0,src:rs,class:"w-6 mr-2"},Cs={key:1,src:ms,class:"w-6 mr-2"},Is={key:1,class:"flex-start"},Fs={key:0,src:vs,class:"w-6 mr-2"},Es={key:1,src:fs,class:"w-6 mr-2"},Bs={class:"mt-1 mr-4 text-xs flex justify-start items-center text-black/50"},Rs={key:0},Ds={key:1},Ps={key:2},Ls={key:3},Ns={class:"ml-auto"},js={key:0},Os={key:1},zs=V({props:{tokenRate:null,stores:null,goods:null,isSale:{type:Boolean,default:!1},card:null,shippingTemplate:{default:()=>({})}},setup(t){const _=t,{tradeContributeSelfRate:v}=Me(),i=m(0),h=q(()=>{const f=+new re(new re(_.goods.goodsDiscountRatio).div(100)).times(_.goods.price).times(i.value);return $e(f,2)}),g=async()=>{i.value=await v()},$=async()=>{g()};return U(()=>{$()}),(f,r)=>(s(),a("div",ps,[t.isSale?(s(),a("div",ks,[e("div",Ss,o(t.goods.title||""),1),S(it,{ratio:t.goods.discountRate||20,class:"h-6"},null,8,["ratio"]),e("div",_s,[t.goods.deliveryType===1||t.goods.shippingMethod===1?(s(),a("div",Ts,[t.isSale?(s(),a("img",Cs)):(s(),a("img",As)),e("div",null,o(f.$t("common.send")),1)])):(s(),a("div",Is,[t.isSale?(s(),a("img",Es)):(s(),a("img",Fs)),e("div",null,o(f.$t("common.offline")+f.$t("common.Payment")),1)]))])])):(s(),a("div",hs,[e("div",gs,[t.goods.type?(s(),b(at,{key:0,type:t.goods.type,class:"inline-block align-text-top mr-1.5"},null,8,["type"])):p("",!0),e("span",ys,o(t.goods.goodsName||""),1),S(Ye,{class:"align-text-bottom",deliveryType:t.goods.deliveryType},null,8,["deliveryType"])]),t.goods.goodsDesc?(s(),a("div",xs,o(t.goods.goodsDesc),1)):p("",!0),e("div",bs,[t.goods.payType!==c(z).STORE_CARD?(s(),b(nt,{key:0,style:{"margin-right":"0"},price:t.goods.price},null,8,["price"])):p("",!0),t.goods.payType!==c(z).STORE_CARD&&t.goods.deliveryType===c(ne).online?(s(),a("div",$s)):p("",!0),t.goods.deliveryType===c(ne).online?(s(),a("div",ws,[t.goods.payType!==c(z).STORE_CARD?(s(),b(et,{key:0,class:"inline-block",showType:"balance",goods:t.goods},null,8,["goods"])):p("",!0)])):p("",!0)])])),e("div",Bs,[e("span",null,[t.shippingTemplate.type===c(X).FREE&&t.shippingTemplate.threshold?(s(),a("span",Rs,o(f.$t("shop.shippingTemplate.actualPayment"))+o(c($e)(t.shippingTemplate.threshold))+"MC"+o(f.$t("shop.shippingTemplate.freeShipping")),1)):p("",!0),t.shippingTemplate.type===c(X).FREE&&t.shippingTemplate.threshold===0?(s(),a("span",Ds,o(f.$t("shop.shippingTemplate.freeShipping")),1)):p("",!0),t.shippingTemplate.type===c(X).NO_SHIPPING?(s(),a("span",Ps,o(f.$t("shop.shippingTemplate.noShipping")),1)):p("",!0),t.shippingTemplate.type===c(X).CASH_ON_DELIVERY?(s(),a("span",Ls,o(f.$t("shop.shippingTemplate.cashOnDelivery")),1)):p("",!0)]),e("span",Ns,[t.goods.deliveryType===c(ne).online?(s(),a("span",js,o(f.$t("goods.confirming receipt")),1)):(s(),a("span",Os,o(f.$t("goods.order completed get integral",{num:c(h)})),1))])])]))}}),Vs=Z(zs,[["__scopeId","data-v-4ae5136e"]]),Us={class:"relative w-full h-full bg-white safe-bottom-page"},Hs={key:0},Ms={class:"relative"},Gs={key:0,class:"absolute top-0 left-0 w-full h-full z-40 bg-[#000000]/70"},qs={class:"absolute top-1/2 left-1/2 translate-x-[-50%] translate-y-[-50%]"},Zs=e("img",{src:ct,class:"h-auto w-52",alt:""},null,-1),Js={class:"flex items-center whitespace-nowrap justify-center mb-0.5"},Ks={class:"text-xs"},Qs={key:0,class:"flex items-center whitespace-nowrap"},Ws={key:0,class:"text-[0.675rem] text-[#999999]"},Xs={class:"text-xs text-[#999] text-center underline mt-0.5"},Ys={class:"ml-2"},eo={class:"px-2.5"},to={key:3,class:"fixed left-2.5 top-[13.2rem] bg-white/80 text-default rounded-2xl px-2 py-1.5 text-xs font-semibold z-50"},so={class:"flex items-center"},oo=e("img",{src:rt,class:"w-3 h-3 mr-1.5"},null,-1),Co=V({setup(t){const{commodities:_,orderList:v}=Ae(),i=m(!1),{loadingToggle:h}=qe(),{t:g}=Se(),$=ze(),f=Ve(),r=Ge(),l=m(null),[u,n]=ie(!1),[x,A]=ie(!1),te=m(),K=m(null),Ie=m(null),me=$.query.id,Fe=async()=>{const d=$.query.id,w=await Ze(+d);l.value=w.data},Ee=q(()=>l.value.mainImageUrls.split(",").filter(d=>d!==""&&d!==null&&d!==void 0&&!Number.isNaN(d))),Be=async()=>{n(!1),await ge()},H=m(null),M=m(null),ve=async()=>{H.value=k(l.value.startTime)*1e3-k(C.value)*1e3>0,M.value=k(l.value.endTime)*1e3-k(C.value)*1e3<=0,be()},Re=async()=>{if(console.log(H.value,M.value,T.value,y.value,"currentAmount.value, totalAmount.value"),T.value>=y.value&&y.value>0){B.value=0;return}if(H.value&&M.value&&T.value<y.value&&y.value>0){B.value=0;return}await Le(),k(l.value.startTime)*1e3-k(C.value)*1e3<=0&&k(l.value.endTime)*1e3-k(C.value)*1e3&&(L.value=0,B.value=k(l.value.endTime)*1e3-k(C.value)*1e3),await ve()},De=()=>{f.push(`submitOrder?id=${l.value.id}`)},Pe=async()=>{if(l.value.stock===0&&l.value.goodsTypes!=2){Y(g("order.Insufficient stock"));return}h(!0);const d=await Je(l.value.id);h(!1),d.success&&(Y(g("cart.addTips")),r.getCartCount())},fe=d=>{f.push(d)},B=m(0),se=m(0),L=m(0),C=m(""),Le=async()=>{const{data:d}=await Ke();C.value=d||null,se.value=k(l.value.endTime)*1e3-k(C.value)*1e3,L.value=k(l.value.startTime)*1e3-k(C.value)*1e3,L.value>0&&(B.value=L.value),L.value<=0&&se.value>0&&(B.value=se.value)},T=m(0),y=m(0),pe=m(0),he=m(0),D=m(null),oe=m(""),ge=async()=>{const d=await _(l.value.id);T.value=+d.currentAmount,y.value=+d.totalAmount,pe.value=y.value-T.value,he.value=+d.limitEach,l.value.discountRate=+re(+d.discountRate).div(1e4).toNumber(),d.lucky!==Ue&&(D.value=l.value.luckyNickName||Te(d.lucky,"...",4,2)),d.status===20&&(oe.value=Qe(d.nextActionTime*1e3)),be()},le=m(!1),Q=m(1),G=m(1e3),N=m([]),ae=m([]),ye=async()=>{if(!D.value||le.value)return;const d=await v(l.value.id+"",(Q.value-1)*G.value,G.value);if(!d.success)return;const w=+d.result.total;if(N.value=Q.value===1?d.result.rows:N.value.concat(d.result.rows),ae.value=Q.value===1?d.result.counts:ae.value.concat(d.result.counts),N.value.length===w){le.value=!0;return}Q.value+=1;const j=w-N.value.length;G.value=j>G.value?G.value:j,await ye()},xe=q(()=>{const d=N.value.findIndex(j=>ee(j)===ee(l.value.lucky));return _e(+d)||[]}),Ne=()=>{A(!0)},be=()=>{if(T.value>=y.value&&y.value>0){B.value=0;return}if(H.value&&M.value&&T.value<y.value&&y.value>0){B.value=0;return}};return U(async()=>{h(!0),await Fe(),await ge(),ye(),ve(),h(!1)}),(d,w)=>{const j=P("VanLoading");return s(),a("div",Us,[l.value?(s(),a("div",Hs,[e("div",Ms,[T.value>=y.value&&D.value?(s(),a("div",Gs,[e("div",qs,[Zs,e("div",{class:"absolute bottom-2 left-1/2 translate-x-[-50%] whitespace-nowrap",onClick:Ne},[e("div",Js,[e("span",Ks,o(d.$t("flashSale.Winning-number")),1),le.value?(s(),a("div",Qs,[(s(!0),a(ce,null,de(c(xe),(I,O)=>(s(),a("div",{class:E(["bg-[#FA1A17] font-semibold text-lg text-white leading-5 rounded-sm w-4 text-center",{"mr-0.5":O!==c(xe).length-1}]),key:O},o(I),3))),128))])):(s(),b(j,{key:1,size:"18"}))]),oe.value?(s(),a("div",Ws,o(d.$t("flashSale.Prizeredemptiondeadline"))+":"+o(oe.value),1)):p("",!0),e("div",Xs,o(d.$t("flashSale.check-the-details")),1)])])])):p("",!0),e("header",{class:E(["flex items-center justify-between fixed top-0 z-50 bg-white py-2.5 px-2.5",{"bg-white/0":T.value>=y.value&&D.value}])},[e("div",{class:E(["flex items-center flex-wra",{"text-white":T.value>=y.value&&D.value}])},[S(ut),e("div",Ys,o(te.value||""),1)],2)],2),l.value.mainImageUrls?(s(),b(tt,{key:1,imgs:c(Ee)||"",class:"mb-2.5",indicatorColor:"#FB1A18",bgColor:"#F4C5C4"},null,8,["imgs"])):p("",!0)]),S(Ct,{goods:l.value,onChangeTime:Re,ref:(I,O)=>{O.cutdown=I,K.value=I},startTime:L.value,cutdownTimestamp:B.value,systemTime:C.value,totalAmount:y.value},null,8,["goods","startTime","cutdownTimestamp","systemTime","totalAmount"]),e("div",eo,[S(Vs,{goods:l.value,class:"mb-2.5",isSale:!0},null,8,["goods"]),l.value.describe||l.value.detailImageUrls?(s(),b(st,{key:0,text:l.value.describe,imgs:(l.value.detailImageUrls||"").split(",")},null,8,["text","imgs"])):p("",!0),S(cs,{goodsId:l.value.id,systemTime:C.value,goods:l.value,ref:(I,O)=>{O.goodsBar=I,Ie.value=I},isFollow:i.value,onHandleBuy:De,isSale:!0,isSaleEnd:M.value,isSaleStart:H.value,totalAmount:y.value,currentAmount:T.value,onToPurchase:w[0]||(w[0]=I=>c(n)(!0)),onHandeToShop:w[1]||(w[1]=I=>fe(`/category?deliveryType=1&shopId=${l.value.shopId}`)),onHandleConnect:w[2]||(w[2]=I=>fe(`/shopInfo?address=${l.value.address}`)),onHandleAddCart:Pe},null,8,["goodsId","systemTime","goods","isFollow","isSaleEnd","isSaleStart","totalAmount","currentAmount"])])])):l.value?(s(),b(dt,{key:1,type:"good"})):p("",!0),l.value?(s(),b(He,{key:2,show:c(u),onClose:Be,goods:l.value,remaining:pe.value,limitEach:he.value},null,8,["show","goods","remaining","limitEach"])):p("",!0),T.value>=y.value&&D.value?(s(),a("div",to,[e("div",so,[oo,e("div",null,o(d.$t("flashSale.Congratulations-tips",{user:` ${D.value} `})),1)])])):p("",!0),c(me)?(s(),b(Vt,{key:4,goodsId:c(me),totalAmount:y.value,list:N.value,countList:ae.value,show:c(x),luckUser:l.value&&l.value.lucky,onClose:w[3]||(w[3]=()=>c(A)(!1))},null,8,["goodsId","totalAmount","list","countList","show","luckUser"])):p("",!0)])}}});export{Co as default};

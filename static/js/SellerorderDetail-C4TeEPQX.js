import{w as B,x as C,r as S,o as be,D as X,a9 as ye,F as v,a2 as h,P as r,G as d,H as e,I as Pe,Q as o,y as ee,B as Oe,a0 as D,E as U,K as k,N as j,O as R,a4 as M,T as $,_ as we,z as me,bc as Me,bp as Be,Y as Fe,Z as Ve,a1 as qe,bg as Ee,be as H,R as Le,l as He}from"./vendor-Ba70TIw4.js";import{g as G}from"./orderTime-DGNmmu3-.js";import{u as Ke,a as Ue,b as Ge,c as ze}from"./useOrderActionButtons-B52Gt0Da.js";import{_ as q}from"./copy-w-F2Lv8QkV.js";import{h as F,d as V,q as Ze,b as fe,l as K,e as W,u as _e,g as he,R as Qe,o as pe,a4 as Ye}from"./index-Bsb9uxb4.js";import{_ as Je,a as We,b as Xe,c as et}from"./remark-CXQr5QyI.js";import{_ as z}from"./MCOIN-Bodfn-v1.js";import{_ as tt}from"./link-DvRTrysK.js";import{u as st}from"./useRefund-Dpqhghzq.js";import{_ as ot}from"./CountdownLabel-sxxOKP2T.js";import{B as nt}from"./BackIcon-DkqwcD_b.js";import{U as rt}from"./UnfreezePop-3L6MSqVY.js";import{a as at,b as it,c as xe,n as ve}from"./order-Bt6BXfCD.js";import{P as lt}from"./flashSale-DDyqLyYN.js";import{s as dt}from"./refund-BilSleEw.js";import"./credit-EZuPIBEN.js";import"./useOrderStatus-eiwKm5Dv.js";import"./order-H59PKTFP.js";import"./useShipTemplate-CJrw2UwP.js";import"./enums-DlE-aiss.js";import"./default-avatar-BIKCDGrQ.js";import"./USDT-Dlu99aCg.js";import"./FMCP-f3k58DsE.js";import"./ApproveButton-DG7THQ9e.js";const ct={key:0,class:"p-3 break-all bg-white rounded-xl"},ut={class:"font-semibold text-base text-b1"},mt={class:"mr-1"},ft=e("span",null,"请在",-1),ht={class:"text-[#FF8812] mx-1"},pt=e("span",null,"内处理售后申请",-1),xt={key:1},vt=e("span",null,null,-1),bt={class:"mt-1 font-normal text-sm text-b2"},yt={key:0},wt={key:1},_t={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone"],setup(t,{emit:x}){const m=t,{t:I}=B(),p=C(()=>{const u=m.order||{};return Ke(u)}),i=S(Date.now());let l=null;const w=C(()=>{const u=G(m.order.expressTime,m.order.confirmLimit,m.nowTime);return u>0?u*1e3:0}),y=C(()=>{const u=be(w.value).unix();if(u<=0)return null;const s=Math.floor(u/(1e3*60*60*24)),a=Math.floor(u%(1e3*60*60*24)/(1e3*60*60)),c=Math.floor(u%(1e3*60*60)/(1e3*60)),f=Math.floor(u%(1e3*60)/1e3);let b="";return s>0&&(b+=`${s}天`),(a>0||s>0)&&(b+=`${a.toString().padStart(2,"0")}时`),(c>0||a>0||s>0)&&(b+=`${c.toString().padStart(2,"0")}分`),b+=`${f.toString().padStart(2,"0")}秒`,b}),_=()=>{i.value=Date.now(),w.value<=0&&l&&(clearInterval(l),l=null,x("timeDone"))};return X(()=>{_(),w.value>0&&p.value&&(l=setInterval(_,1e3))}),ye(()=>{l&&(clearInterval(l),l=null)}),(u,s)=>r(p)?(d(),v("div",ct,[e("div",ut,[e("span",mt,[r(y)?(d(),v(Pe,{key:0},[ft,e("span",ht,o(r(y)),1),pt],64)):(d(),v("span",xt,"请及时处理售后申请"))]),vt]),e("div",bt,[r(y)?(d(),v("span",yt," 请关注商品状态，倒计时结束买家申请平台介入 ")):(d(),v("span",wt," 请关注商品状态，买家可申请平台介入 "))])])):h("",!0)}},gt={class:"p-3 break-all bg-white rounded-xl"},kt={class:"title text-b1 text-sm font-semibold flex justify-between"},Ct=e("img",{src:q,class:"w-5 h-5 ml-2",alt:""},null,-1),Tt=[Ct],It={class:"font-normal text-sm text-b1 mt-2"},At={class:"mt-1 text-b1 text-sm font-normal"},Rt={class:"ml-1"},St=ee({props:{order:null},setup(t){const{order:x}=t,m=C(()=>`${x.userAddress.provinceName??""}${x.userAddress.cityName??""}${x.userAddress.countyName??""}${x.userAddress.detailInfo??""} ${x.userAddress.userName??""} ${x.userAddress.telNumber??""}`),I=()=>{const p=m.value;F(p)};return(p,i)=>(d(),v("div",gt,[e("div",kt,[e("span",null,o(p.$t("order.buyerAddressInfo")),1),e("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:I},Tt)]),e("div",It,o(t.order.userAddress.provinceName??"")+o(t.order.userAddress.cityName??"")+o(t.order.userAddress.countyName??"")+o(t.order.userAddress.detailInfo??""),1),e("div",At,[e("span",null,o(t.order.userAddress.userName),1),e("span",Rt,o(t.order.userAddress.telNumber??""),1)])]))}}),Nt={class:"p-3 break-all bg-white rounded-xl"},jt={class:"title text-b1 text-sm font-semibold"},Dt={class:"content"},Pt={class:"flex justify-between items-center mt-[16px]"},Ot={class:"text-b3 text-sm font-normal"},Mt={class:"text-b1 text-sm font-normal text-right flex items-center"},Bt=e("div",{class:"flex-shrink-0"},[e("img",{class:"w-[16px] h-[16px]",src:z})],-1),Ft={class:"ml-1"},Vt={key:0,class:"flex justify-between items-center mt-[16px]"},qt={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},Et={class:"text-b1 text-sm font-normal text-right flex items-center"},Lt={class:"mr-1"},Ht=e("div",{class:"flex-shrink-0"},[e("img",{class:"w-[16px] h-[16px]",src:z})],-1),Kt={class:"ml-1"},Ut={key:1,class:"flex justify-between items-center mt-[16px]"},Gt={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},zt={class:"text-b1 text-sm font-normal text-right flex items-center"},Zt=e("div",{class:"mr-1"},"-",-1),Qt=e("div",{class:"flex-shrink-0"},[e("img",{class:"w-[16px] h-[16px]",src:z})],-1),Yt={class:"ml-1"},Jt={class:"flex justify-between items-center mt-[16px]"},Wt={class:"text-b3 text-sm font-normal"},Xt={class:"text-b1 text-sm font-normal text-right flex items-center"},es=e("div",{class:"flex-shrink-0"},[e("img",{class:"w-[16px] h-[16px]",src:z})],-1),ts={class:"ml-1"},ss={class:"flex justify-between items-center mt-[16px]"},os={class:"text-b3 text-sm font-normal"},ns={class:"text-b1 text-sm font-normal text-right"},rs={class:"flex items-center"},as={class:"flex justify-between items-center mt-[16px]"},is={class:"text-b3 text-sm font-normal"},ls=["href"],ds=e("img",{src:tt,class:"w-5 h-5 ml-1",alt:""},null,-1),cs={key:1},us={class:"flex justify-between items-center mt-[16px]"},ms={class:"text-b3 text-sm font-normal"},fs=e("img",{src:q,class:"w-5 h-5 ml-1",alt:""},null,-1),hs={key:2,class:"flex justify-between items-center mt-[16px]"},ps={class:"text-b3 text-sm font-normal"},xs={class:"text-b1 text-sm font-normal text-right"},vs={key:3,class:"flex justify-between items-center mt-[16px]"},bs={class:"text-b3 text-sm font-normal"},ys={class:"text-b1 text-sm font-normal text-right"},ws={key:4,class:"flex justify-between items-center mt-[16px]"},_s={class:"text-b3 text-sm font-normal"},gs={class:"text-b1 text-sm font-normal text-right"},$s={key:5,class:"flex justify-between items-center mt-[16px]"},ks={class:"text-b3 text-sm font-normal"},Cs={class:"text-b1 text-sm font-normal text-right"},Ts={key:6,class:"flex justify-between items-center mt-[16px]"},Is={class:"text-b3 text-sm font-normal whitespace-nowrap"},As={class:"text-b1 text-sm font-normal text-right flex items-center"},Rs={class:"break-all flex-1"},Ss=e("img",{src:q,class:"w-5 h-5",alt:""},null,-1),Ns=[Ss],js={key:7,class:"flex justify-between items-center mt-[16px]"},Ds=e("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 发货物流公司 ",-1),Ps={class:"text-b1 text-sm font-normal text-right break-all"},Os={key:8,class:"flex justify-between items-center mt-[16px]"},Ms=e("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 发货运单号 ",-1),Bs={class:"text-b1 text-sm font-normal text-right flex items-center"},Fs={class:"break-all flex-1"},Vs=e("img",{src:q,class:"w-5 h-5",alt:""},null,-1),qs=[Vs],Es={key:9,class:"flex justify-between items-center mt-[16px]"},Ls=e("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 退货物流公司 ",-1),Hs={class:"text-b1 text-sm font-normal text-right break-all"},Ks={key:10,class:"flex justify-between items-center mt-[16px]"},Us=e("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 退货运单号 ",-1),Gs={class:"text-b1 text-sm font-normal text-right flex items-center"},zs={class:"break-all flex-1"},Zs=e("img",{src:q,class:"w-5 h-5",alt:""},null,-1),Qs=[Zs],Ys={props:{order:{type:Object,required:!0}},setup(t){const x=t,{t:m}=B(),I=C(()=>{let i=0;return i=new Oe(x.order.totalAmount||0),V(i)}),p=C(()=>{var l;const i=x.order.orderGoods||[];return i.length>0?i[0].discountRatio||0:((l=x.order.stores)==null?void 0:l.discountRatio)||0});return(i,l)=>{var w,y,_,u,s;return d(),v("div",Nt,[e("div",jt,o(i.$t("order.orderInfo")),1),e("div",Dt,[e("div",Pt,[e("div",Ot,o(i.$t("order.total price detail")),1),e("div",Mt,[Bt,e("div",Ft,o(r(V)(t.order.totalAmountOriginal||t.order.totalAmount)),1)])]),t.order.merchantAdjustAmount?(d(),v("div",Vt,[e("div",qt,o(i.$t("order.merchant modify price")),1),e("div",Et,[e("div",Lt,o(t.order.merchantAdjustAmount>0?"+":"-"),1),Ht,e("div",Kt,o(Math.abs(t.order.merchantAdjustAmount)||0),1)])])):h("",!0),t.order.fmGeneralActivity&&t.order.activityReduceAmount?(d(),v("div",Ut,[e("div",Gt,o(((w=t.order.fmGeneralActivity)==null?void 0:w.name)||"-"),1),e("div",zt,[Zt,Qt,e("div",Yt,o(r(V)(t.order.activityReduceAmount)),1)])])):h("",!0),e("div",Jt,[e("div",Wt,o(i.$t("order.total price actual")),1),e("div",Xt,[es,e("div",ts,o(r(I)),1)])]),e("div",ss,[e("div",os,o(i.$t("common.ratio")),1),e("div",ns,[e("div",rs,o(r(p))+"%",1)])]),e("div",as,[e("div",is,o(i.$t("order.hash")),1),t.order.hash?(d(),v("a",{key:0,class:"text-sm font-normal text-right flex items-center underline text-[#FF8812]",href:`${r(Ze).chainConfig.blockExplorerUrls[0]}/tx/${t.order.hash}`},[D(o(r(fe)(t.order.hash,"***",9,5)||"--")+" ",1),ds],8,ls)):(d(),v("span",cs," -- "))]),e("div",us,[e("div",ms,o(i.$t("order.payAddress")),1),e("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:l[0]||(l[0]=a=>r(F)(t.order.address))},[D(o(r(fe)(t.order.address,"...",5,5))+" ",1),fs])]),t.order.createTime?(d(),v("div",hs,[e("div",ps,o(i.$t("order.createTime")),1),e("div",xs,o(r(K)(t.order.createTime)),1)])):h("",!0),t.order.chainCreateTime?(d(),v("div",vs,[e("div",bs,o(i.$t("order.chainFinishTime")),1),e("div",ys,o(r(K)(t.order.chainCreateTime)),1)])):h("",!0),t.order.expressTime?(d(),v("div",ws,[e("div",_s,o(i.$t("order.expressTime")),1),e("div",gs,o(r(K)(t.order.expressTime)),1)])):h("",!0),t.order.finishTime?(d(),v("div",$s,[e("div",ks,o(i.$t("order.finishTime")),1),e("div",Cs,o(r(K)(t.order.finishTime)),1)])):h("",!0),t.order.id?(d(),v("div",Ts,[e("div",Is,o(i.$t("order.orderNumber")),1),e("div",As,[e("div",Rs,o(t.order.id),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:l[1]||(l[1]=a=>r(F)(t.order.id))},Ns)])])):h("",!0),t.order.expressCompany?(d(),v("div",js,[Ds,e("div",Ps,o(t.order.expressCompany),1)])):h("",!0),t.order.expressNo?(d(),v("div",Os,[Ms,e("div",Bs,[e("div",Fs,o(t.order.expressNo),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:l[2]||(l[2]=a=>r(F)(t.order.expressNo))},qs)])])):h("",!0),(y=t.order.refundInfo)!=null&&y.expressCompany?(d(),v("div",Es,[Ls,e("div",Hs,o((_=t.order.refundInfo)==null?void 0:_.expressCompany),1)])):h("",!0),(u=t.order.refundInfo)!=null&&u.expressNo?(d(),v("div",Ks,[Us,e("div",Gs,[e("div",zs,o((s=t.order.refundInfo)==null?void 0:s.expressNo),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:l[3]||(l[3]=a=>{var c;return r(F)((c=t.order.refundInfo)==null?void 0:c.expressNo)})},Qs)])])):h("",!0)])])}}},Js={key:0,class:"p-3 break-all bg-white rounded-xl"},Ws={class:"font-semibold text-base text-b1"},Xs={class:"text-[#FF8812] mr-1"},eo=e("span",null,"后可确认收货",-1),to=e("div",{class:"mt-1 font-normal text-sm text-b2"},"请关注订单状态",-1),so={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone"],setup(t,{emit:x}){const m=t,{t:I}=B(),p=S(Date.now());let i=null;const l=C(()=>{const u=G(m.order.expressTime,m.order.confirmLimit,m.nowTime);return u>0?u*1e3:0}),w=C(()=>l.value>0),y=C(()=>{const u=be(l.value).unix();if(u<=0)return"00秒";const s=Math.floor(u/(1e3*60*60*24)),a=Math.floor(u%(1e3*60*60*24)/(1e3*60*60)),c=Math.floor(u%(1e3*60*60)/(1e3*60)),f=Math.floor(u%(1e3*60)/1e3);let b="";return s>0&&(b+=`${s}天`),(a>0||s>0)&&(b+=`${a.toString().padStart(2,"0")}时`),(c>0||a>0||s>0)&&(b+=`${c.toString().padStart(2,"0")}分`),b+=`${f.toString().padStart(2,"0")}秒`,b}),_=()=>{p.value=Date.now(),l.value<=0&&i&&(clearInterval(i),i=null,x("timeDone"))};return X(()=>{_(),l.value>0&&(i=setInterval(_,1e3))}),ye(()=>{i&&(clearInterval(i),i=null)}),(u,s)=>r(w)?(d(),v("div",Js,[e("div",Ws,[e("span",Xs,o(r(y)),1),eo]),to])):h("",!0)}},oo={class:"flex justify-between items-center gap-3 mt-5 fixed left-0 right-0 bottom-0 safe-bottom px-3"},no=e("span",{class:"whitespace-nowrap"},"收到退回商品确认退款",-1),ro={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0},shopAddress:{type:String,default:null},btnLoading:{type:Boolean,default:!1}},emits:["handleTo","handleConfirm","handleModifyPrice","handleRefresh"],setup(t,{emit:x}){const m=t,{t:I}=B(),{accountStore:p}=W();W(),_e();const i=C(()=>(m.order.status===1||m.order.status===2)&&m.order.payType!=2&&!m.order.merchantsConfirm&&!st(m.order,"MERCHANT_RECEIVE","visible")),l=C(()=>{const a=m.order||{};return Ue(a)}),w=C(()=>{const a=m.order||{};return Ge(a)}),y=C(()=>{const a=m.order||{};return ze(a)}),_=()=>{if(p.isOnlyView)return $($t("order.Requires merchant account operation"));x("handleConfirm",m.order)},u=()=>{if(p.isOnlyView)return $($t("order.Requires merchant account operation"));x("handleMerchantReceive",m.order)},s=()=>{if(p.isOnlyView)return $($t("order.Requires merchant account operation"));x("handlePlatformIntervene",m.order)};return(a,c)=>{const f=U("VanButton");return d(),v("div",oo,[!r(p).isOnlyView&&t.order.status===0&&!t.order.hash?(d(),k(f,{key:0,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:c[1]||(c[1]=M(b=>r(p).isOnlyView?r($)(a.$t("order.Requires merchant account operation")):a.$emit("handleModifyPrice"),["stop"])),disabled:t.order.hash},{default:j(()=>[D(o(a.$t("order.modifyPrice"))+" ",1),R(ot,{class:"inline-block ml-1",startTime:t.order.createTime,duration:15,durationType:"minutes",showZero:!1,onDone:c[0]||(c[0]=b=>a.$emit("handleRefresh"))},null,8,["startTime"])]),_:1},8,["disabled"])):h("",!0),!r(p).isOnlyView&&r(i)?(d(),k(f,{key:1,round:"",class:"flex-1 gray-btn border-btn font-normal text-base h-[46px] rounded-full",loading:t.btnLoading,onClick:c[2]||(c[2]=M(b=>r(p).isOnlyView?r($)(a.$t("order.Requires merchant account operation")):a.$emit("handleCancel"),["stop"]))},{default:j(()=>[D(o(a.$t("order.cancelOrder")),1)]),_:1},8,["loading"])):h("",!0),!r(p).isOnlyView&&t.order.status===1?(d(),k(f,{key:2,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:c[3]||(c[3]=M(b=>r(p).isOnlyView?r($)(a.$t("order.Requires merchant account operation")):a.$emit("handleDelivery"),["stop"]))},{default:j(()=>[D(o(a.$t("order.Ship")),1)]),_:1})):h("",!0),r(l)?(d(),k(f,{key:3,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",disabled:r(G)(t.order.expressTime,t.order.confirmLimit,t.nowTime)>0,loading:t.order.loading,onClick:M(_,["stop"])},{default:j(()=>[D(o(a.$t("order.confirmGeted")),1)]),_:1},8,["disabled","loading","onClick"])):h("",!0),r(y)?(d(),k(f,{key:4,round:"",class:"flex-1 gray-btn border-btn font-normal text-base h-[46px] rounded-full",loading:t.btnLoading,onClick:M(s,["stop"])},{default:j(()=>[D(o(a.$t("order.Platform intervention")),1)]),_:1},8,["loading","onClick"])):h("",!0),r(w)?(d(),k(f,{key:5,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",loading:t.order.loading||t.btnLoading,onClick:M(u,["stop"])},{default:j(()=>[no]),_:1},8,["loading","onClick"])):h("",!0)])}}},ao={key:0,class:"p-3 break-all bg-white rounded-xl"},io={class:"font-semibold text-base text-b1"},lo={class:"mt-1 font-normal text-sm text-b2"},co={props:{order:{type:Object,required:!0}},setup(t){return(x,m)=>t.order.status===0?(d(),v("div",ao,[e("div",io,[e("span",null,o(x.$t("order.seller count down label 1")),1)]),e("div",lo,[e("span",null,o(x.$t("order.seller count down label 2")),1)])])):h("",!0)}},ge=t=>(Fe("data-v-77d0f6f8"),t=t(),Ve(),t),uo={class:"popup-header"},mo={class:"title text-base font-semibold text-b1 whitespace-nowrap"},fo={class:"popup-body"},ho={class:"gap-1 text-sm flex justify-between w-full"},po={class:"text-b2 font-normal text-sm whitespace-nowrap"},xo={class:"flex items-center gap-1 text-b1 text-sm font-normal"},vo=["src"],bo={class:""},yo=ge(()=>e("div",{class:"divider"},null,-1)),wo={class:"gap-1 text-sm flex justify-between w-full"},_o={class:"text-b2 font-normal text-sm whitespace-nowrap"},go={class:"flex items-center gap-1 text-b1 text-sm font-normal"},$o=["src"],ko={class:""},Co=ge(()=>e("div",{class:"divider"},null,-1)),To={class:"gap-1 text-sm flex justify-between w-full"},Io={class:"text-b2 font-normal text-sm whitespace-nowrap"},Ao={class:"flex items-center justify-end text-b1 text-sm font-normal"},Ro=["placeholder","disabled"],So={class:"popup-footer w-full mt-4"},No=ee({props:{show:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},order:{type:Object,default:()=>{}}},emits:["update:show","submit"],setup(t,{expose:x,emit:m}){const I=t,{t:p}=B(),i=S(!1),l=S(null);me(()=>I.show,s=>{i.value=s,l.value=null},{immediate:!0}),me(()=>i.value,s=>{m("update:show",s)});const w=()=>{i.value=!1,l.value=0},y=s=>{const a=s.target;let c=a.value;c=c.replace(/[^\d.]/g,"");const f=c.split(".");f.length>2&&(c=f[0]+"."+f.slice(1).join("")),c.indexOf("-")>0&&(c=c.replace(/-/g,"")),f.length===2&&f[1].length>8&&(c=f[0]+"."+f[1].substring(0,8)),l.value=c,a.value=c},_=s=>{const a=s.key,c=s.target.value,f=/[\d.-]/,b=["Backspace","Delete","Tab","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];if(!f.test(a)&&!b.includes(a)){s.preventDefault();return}if(a==="."&&c.includes(".")){s.preventDefault();return}if(a==="-"&&c.length>0){s.preventDefault();return}},u=()=>{m("submit",l.value)};return x({onClose:w}),(s,a)=>{const c=U("van-icon"),f=U("VanButton"),b=U("van-popup");return d(),k(b,{show:i.value,"onUpdate:show":a[1]||(a[1]=P=>i.value=P),position:"bottom",round:"",style:{width:"100%",borderRadius:"20px 20px 0 0"}},{default:j(()=>[e("div",uo,[e("span",mo,o(s.$t("order.modifyPrice")),1),R(c,{name:"cross",class:"close-icon",onClick:w})]),e("div",fo,[e("div",ho,[e("div",po,o(s.$t("order.rigin price")),1),e("div",xo,[e("img",{src:r(he)("images/tokens/MCOIN.png"),class:"w-5"},null,8,vo),e("span",bo,o(r(V)(t.order.totalAmountOriginal||0)),1)])]),yo,e("div",wo,[e("div",_o,o(s.$t("order.last price")),1),e("div",go,[e("img",{src:r(he)("images/tokens/MCOIN.png"),class:"w-5"},null,8,$o),e("span",ko,o(r(V)(t.order.totalAmount||0)),1)])]),Co,e("div",To,[e("div",Io,o(s.$t("order.new price")),1),e("div",Ao,[Me(e("input",{type:"text",placeholder:s.$t("order.new price placeholder"),class:"text-right text-[#FF8812] text-sm font-normal max-w-[150px]","onUpdate:modelValue":a[0]||(a[0]=P=>l.value=P),disabled:t.loading,onInput:y,onKeypress:_},null,40,Ro),[[Be,l.value]])])])]),e("div",So,[R(f,{round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full w-full",loading:t.loading,onClick:u},{default:j(()=>[D(o(s.$t("common.confirm")),1)]),_:1},8,["loading"])])]),_:1},8,["show"])}}}),jo=we(No,[["__scopeId","data-v-77d0f6f8"]]),Do={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},Po={class:"font-bold text-base text-b1"},Oo={class:"px-3 safe-bottom pt-[50px] flex flex-col gap-3"},Mo=ee({setup(t){const{getCurrentStoreId:x}=_e(),{getMerchantDhKey:m,decryptAddressKey:I,decryptKey:p}=Qe(),{cancel:i}=pe(),{clerkStore:l}=W(),w=qe(),y=He(),{t:_}=B(),u=w.query.id,s=S(null),a=S(!1),c=n=>{const g=n.target.scrollTop;a.value=g>25},f=async()=>{var g,T,N,L,re,ae,ie,le,de,ce;const n=await at({id:u});if((g=n.data)!=null&&g.userAddress&&(n.data.userAddress.postscript=n.data.postscript),(T=n.data)!=null&&T.userAddress&&((L=(N=n.data)==null?void 0:N.userAddress)!=null&&L.encryptFlag)){const A=await m((re=n.data)==null?void 0:re.address,(ae=n.data)==null?void 0:ae.submitUserPubKey);A&&(n.data.userAddress=I(n.data.userAddress,A))}if(n.data.shippingHash){const A=await m(n.data.address,(ie=n.data)==null?void 0:ie.shippingUserPubKey);if(A){const ue=p(n.data.expressNo,A);ue.hash===n.data.shippingHash&&(n.data.expressNo=ue.decrypt,n.data.expressCompany=p(n.data.expressCompany,A).decrypt)}}if((le=n.data.refundInfo)!=null&&le.shippingHash){const A=await m(n.data.address,(ce=(de=n.data)==null?void 0:de.refundInfo)==null?void 0:ce.shippingUserPubKey);A&&(n.data.refundInfo.expressNo=p(n.data.refundInfo.expressNo,A).decrypt,n.data.refundInfo.expressCompany=p(n.data.refundInfo.expressCompany,A).decrypt)}s.value=n.data},b=n=>{y.push(n)},P=()=>{f()},O=S(new Date().getTime()/1e3);Ee(()=>{O.value+=1},1e3);const{merchantConfirm:$e}=pe(),ke=async n=>{if(l.isClerk&&!l.clerkAuth)return $(_("order.Requires merchant account operation"));n.loading=!0;try{const T=(await xe({orderIds:n.id})).data.ordIds,N=await $e(T);if(!N.success)return;if(n.payType!==lt.STORE_CARD){if(!(await ve({ordIds:T,hash:N.result.hash})).success)return;n.merchantsConfirm=1,$.success(_("order.confirmSuccess")),setTimeout(()=>{y.replace({path:"/sellerOrderList",query:{type:1,active:3}})},2e3)}}finally{n.loading=!1}},te=S(null),[Ce,se]=H(!1),[Te,Z]=H(!1),oe=()=>{Z(!0)},Ie=async n=>{if(!n){$.fail("请输入修改后的价格");return}if(n<=0){$.fail("价格不能小于0");return}se(!0);const g=await it({orderId:s.value.id,amount:n});se(!1),g.success&&($.success("修改价格成功"),Z(!1),sessionStorage.setItem("modifiedOrderId",s.value.id.toString()),f())},Ae=()=>{y.push(`/sellerDelivery?id=${s.value.id}&detail=1`)},Re=()=>{w.params.quick==="quackChange"&&oe()},[Q,ne]=H(!1),[Se,E]=H(!1),Ne=async()=>{if(l.isClerk&&!l.clerkAuth)return $(_("order.Requires merchant account operation"));J.value=!1,!Q.value&&(s.value.creditFlag?E(!0):Y())},Y=async()=>{ne(!0);try{const g=(await xe({orderIds:u})).data.ordIds;if(J.value&&!(await dt({orderId:u,type:1})).success)return;const T=await i(g);if(!T.success||!(await ve({ordIds:g,hash:T.result.transactionHash})).success)return;E(!1),f(),setTimeout(()=>{y.push({path:"/sellerOrderList",query:{active:4},replace:!0})},500)}catch(n){$(n.message||n)}finally{ne(!1)}},J=S(!1),je=async()=>{try{J.value=!0,s.value.creditFlag?E(!0):Y()}catch(n){$(n.message||n)}},De=async n=>{b("/refundService?&role=merchants&id="+n.id)};return X(async()=>{var n;O.value=await Ye(),await f(),te.value=(n=await x())==null?void 0:n.merchant,Re()}),(n,g)=>s.value?(d(),v("div",{key:0,class:"font-Puhui main-bg safe-bottom-page",onScroll:c},[e("section",{class:Le(["header-bar fixed top-0 left-0 right-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 backdrop-blur-md transition-all duration-300",{"bg-white":a.value}])},[e("div",Do,[R(nt)]),e("div",Po,[e("span",null,o(n.$t("order.orderDetail")),1)])],2),e("section",Oo,[R(_t,{"now-time":O.value,order:s.value,onTimeDone:P},null,8,["now-time","order"]),s.value.status===2&&r(G)(s.value.expressTime,s.value.confirmLimit,O.value)>0&&!s.value.refundInfo?(d(),k(so,{key:0,order:s.value,"now-time":O.value,onTimeDone:P},null,8,["order","now-time"])):h("",!0),s.value.status===0&&!s.value.hash?(d(),k(co,{key:1,order:s.value},null,8,["order"])):h("",!0),R(St,{order:s.value},null,8,["order"]),R(Je,{order:s.value},null,8,["order"]),R(We,{order:s.value,"show-price":!1,"show-shipping-template":!0},null,8,["order"]),s.value.status===0&&!s.value.hash?(d(),k(Xe,{key:2,order:s.value},null,8,["order"])):h("",!0),s.value.status!==0||s.value.hash?(d(),k(Ys,{key:3,order:s.value},null,8,["order"])):h("",!0),s.value.id&&s.value.status===0?(d(),k(et,{key:4,order:s.value},null,8,["order"])):h("",!0),s.value.status==0&&s.value.hash?h("",!0):(d(),k(ro,{key:5,order:s.value,"now-time":O.value,"shop-address":te.value,btnLoading:r(Q),onHandleTo:b,onHandleConfirm:ke,onHandleModifyPrice:oe,onHandleRefresh:f,onHandleDelivery:Ae,onHandleCancel:Ne,onHandleMerchantReceive:je,onHandlePlatformIntervene:De},null,8,["order","now-time","shop-address","btnLoading"]))]),R(jo,{ref:(T,N)=>{N.changePriceRef=T},show:r(Te),loading:r(Ce),onClose:g[0]||(g[0]=T=>r(Z)(!1)),order:s.value,onSubmit:Ie},null,8,["show","loading","order"]),R(rt,{order:s.value,show:r(Se),type:"1",onClose:g[1]||(g[1]=T=>r(E)(!1)),loading:r(Q),onHandleSubmit:Y},null,8,["order","show","loading"])],32)):h("",!0)}}),ln=we(Mo,[["__scopeId","data-v-1f7bb28d"]]);export{ln as default};

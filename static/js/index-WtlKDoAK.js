import{_ as xe}from"./kefu-DRX49rvc.js";import{_ as oe,y as M,x as j,F as n,G as a,X as d,P as $,R as G,Q as _,H as s,I as O,J as le,w as ne,K as m,O as B,a1 as be,a4 as we,T as H,a2 as Te,l as $e,r as c,a8 as _e,z as ee,bh as Ce,D as Ie,E as U,N as E,Z as Le,$ as Se}from"./vendor-BlU_hoYl.js";import{e as qe,v as Ae,g as Re,a7 as Ne,bo as De,r as Be,a8 as Ge,X as ze,bp as Ee,bq as Me,aL as Ue,bd as je}from"./index-Clz0Qna-.js";import{a as Oe}from"./shop-CeqcS6K2.js";import{_ as Fe}from"./buy-cart-m4kq4Bzt.js";import{_ as Pe}from"./BoutiqueLable-negN2DKs.js";import{R as te}from"./RatioBox-CfBlBgLi.js";import{_ as Ve}from"./ShopMaskTips-CxJi-SfW.js";import{_ as ae}from"./GoodsPrice-BNTIqb2J.js";import{_ as se}from"./CardPrice-CwWzcSMy.js";import{D as He}from"./goods-BVwS8oFG.js";import{M as Ke}from"./MallTabBar-CIYGM8Fg.js";import{B as Xe}from"./BackIcon-8hcEjDKb.js";import{a as Ye}from"./category-5QTDC8Db.js";import{b as Je}from"./mall-tuLNpwbe.js";import{_ as Qe}from"./DefaultPage-DQXPcwhv.js";import{H as We}from"./HomeGoodsItem-C929Vd0g.js";import"./MCOIN-Bodfn-v1.js";import"./store-odfdGeH-.js";import"./useCityMap-L2xSDWSa.js";import"./ImgBoutiqueLable-BIio6fYG.js";const Ze=""+new URL("../images/flashSale-DOaFK4_-.png",import.meta.url).href,et=""+new URL("../images/unflashSale-CjYqec_P.png",import.meta.url).href,tt={class:"relative z-20 whitespace-nowrap flex justify-center gap-16 px-12 py-2.5 overflow-hidden bg-white rounded-t-lg sort-shadow text-black-400 text-sm font-normal"},at={class:"flex items-center gap-1"},st={key:0,class:"w-4 h-4",src:Ze},ot={key:1,class:"w-4 h-4",src:et},lt=M({props:{deliveryType:null},emits:["change"],setup(e,{emit:f}){const{useShopStore:i}=qe(),b=j(()=>i.shopMenus&&i.shopMenus.includes(4)),q=j(()=>i.shopMenus&&i.shopMenus.includes(3));return(o,r)=>(a(),n("div",tt,[$(b)?(a(),n("div",{key:0,class:G({active:e.deliveryType===1}),onClick:r[0]||(r[0]=p=>f("change",1))},_(o.$t("common.send")),3)):d("",!0),$(b)?(a(),n("div",{key:1,class:G({active:e.deliveryType===2}),onClick:r[1]||(r[1]=p=>f("change",2))},_(o.$t("shop.offline server")),3)):d("",!0),$(q)?(a(),n("div",{key:2,class:G({active:e.deliveryType===3}),onClick:r[2]||(r[2]=p=>f("change",3))},[s("div",at,[e.deliveryType===3?(a(),n("img",st)):(a(),n("img",ot)),s("span",null,_(o.$t("order.onesale order")),1)])],2)):d("",!0)]))}}),nt=oe(lt,[["__scopeId","data-v-3069830c"]]),it={class:"relative w-[100px] h-full overflow-hidden border-solid border-r-2 border-primary-008"},rt={class:"w-[98px] h-full overflow-y-auto flex flex-col gap-2 py-4"},dt=["onClick"],ct={class:"font-normal leading-6 text-center"},ut=M({props:{list:{default:()=>[]},flashSaleList:{default:()=>[]},classId:{default:null},shopId:null,deliveryType:null},emits:["change"],setup(e,{emit:f}){const i=e,{currentLocale:b}=Ae(),q=j(()=>i.deliveryType===3?i.flashSaleList.map(o=>({...o,name:o[`${Oe[b.value]}Name`]})):i.list.filter(o=>+o.type==+i.deliveryType||!o.type));return(o,r)=>(a(),n("div",it,[s("div",rt,[(a(!0),n(O,null,le($(q),p=>(a(),n("div",{class:G(["relative py-1.5 pl-4 pr-2 text-sm text-black-400",{"text-black-800 bg-primary-008":e.classId===p.id}]),key:p.id,onClick:z=>f("change",p.id)},[s("span",ct,_(p.name),1)],10,dt))),128))])]))}}),vt=""+new URL("../images/offline-black-OiwvbEll.svg",import.meta.url).href,mt=""+new URL("../images/cart-icon-ibBU6cSG.svg",import.meta.url).href,yt=""+new URL("../images/Rob-CY-NIaX_.png",import.meta.url).href,ft=""+new URL("../images/Robed-BOyO2jaS.png",import.meta.url).href,pt={class:"flex items-start justify-between"},ht={class:"w-[90px] h-[90px] relative"},gt=["src"],kt={class:"text-sm flex items-center mb-1.5 relative"},xt={class:"text-sm flex-1 w-0 font-semibold leading-[0.875rem] truncate text-default mr-1"},bt={class:"flex items-center"},wt={class:"flex-1"},Tt={class:"mb-2 text-xs leading-normal line-clamp-1 text-black-400"},$t={key:0,class:"flex items-center gap-1"},_t={class:"inline-flex bg-[#FED73A] items-center gap-1 px-1.5 py-1 text-xs font-bold rounded bg-ratio text-black no-wrap"},Ct=s("img",{class:"w-[1rem] h-[1rem]",src:vt},null,-1),It={key:1,class:"text-sm font-bold"},Lt={class:"flex items-end mt-1"},St=["onClick"],qt={key:0,class:"w-6 h-6",src:mt},At={key:1,class:"w-6 h-6",src:Fe},Rt={key:1,class:"flex w-full"},Nt={key:0,class:"text-sm font-bold"},Dt={class:"ml-auto"},Bt={key:0,class:"w-5 h-5 mr-2",src:yt},Gt={key:1,class:"w-5 h-5 mr-2",src:ft},zt=s("div",{class:"flex items-center h-2.5"},[s("div",{class:"h-[1px] w-full bg-black-100"})],-1),Et=M({props:{data:null,deliveryType:null},emits:["handleAddCart","click"],setup(e,{emit:f}){const i=e,{t:b}=ne(),q=async()=>{if(i.data.goods.stock===0&&i.data.goods.goodsTypes!=2){H(b("order.Insufficient stock"));return}i.data.goods.deliveryType===1?f("handleAddCart",i.data.goods):f("click")};return(o,r)=>(a(),n(O,null,[e.data.goods?(a(),n("div",{key:0,class:"w-full py-3 bg-white rounded",onClick:r[0]||(r[0]=p=>f("click"))},[s("section",pt,[s("div",ht,[(e.data.goods.status!=1||!+e.data.goods.stock)&&e.deliveryType!==3&&e.data.goods.goodsTypes!=2?(a(),m(Ve,{key:0,status:e.data.goods.status,stock:e.data.goods.stock},null,8,["status","stock"])):d("",!0),s("img",{src:e.data&&e.data.goods&&e.data.goods.icons&&e.data.goods.icons.split(",")[0]||$(Re)("images/activity/boutique/squre_empty.png"),class:"rounded w-[90px] h-[90px] aspect-square object-cover"},null,8,gt)]),s("section",{class:G(["flex-1 min-h-[90px] ml-2 flex flex-col",{" justify-between":e.deliveryType==3}])},[s("div",kt,[e.data.goods.type?(a(),m(Pe,{key:0,type:e.data.goods.type,class:"flex-shrink-0 mr-1"},null,8,["type"])):d("",!0),s("div",xt,_(e.data.goods.goodsName),1)]),s("div",bt,[s("div",wt,[s("div",Tt,_(e.data.goods.goodsDesc),1),e.deliveryType===2?(a(),n("div",$t,[s("div",_t,[Ct,be(" "+_(o.$t("common.offline")),1)]),B(te,{ratio:e.data.goods.discountRatio},null,8,["ratio"])])):d("",!0),e.deliveryType!==3?(a(),n("div",It,[e.data.goods.payType!==2?(a(),m(ae,{key:0,color:"#000000",class:"mt-1.5 text-base",price:e.data.goods.price},null,8,["price"])):d("",!0),e.data.goods.payType===2||e.data.goods.payType===3?(a(),m(se,{key:1,color:"#000000",class:"mt-1.5 text-base",price:e.data.goods.cardPrice,symbol:e.data.card&&e.data.card.symbol},null,8,["price","symbol"])):d("",!0)])):d("",!0)])]),s("div",Lt,[s("div",null,[e.data.goods.payType!==2&&Number(e.data.goods.deliveryType)===$(He).online&&e.deliveryType!=3?(a(),m(te,{key:0,class:"flex-shrink-0",tag:o.$t("common.rebate"),ratio:e.data.goods.discountRatio||0},null,8,["tag","ratio"])):d("",!0)]),e.deliveryType!=3?(a(),n("div",{key:0,onClick:we(q,["stop"]),class:"px-1.5 ml-auto"},[e.data.goods.deliveryType===1?(a(),n("img",qt)):(a(),n("img",At))],8,St)):(a(),n("div",Rt,[e.deliveryType===3?(a(),n("div",Nt,[e.data.goods.payType!==2?(a(),m(ae,{key:0,price:e.data.goods.price},null,8,["price"])):d("",!0),e.data.goods.payType===2||e.data.goods.payType===3?(a(),m(se,{key:1,class:"ml-auto",price:e.data.goods.cardPrice,symbol:e.data.card&&e.data.card.symbol},null,8,["price","symbol"])):d("",!0)])):d("",!0),s("div",Dt,[+e.data.goods.status>=15?(a(),n("img",Bt)):(a(),n("img",Gt))])]))])],2)])])):d("",!0),zt],64))}}),ie=e=>(Le("data-v-98da3930"),e=e(),Se(),e),Mt={class:"z-50 overflow-y-auto parent-view mall-header-bg"},Ut={class:"sticky top-0 z-50 text-sm font-normal mall-header-bg"},jt={class:"flex relative justify-center items-center h-[44px] px-2.5"},Ot={class:"absolute left-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},Ft={class:"font-semibold"},Pt=ie(()=>s("img",{class:"w-5 h-5",src:xe},null,-1)),Vt=[Pt],Ht={class:"px-2.5 sticky top-[44px]"},Kt={key:0,class:"bg-gradient-7 text-white px-2.5 py-0.5 text-xxs leading-normal rounded-xl"},Xt=ie(()=>s("div",{class:"h-[16px]"},null,-1)),Yt={class:"overflow-hidden shadow-box"},Jt={class:"mall-header-bg mall-header-bg-box"},Qt=M({name:"CategoryShopDetail"});function Wt(e){const{t:f}=ne(),i=Te(),b=$e(),q=Ne(),o=c(1);i.query.deliveryType&&(o.value=Number(i.query.deliveryType));const r=j(()=>i.query.shopId||null),p=c(null);p.value=i.query.shopId;const z=c(null),{y:K}=_e(z);ee(()=>r,async t=>{t.value&&t.value!==p.value&&(p.value=t.value,h.value&&(h.value=null),W(),I())},{deep:!0});const h=c(null),re=t=>{h.value!==t&&(h.value=t,I())};ee(()=>i.query.deliveryType,()=>{i.query.deliveryType&&+i.query.deliveryType!=+o.value&&(o.value=Number(i.query.deliveryType),h.value=null,F(),I())},{deep:!0});const y=c(null),de=async()=>{if(!r.value)return;const t=await ze(r.value);!t.success||!t.data||(y.value=t.data,I())},ce=t=>{o.value!==t&&(T.value="",b.replace({path:"category",query:{deliveryType:t,shopId:r.value}}),o.value=t,h.value=null,A.value=[],A.value.unshift({name:"推薦",id:null}),F(),I())},A=c([]),F=async()=>{if(o.value===2){try{const{success:l,data:k}=await Ee({shopId:r.value});if(!l)return;const u=(k||[]).filter(R=>R.goodsCount>0).map(R=>({name:R.goodsCategoryName,id:R.goodsCategoryId}));u.unshift({name:"推薦",id:null}),A.value=u}catch(l){console.error("获取线下服务类目数据失败:",l),A.value=[]}return}const t=await Ye({address:y.value.merchant});t.success&&(A.value=t.data||[],A.value.unshift({name:"推薦",id:null}))},P=c([]),ue=async()=>{const t=await Me(y.value.merchant);t.success&&(P.value=t.data||[],P.value.unshift({cnName:"推薦",jpName:"推薦する",enName:"recommend",id:null}))},g=c([]),N=c(!1),w=c(!1),C=c(0),V=c(10),D=c(0),ve=c,X=async()=>{!y.value&&r.value||(N.value=!0,C.value+=1,await me(),setTimeout(()=>{N.value=!1},1500))},T=c(""),me=async()=>{if(o.value===2){await ye();return}await fe()},ye=async()=>{var u;let t=null,l=null;h.value===null?(l="desc|goods_sales_volume,asc|goods_id",t=null):(l="asc|goods_id",t=h.value||null);const k={page:C.value,size:V.value,goodsStatus:1,goodsNameLike:T.value,shopId:((u=y.value)==null?void 0:u.id)||"",goodsCategoryId1:t,sortBy:l,distinctFlag:!0},x=await Ue(k);if(N.value=!1,!x.success||!x.data||!x.data.total){w.value=!0,g.value=C.value===1?[]:g.value;return}D.value=x.data.total;const L=x.data.records||[];g.value=C.value===1?L:g.value.concat(L),g.value.length>=D.value&&(w.value=!0)},fe=async()=>{var x,L;const t={page:C.value,size:V.value,status:1,subclassId:h.value,deliveryType:o.value,merchant:(x=y.value)==null?void 0:x.merchant,keyword:T.value};let l=null;if(o.value===3?l=await je({page:C.value,size:V.value,merchant:(L=y.value)==null?void 0:L.merchant,categoryId:h.value?h.value:null,title:T.value}):l=await Je(t),N.value=!1,!l.success){w.value=!0;return}if(!l.data||!+l.total){w.value=!0,g.value=C.value===1?[]:g.value;return}D.value=l.total;const k=c([]);o.value===3?k.value=l.data.map(u=>({goods:{...u,goodsName:u.title,icons:u.mainImageUrls,deliveryType:u.shippingMethod}})):k.value=l.data.map(u=>({goods:u.goods,stores:u.stores||ve,card:u.card})),g.value=C.value===1?k.value:g.value.concat(k.value),g.value.length>=D.value&&(w.value=!0)},{loadingToggle:Y}=Be(),pe=async t=>{if(t.stock===0&&t.goodsTypes!=2){H(f("order.Insufficient stock"));return}Y(!0);const l=await Ge(t.id);Y(!1),l.success&&(H(f("cart.addTips")),q.getCartCount())},J=t=>{b.push(t)},Q=c(null),he=t=>{t.code==="Enter"&&(I(),Q.value.blur())},ge=()=>{T.value="",I()},I=()=>{if(K.value=0,y.value&&+y.value.status!=1){w.value=!0;return}g.value=[],C.value=0,D.value=0,w.value=!1,X()},ke=t=>{let l={};t.goodsId&&(l.goodsId=t.goodsId),t.storeId&&(l.storeId=t.storeId),b.push({path:"/offlineGoodsDetail",query:l})},W=async()=>{if(await de(),y.value&&+y.value.status!=1){w.value=!0;return}T.value="",F(),ue()};return Ce(()=>{z.value&&z.value.scrollTo(0,K.value)}),Ie(()=>{W()}),(t,l)=>{var R,Z;const k=U("van-icon"),x=U("van-field"),L=U("van-sticky"),u=U("VanList");return a(),n("div",Mt,[s("section",Ut,[s("section",jt,[s("div",Ot,[B(Xe,null,{default:E(()=>[s("span",null,_(t.$t("common.return")),1)]),_:1})]),s("div",Ft,_(t.$t("shop.Classification")),1),(R=y.value)!=null&&R.merchant?(a(),n("div",{key:0,onClick:l[0]||(l[0]=v=>{var S;return J(`/shopInfo?address=${(S=y.value)==null?void 0:S.merchant}`)}),class:"absolute right-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},Vt)):d("",!0)]),s("section",Ht,[B(x,{ref:(v,S)=>{S.searchRef=v,Q.value=v},"model-value":T.value,"onUpdate:model-value":l[1]||(l[1]=v=>T.value=v),clearable:"",class:"flex-1 rounded-3xl flex items-center h-[30px] text-black-300",onKeypress:he,placeholder:t.$t("mall.Enter search keywords"),onClear:ge,enterkeyhint:"search"},{"left-icon":E(()=>[T.value?d("",!0):(a(),m(k,{key:0,name:"search",size:"18"}))]),"right-icon":E(()=>[s("div",{onClick:I},[T.value?(a(),m(k,{key:1,name:"search",size:"18"})):(a(),n("div",Kt,_(t.$t("common.search")),1))])]),_:1},8,["model-value","placeholder"])]),Xt]),s("div",Yt,[B(L,{"offset-top":90},{default:E(()=>[s("div",Jt,[B(nt,{deliveryType:o.value,onChange:ce},null,8,["deliveryType"])])]),_:1}),s("div",{class:G(["relative flex bg-white h-[calc(100vh-84px)] overflow-hidden",{"safe-bottom-page":$(r)}])},[B(ut,{shopId:$(r),classId:h.value,list:A.value,flashSaleList:P.value,onChange:re,deliveryType:o.value},null,8,["shopId","classId","list","flashSaleList","deliveryType"]),s("div",{class:"relative flex-1 h-full overflow-y-auto",ref:(v,S)=>{S.listPageRef=v,z.value=v}},[w.value&&D.value===0?(a(),m(Qe,{key:0,title:t.$t("common.No products")},null,8,["title"])):(a(),m(u,{key:1,loading:N.value,"onUpdate:loading":l[2]||(l[2]=v=>N.value=v),finished:w.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:X,class:"px-2.5 py-2.5"},{default:E(()=>[(a(!0),n(O,null,le(g.value,v=>(a(),n(O,null,[o.value!==2?(a(),m(Et,{key:0,data:v,onClick:S=>J(`${o.value==3?"/saleGoodDetail":"/goodsDetail"}?id=${v.goods.id}`),onHandleAddCart:pe,deliveryType:o.value},null,8,["data","onClick","deliveryType"])):(a(),m(We,{key:1,goods:v,class:"mb-4 :last:mb-0 border-b border-gray-200 pb-4 home-goods-item",onClick:S=>ke(v),"show-store-name":""},null,8,["goods","onClick"]))],64))),256))]),_:1},8,["loading","finished","finished-text","loading-text"]))],512)],2)]),$(r)?(a(),m(Ke,{key:0,shopId:$(r),shopType:(Z=y.value)==null?void 0:Z.type},null,8,["shopId","shopType"])):d("",!0),o.value!==3?(a(),m(De,{key:1})):d("",!0)])}}const Zt=M({...Qt,setup:Wt}),ba=oe(Zt,[["__scopeId","data-v-98da3930"]]);export{ba as default};

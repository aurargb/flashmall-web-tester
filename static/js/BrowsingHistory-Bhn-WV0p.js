import{C as mo}from"./CommonVanProvider-CDfGVWR4.js";import{B as fo}from"./BetweenTab-BE6o466J.js";import{_ as R,y as E,l as V,x as F,E as S,F as y,G as n,H as t,O as I,P as f,Q as v,K as h,X as T,a4 as P,Z as A,$ as G,o as po,I as j,J as q,ab as go,w as ho,a2 as _o,bf as vo,r as b,be as J,D as yo,bh as wo,N as D}from"./vendor-BlU_hoYl.js";import{_ as Q}from"./MCOIN-Bodfn-v1.js";import{_ as X}from"./store-odfdGeH-.js";import{_ as W}from"./shop-arrow-right-BMae5SG7.js";import{R as Y}from"./RatioBox-CfBlBgLi.js";import{_ as oo}from"./ImgBoutiqueLable-BIio6fYG.js";import{d as to,N as so,C as xo,a5 as bo,a6 as $o}from"./index-Clz0Qna-.js";import{_ as Co}from"./EmptyTipsPop-DRPu7DDc.js";import"./BackIcon-8hcEjDKb.js";/* empty css                                                               */import"./shop-CeqcS6K2.js";const Io=""+new URL("../images/dark-delete-Bo7Z4RyI.svg",import.meta.url).href,z=o=>(A("data-v-4767cbbe"),o=o(),G(),o),ko=["data-store-name"],Bo={class:"shrink-0 offline-goods-img__wrap w-[60px] h-[60px] overflow-hidden relative"},So={class:"offline-goods-info__wrap ml-2 flex-1 min-h-[60px]",style:{width:"calc(100% - 60px - 8px)"}},To={class:"w-full items-start flex flex-col justify-between h-[60px]"},Eo={class:"w-full"},Lo={class:"font-semibold text-sm line-clamp-1"},Ho={class:"flex items-center justify-start font-Puhui"},No={class:"flex items-center"},Oo=z(()=>t("img",{src:Q,class:"w-4 h-4 mr-1"},null,-1)),Do={class:"text-b1 font-semibold text-sm"},Po=["onClick"],jo={class:"font-normal text-b3 text-sm flex items-center justify-start"},qo=z(()=>t("img",{src:X,class:"w-4 h-4"},null,-1)),Ro={class:"line-clamp-1"},Vo=z(()=>t("img",{src:W,class:"w-4 h-4"},null,-1)),Fo=E({props:{goods:{type:Object,default:()=>({})}},setup(o){const l=o,m=V(),w=F(()=>{var e;return(((e=l.goods.icons)==null?void 0:e.split(","))||[""])[0]}),$=()=>{var e,a;const d=((e=l.goods)==null?void 0:e.id)||((a=l.goods)==null?void 0:a.goodsId);d&&m.push({path:"/goodsDetail",query:{id:d,activated:1}})},r=()=>{var e;const d=(e=l.goods)==null?void 0:e.shopId;d&&m.push({path:"/shop",query:{shopId:d,activated:1}})};return(d,e)=>{const a=S("VanImage");return n(),y("section",{class:"flex items-start bg-white p-3 rounded-xl","data-store-name":o.goods.shopName,onClick:$},[t("div",Bo,[I(a,{src:f(w),class:"offline-goods-img w-[60px] h-[60px] rounded-lg overflow-hidden",alt:"商品主图",fit:"cover"},null,8,["src"]),I(oo,{type:+o.goods.type||null},null,8,["type"])]),t("div",So,[t("div",To,[t("div",Eo,[t("div",Lo,v(o.goods.goodsName||""),1)]),t("div",Ho,[t("div",No,[Oo,t("div",Do,v(f(to)(o.goods.price)),1)]),o.goods.discountRatio?(n(),h(Y,{key:0,class:"ratio-box ml-2 !px-1",tag:d.$t("common.rebate"),ratio:o.goods.discountRatio},null,8,["tag","ratio"])):T("",!0)]),t("div",{class:"w-full",onClick:P(r,["stop"])},[t("div",jo,[qo,t("span",Ro,v(o.goods.storeName||"--"),1),Vo])],8,Po)])])],8,ko)}}}),Ao=R(Fo,[["__scopeId","data-v-4767cbbe"]]),M=o=>(A("data-v-82dd0e16"),o=o(),G(),o),Go=["data-store-name"],zo={class:"shrink-0 offline-goods-img__wrap w-[60px] h-[60px] overflow-hidden relative"},Mo={class:"offline-goods-info__wrap ml-2 flex-1 min-h-[60px]",style:{width:"calc(100% - 60px - 8px)"}},Uo={class:"w-full items-start flex flex-col justify-between h-[60px]"},Zo={class:"w-full"},Jo={class:"font-semibold text-sm line-clamp-1"},Ko={class:"flex items-center justify-start font-Puhui"},Qo={class:"flex items-center"},Xo=M(()=>t("img",{src:Q,class:"w-4 h-4 mr-1"},null,-1)),Wo={class:"text-b1 font-semibold text-sm"},Yo={class:"w-full"},ot={class:"font-normal text-b3 text-sm flex items-center justify-start"},tt=M(()=>t("img",{src:X,class:"w-4 h-4"},null,-1)),st={class:"line-clamp-1"},et=["onClick"],at={key:0},nt=["onClick"],lt=M(()=>t("img",{src:W,class:"w-4 h-4"},null,-1)),it=E({props:{goods:{type:Object,default:()=>({})}},setup(o){const l=o,m=V(),w=F(()=>{var a;return(((a=l.goods.goodsIcons)==null?void 0:a.split(","))||[""])[0]}),$=()=>{var g,k,C;const e=(g=l.goods)==null?void 0:g.goodsId;if(!e)return;let a={};e&&(a.goodsId=e),(k=l.goods)!=null&&k.storeId&&(a.storeId=(C=l.goods)==null?void 0:C.storeId),m.push({path:"/offlineGoodsDetail",query:{...a,activated:1}})},r=()=>{var a;const e=(a=l.goods)==null?void 0:a.shopId;e&&m.push({path:"/shop",query:{shopId:e,activated:1}})},d=()=>{var a;const e=(a=l.goods)==null?void 0:a.storeId;e&&m.push({path:"/storefront",query:{storeId:e,activated:1}})};return(e,a)=>{const g=S("VanImage");return n(),y("section",{class:"flex items-start bg-white p-3 rounded-xl","data-store-name":o.goods.shopName,onClick:$},[t("div",zo,[I(g,{src:f(w),class:"offline-goods-img w-[60px] h-[60px] rounded-lg overflow-hidden",alt:"商品主图",fit:"cover"},null,8,["src"]),I(oo,{type:+o.goods.goodsType||null},null,8,["type"])]),t("div",Mo,[t("div",Uo,[t("div",Zo,[t("div",Jo,v(o.goods.goodsName||""),1)]),t("div",Ko,[t("div",Qo,[Xo,t("div",Wo,v(f(to)(o.goods.goodsPrice)),1)]),o.goods.goodsDiscountRatio?(n(),h(Y,{key:0,class:"ratio-box ml-2 !px-1",tag:e.$t("common.rebate"),ratio:o.goods.goodsDiscountRatio},null,8,["tag","ratio"])):T("",!0)]),t("div",Yo,[t("div",ot,[tt,t("span",st,[t("span",{onClick:P(r,["stop"])},v(o.goods.shopName||""),9,et),o.goods.storeName&&o.goods.shopName?(n(),y("span",at," · ")):T("",!0),t("span",{onClick:P(d,["stop"])},v(o.goods.storeName||""),9,nt)]),lt])])])])],8,Go)}}}),ct=R(it,[["__scopeId","data-v-82dd0e16"]]),rt={class:""},dt={class:"dat__wrap text-sm font-b1 font-normal"},ut={class:"log-list__wrap mt-3"},K={props:{data:{type:Object,default:()=>({})},isOffline:{type:Boolean,default:!1}},setup(o){const l=o,m=F(()=>po().isSame(l.data.day,"day"));return(w,$)=>(n(),y("div",rt,[t("p",dt,v(f(m)?w.$t("common.today"):o.data.day),1),t("div",ut,[(n(!0),y(j,null,q(o.data.goodsList||[],(r,d)=>(n(),y("div",{key:d},[(n(),h(go(o.isOffline?ct:Ao),{goods:r,class:"mb-3 :last:mb-0"},null,8,["goods"]))]))),128))])]))}},mt=o=>so("GET","/goodsLook/history",o),ft=()=>so("POST","/goodsLook/clear",null),pt=o=>(A("data-v-333dbcdd"),o=o(),G(),o),gt=pt(()=>t("img",{class:"w-[20px] h-auto",src:Io},null,-1)),ht=[gt],_t={class:"scrollPage p-3 h-[calc(100vh-83px)] overflow-y-auto"},vt=E({name:"BrowsingHistory"});function yt(o){const{t:l}=ho(),m=V(),w=_o(),$=[{label:l("shop.on-line"),value:1},{label:l("shop.off-line"),value:2}],r=vo({type:Number(w.query.type)||1}),d=s=>{r.type=s||1,m.replace({query:{type:s}}),L()},e=b(!1),a=b(!1),g=b(0),k=b(5),C=b(0),_=b([]),L=()=>{g.value=0,C.value=0,a.value=!1,_.value=[],U()},U=async()=>{e.value=!0,g.value+=1,await eo(),e.value=!1},eo=async()=>{let s=null;if(r.type===1&&(s=await mt({page:g.value,size:k.value})),r.type===2){const u=await bo({page:g.value,size:k.value,sortBy:"desc|create_time"});s={success:u.success,data:u.data.records||[],total:u.data.total||0},s.data&&s.data.forEach(p=>{p.goodsList=p.goodsLooks||[]})}if(!s.success){a.value=!0;return}if(!s.data||!s.total){a.value=!0;return}C.value=s.total;const i=s.data||[];_.value=ao(_.value,i),_.value.length>=C.value&&(a.value=!0)},ao=(s,i)=>{if(g.value===1)return i;const u=[...s];return i.forEach(p=>{const c=u.findIndex(x=>x.day===p.day);c!==-1?u[c].goodsList=[...u[c].goodsList,...p.goodsList]:u.push(p)}),u},[no,H]=J(!1),[lo,N]=J(!1),io=async()=>{let s=null;r.type===1&&(s=await ft()),r.type===2&&(s=await $o()),s.success&&(L(),N(!0)),setTimeout(()=>{N(!1)},1e3)},Z=()=>{H(!1)},co=()=>{io(),H(!1)};let B=null;const ro=async()=>{const s=localStorage.getItem("browsingHistory_scrollTop");+s?(console.log("setCacheScrollTop",+s),B.scrollTo({top:+s,left:0,behavior:"instant"})):localStorage.removeItem("browsingHistory_scrollTop")},O=b(!1),uo=()=>{O.value||(O.value=!0,setTimeout(()=>{localStorage.setItem("browsingHistory_scrollTop",B.scrollTop+""),O.value=!1},500))};return yo(()=>{B=document.querySelector(".scrollPage"),B.addEventListener("scroll",uo)}),wo(()=>{var s,i,u,p;ro(),!(((p=(u=(i=(s=m==null?void 0:m.options)==null?void 0:s.history)==null?void 0:i.state)==null?void 0:u.forward)==null?void 0:p.indexOf("activated=1"))>-1&&_.value.length)&&L()}),(s,i)=>{const u=S("Empty"),p=S("van-list");return n(),h(mo,{title:s.$t("common.browsing history"),class:"bg-gray1 font-Puhui font-normal relative shopGoodsPage","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(c,x)=>{x.browsingHistoryRef=c}},{right:D(()=>[t("div",{onClick:i[0]||(i[0]=c=>f(H)(!0))},ht)]),default:D(()=>[t("div",null,[I(fo,{class:"between-tab__wrap",options:$,"label-key":"label","value-key":"value",modelValue:f(r).type,"onUpdate:modelValue":i[1]||(i[1]=c=>f(r).type=c),onChange:d},null,8,["modelValue"]),t("div",_t,[_.value.length===0&&!e.value?(n(),h(u,{key:0,name:s.$t("common.no records")},null,8,["name"])):(n(),h(p,{key:1,loading:e.value,"onUpdate:loading":i[2]||(i[2]=c=>e.value=c),"finished-text":s.$t("common.noMore"),"loading-text":s.$t("common.loading"),finished:a.value,onLoad:U,"immediate-check":!0},{default:D(()=>[f(r).type===1?(n(!0),y(j,{key:0},q(_.value,(c,x)=>(n(),h(K,{key:x,data:c,isOffline:!1},null,8,["data"]))),128)):(n(!0),y(j,{key:1},q(_.value,(c,x)=>(n(),h(K,{key:x,data:c,isOffline:!0},null,8,["data"]))),128))]),_:1},8,["loading","finished-text","loading-text","finished"]))])]),I(xo,{show:f(no),title:"删除确认",content:"确定要删除全部浏览记录吗？",showConfirm:!0,showReject:!0,rejectText:"取消",confirmText:"确认",onClose:Z,onReject:Z,onConfirm:co,confirmStyle:{background:"#f44",color:"white"}},null,8,["show"]),f(lo)?(n(),h(Co,{key:0,isError:!1,onClose:i[3]||(i[3]=c=>f(N)(!1)),text:"删除成功"})):T("",!0)]),_:1},8,["title"])}}const wt=E({...vt,setup:yt}),Ot=R(wt,[["__scopeId","data-v-333dbcdd"]]);export{Ot as default};

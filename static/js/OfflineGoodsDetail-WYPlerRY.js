import{S as N,G as U,a as V,_ as X,b as Y}from"./ShareGoodPopup-BzlbgEaU.js";import{y as B,bf as J,x as P,z as K,F as S,G as d,H as u,Q as F,P as i,I as M,J as Q,K as g,X as W,bs as Z,_ as A,be as ee,r as m,w as oe,a1 as se,l as te,bj as ae,by as le,D as ne,a2 as I,O as L,R as ie,Y as re,Z as de,T as ue}from"./vendor-Ba70TIw4.js";import{_ as ce}from"./GoodsEvaluateItem-DAuIaSyV.js";import{aG as me,e as pe,r as ge,aH as ve,aI as fe,X as ye,W as he}from"./index-DGR86ePT.js";import{G as Ie,a as we,_ as _e}from"./GoodsInfo-CM9k6ImR.js";import{R as Se}from"./RemovedShelves-I9s0rUiR.js";import{S as be}from"./shop-CeqcS6K2.js";import{O as Te}from"./offlineGoods-DvT2Go6q.js";import{D as G}from"./goods-BVwS8oFG.js";import"./shop-arrow-right-BueA_z4m.js";import"./BoutiqueLabelInLogo-BUC1vRQ4.js";import"./RatioBox-DxAmCY_c.js";import"./kefu-B-s0jZtS.js";import"./goods-BZ-_UyPn.js";import"./convertToImage-Ct2iSnQg.js";import"./browser-DFlSdkZC.js";import"./upload-28Y_C7H9.js";import"./active_empty-ofPcrP74.js";import"./HelpPop-vGyfF3_2.js";import"./MCOIN-BOqZVkND.js";import"./logo-JjZ15zkW.js";import"./BoutiqueLable-RObK-asU.js";import"./flashSale-DDyqLyYN.js";import"./GoodsPrice-9JtLUWL4.js";import"./enums-DlE-aiss.js";import"./BackIcon-DkqwcD_b.js";const xe={class:"relative mb-2 w-full flex justify-center items-center"},$e={class:"text-sm font-semibold text-center"},ke={class:"absolute right-0 top-0 text-[12px] text-[#999999] leading-[20px]"},Fe=B({props:{goodsId:null},emits:["handleTo"],setup(c,{emit:b}){const v=c,a=J({commentList:[],total:0}),T=async()=>{const l=await me({goodsId:v.goodsId,page:1,size:1,commentStatus:1,sortBy:"desc|comment_time"});l.success&&(a.commentList=l.data.records||[],a.total=l.data.total)},f=P(()=>{if(a.commentList&&a.commentList.length>0){const l=[];for(let t=0;t<a.commentList.length;t++)a.commentList[t].commentPics&&a.commentList[t].commentPics.length>0&&l.push(...a.commentList[t].commentPics.split(","));return l}return[]}),x=l=>{const t=f.value.findIndex(e=>e===l);Z({images:f.value,closeable:!0,showIndex:!0,startPosition:t})};return K(()=>v.goodsId,()=>{T()},{immediate:!0}),(l,t)=>(d(),S("div",{class:"p-2.5 mb-2.5 bg-white rounded-xl text-base",onClick:t[0]||(t[0]=e=>b("handleTo",`/offline-evaluate-home?goodsId=${c.goodsId}`))},[u("div",xe,[u("div",$e,F(l.$t("evaluate.Buyer Reviews"))+"（"+F(i(a).total)+"） ",1),u("div",ke,F(l.$t("common.all"))+" > ",1)]),(d(!0),S(M,null,Q(i(a).commentList,(e,n)=>(d(),g(ce,{onImgPre:x,key:e.id,data:e,class:"border-none",style:W(n===i(a).commentList.length-1?"margin-bottom:0":"")},null,8,["data","style"]))),128))]))}}),C=c=>(re("data-v-64cc3f34"),c=c(),de(),c),Le={class:"relative w-full h-full !bg-[#F8F8F8]"},Ge={key:0},Pe=C(()=>u("img",{class:"w-[1.375rem] h-[1.375rem]",src:X},null,-1)),Be=[Pe],De=C(()=>u("img",{class:"w-[1.375rem] h-[1.375rem]",src:Y},null,-1)),Ce=[De],Oe={class:"safe-bottom-page pt-4 px-2.5 bg-[#F8F8F8]"},He=B({name:"GoodsDetail"});function Re(c){const{orderGoodsStore:b}=pe(),[v,a]=ee(!1),T=m(!1),{loadingToggle:f}=ge(),{t:x}=oe(),l=se(),t=te(),e=m(null),n=m(null),$=m(l.query.goodsId),p=P(()=>l.query.storeId),O=P(()=>window.location.origin+"/#/offlineGoodsDetail?goodsId="+$.value+(p.value?`&storeId=${p.value}`:"")),H=async()=>{const o=$.value;if(o==null||o==="")return;let s={id:o};p.value&&(s.storeId=p.value),console.log(s);const r=await fe(s);e.value=r.data,e.value.icons=e.value.goodsIcons,e.value.type=e.value.goodsType,e.value.deliveryType=G.offeline,e.value.price=e.value.goodsPrice},R=async()=>{var r;if(!((r=e.value)!=null&&r.shopId))return;const{success:o,data:s}=await ye(e.value.shopId);o&&(n.value=s)},y=m(null),h=o=>{t.push(o)},q=()=>{ue({message:x("common.Saved successfully"),icon:he("toast-success.svg"),duration:3e3})},z=()=>{try{window.history.state.back?t.back():window.history.length>2?window.history.back():t.replace({path:"/mall"})}catch{t.push("/")}},E=()=>{b.changeOfflineInfo({goods:e.value,store:n.value});let o=`/offlineSubmit?key=${$.value}&orderType=${Te.GOODS}`;p.value&&(o+=`&storeId=${p.value}`),h(o)},D=m(0);let w=m(!0);const k=le(()=>{const o=document.getElementById("fm-page");D.value=o.scrollY||o.scrollTop,D.value<100?(w.value=!1,y.value&&y.value.resumeSwiper()):(w.value=!0,y.value&&y.value.pauseSwiper())},100),j=()=>{document.getElementById("fm-page").addEventListener("scroll",k),k()};return ae(()=>{const o=document.getElementById("fm-page");o&&o.removeEventListener("scroll",k)}),ne(async()=>{j(),f(!0),await H(),await R(),f(!1)}),(o,s)=>(d(),S("div",Le,[e.value&&n.value&&+e.value.goodsStatus==1&&+n.value.status!=3&&+n.value.status!=4&&+n.value.status!=0?(d(),S("div",Ge,[u("header",{class:ie(["flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[44px] px-2.5 fixed",{"bg-white":i(w)," bg-black/0":!i(w)}])},[u("div",{class:"flex flex-wrap items-center",onClick:z},Be),u("div",{onClick:s[0]||(s[0]=r=>i(a)(!0))},Ce)],2),L(Ie,{ref:(r,_)=>{_.goodsImgRef=r,y.value=r},imgs:(e.value.goodsIcons||"").split(","),goodsTypes:i(G).offeline},null,8,["imgs","goodsTypes"]),L(we,{stores:n.value,goods:e.value,class:"relative z-10"},null,8,["stores","goods"]),u("div",Oe,[L(Fe,{onHandleTo:h,goodsId:e.value.goodsId},null,8,["goodsId"]),n.value.id?(d(),g(N,{key:0,store:n.value,onHandleTo:h},null,8,["store"])):I("",!0),e.value.goodsDesc||e.value.goodsPics?(d(),g(_e,{key:1,text:e.value.goodsDesc,imgs:(e.value.goodsPics||"").split(",")},null,8,["text","imgs"])):I("",!0)]),e.value.goodsId?(d(),g(U,{key:0,goods:e.value,goodsId:e.value.goodsId,boutiqueFlag:e.value.goodsType>=i(be).SD,isFollow:T.value,deliveryType:i(G).offeline,storeInfo:n.value,onHandeToShop:s[1]||(s[1]=r=>h(`/category?deliveryType=1&shopId=${n.value.id}`)),onHandleConnect:s[2]||(s[2]=r=>{var _;return h(`/shopInfo?address=${(_=n.value)==null?void 0:_.merchant}`)}),onHandleOffine:s[3]||(s[3]=r=>E())},null,8,["goods","goodsId","boutiqueFlag","isFollow","deliveryType","storeInfo"])):I("",!0)])):e.value&&!i(ve)?(d(),g(Se,{key:1,type:"good"})):I("",!0),i(v)?(d(),g(V,{key:2,show:i(v),onOnSuceess:q,onClose:s[4]||(s[4]=r=>i(a)(!1)),goods:e.value,"code-url":i(O)},null,8,["show","goods","code-url"])):I("",!0)]))}const qe=B({...He,setup:Re}),mo=A(qe,[["__scopeId","data-v-64cc3f34"]]);export{mo as default};

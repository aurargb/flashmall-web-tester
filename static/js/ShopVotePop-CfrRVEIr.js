import{_ as G,y as Te,F as l,G as a,a2 as v,P as t,I as h,a0 as k,Q as i,X as Oe,R as I,bl as ze,w as je,x,r as D,bf as Ue,be as A,bj as Re,D as qe,E as B,K as y,N as Ie,H as o,O as C,J as Fe,a4 as Ke,$ as Xe,B as Ge,Y as He,Z as Je,T as N}from"./vendor-Ba70TIw4.js";import{_ as Qe}from"./member-BZWba7V1.js";import{S as We}from"./SkewCard-DeGtIyUY.js";import{S as Ye}from"./shop-CeqcS6K2.js";import{e as Ze,g as Ce,b as et,W as K,r as tt,bp as st}from"./index-DiRx6UeW.js";import{b as ot}from"./beiExtRewardContract-DuWrmGqG.js";import{q as nt,c as at,d as it}from"./beiRanking-ZPz4-w-m.js";import{b as lt}from"./beiConstContract-B6WRNL-U.js";const ut={key:0},ct=k("普通店铺"),rt=Te({props:{type:null,width:{default:125}},setup(f){return(b,P)=>(a(),l("div",{class:I(["tag-box text-right text-white font-semibold pr-5 pt-1 h-[75px] min-w-[120px]",`bg-${f.type||0}`]),style:Oe({width:`${f.width}px`})},[f.type!==void 0?(a(),l("span",ut,[f.type===t(Ye).SD?(a(),l(h,{key:0},[ct],64)):(a(),l(h,{key:1},[k(i(b.$t(`common.shop_type_${f.type}`))+"店铺",1)],64))])):v("",!0)],6))}}),dt=G(rt,[["__scopeId","data-v-ea5a823e"]]),ft={},vt={class:"points_wrapper"},pt=ze('<i class="point" data-v-66db05bc></i><i class="point" data-v-66db05bc></i><i class="point" data-v-66db05bc></i><i class="point" data-v-66db05bc></i><i class="point" data-v-66db05bc></i><i class="point" data-v-66db05bc></i><i class="point" data-v-66db05bc></i><i class="point" data-v-66db05bc></i><i class="point" data-v-66db05bc></i><i class="point" data-v-66db05bc></i>',10),mt=[pt];function ht(f,b){return a(),l("div",vt,mt)}const X=G(ft,[["render",ht],["__scopeId","data-v-66db05bc"]]),E=f=>(He("data-v-1132d4d2"),f=f(),Je(),f),bt={class:"relative m-auto text-sm font-normal font-Puhui"},_t={class:"relative z-0 p-3"},kt={class:"flex items-center gap-x-2"},gt={class:"relative"},wt={class:"-mt-5 w-[40px] border-[1px] border-solid border-white flex-center bg-yellow rounded-3xl mx-auto relative z-10"},xt=E(()=>o("img",{src:Qe,class:"w-4 h-4"},null,-1)),yt={class:"text-sm"},It={class:"flex flex-col gap-1 flex-1"},Ft={class:"text-base font-semibold line-clamp-1 name-width"},Ct={class:"text-b3 flex items-center"},Tt=["src"],Dt=E(()=>o("span",{class:"mx-1"},"|",-1)),Bt={class:"flex-1"},Et={class:"w-full h-[40px] bg-b5 rounded-full p-0.5 mt-4"},$t={class:"w-full h-full relative"},Lt={class:"absolute w-full h-full flex items-center justify-center left-0 top-0"},Vt=["onClick"],Mt={class:"mt-4 flex items-center bg-b5 p-3 rounded-[10px]"},St={class:"flex items-center gap-x-3"},At=["onClick"],Nt={class:"text-b3 mt-1 flex items-center"},Pt={key:0,class:"text-left text-b3 font-normal"},Ot={class:"flex items-center"},zt=E(()=>o("span",{class:"text-success"},"充电：",-1)),jt=k(" 当前电量已满无需充电 "),Ut=k(" 预计电量+"),Rt={key:1},qt={class:"flex items-center"},Kt=E(()=>o("span",{class:"text-error"},"放电：",-1)),Xt=k("预计电量-"),Gt={key:1},Ht={key:1,class:"flex-col w-full"},Jt={class:"flex-center-bw"},Qt={class:"flex items-center text-left"},Wt=E(()=>o("span",null,"测算结果",-1)),Yt=[Wt],Zt={key:0,class:"break-words"},es={class:"flex-center-bw mt-4 gap-x-3"},ts=["src"],ss=["src"],os=["src"],ns=Te({props:{show:{type:Boolean},shopId:null,teleport:null},emits:["close","voteSuccess","handleTo"],setup(f,{emit:b}){const{show:P,shopId:H,teleport:as}=f,{t:J}=je(),{contributesStore:O}=Ze(),{voteByPoint:De,voteByLp:Be,userVoteDetailView:Ee,voteMonthTimestampView:$e}=ot(),{userTotalLp:Le}=lt(),{loadingToggle:z}=tt(),$=x(()=>[{id:1,text:J("ranking.points_ticket")},{id:2,text:J("ranking.lp_ticket")}]),c=D(null),Ve=[.25,.5,.75],n=Ue({tab:1,votesInfo:{1:{total:0,sumUsed:0},2:{total:0,sumUsed:0}},estimateInfo:{coefficient:1,coefficientLikeBudget:1,coefficientNotLikeBudget:1,score:0,scoreLikeBudget:0,scoreNotLikeBudget:0,likeDiffer:0,notlikeDiffer:0,tickets:0},totalTimes:5,rewardTimes:5}),L=x(()=>n==null?void 0:n.votesInfo[n.tab]),T=x(()=>{var s;return Math.max(((s=L.value)==null?void 0:s.total)-(L==null?void 0:L.value.sumUsed),0)}),r=D(null),Q=D(null),W=D(null),[g,j]=A(!0),[d,_]=A(!1),[Y,Z]=A(!1),[ee,te]=A(!1),U=x(()=>{var s;return Math.min(Math.abs(Math.min(((s=c.value)==null?void 0:s.lpTicket)||0,0)),T.value||0)}),se=x(()=>{var s,e;return Math.min(+((s=c.value)==null?void 0:s.pointTicket)*10-Math.abs((e=c.value)==null?void 0:e.lpTicket),T.value||0)}),oe=x(()=>r.value&&r.value>U.value),ne=x(()=>r.value&&r.value>se.value),p=D(null),ae=s=>{g.value||d.value||(r.value=Math.floor(new Ge(T.value).times(s).toNumber()))},R=()=>{z(!1),b("close")},Me=s=>{+n.tab==+s||d.value||(r.value=null,n.estimateInfo.tickets=0,n.tab=s)},Se=async()=>{const{result:s}=await $e();W.value=+s.thisMonthTime},Ae=async()=>{z(!0);const{success:s,data:e}=await nt({shopId:H,month:st()});s&&(z(!1),c.value=e)},ie=async()=>{if(n.tab===1)return;if(r.value<=0){n.estimateInfo.tickets=0;return}te(!0);const{success:s,data:e}=await at(H,r.value);s&&(n.estimateInfo=e,n.estimateInfo.tickets=r.value,n.estimateInfo.likeDiffer=Math.abs((e==null?void 0:e.scoreLikeBudget)-(e==null?void 0:e.score)),n.estimateInfo.notlikeDiffer=Math.abs((e==null?void 0:e.scoreNotLikeBudget)-(e==null?void 0:e.score))||0,te(!1))},le=async()=>{var m;if(!Number(r.value)||+r.value<=0)return N({message:"请输入投票数",duration:2e3}),!1;if(+r.value>+T.value)return N({message:"超过可投数量",duration:2e3}),!1;const{success:s,data:e}=await it((m=c.value)==null?void 0:m.shopId);return s||N({message:"网络异常～",duration:2e3}),s&&!e&&N({message:"当前店铺无法投票请联系店家确认",duration:2e3}),e},Ne=async()=>{var e;if(g.value||d.value)return;if(_(!0),!await le()){_(!1);return}p.value=null,_(!0);const{success:s}=await De((e=c.value)==null?void 0:e.shopId,r.value);_(!1),s&&(console.log(+n.rewardTimes,+n.totalTimes),b("close"),b("voteSuccess",{direct:200,differ:+r.value},+n.rewardTimes<+n.totalTimes))},ue=async s=>{var m,V,M,F,S,w;if(g.value||d.value||s===200&&oe.value||s===400&&ne.value)return;if(_(!0),!await le()){_(!1);return}_(!0),p.value=s,((m=n.estimateInfo)==null?void 0:m.tickets)!==r.value&&await ie();const{success:e}=await Be((V=c.value)==null?void 0:V.shopId,r.value,s);_(!1),e&&(b("close"),b("voteSuccess",{direct:s,differ:s===200?(M=n.estimateInfo)==null?void 0:M.likeDiffer:(F=n.estimateInfo)==null?void 0:F.notlikeDiffer,score:s===200?(S=n.estimateInfo)==null?void 0:S.scoreLikeBudget:(w=n.estimateInfo)==null?void 0:w.scoreNotLikeBudget},+n.rewardTimes<+n.totalTimes))},Pe=async()=>{j(!0),await Se();const{success:s,result:e}=await Ee(W.value);n.rewardTimes=+(e==null?void 0:e.times),n.votesInfo[1]={total:Math.min(Math.floor(O.contributes/1e3),500),sumUsed:+(e==null?void 0:e.sumTickets)},console.log("rewardTimes :",+(e==null?void 0:e.times)),console.log("contributes :",O.contributes),console.log("sumTickets :",+(e==null?void 0:e.sumTickets)),console.log("votesInfo:",n.votesInfo[1]),s&&j(!1);const m=Math.floor(+await Le());j(!1),n.votesInfo[2]={total:+m,sumUsed:+(e==null?void 0:e.sumLp)}},ce=s=>{(s.key==="Enter"||s.key==="Escape")&&Q.value.blur()};return Re(()=>{window.removeEventListener("keydown",ce)}),qe(async()=>{window.addEventListener("keydown",ce),Ae(),await O.fetchContributes(),Pe()}),(s,e)=>{const m=B("van-icon"),V=B("VanImage"),M=B("VanField"),F=B("VanLoading"),S=B("VanPopup");return a(),y(S,{show:f.show,"onUpdate:show":e[7]||(e[7]=w=>Xe(P)?P.value=w:null),teleport:f.teleport,onClickOverlay:Ke(R,["stop"]),onClose:R,round:"",class:"bg-transparent position-center",style:{"min-width":"280px","max-width":"350px",width:"85%"}},{default:Ie(()=>[o("div",bt,[o("div",{class:"text-right text-b6 ml-auto text-lg font-bold h-6 flex items-start justify-end",onClick:R},[C(m,{name:"cross"})]),C(We,{width:"210",right:"26"},{default:Ie(()=>{var w,re,de,fe,ve,pe,me,he,be,_e,ke,ge,we,xe,ye;return[C(dt,{class:"absolute right-1.5 top-1.5 -z-20",type:(w=c.value)==null?void 0:w.type},null,8,["type"]),o("div",_t,[o("div",kt,[o("div",gt,[C(V,{round:"",src:(((re=c.value)==null?void 0:re.logo)||"").split(",")[0],errorIcon:t(Ce)("images/ranking/noPosition.png"),fit:"cover",width:"46px",height:"46px"},null,8,["src","errorIcon"]),o("div",wt,[xt,o("span",yt,"V"+i((de=c.value)==null?void 0:de.memberLevel),1)])]),o("div",It,[o("div",Ft,i((fe=c.value)==null?void 0:fe.storeName),1),o("div",Ct,[o("span",null,i(t(et)((ve=c.value)==null?void 0:ve.shopAddress,"**",0,4)),1),(pe=c.value)!=null&&pe.authorizeAddress?(a(),l("img",{key:0,src:t(Ce)("images/ranking/auth.svg"),class:"w-4 h-4"},null,8,Tt)):v("",!0),Dt,o("span",null,i(s.$t("ranking.battery"))+i(((me=c.value)==null?void 0:me.score)||0),1),o("div",{class:"text-newOrigin pl-1",onClick:e[0]||(e[0]=u=>t(Z)(!t(Y)))},i(s.$t("user.feedbackDetail")),1)])])]),o("div",{class:I(["bg-[#FF88121F] text-newOrigin rounded px-2 flex items-center justify-between overflow-hidden transition-all duration-300",t(Y)?"py-0.5 min-h-[56px] border border-newOrigin mt-1":"h-0 mt-0"]),onClick:e[1]||(e[1]=u=>t(Z)(!1))},[o("div",Bt,[o("div",null,"当前 LP 票总计："+i(+((he=c.value)==null?void 0:he.lpTicket))+"票",1),o("div",null,i(+((be=c.value)==null?void 0:be.pointTicket))+i(s.$t("ranking.points_ticket"))+" - "+i(Math.floor(Math.abs((_e=c.value)==null?void 0:_e.lpTicket)*(((ke=c.value)==null?void 0:ke.coefficient)||.1)))+"放电量 = "+i((ge=c.value)==null?void 0:ge.score)+i(s.$t("ranking.battery")),1)]),o("div",null,[C(m,{name:"cross"})])],2),o("div",Et,[o("div",$t,[o("div",{class:I(["absolute w-[50%] h-full bg-b1 rounded-full left-0 transition-all duration-300",`w-[${100/t($).length}%] left-${t($).findIndex(u=>u.id===t(n).tab)||0}/${t($).length}`])},null,2),o("div",Lt,[(a(!0),l(h,null,Fe(t($),u=>(a(),l("div",{class:"w-[50%] h-full flex items-center justify-center overflow-hidden",onClick:q=>Me(u.id),key:u.id},[o("span",{class:I(["text-sm text-center line-clamp-1 transition-all duration-300",[t(n).tab===u.id?"text-b6 font-semibold":"text-b3 font-normal"]])},i(u.text),3)],8,Vt))),128))])])]),o("div",Mt,[C(M,{type:"digit",modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=u=>r.value=u),placeholder:"0",ref:(u,q)=>{q.amountInputRef=u,Q.value=u}},null,8,["modelValue"]),o("div",St,[t(n).tab===1?(a(),l(h,{key:0},[(a(),l(h,null,Fe(Ve,u=>o("div",{class:"shrink-0 w-fit text-newOrigin px-0.5",key:u,onClick:q=>ae(u)},i(u*100)+"% ",9,At)),64)),o("div",{class:"shrink-0 w-fit text-newOrigin",onClick:e[3]||(e[3]=u=>ae(1))}," MAX ")],64)):v("",!0)])]),o("div",Nt,[+t(n).tab==2&&((we=t(n).estimateInfo)==null?void 0:we.tickets)>0?(a(),l("div",Pt,[o("div",Ot,[zt,t(U)<=0?(a(),l(h,{key:0},[jt],64)):(a(),l(h,{key:1},[Ut,t(ee)?(a(),y(F,{key:0,size:"12"})):(a(),l("span",Rt,i((xe=t(n).estimateInfo)==null?void 0:xe.likeDiffer),1))],64))]),o("div",qt,[Kt,Xt,t(ee)?(a(),y(F,{key:0,size:"12"})):(a(),l("span",Gt,i((ye=t(n).estimateInfo)==null?void 0:ye.notlikeDiffer),1))])])):(a(),l("div",Ht,[o("div",Jt,[o("div",Qt,[k(i(s.$t("ranking.remain_ticket")),1),t(g)?(a(),y(F,{key:0,size:"10"})):(a(),l(h,{key:1},[k(i(t(T)),1)],64)),k(i(t(n).tab===1?s.$t("ranking.points_ticket"):s.$t("ranking.lp_ticket")),1)]),t(n).tab===2&&r.value>0?(a(),l("div",{key:0,class:"pl-1.5 ml-auto text-newOrigin min-w-fit",onClick:ie},Yt)):v("",!0)]),t(n).tab===2?(a(),l("div",Zt," 最大可放电"+i(t(se))+"票数,最大可充电"+i(t(U))+"票数 ",1)):v("",!0)]))]),o("div",es,[t(n).tab===1?(a(),l("div",{key:0,class:I(["btn-power text-b6 w-full h-[46px] rounded-full border-none text-base font-semibold flex items-center justify-center",{"opacity-60":t(g)}]),onClick:e[4]||(e[4]=u=>Ne())},[t(d)?v("",!0):(a(),l("img",{key:0,src:t(K)("charge.svg"),class:"w-[18px] h-[18px]"},null,8,ts)),o("span",null,i(t(d)?"充电中":"充电"),1),t(d)?(a(),y(X,{key:1})):v("",!0)],2)):(a(),l(h,{key:1},[o("div",{class:I(["btn-discharge text-b6 w-full h-[46px] rounded-full border-none text-base font-semibold flex items-center justify-center",{"opacity-60":t(ne)||t(g)||t(d)&&+p.value!=400}]),onClick:e[5]||(e[5]=u=>ue(400))},[t(d)&&+p.value==400?v("",!0):(a(),l("img",{key:0,src:t(K)("discharge.svg"),class:"w-[18px] h-[18px]"},null,8,ss)),o("span",null,i(t(d)&&+p.value==400?"放电中":"放电"),1),t(d)&&+p.value==400?(a(),y(X,{key:1})):v("",!0)],2),o("div",{class:I(["btn-power text-b6 w-full h-[46px] rounded-full border-none text-base font-semibold flex items-center justify-center",{"opacity-60":t(oe)||t(g)||t(d)&&+p.value!=200}]),onClick:e[6]||(e[6]=u=>ue(200))},[t(d)&&+p.value==200?v("",!0):(a(),l("img",{key:0,src:t(K)("charge.svg"),class:"w-[18px] h-[18px]"},null,8,os)),o("span",null,i(t(d)&&+p.value==200?"充电中":"充电"),1),t(d)&&+p.value==200?(a(),y(X,{key:1})):v("",!0)],2)],64))])])]}),_:1})])]),_:1},8,["show","teleport","onClickOverlay"])}}}),ps=G(ns,[["__scopeId","data-v-1132d4d2"]]);export{ps as S,dt as a};

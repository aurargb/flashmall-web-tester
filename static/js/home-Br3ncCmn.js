import{a as st,_ as ot}from"./2year-DDqfglUX.js";import{_ as at}from"./adpng-DGFmXgre.js";import{_ as B,F as v,G as u,H as o,Q as nt,Y as W,Z as U,y as it,l as rt,a1 as ct,bw as C,r as A,x as lt,bh as mt,E as T,O as I,K as G,a2 as Y,X as dt,N as D,I as E,J as H,P as f,aH as ut,o as h,T as d}from"./vendor-Ba70TIw4.js";import{u as pt,e as ft,h as R}from"./index-DiRx6UeW.js";import{G as _t}from"./goodsItem-Doab2JPt.js";import{c as gt,a as ht,h as vt,i as yt}from"./festivalActivities-D2J2XWoL.js";import{_ as M}from"./EmptyTipsPop-BnhhUp92.js";import"./MCOIN-Bodfn-v1.js";import"./cart-DpaReRSb.js";const wt=""+new URL("../images/cloud-Bm1cgOa4.png",import.meta.url).href,xt=""+new URL("../images/more-E9N74XOk.svg",import.meta.url).href,bt=""+new URL("../images/left-flash-COSh5QZ9.svg",import.meta.url).href,kt=""+new URL("../images/right-flash-DBRaslZc.svg",import.meta.url).href,j=l=>(W("data-v-67fd3e7e"),l=l(),U(),l),Ct={class:"tag__wrap"},At=j(()=>o("img",{src:bt,alt:""},null,-1)),It={class:"text-b6 text-base font-semibold leading-4"},Gt=j(()=>o("img",{src:kt,alt:""},null,-1)),$t={props:{name:{type:String,default:""}},setup(l){return(g,k)=>(u(),v("div",Ct,[At,o("span",It,nt(l.name),1),Gt]))}},Lt=B($t,[["__scopeId","data-v-67fd3e7e"]]),_=l=>(W("data-v-5d6f14df"),l=l(),U(),l),St={class:"active-container"},Tt=_(()=>o("img",{class:"header-bottom",src:wt},null,-1)),Yt=_(()=>o("img",{class:"w-[22px] h-[22px]",src:st,alt:"返回"},null,-1)),Dt=[Yt],Et={class:"body__wrap"},Ht=_(()=>o("span",{class:"text-[20px] text-b6 font-Puhui"}," 我要报名 ",-1)),Rt={class:"goods-list-container"},Mt={class:"goods-grid"},Bt=["onClick"],Wt=_(()=>o("span",{class:"text-[#FF8812] text-sm font-normal"},"查看更多",-1)),Ut=_(()=>o("img",{src:xt,class:"w-5 h-5"},null,-1)),jt=[Wt,Ut],qt=_(()=>o("div",{class:"px-[65px] w-full flex justify-center items-center pt-5"},[o("img",{class:"logo-2-year",src:ot,alt:"2周年"})],-1)),Nt=_(()=>o("img",{src:at,alt:"广告"},null,-1)),Ot=[Nt],Pt=it({name:"520Home"});function Ft(l){pt();const g=rt(),k=ct(),[q,$]=C(!1),[N,L]=C(!1),[O,S]=C(),m=A({fmGeneralActivity:{},fmGeneralActivityLabelList:[],fmGeneralActivityRule:{}}),{accountStore:P}=ft();lt(()=>P.store.id);const F=async()=>{const e={generalActivityId:1};try{const t=await ht(e);t.code==1?(m.value=t.data,V(),Z(),J()):t.message&&d(t.message)}catch(t){console.error("获取活动信息失败:",t),d("获取活动信息失败")}},J=()=>{var a,s;const e=h(),t=h((s=(a=m.value)==null?void 0:a.fmGeneralActivity)==null?void 0:s.endTime);e.isAfter(t)&&L(!0)},V=()=>{var t,a;const e=(a=(t=m.value)==null?void 0:t.fmGeneralActivity)==null?void 0:a.name;e&&(document.title=e)},y=A({}),Z=()=>{var t,a,s,n;const e=((a=(t=m.value)==null?void 0:t.fmGeneralActivity)==null?void 0:a.activityMallImgs)||((n=(s=m.value)==null?void 0:s.fmGeneralActivity)==null?void 0:n.activityMainImgs)||"";if(e){const r=e.split(",")[0];y.value={backgroundImage:`url(${r})`};const c=new Image;c.onload=()=>{const i=c.naturalWidth,p=c.naturalHeight;if(i>0&&p>0){const x=document.documentElement.clientWidth>=375?375:document.documentElement.clientWidth,b=p/i*x;y.value={...y.value,height:`${b}px`}}},c.onerror=()=>{console.log("活动主图图片加载失败")},c.src=r}},w=A([]),z=async()=>{try{const e=await vt();if(e.code==1&&e.data){const t=e.data||[],a=await Promise.all(t.map(async s=>{var r,c;const n={generalActivityId:((c=(r=m.value)==null?void 0:r.fmGeneralActivity)==null?void 0:c.id)||1,generalActivityClassifyId:s.id,status:2};try{const i=await yt(n);if(i.code==1&&i.data){const p=i.data.slice(0,4)||[];return{...s,goodsList:p}}else return i.message&&i.code!==1&&console.warn(`获取分类 ${s.name} 商品列表提示: ${i.message}`),{...s,goodsList:[]}}catch(i){return console.error(`获取分类 ${s.name} 的商品列表失败:`,i),{...s,goodsList:[]}}}));w.value=a.filter(s=>s.goodsList&&s.goodsList.length>0)}else e.message&&d(e.message),w.value=[]}catch(e){console.error("获取分类或商品列表过程中发生错误:",e),d("加载数据失败"),w.value=[]}},Q=()=>{const e="https://metakey.pro/invite?code=cngkfc1i";R(e),ut.confirm({title:"群聊链接",message:"群聊链接已复制，请在手机浏览器打开",showCancelButton:!1}).then(()=>{R(e)})},X=e=>{const t={...e};Reflect.deleteProperty(t,"goodsList"),g.push({path:"520-classify",query:{id:t.id,name:t.name}})},K=()=>{var e,t;((t=(e=window.history)==null?void 0:e.state)==null?void 0:t.back)===null?g.replace({path:"/"}):g.back()},tt=async()=>{var s,n,r,c,i,p,x,b;const e={needlogin:"true",...k.query};g.replace({path:k.path,query:e});const t=new Date().getTime();if(console.log("当前时间",h(t).format("YYYY-MM-DD HH:mm:ss")),console.log("后台配置的报名开始时间",h((n=(s=m.value)==null?void 0:s.fmGeneralActivity)==null?void 0:n.applyStartTime).format("YYYY-MM-DD HH:mm:ss")),console.log("后台配置的报名结束时间",h((c=(r=m.value)==null?void 0:r.fmGeneralActivity)==null?void 0:c.applyEndTime).format("YYYY-MM-DD HH:mm:ss")),t<((p=(i=m.value)==null?void 0:i.fmGeneralActivity)==null?void 0:p.applyStartTime)){d("报名时间未开始");return}if(t>((b=(x=m.value)==null?void 0:x.fmGeneralActivity)==null?void 0:b.applyEndTime)){d("报名时间已结束");return}d.loading({message:"查询中..."});const a=await gt();if(a.code==1&&!a.data){d.clear(),S(!0);return}else a.code==1&&a.data&&setTimeout(()=>{d.clear(),g.push({path:"/520-index",query:{from:"fm"}})},500)},et=async()=>{await F()};return mt(()=>{z()}),et(),(e,t)=>{const a=T("van-button"),s=T("van-overlay");return u(),v("div",St,[o("div",{class:"header__wrap",style:dt(y.value)},[o("div",{class:"join-im-btn",onClick:Q},"活动讨论"),Tt,o("div",{class:"back-arrow w-[22px] h-[22px] absolute top-[11px] left-[9px]",onClick:K},Dt)],4),o("div",Et,[o("div",{class:"btn__wrap w-full",onClick:tt},[I(a,{class:"submit-btn"},{default:D(()=>[Ht]),_:1})]),(u(!0),v(E,null,H(w.value,n=>(u(),v("div",{class:"classify-group pb-3 pt-9",key:n.id},[I(Lt,{name:n.name},null,8,["name"]),o("div",Rt,[o("div",Mt,[(u(!0),v(E,null,H(n.goodsList,r=>(u(),G(_t,{key:r.id,goods:r},null,8,["goods"]))),128))])]),o("div",{class:"view-more-btn flex justify-center items-center mt-2",onClick:r=>X(n)},jt,8,Bt)]))),128)),qt]),I(s,{show:f(q),onClick:t[1]||(t[1]=n=>f($)(!1)),"z-index":"9999"},{default:D(()=>[o("div",{class:"ad-img-container",onClick:t[0]||(t[0]=n=>f($)(!1))},Ot)]),_:1},8,["show"]),f(N)?(u(),G(M,{key:0,isError:!0,onClose:t[2]||(t[2]=n=>f(L)(!1)),text:"很遗憾，活动已过期"})):Y("",!0),f(O)?(u(),G(M,{key:1,isError:!0,onClose:t[3]||(t[3]=n=>f(S)(!1)),text:"很遗憾根据您店铺以往数据综合评估暂不符合报名资质要求"})):Y("",!0)])}}const Jt=Object.assign(Pt,{setup:Ft}),oe=B(Jt,[["__scopeId","data-v-5d6f14df"]]);export{oe as default};
